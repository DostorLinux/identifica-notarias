(self.webpackChunkidentifica=self.webpackChunkidentifica||[]).push([[179],{416:(ed,td,xo)=>{"use strict";var ki={};xo.r(ki),xo.d(ki,{AnchorPosition:()=>ts,DrawBox:()=>H6,DrawBoxOptions:()=>U6,DrawTextField:()=>HC,DrawTextFieldOptions:()=>UC});var il={};function Ze(n){return"function"==typeof n}function kn(n){const t=n(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}xo.r(il),xo.d(il,{DrawFaceLandmarks:()=>r5,DrawFaceLandmarksOptions:()=>n5,drawContour:()=>Ku,drawDetections:()=>C2e,drawFaceExpressions:()=>R2e,drawFaceLandmarks:()=>k2e});const $s=kn(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function va(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class gr{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const i of t)i.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Ze(r))try{r()}catch(i){e=i instanceof $s?i.errors:[i]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const i of o)try{ma(i)}catch(a){e=e??[],a instanceof $s?e=[...e,...a.errors]:e.push(a)}}if(e)throw new $s(e)}}add(e){var t;if(e&&e!==this)if(this.closed)ma(e);else{if(e instanceof gr){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&va(t,e)}remove(e){const{_finalizers:t}=this;t&&va(t,e),e instanceof gr&&e._removeParent(this)}}gr.EMPTY=(()=>{const n=new gr;return n.closed=!0,n})();const qs=gr.EMPTY;function al(n){return n instanceof gr||n&&"closed"in n&&Ze(n.remove)&&Ze(n.add)&&Ze(n.unsubscribe)}function ma(n){Ze(n)?n():n.unsubscribe()}const hi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Fi={setTimeout(n,e,...t){const{delegate:r}=Fi;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Fi;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function yn(n){Fi.setTimeout(()=>{const{onUnhandledError:e}=hi;if(!e)throw n;e(n)})}function zt(){}const jn=Xs("C",void 0,void 0);function Xs(n,e,t){return{kind:n,value:e,error:t}}let Wo=null;function Wp(n){if(hi.useDeprecatedSynchronousErrorHandling){const e=!Wo;if(e&&(Wo={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:r}=Wo;if(Wo=null,t)throw r}}else n()}class s1 extends gr{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,al(e)&&e.add(this)):this.destination=T5}static create(e,t,r){return new nd(e,t,r)}next(e){this.isStopped?c1(function _o(n){return Xs("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?c1(function wo(n){return Xs("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?c1(jn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const A5=Function.prototype.bind;function u1(n,e){return A5.call(n,e)}class I5{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){Gp(r)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){Gp(r)}else Gp(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Gp(t)}}}class nd extends s1{constructor(e,t,r){let o;if(super(),Ze(e)||!e)o={next:e??void 0,error:t??void 0,complete:r??void 0};else{let i;this&&hi.useDeprecatedNextContext?(i=Object.create(e),i.unsubscribe=()=>this.unsubscribe(),o={next:e.next&&u1(e.next,i),error:e.error&&u1(e.error,i),complete:e.complete&&u1(e.complete,i)}):o=e}this.destination=new I5(o)}}function Gp(n){hi.useDeprecatedSynchronousErrorHandling?function S5(n){hi.useDeprecatedSynchronousErrorHandling&&Wo&&(Wo.errorThrown=!0,Wo.error=n)}(n):yn(n)}function c1(n,e){const{onStoppedNotification:t}=hi;t&&Fi.setTimeout(()=>t(n,e))}const T5={closed:!0,next:zt,error:function D5(n){throw n},complete:zt},l1="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ks(n){return n}function bE(n){return 0===n.length?Ks:1===n.length?n[0]:function(t){return n.reduce((r,o)=>o(r),t)}}let In=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,o){const i=function O5(n){return n&&n instanceof s1||function N5(n){return n&&Ze(n.next)&&Ze(n.error)&&Ze(n.complete)}(n)&&al(n)}(t)?t:new nd(t,r,o);return Wp(()=>{const{operator:a,source:s}=this;i.add(a?a.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=CE(r))((o,i)=>{const a=new nd({next:s=>{try{t(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});this.subscribe(a)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[l1](){return this}pipe(...t){return bE(t)(this)}toPromise(t){return new(t=CE(t))((r,o)=>{let i;this.subscribe(a=>i=a,a=>o(a),()=>r(i))})}}return n.create=e=>new n(e),n})();function CE(n){var e;return null!==(e=n??hi.Promise)&&void 0!==e?e:Promise}const M5=kn(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Li=(()=>{class n extends In{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new EE(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new M5}next(t){Wp(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Wp(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Wp(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:o,observers:i}=this;return r||o?qs:(this.currentObservers=null,i.push(t),new gr(()=>{this.currentObservers=null,va(i,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:o,isStopped:i}=this;r?t.error(o):i&&t.complete()}asObservable(){const t=new In;return t.source=this,t}}return n.create=(e,t)=>new EE(e,t),n})();class EE extends Li{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)}error(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:qs}}function SE(n){return Ze(n?.lift)}function rr(n){return e=>{if(SE(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fn(n,e,t,r,o){return new P5(n,e,t,r,o)}class P5 extends s1{constructor(e,t,r,o,i,a){super(e),this.onFinalize=i,this.shouldUnsubscribe=a,this._next=t?function(s){try{t(s)}catch(u){e.error(u)}}:super._next,this._error=o?function(s){try{o(s)}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(s){e.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function $e(n,e){return rr((t,r)=>{let o=0;t.subscribe(Fn(r,i=>{r.next(n.call(e,i,o++))}))})}function Yu(n){return this instanceof Yu?(this.v=n,this):new Yu(n)}function B5(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function DE(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(a){return new Promise(function(s,u){!function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}(s,u,(a=n[i](a)).done,a.value)})}}}const TE=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function RE(n){return Ze(n?.then)}function NE(n){return Ze(n[l1])}function OE(n){return Symbol.asyncIterator&&Ze(n?.[Symbol.asyncIterator])}function ME(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const PE=function U5(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function kE(n){return Ze(n?.[PE])}function FE(n){return function L5(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=t.apply(n,e||[]),i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(d){r[d]&&(o[d]=function(h){return new Promise(function(p,g){i.push([d,h,p,g])>1||s(d,h)})})}function s(d,h){try{!function u(d){d.value instanceof Yu?Promise.resolve(d.value.v).then(c,l):f(i[0][2],d)}(r[d](h))}catch(p){f(i[0][3],p)}}function c(d){s("next",d)}function l(d){s("throw",d)}function f(d,h){d(h),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:r,done:o}=yield Yu(t.read());if(o)return yield Yu(void 0);yield yield Yu(r)}}finally{t.releaseLock()}})}function LE(n){return Ze(n?.getReader)}function Go(n){if(n instanceof In)return n;if(null!=n){if(NE(n))return function H5(n){return new In(e=>{const t=n[l1]();if(Ze(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(TE(n))return function W5(n){return new In(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(RE(n))return function G5(n){return new In(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,yn)})}(n);if(OE(n))return BE(n);if(kE(n))return function z5(n){return new In(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(LE(n))return function j5(n){return BE(FE(n))}(n)}throw ME(n)}function BE(n){return new In(e=>{(function $5(n,e){var t,r,o,i;return function k5(n,e,t,r){return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):function o(i){return i instanceof t?i:new t(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=B5(n);!(r=yield t.next()).done;)if(e.next(r.value),e.closed)return}catch(a){o={error:a}}finally{try{r&&!r.done&&(i=t.return)&&(yield i.call(t))}finally{if(o)throw o.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function as(n,e,t,r=0,o=!1){const i=e.schedule(function(){t(),o?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(i),!o)return i}function Er(n,e,t=1/0){return Ze(e)?Er((r,o)=>$e((i,a)=>e(r,i,o,a))(Go(n(r,o))),t):("number"==typeof e&&(t=e),rr((r,o)=>function q5(n,e,t,r,o,i,a,s){const u=[];let c=0,l=0,f=!1;const d=()=>{f&&!u.length&&!c&&e.complete()},h=g=>c<r?p(g):u.push(g),p=g=>{i&&e.next(g),c++;let v=!1;Go(t(g,l++)).subscribe(Fn(e,m=>{o?.(m),i?h(m):e.next(m)},()=>{v=!0},void 0,()=>{if(v)try{for(c--;u.length&&c<r;){const m=u.shift();a?as(e,a,()=>p(m)):p(m)}d()}catch(m){e.error(m)}}))};return n.subscribe(Fn(e,h,()=>{f=!0,d()})),()=>{s?.()}}(r,o,n,t)))}function sl(n=1/0){return Er(Ks,n)}const Bi=new In(n=>n.complete());function VE(n){return n&&Ze(n.schedule)}function d1(n){return n[n.length-1]}function UE(n){return Ze(d1(n))?n.pop():void 0}function rd(n){return VE(d1(n))?n.pop():void 0}function HE(n,e=0){return rr((t,r)=>{t.subscribe(Fn(r,o=>as(r,n,()=>r.next(o),e),()=>as(r,n,()=>r.complete(),e),o=>as(r,n,()=>r.error(o),e)))})}function WE(n,e=0){return rr((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function GE(n,e){if(!n)throw new Error("Iterable cannot be null");return new In(t=>{as(t,e,()=>{const r=n[Symbol.asyncIterator]();as(t,e,()=>{r.next().then(o=>{o.done?t.complete():t.next(o.value)})},0,!0)})})}function Dn(n,e){return e?function tV(n,e){if(null!=n){if(NE(n))return function Y5(n,e){return Go(n).pipe(WE(e),HE(e))}(n,e);if(TE(n))return function Q5(n,e){return new In(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}(n,e);if(RE(n))return function Z5(n,e){return Go(n).pipe(WE(e),HE(e))}(n,e);if(OE(n))return GE(n,e);if(kE(n))return function J5(n,e){return new In(t=>{let r;return as(t,e,()=>{r=n[PE](),as(t,e,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(a){return void t.error(a)}i?t.complete():t.next(o)},0,!0)}),()=>Ze(r?.return)&&r.return()})}(n,e);if(LE(n))return function eV(n,e){return GE(FE(n),e)}(n,e)}throw ME(n)}(n,e):Go(n)}function zE(n={}){const{connector:e=(()=>new Li),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=n;return i=>{let a,s,u,c=0,l=!1,f=!1;const d=()=>{s?.unsubscribe(),s=void 0},h=()=>{d(),a=u=void 0,l=f=!1},p=()=>{const g=a;h(),g?.unsubscribe()};return rr((g,v)=>{c++,!f&&!l&&d();const m=u=u??e();v.add(()=>{c--,0===c&&!f&&!l&&(s=h1(p,o))}),m.subscribe(v),!a&&c>0&&(a=new nd({next:y=>m.next(y),error:y=>{f=!0,d(),s=h1(h,t,y),m.error(y)},complete:()=>{l=!0,d(),s=h1(h,r),m.complete()}}),Go(g).subscribe(a))})(i)}}function h1(n,e,...t){if(!0===e)return void n();if(!1===e)return;const r=new nd({next:()=>{r.unsubscribe(),n()}});return Go(e(...t)).subscribe(r)}function rn(n){for(let e in n)if(n[e]===rn)return e;throw Error("Could not find renamed property on target object.")}function p1(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function on(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(on).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function g1(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const rV=rn({__forward_ref__:rn});function an(n){return n.__forward_ref__=an,n.toString=function(){return on(this())},n}function We(n){return v1(n)?n():n}function v1(n){return"function"==typeof n&&n.hasOwnProperty(rV)&&n.__forward_ref__===an}function m1(n){return n&&!!n.\u0275providers}const jE="https://g.co/ng/security#xss";class ie extends Error{constructor(e,t){super(zp(e,t)),this.code=e}}function zp(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}function Je(n){return"string"==typeof n?n:null==n?"":String(n)}function jp(n,e){throw new ie(-201,!1)}function pi(n,e){null==n&&function $t(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function Ae(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function no(n){return{providers:n.providers||[],imports:n.imports||[]}}function $p(n){return $E(n,qp)||$E(n,XE)}function $E(n,e){return n.hasOwnProperty(e)?n[e]:null}function qE(n){return n&&(n.hasOwnProperty(y1)||n.hasOwnProperty(dV))?n[y1]:null}const qp=rn({\u0275prov:rn}),y1=rn({\u0275inj:rn}),XE=rn({ngInjectableDef:rn}),dV=rn({ngInjectorDef:rn});var Ge=(()=>((Ge=Ge||{})[Ge.Default=0]="Default",Ge[Ge.Host=1]="Host",Ge[Ge.Self=2]="Self",Ge[Ge.SkipSelf=4]="SkipSelf",Ge[Ge.Optional=8]="Optional",Ge))();let x1;function gi(n){const e=x1;return x1=n,e}function KE(n,e,t){const r=$p(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Ge.Optional?null:void 0!==e?e:void jp(on(n))}const dn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),od={},w1="__NG_DI_FLAG__",Xp="ngTempTokenPath",pV="ngTokenPath",gV=/\n/gm,vV="\u0275",YE="__source";let id;function ul(n){const e=id;return id=n,e}function mV(n,e=Ge.Default){if(void 0===id)throw new ie(-203,!1);return null===id?KE(n,void 0,e):id.get(n,e&Ge.Optional?null:void 0,e)}function me(n,e=Ge.Default){return(function hV(){return x1}()||mV)(We(n),e)}function ft(n,e=Ge.Default){return me(n,Kp(e))}function Kp(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function _1(n){const e=[];for(let t=0;t<n.length;t++){const r=We(n[t]);if(Array.isArray(r)){if(0===r.length)throw new ie(900,!1);let o,i=Ge.Default;for(let a=0;a<r.length;a++){const s=r[a],u=yV(s);"number"==typeof u?-1===u?o=s.token:i|=u:o=s}e.push(me(o,i))}else e.push(me(r))}return e}function ad(n,e){return n[w1]=e,n.prototype[w1]=e,n}function yV(n){return n[w1]}function ss(n){return{toString:n}.toString()}var ya=(()=>((ya=ya||{})[ya.OnPush=0]="OnPush",ya[ya.Default=1]="Default",ya))(),xa=(()=>{return(n=xa||(xa={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",xa;var n})();const us={},Bt=[],Yp=rn({\u0275cmp:rn}),b1=rn({\u0275dir:rn}),C1=rn({\u0275pipe:rn}),QE=rn({\u0275mod:rn}),cs=rn({\u0275fac:rn}),sd=rn({__NG_ELEMENT_ID__:rn});let _V=0;function Vi(n){return ss(()=>{const e=eS(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===ya.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,data:n.data||{},encapsulation:n.encapsulation||xa.Emulated,id:"c"+_V++,styles:n.styles||Bt,_:null,schemas:n.schemas||null,tView:null};tS(t);const r=n.dependencies;return t.directiveDefs=Zp(r,!1),t.pipeDefs=Zp(r,!0),t})}function CV(n){return qt(n)||Vr(n)}function EV(n){return null!==n}function bo(n){return ss(()=>({type:n.type,bootstrap:n.bootstrap||Bt,declarations:n.declarations||Bt,imports:n.imports||Bt,exports:n.exports||Bt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function JE(n,e){if(null==n)return us;const t={};for(const r in n)if(n.hasOwnProperty(r)){let o=n[r],i=o;Array.isArray(o)&&(i=o[1],o=o[0]),t[o]=r,e&&(e[o]=i)}return t}function je(n){return ss(()=>{const e=eS(n);return tS(e),e})}function Co(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function qt(n){return n[Yp]||null}function Vr(n){return n[b1]||null}function Eo(n){return n[C1]||null}function jo(n,e){const t=n[QE]||null;if(!t&&!0===e)throw new Error(`Type ${on(n)} does not have '\u0275mod' property.`);return t}function eS(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,exportAs:n.exportAs||null,standalone:!0===n.standalone,selectors:n.selectors||Bt,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:JE(n.inputs,e),outputs:JE(n.outputs)}}function tS(n){n.features?.forEach(e=>e(n))}function Zp(n,e){if(!n)return null;const t=e?Eo:CV;return()=>("function"==typeof n?n():n).map(r=>t(r)).filter(EV)}const ls=0,ye=1,at=2,Tn=3,Ui=4,Zu=5,Ur=6,ll=7,Ln=8,Qp=9,Jp=10,dt=11,E1=12,ud=13,nS=14,fl=15,Hr=16,cd=17,dl=18,wa=19,ld=20,rS=21,hn=22,S1=1,oS=2,eg=7,tg=8,hl=9,ro=10;function $o(n){return Array.isArray(n)&&"object"==typeof n[S1]}function Hi(n){return Array.isArray(n)&&!0===n[S1]}function A1(n){return 0!=(4&n.flags)}function fd(n){return n.componentOffset>-1}function ng(n){return 1==(1&n.flags)}function Wi(n){return!!n.template}function AV(n){return 0!=(256&n[at])}function Qu(n,e){return n.hasOwnProperty(cs)?n[cs]:null}class TV{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function qo(){return sS}function sS(n){return n.type.prototype.ngOnChanges&&(n.setInput=NV),RV}function RV(){const n=cS(this),e=n?.current;if(e){const t=n.previous;if(t===us)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function NV(n,e,t,r){const o=this.declaredInputs[t],i=cS(n)||function OV(n,e){return n[uS]=e}(n,{previous:us,current:null}),a=i.current||(i.current={}),s=i.previous,u=s[o];a[o]=new TV(u&&u.currentValue,e,s===us),n[r]=e}qo.ngInherit=!0;const uS="__ngSimpleChanges__";function cS(n){return n[uS]||null}const vi=function(n,e,t){};function Sr(n){for(;Array.isArray(n);)n=n[ls];return n}function rg(n,e){return Sr(e[n])}function Xo(n,e){return Sr(e[n.index])}function dS(n,e){return n.data[e]}function Ko(n,e){const t=e[n];return $o(t)?t:t[ls]}function og(n){return 64==(64&n[at])}function Zs(n,e){return null==e?null:n[e]}function hS(n){n[dl]=0}function D1(n,e){n[Zu]+=e;let t=n,r=n[Tn];for(;null!==r&&(1===e&&1===t[Zu]||-1===e&&0===t[Zu]);)r[Zu]+=e,t=r,r=r[Tn]}const et={lFrame:CS(null),bindingsEnabled:!0};function gS(){return et.bindingsEnabled}function ne(){return et.lFrame.lView}function St(){return et.lFrame.tView}function xe(n){return et.lFrame.contextLView=n,n[Ln]}function we(n){return et.lFrame.contextLView=null,n}function Ar(){let n=vS();for(;null!==n&&64===n.type;)n=n.parent;return n}function vS(){return et.lFrame.currentTNode}function _a(n,e){const t=et.lFrame;t.currentTNode=n,t.isParent=e}function T1(){return et.lFrame.isParent}function R1(){et.lFrame.isParent=!1}function oo(){const n=et.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function gl(){return et.lFrame.bindingIndex++}function ds(n){const e=et.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function jV(n,e){const t=et.lFrame;t.bindingIndex=t.bindingRootIndex=n,N1(e)}function N1(n){et.lFrame.currentDirectiveIndex=n}function wS(){return et.lFrame.currentQueryIndex}function M1(n){et.lFrame.currentQueryIndex=n}function qV(n){const e=n[ye];return 2===e.type?e.declTNode:1===e.type?n[Ur]:null}function _S(n,e,t){if(t&Ge.SkipSelf){let o=e,i=n;for(;!(o=o.parent,null!==o||t&Ge.Host||(o=qV(i),null===o||(i=i[fl],10&o.type))););if(null===o)return!1;e=o,n=i}const r=et.lFrame=bS();return r.currentTNode=e,r.lView=n,!0}function P1(n){const e=bS(),t=n[ye];et.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function bS(){const n=et.lFrame,e=null===n?null:n.child;return null===e?CS(n):e}function CS(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function ES(){const n=et.lFrame;return et.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const SS=ES;function k1(){const n=ES();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function io(){return et.lFrame.selectedIndex}function Ju(n){et.lFrame.selectedIndex=n}function _n(){const n=et.lFrame;return dS(n.tView,n.selectedIndex)}function ig(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const i=n.data[t].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;a&&(n.contentHooks||(n.contentHooks=[])).push(-t,a),s&&((n.contentHooks||(n.contentHooks=[])).push(t,s),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,s)),u&&(n.viewHooks||(n.viewHooks=[])).push(-t,u),c&&((n.viewHooks||(n.viewHooks=[])).push(t,c),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,c)),null!=l&&(n.destroyHooks||(n.destroyHooks=[])).push(t,l)}}function ag(n,e,t){AS(n,e,3,t)}function sg(n,e,t,r){(3&n[at])===t&&AS(n,e,t,r)}function F1(n,e){let t=n[at];(3&t)===e&&(t&=2047,t+=1,n[at]=t)}function AS(n,e,t,r){const i=r??-1,a=e.length-1;let s=0;for(let u=void 0!==r?65535&n[dl]:0;u<a;u++)if("number"==typeof e[u+1]){if(s=e[u],null!=r&&s>=r)break}else e[u]<0&&(n[dl]+=65536),(s<i||-1==i)&&(n7(n,t,e,u),n[dl]=(4294901760&n[dl])+u+2),u++}function n7(n,e,t,r){const o=t[r]<0,i=t[r+1],s=n[o?-t[r]:t[r]];if(o){if(n[at]>>11<n[dl]>>16&&(3&n[at])===e){n[at]+=2048,vi(4,s,i);try{i.call(s)}finally{vi(5,s,i)}}}else{vi(4,s,i);try{i.call(s)}finally{vi(5,s,i)}}}const vl=-1;class hd{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function B1(n,e,t){let r=0;for(;r<t.length;){const o=t[r];if("number"==typeof o){if(0!==o)break;r++;const i=t[r++],a=t[r++],s=t[r++];n.setAttribute(e,a,s,i)}else{const i=o,a=t[++r];DS(i)?n.setProperty(e,i,a):n.setAttribute(e,i,a),r++}}return r}function IS(n){return 3===n||4===n||6===n}function DS(n){return 64===n.charCodeAt(0)}function pd(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const o=e[r];"number"==typeof o?t=o:0===t||TS(n,t,o,null,-1===t||2===t?e[++r]:null)}}return n}function TS(n,e,t,r,o){let i=0,a=n.length;if(-1===e)a=-1;else for(;i<n.length;){const s=n[i++];if("number"==typeof s){if(s===e){a=-1;break}if(s>e){a=i-1;break}}}for(;i<n.length;){const s=n[i];if("number"==typeof s)break;if(s===t){if(null===r)return void(null!==o&&(n[i+1]=o));if(r===n[i+1])return void(n[i+2]=o)}i++,null!==r&&i++,null!==o&&i++}-1!==a&&(n.splice(a,0,e),i=a+1),n.splice(i++,0,t),null!==r&&n.splice(i++,0,r),null!==o&&n.splice(i++,0,o)}function RS(n){return n!==vl}function ug(n){return 32767&n}function cg(n,e){let t=function a7(n){return n>>16}(n),r=e;for(;t>0;)r=r[fl],t--;return r}let V1=!0;function lg(n){const e=V1;return V1=n,e}const NS=255,OS=5;let s7=0;const ba={};function fg(n,e){const t=MS(n,e);if(-1!==t)return t;const r=e[ye];r.firstCreatePass&&(n.injectorIndex=e.length,U1(r.data,n),U1(e,null),U1(r.blueprint,null));const o=H1(n,e),i=n.injectorIndex;if(RS(o)){const a=ug(o),s=cg(o,e),u=s[ye].data;for(let c=0;c<8;c++)e[i+c]=s[a+c]|u[a+c]}return e[i+8]=o,i}function U1(n,e){n.push(0,0,0,0,0,0,0,0,e)}function MS(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function H1(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,o=e;for(;null!==o;){if(r=US(o),null===r)return vl;if(t++,o=o[fl],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return vl}function W1(n,e,t){!function u7(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(sd)&&(r=t[sd]),null==r&&(r=t[sd]=s7++);const o=r&NS;e.data[n+(o>>OS)]|=1<<o}(n,e,t)}function PS(n,e,t){if(t&Ge.Optional||void 0!==n)return n;jp()}function kS(n,e,t,r){if(t&Ge.Optional&&void 0===r&&(r=null),!(t&(Ge.Self|Ge.Host))){const o=n[Qp],i=gi(void 0);try{return o?o.get(e,r,t&Ge.Optional):KE(e,r,t&Ge.Optional)}finally{gi(i)}}return PS(r,0,t)}function FS(n,e,t,r=Ge.Default,o){if(null!==n){if(1024&e[at]){const a=function h7(n,e,t,r,o){let i=n,a=e;for(;null!==i&&null!==a&&1024&a[at]&&!(256&a[at]);){const s=LS(i,a,t,r|Ge.Self,ba);if(s!==ba)return s;let u=i.parent;if(!u){const c=a[rS];if(c){const l=c.get(t,ba,r);if(l!==ba)return l}u=US(a),a=a[fl]}i=u}return o}(n,e,t,r,ba);if(a!==ba)return a}const i=LS(n,e,t,r,ba);if(i!==ba)return i}return kS(e,t,r,o)}function LS(n,e,t,r,o){const i=function f7(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(sd)?n[sd]:void 0;return"number"==typeof e?e>=0?e&NS:d7:e}(t);if("function"==typeof i){if(!_S(e,n,r))return r&Ge.Host?PS(o,0,r):kS(e,t,r,o);try{const a=i(r);if(null!=a||r&Ge.Optional)return a;jp()}finally{SS()}}else if("number"==typeof i){let a=null,s=MS(n,e),u=vl,c=r&Ge.Host?e[Hr][Ur]:null;for((-1===s||r&Ge.SkipSelf)&&(u=-1===s?H1(n,e):e[s+8],u!==vl&&VS(r,!1)?(a=e[ye],s=ug(u),e=cg(u,e)):s=-1);-1!==s;){const l=e[ye];if(BS(i,s,l.data)){const f=l7(s,e,t,a,r,c);if(f!==ba)return f}u=e[s+8],u!==vl&&VS(r,e[ye].data[s+8]===c)&&BS(i,s,e)?(a=l,s=ug(u),e=cg(u,e)):s=-1}}return o}function l7(n,e,t,r,o,i){const a=e[ye],s=a.data[n+8],l=dg(s,a,t,null==r?fd(s)&&V1:r!=a&&0!=(3&s.type),o&Ge.Host&&i===s);return null!==l?ec(e,a,l,s):ba}function dg(n,e,t,r,o){const i=n.providerIndexes,a=e.data,s=1048575&i,u=n.directiveStart,l=i>>20,d=o?s+l:n.directiveEnd;for(let h=r?s:s+l;h<d;h++){const p=a[h];if(h<u&&t===p||h>=u&&p.type===t)return h}if(o){const h=a[u];if(h&&Wi(h)&&h.type===t)return u}return null}function ec(n,e,t,r){let o=n[t];const i=e.data;if(function r7(n){return n instanceof hd}(o)){const a=o;a.resolving&&function oV(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new ie(-200,`Circular dependency in DI detected for ${n}${t}`)}(function jt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Je(n)}(i[t]));const s=lg(a.canSeeViewProviders);a.resolving=!0;const u=a.injectImpl?gi(a.injectImpl):null;_S(n,r,Ge.Default);try{o=n[t]=a.factory(void 0,i,n,r),e.firstCreatePass&&t>=r.directiveStart&&function t7(n,e,t){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=e.type.prototype;if(r){const a=sS(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,a),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,a)}o&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,o),i&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,i),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,i))}(t,i[t],e)}finally{null!==u&&gi(u),lg(s),a.resolving=!1,SS()}}return o}function BS(n,e,t){return!!(t[e+(n>>OS)]&1<<n)}function VS(n,e){return!(n&Ge.Self||n&Ge.Host&&e)}class ml{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return FS(this._tNode,this._lView,e,Kp(r),t)}}function d7(){return new ml(Ar(),ne())}function Ir(n){return ss(()=>{const e=n.prototype.constructor,t=e[cs]||G1(e),r=Object.prototype;let o=Object.getPrototypeOf(n.prototype).constructor;for(;o&&o!==r;){const i=o[cs]||G1(o);if(i&&i!==t)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function G1(n){return v1(n)?()=>{const e=G1(We(n));return e&&e()}:Qu(n)}function US(n){const e=n[ye],t=e.type;return 2===t?e.declTNode:1===t?n[Ur]:null}const xl="__parameters__";function _l(n,e,t){return ss(()=>{const r=function z1(n){return function(...t){if(n){const r=n(...t);for(const o in r)this[o]=r[o]}}}(e);function o(...i){if(this instanceof o)return r.apply(this,i),this;const a=new o(...i);return s.annotation=a,s;function s(u,c,l){const f=u.hasOwnProperty(xl)?u[xl]:Object.defineProperty(u,xl,{value:[]})[xl];for(;f.length<=l;)f.push(null);return(f[l]=f[l]||[]).push(a),u}}return t&&(o.prototype=Object.create(t.prototype)),o.prototype.ngMetadataName=n,o.annotationCls=o,o})}class ge{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Ae({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function tc(n,e){n.forEach(t=>Array.isArray(t)?tc(t,e):e(t))}function WS(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function pg(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Yo(n,e,t){let r=bl(n,e);return r>=0?n[1|r]=t:(r=~r,function m7(n,e,t,r){let o=n.length;if(o==e)n.push(t,r);else if(1===o)n.push(r,n[0]),n[0]=t;else{for(o--,n.push(n[o-1],n[o]);o>e;)n[o]=n[o-2],o--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function $1(n,e){const t=bl(n,e);if(t>=0)return n[1|t]}function bl(n,e){return function GS(n,e,t){let r=0,o=n.length>>t;for(;o!==r;){const i=r+(o-r>>1),a=n[i<<t];if(e===a)return i<<t;a>e?o=i:r=i+1}return~(o<<t)}(n,e,1)}const yd=ad(_l("Optional"),8),xd=ad(_l("SkipSelf"),4);var So=(()=>((So=So||{})[So.Important=1]="Important",So[So.DashCase=2]="DashCase",So))();const Q1=new Map;let V7=0;const ey="__ngContext__";function Wr(n,e){$o(e)?(n[ey]=e[ld],function H7(n){Q1.set(n[ld],n)}(e)):n[ey]=e}let ty;function ny(n,e){return ty(n,e)}function Cd(n){const e=n[Tn];return Hi(e)?e[Tn]:e}function ry(n){return cA(n[ud])}function oy(n){return cA(n[Ui])}function cA(n){for(;null!==n&&!Hi(n);)n=n[Ui];return n}function El(n,e,t,r,o){if(null!=r){let i,a=!1;Hi(r)?i=r:$o(r)&&(a=!0,r=r[ls]);const s=Sr(r);0===n&&null!==t?null==o?gA(e,t,s):nc(e,t,s,o||null,!0):1===n&&null!==t?nc(e,t,s,o||null,!0):2===n?function fy(n,e,t){const r=yg(n,e);r&&function sU(n,e,t,r){n.removeChild(e,t,r)}(n,r,e,t)}(e,s,a):3===n&&e.destroyNode(s),null!=i&&function lU(n,e,t,r,o){const i=t[eg];i!==Sr(t)&&El(e,n,r,i,o);for(let s=ro;s<t.length;s++){const u=t[s];Ed(u[ye],u,n,e,r,i)}}(e,n,i,t,o)}}function ay(n,e,t){return n.createElement(e,t)}function fA(n,e){const t=n[hl],r=t.indexOf(e),o=e[Tn];512&e[at]&&(e[at]&=-513,D1(o,-1)),t.splice(r,1)}function sy(n,e){if(n.length<=ro)return;const t=ro+e,r=n[t];if(r){const o=r[cd];null!==o&&o!==n&&fA(o,r),e>0&&(n[t-1][Ui]=r[Ui]);const i=pg(n,ro+e);!function J7(n,e){Ed(n,e,e[dt],2,null,null),e[ls]=null,e[Ur]=null}(r[ye],r);const a=i[wa];null!==a&&a.detachView(i[ye]),r[Tn]=null,r[Ui]=null,r[at]&=-65}return r}function dA(n,e){if(!(128&e[at])){const t=e[dt];t.destroyNode&&Ed(n,e,t,3,null,null),function nU(n){let e=n[ud];if(!e)return uy(n[ye],n);for(;e;){let t=null;if($o(e))t=e[ud];else{const r=e[ro];r&&(t=r)}if(!t){for(;e&&!e[Ui]&&e!==n;)$o(e)&&uy(e[ye],e),e=e[Tn];null===e&&(e=n),$o(e)&&uy(e[ye],e),t=e&&e[Ui]}e=t}}(e)}}function uy(n,e){if(!(128&e[at])){e[at]&=-65,e[at]|=128,function aU(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const o=e[t[r]];if(!(o instanceof hd)){const i=t[r+1];if(Array.isArray(i))for(let a=0;a<i.length;a+=2){const s=o[i[a]],u=i[a+1];vi(4,s,u);try{u.call(s)}finally{vi(5,s,u)}}else{vi(4,o,i);try{i.call(o)}finally{vi(5,o,i)}}}}}(n,e),function iU(n,e){const t=n.cleanup,r=e[ll];let o=-1;if(null!==t)for(let i=0;i<t.length-1;i+=2)if("string"==typeof t[i]){const a=t[i+3];a>=0?r[o=a]():r[o=-a].unsubscribe(),i+=2}else{const a=r[o=t[i+1]];t[i].call(a)}if(null!==r){for(let i=o+1;i<r.length;i++)(0,r[i])();e[ll]=null}}(n,e),1===e[ye].type&&e[dt].destroy();const t=e[cd];if(null!==t&&Hi(e[Tn])){t!==e[Tn]&&fA(t,e);const r=e[wa];null!==r&&r.detachView(n)}!function W7(n){Q1.delete(n[ld])}(e)}}function hA(n,e,t){return function pA(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[ls];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:i}=n.data[r.directiveStart+o];if(i===xa.None||i===xa.Emulated)return null}return Xo(r,t)}}(n,e.parent,t)}function nc(n,e,t,r,o){n.insertBefore(e,t,r,o)}function gA(n,e,t){n.appendChild(e,t)}function vA(n,e,t,r,o){null!==r?nc(n,e,t,r,o):gA(n,e,t)}function yg(n,e){return n.parentNode(e)}let cy,_g,py,bg,xA=function yA(n,e,t){return 40&n.type?Xo(n,t):null};function xg(n,e,t,r){const o=hA(n,r,e),i=e[dt],s=function mA(n,e,t){return xA(n,e,t)}(r.parent||e[Ur],r,e);if(null!=o)if(Array.isArray(t))for(let u=0;u<t.length;u++)vA(i,o,t[u],s,!1);else vA(i,o,t,s,!1);void 0!==cy&&cy(i,r,e,t,o)}function wg(n,e){if(null!==e){const t=e.type;if(3&t)return Xo(e,n);if(4&t)return ly(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return wg(n,r);{const o=n[e.index];return Hi(o)?ly(-1,o):Sr(o)}}if(32&t)return ny(e,n)()||Sr(n[e.index]);{const r=_A(n,e);return null!==r?Array.isArray(r)?r[0]:wg(Cd(n[Hr]),r):wg(n,e.next)}}return null}function _A(n,e){return null!==e?n[Hr][Ur].projection[e.projection]:null}function ly(n,e){const t=ro+n+1;if(t<e.length){const r=e[t],o=r[ye].firstChild;if(null!==o)return wg(r,o)}return e[eg]}function dy(n,e,t,r,o,i,a){for(;null!=t;){const s=r[t.index],u=t.type;if(a&&0===e&&(s&&Wr(Sr(s),r),t.flags|=2),32!=(32&t.flags))if(8&u)dy(n,e,t.child,r,o,i,!1),El(e,n,o,s,i);else if(32&u){const c=ny(t,r);let l;for(;l=c();)El(e,n,o,l,i);El(e,n,o,s,i)}else 16&u?bA(n,e,r,t,o,i):El(e,n,o,s,i);t=a?t.projectionNext:t.next}}function Ed(n,e,t,r,o,i){dy(t,r,n.firstChild,e,o,i,!1)}function bA(n,e,t,r,o,i){const a=t[Hr],u=a[Ur].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)El(e,n,o,u[c],i);else dy(n,e,u,a[Tn],o,i,!0)}function CA(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function EA(n,e,t){const{mergedAttrs:r,classes:o,styles:i}=t;null!==r&&B1(n,e,r),null!==o&&CA(n,e,o),null!==i&&function dU(n,e,t){n.setAttribute(e,"style",t)}(n,e,i)}function Sl(n){return function hy(){if(void 0===_g&&(_g=null,dn.trustedTypes))try{_g=dn.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return _g}()?.createHTML(n)||n}function AA(n){return function gy(){if(void 0===bg&&(bg=null,dn.trustedTypes))try{bg=dn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return bg}()?.createHTML(n)||n}class TA{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${jE})`}}function Qs(n){return n instanceof TA?n.changingThisBreaksApplicationSecurity:n}class CU{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Sl(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class EU{constructor(e){this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(e){const t=this.inertDocument.createElement("template");return t.innerHTML=Sl(e),t}}const AU=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function vy(n){return(n=String(n)).match(AU)?n:"unsafe:"+n}function hs(n){const e={};for(const t of n.split(","))e[t]=!0;return e}function Ad(...n){const e={};for(const t of n)for(const r in t)t.hasOwnProperty(r)&&(e[r]=!0);return e}const NA=hs("area,br,col,hr,img,wbr"),OA=hs("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),MA=hs("rp,rt"),my=Ad(NA,Ad(OA,hs("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ad(MA,hs("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ad(MA,OA)),yy=hs("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),PA=Ad(yy,hs("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),hs("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),IU=hs("script,style,template");class DU{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,r=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?r=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,r&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let o=this.checkClobberedElement(t,t.nextSibling);if(o){t=o;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!my.hasOwnProperty(t))return this.sanitizedSomething=!0,!IU.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const r=e.attributes;for(let o=0;o<r.length;o++){const i=r.item(o),a=i.name,s=a.toLowerCase();if(!PA.hasOwnProperty(s)){this.sanitizedSomething=!0;continue}let u=i.value;yy[s]&&(u=vy(u)),this.buf.push(" ",a,'="',kA(u),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();my.hasOwnProperty(t)&&!NA.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(kA(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const TU=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,RU=/([^\#-~ |!])/g;function kA(n){return n.replace(/&/g,"&amp;").replace(TU,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(RU,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Cg;function xy(n){return"content"in n&&function OU(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var $n=(()=>(($n=$n||{})[$n.NONE=0]="NONE",$n[$n.HTML=1]="HTML",$n[$n.STYLE=2]="STYLE",$n[$n.SCRIPT=3]="SCRIPT",$n[$n.URL=4]="URL",$n[$n.RESOURCE_URL=5]="RESOURCE_URL",$n))();function wy(n){const e=function Id(){const n=ne();return n&&n[E1]}();return e?AA(e.sanitize($n.HTML,n)||""):function Sd(n,e){const t=function bU(n){return n instanceof TA&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${jE})`)}return t===e}(n,"HTML")?AA(Qs(n)):function NU(n,e){let t=null;try{Cg=Cg||function RA(n){const e=new EU(n);return function SU(){try{return!!(new window.DOMParser).parseFromString(Sl(""),"text/html")}catch{return!1}}()?new CU(e):e}(n);let r=e?String(e):"";t=Cg.getInertBodyElement(r);let o=5,i=r;do{if(0===o)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=t.innerHTML,t=Cg.getInertBodyElement(r)}while(r!==i);return Sl((new DU).sanitizeChildren(xy(t)||t))}finally{if(t){const r=xy(t)||t;for(;r.firstChild;)r.removeChild(r.firstChild)}}}(function SA(){return void 0!==py?py:typeof document<"u"?document:void 0}(),Je(n))}const Eg=new ge("ENVIRONMENT_INITIALIZER"),VA=new ge("INJECTOR",-1),UA=new ge("INJECTOR_DEF_TYPES");class HA{get(e,t=od){if(t===od){const r=new Error(`NullInjectorError: No provider for ${on(e)}!`);throw r.name="NullInjectorError",r}return t}}function VU(...n){return{\u0275providers:WA(0,n),\u0275fromNgModule:!0}}function WA(n,...e){const t=[],r=new Set;let o;return tc(e,i=>{const a=i;_y(a,t,[],r)&&(o||(o=[]),o.push(a))}),void 0!==o&&GA(o,t),t}function GA(n,e){for(let t=0;t<n.length;t++){const{providers:o}=n[t];by(o,i=>{e.push(i)})}}function _y(n,e,t,r){if(!(n=We(n)))return!1;let o=null,i=qE(n);const a=!i&&qt(n);if(i||a){if(a&&!a.standalone)return!1;o=n}else{const u=n.ngModule;if(i=qE(u),!i)return!1;o=u}const s=r.has(o);if(a){if(s)return!1;if(r.add(o),a.dependencies){const u="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const c of u)_y(c,e,t,r)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;r.add(o);try{tc(i.imports,l=>{_y(l,e,t,r)&&(c||(c=[]),c.push(l))})}finally{}void 0!==c&&GA(c,e)}if(!s){const c=Qu(o)||(()=>new o);e.push({provide:o,useFactory:c,deps:Bt},{provide:UA,useValue:o,multi:!0},{provide:Eg,useValue:()=>me(o),multi:!0})}const u=i.providers;null==u||s||by(u,l=>{e.push(l)})}}return o!==n&&void 0!==n.providers}function by(n,e){for(let t of n)m1(t)&&(t=t.\u0275providers),Array.isArray(t)?by(t,e):e(t)}const UU=rn({provide:String,useValue:rn});function Cy(n){return null!==n&&"object"==typeof n&&UU in n}function rc(n){return"function"==typeof n}const Ey=new ge("Set Injector scope."),Sg={},WU={};let Sy;function Ag(){return void 0===Sy&&(Sy=new HA),Sy}class Ca{}class $A extends Ca{get destroyed(){return this._destroyed}constructor(e,t,r,o){super(),this.parent=t,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Iy(e,a=>this.processProvider(a)),this.records.set(VA,Al(void 0,this)),o.has("environment")&&this.records.set(Ca,Al(void 0,this));const i=this.records.get(Ey);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(UA.multi,Bt,Ge.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=ul(this),r=gi(void 0);try{return e()}finally{ul(t),gi(r)}}get(e,t=od,r=Ge.Default){this.assertNotDestroyed(),r=Kp(r);const o=ul(this),i=gi(void 0);try{if(!(r&Ge.SkipSelf)){let s=this.records.get(e);if(void 0===s){const u=function qU(n){return"function"==typeof n||"object"==typeof n&&n instanceof ge}(e)&&$p(e);s=u&&this.injectableDefInScope(u)?Al(Ay(e),Sg):null,this.records.set(e,s)}if(null!=s)return this.hydrate(e,s)}return(r&Ge.Self?Ag():this.parent).get(e,t=r&Ge.Optional&&t===od?null:t)}catch(a){if("NullInjectorError"===a.name){if((a[Xp]=a[Xp]||[]).unshift(on(e)),o)throw a;return function xV(n,e,t,r){const o=n[Xp];throw e[YE]&&o.unshift(e[YE]),n.message=function wV(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&n.charAt(1)==vV?n.slice(2):n;let o=on(e);if(Array.isArray(e))o=e.map(on).join(" -> ");else if("object"==typeof e){let i=[];for(let a in e)if(e.hasOwnProperty(a)){let s=e[a];i.push(a+":"+("string"==typeof s?JSON.stringify(s):on(s)))}o=`{${i.join(", ")}}`}return`${t}${r?"("+r+")":""}[${o}]: ${n.replace(gV,"\n  ")}`}("\n"+n.message,o,t,r),n[pV]=o,n[Xp]=null,n}(a,e,"R3InjectorError",this.source)}throw a}finally{gi(i),ul(o)}}resolveInjectorInitializers(){const e=ul(this),t=gi(void 0);try{const r=this.get(Eg.multi,Bt,Ge.Self);for(const o of r)o()}finally{ul(e),gi(t)}}toString(){const e=[],t=this.records;for(const r of t.keys())e.push(on(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ie(205,!1)}processProvider(e){let t=rc(e=We(e))?e:We(e&&e.provide);const r=function zU(n){return Cy(n)?Al(void 0,n.useValue):Al(qA(n),Sg)}(e);if(rc(e)||!0!==e.multi)this.records.get(t);else{let o=this.records.get(t);o||(o=Al(void 0,Sg,!0),o.factory=()=>_1(o.multi),this.records.set(t,o)),t=e,o.multi.push(e)}this.records.set(t,r)}hydrate(e,t){return t.value===Sg&&(t.value=WU,t.value=t.factory()),"object"==typeof t.value&&t.value&&function $U(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=We(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function Ay(n){const e=$p(n),t=null!==e?e.factory:Qu(n);if(null!==t)return t;if(n instanceof ge)throw new ie(204,!1);if(n instanceof Function)return function GU(n){const e=n.length;if(e>0)throw function md(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}(e,"?"),new ie(204,!1);const t=function lV(n){const e=n&&(n[qp]||n[XE]);return e?(function fV(n){if(n.hasOwnProperty("name"))return n.name;(""+n).match(/^function\s*([^\s(]+)/)}(n),e):null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new ie(204,!1)}function qA(n,e,t){let r;if(rc(n)){const o=We(n);return Qu(o)||Ay(o)}if(Cy(n))r=()=>We(n.useValue);else if(function jA(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(..._1(n.deps||[]));else if(function zA(n){return!(!n||!n.useExisting)}(n))r=()=>me(We(n.useExisting));else{const o=We(n&&(n.useClass||n.provide));if(!function jU(n){return!!n.deps}(n))return Qu(o)||Ay(o);r=()=>new o(..._1(n.deps))}return r}function Al(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Iy(n,e){for(const t of n)Array.isArray(t)?Iy(t,e):t&&m1(t)?Iy(t.\u0275providers,e):e(t)}class XU{}class XA{}class YU{resolveComponentFactory(e){throw function KU(n){const e=Error(`No component factory found for ${on(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let Il=(()=>{class n{}return n.NULL=new YU,n})();function ZU(){return Dl(Ar(),ne())}function Dl(n,e){return new ao(Xo(n,e))}let ao=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=ZU,n})();function QU(n){return n instanceof ao?n.nativeElement:n}class YA{}let Ea=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function JU(){const n=ne(),t=Ko(Ar().index,n);return($o(t)?t:n)[dt]}(),n})(),e9=(()=>{class n{}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:()=>null}),n})();class Dd{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const t9=new Dd("15.2.4"),Dy={},Ty="ngOriginalError";function Ry(n){return n[Ty]}class Tl{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&Ry(e);for(;t&&Ry(t);)t=Ry(t);return t||null}}function ZA(n){return n.ownerDocument.defaultView}function ps(n){return n instanceof Function?n():n}function JA(n,e,t){let r=n.length;for(;;){const o=n.indexOf(e,t);if(-1===o)return o;if(0===o||n.charCodeAt(o-1)<=32){const i=e.length;if(o+i===r||n.charCodeAt(o+i)<=32)return o}t=o+1}}const eI="ng-template";function f9(n,e,t){let r=0,o=!0;for(;r<n.length;){let i=n[r++];if("string"==typeof i&&o){const a=n[r++];if(t&&"class"===i&&-1!==JA(a.toLowerCase(),e,0))return!0}else{if(1===i){for(;r<n.length&&"string"==typeof(i=n[r++]);)if(i.toLowerCase()===e)return!0;return!1}"number"==typeof i&&(o=!1)}}return!1}function tI(n){return 4===n.type&&n.value!==eI}function d9(n,e,t){return e===(4!==n.type||t?n.value:eI)}function h9(n,e,t){let r=4;const o=n.attrs||[],i=function v9(n){for(let e=0;e<n.length;e++)if(IS(n[e]))return e;return n.length}(o);let a=!1;for(let s=0;s<e.length;s++){const u=e[s];if("number"!=typeof u){if(!a)if(4&r){if(r=2|1&r,""!==u&&!d9(n,u,t)||""===u&&1===e.length){if(Gi(r))return!1;a=!0}}else{const c=8&r?u:e[++s];if(8&r&&null!==n.attrs){if(!f9(n.attrs,c,t)){if(Gi(r))return!1;a=!0}continue}const f=p9(8&r?"class":u,o,tI(n),t);if(-1===f){if(Gi(r))return!1;a=!0;continue}if(""!==c){let d;d=f>i?"":o[f+1].toLowerCase();const h=8&r?d:null;if(h&&-1!==JA(h,c,0)||2&r&&c!==d){if(Gi(r))return!1;a=!0}}}}else{if(!a&&!Gi(r)&&!Gi(u))return!1;if(a&&Gi(u))continue;a=!1,r=u|1&r}}return Gi(r)||a}function Gi(n){return 0==(1&n)}function p9(n,e,t,r){if(null===e)return-1;let o=0;if(r||!t){let i=!1;for(;o<e.length;){const a=e[o];if(a===n)return o;if(3===a||6===a)i=!0;else{if(1===a||2===a){let s=e[++o];for(;"string"==typeof s;)s=e[++o];continue}if(4===a)break;if(0===a){o+=4;continue}}o+=i?1:2}return-1}return function m9(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function nI(n,e,t=!1){for(let r=0;r<e.length;r++)if(h9(n,e[r],t))return!0;return!1}function rI(n,e){return n?":not("+e.trim()+")":e}function x9(n){let e=n[0],t=1,r=2,o="",i=!1;for(;t<n.length;){let a=n[t];if("string"==typeof a)if(2&r){const s=n[++t];o+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?o+="."+a:4&r&&(o+=" "+a);else""!==o&&!Gi(a)&&(e+=rI(i,o),o=""),r=a,i=i||!Gi(r);t++}return""!==o&&(e+=rI(i,o)),e}const tt={};function ke(n){oI(St(),ne(),io()+n,!1)}function oI(n,e,t,r){if(!r)if(3==(3&e[at])){const i=n.preOrderCheckHooks;null!==i&&ag(e,i,t)}else{const i=n.preOrderHooks;null!==i&&sg(e,i,0,t)}Ju(t)}function uI(n,e=null,t=null,r){const o=cI(n,e,t,r);return o.resolveInjectorInitializers(),o}function cI(n,e=null,t=null,r,o=new Set){const i=[t||Bt,VU(n)];return r=r||("object"==typeof n?void 0:on(n)),new $A(i,e||Ag(),r||null,o)}let Sa=(()=>{class n{static create(t,r){if(Array.isArray(t))return uI({name:""},r,t,"");{const o=t.name??"";return uI({name:o},t.parent,t.providers,o)}}}return n.THROW_IF_NOT_FOUND=od,n.NULL=new HA,n.\u0275prov=Ae({token:n,providedIn:"any",factory:()=>me(VA)}),n.__NG_ELEMENT_ID__=-1,n})();function Q(n,e=Ge.Default){const t=ne();return null===t?me(n,e):FS(Ar(),t,We(n),e)}function mI(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const i=t[r+1];if(-1!==i){const a=n.data[i];M1(t[r]),a.contentQueries(2,e[i],i)}}}function Dg(n,e,t,r,o,i,a,s,u,c,l){const f=e.blueprint.slice();return f[ls]=o,f[at]=76|r,(null!==l||n&&1024&n[at])&&(f[at]|=1024),hS(f),f[Tn]=f[fl]=n,f[Ln]=t,f[Jp]=a||n&&n[Jp],f[dt]=s||n&&n[dt],f[E1]=u||n&&n[E1]||null,f[Qp]=c||n&&n[Qp]||null,f[Ur]=i,f[ld]=function U7(){return V7++}(),f[rS]=l,f[Hr]=2==e.type?n[Hr]:f,f}function Ol(n,e,t,r,o){let i=n.data[e];if(null===i)i=function ky(n,e,t,r,o){const i=vS(),a=T1(),u=n.data[e]=function j9(n,e,t,r,o,i){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?i:i&&i.parent,t,e,r,o);return null===n.firstChild&&(n.firstChild=u),null!==i&&(a?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u,u.prev=i)),u}(n,e,t,r,o),function zV(){return et.lFrame.inI18n}()&&(i.flags|=32);else if(64&i.type){i.type=t,i.value=r,i.attrs=o;const a=function dd(){const n=et.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();i.injectorIndex=null===a?-1:a.injectorIndex}return _a(i,!0),i}function Td(n,e,t,r){if(0===t)return-1;const o=e.length;for(let i=0;i<t;i++)e.push(r),n.blueprint.push(r),n.data.push(null);return o}function Fy(n,e,t){P1(e);try{const r=n.viewQuery;null!==r&&$y(1,r,t);const o=n.template;null!==o&&yI(n,e,o,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&mI(n,e),n.staticViewQueries&&$y(2,n.viewQuery,t);const i=n.components;null!==i&&function W9(n,e){for(let t=0;t<e.length;t++)lH(n,e[t])}(e,i)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[at]&=-5,k1()}}function Tg(n,e,t,r){const o=e[at];if(128!=(128&o)){P1(e);try{hS(e),function yS(n){return et.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&yI(n,e,t,2,r);const a=3==(3&o);if(a){const c=n.preOrderCheckHooks;null!==c&&ag(e,c,null)}else{const c=n.preOrderHooks;null!==c&&sg(e,c,0,null),F1(e,0)}if(function uH(n){for(let e=ry(n);null!==e;e=oy(e)){if(!e[oS])continue;const t=e[hl];for(let r=0;r<t.length;r++){const o=t[r];512&o[at]||D1(o[Tn],1),o[at]|=512}}}(e),function sH(n){for(let e=ry(n);null!==e;e=oy(e))for(let t=ro;t<e.length;t++){const r=e[t],o=r[ye];og(r)&&Tg(o,r,o.template,r[Ln])}}(e),null!==n.contentQueries&&mI(n,e),a){const c=n.contentCheckHooks;null!==c&&ag(e,c)}else{const c=n.contentHooks;null!==c&&sg(e,c,1),F1(e,1)}!function U9(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const o=t[r];if(o<0)Ju(~o);else{const i=o,a=t[++r],s=t[++r];jV(a,i),s(2,e[i])}}}finally{Ju(-1)}}(n,e);const s=n.components;null!==s&&function H9(n,e){for(let t=0;t<e.length;t++)cH(n,e[t])}(e,s);const u=n.viewQuery;if(null!==u&&$y(2,u,r),a){const c=n.viewCheckHooks;null!==c&&ag(e,c)}else{const c=n.viewHooks;null!==c&&sg(e,c,2),F1(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[at]&=-41,512&e[at]&&(e[at]&=-513,D1(e[Tn],-1))}finally{k1()}}}function yI(n,e,t,r,o){const i=io(),a=2&r;try{Ju(-1),a&&e.length>hn&&oI(n,e,hn,!1),vi(a?2:0,o),t(r,o)}finally{Ju(i),vi(a?3:1,o)}}function Ly(n,e,t){if(A1(e)){const o=e.directiveEnd;for(let i=e.directiveStart;i<o;i++){const a=n.data[i];a.contentQueries&&a.contentQueries(1,t[i],i)}}}function By(n,e,t){gS()&&(function Z9(n,e,t,r){const o=t.directiveStart,i=t.directiveEnd;fd(t)&&function oH(n,e,t){const r=Xo(e,n),o=xI(t),i=n[Jp],a=Rg(n,Dg(n,o,null,t.onPush?32:16,r,e,i,i.createRenderer(r,t),null,null,null));n[e.index]=a}(e,t,n.data[o+t.componentOffset]),n.firstCreatePass||fg(t,e),Wr(r,e);const a=t.initialInputs;for(let s=o;s<i;s++){const u=n.data[s],c=ec(e,n,s,t);Wr(c,e),null!==a&&iH(0,s-o,c,u,0,a),Wi(u)&&(Ko(t.index,e)[Ln]=ec(e,n,s,t))}}(n,e,t,Xo(t,e)),64==(64&t.flags)&&SI(n,e,t))}function Vy(n,e,t=Xo){const r=e.localNames;if(null!==r){let o=e.index+1;for(let i=0;i<r.length;i+=2){const a=r[i+1],s=-1===a?t(e,n):n[a];n[o++]=s}}}function xI(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Uy(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function Uy(n,e,t,r,o,i,a,s,u,c){const l=hn+r,f=l+o,d=function G9(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:tt);return t}(l,f),h="function"==typeof c?c():c;return d[ye]={type:n,blueprint:d,template:t,queries:null,viewQuery:s,declTNode:e,data:d.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:u,consts:h,incompleteFirstPass:!1}}function wI(n,e,t,r){const o=II(e);null===t?o.push(r):(o.push(t),n.firstCreatePass&&DI(n).push(r,o.length-1))}function _I(n,e,t,r){for(let o in n)if(n.hasOwnProperty(o)){t=null===t?{}:t;const i=n[o];null===r?bI(t,e,o,i):r.hasOwnProperty(o)&&bI(t,e,r[o],i)}return t}function bI(n,e,t,r){n.hasOwnProperty(t)?n[t].push(e,r):n[t]=[e,r]}function Zo(n,e,t,r,o,i,a,s){const u=Xo(e,t);let l,c=e.inputs;!s&&null!=c&&(l=c[r])?(qy(n,t,l,r,o),fd(e)&&CI(t,e.index)):3&e.type&&(r=function q9(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),o=null!=a?a(o,e.value||"",r):o,i.setProperty(u,r,o))}function CI(n,e){const t=Ko(e,n);16&t[at]||(t[at]|=32)}function Hy(n,e,t,r){if(gS()){const o=null===r?null:{"":-1},i=function J9(n,e){const t=n.directiveRegistry;let r=null,o=null;if(t)for(let i=0;i<t.length;i++){const a=t[i];if(nI(e,a.selectors,!1))if(r||(r=[]),Wi(a))if(null!==a.findHostDirectiveDefs){const s=[];o=o||new Map,a.findHostDirectiveDefs(a,s,o),r.unshift(...s,a),Wy(n,e,s.length)}else r.unshift(a),Wy(n,e,0);else o=o||new Map,a.findHostDirectiveDefs?.(a,r,o),r.push(a)}return null===r?null:[r,o]}(n,t);let a,s;null===i?a=s=null:[a,s]=i,null!==a&&EI(n,e,t,a,o,s),o&&function eH(n,e,t){if(e){const r=n.localNames=[];for(let o=0;o<e.length;o+=2){const i=t[e[o+1]];if(null==i)throw new ie(-301,!1);r.push(e[o],i)}}}(t,r,o)}t.mergedAttrs=pd(t.mergedAttrs,t.attrs)}function EI(n,e,t,r,o,i){for(let c=0;c<r.length;c++)W1(fg(t,e),n,r[c].type);!function nH(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,r.length);for(let c=0;c<r.length;c++){const l=r[c];l.providersResolver&&l.providersResolver(l)}let a=!1,s=!1,u=Td(n,e,r.length,null);for(let c=0;c<r.length;c++){const l=r[c];t.mergedAttrs=pd(t.mergedAttrs,l.hostAttrs),rH(n,t,e,u,l),tH(u,l,o),null!==l.contentQueries&&(t.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(t.flags|=64);const f=l.type.prototype;!a&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),a=!0),!s&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),s=!0),u++}!function $9(n,e,t){const o=e.directiveEnd,i=n.data,a=e.attrs,s=[];let u=null,c=null;for(let l=e.directiveStart;l<o;l++){const f=i[l],d=t?t.get(f):null,p=d?d.outputs:null;u=_I(f.inputs,l,u,d?d.inputs:null),c=_I(f.outputs,l,c,p);const g=null===u||null===a||tI(e)?null:aH(u,l,a);s.push(g)}null!==u&&(u.hasOwnProperty("class")&&(e.flags|=8),u.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=s,e.inputs=u,e.outputs=c}(n,t,i)}function SI(n,e,t){const r=t.directiveStart,o=t.directiveEnd,i=t.index,a=function $V(){return et.lFrame.currentDirectiveIndex}();try{Ju(i);for(let s=r;s<o;s++){const u=n.data[s],c=e[s];N1(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&Q9(u,c)}}finally{Ju(-1),N1(a)}}function Q9(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function Wy(n,e,t){e.componentOffset=t,(n.components||(n.components=[])).push(e.index)}function tH(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Wi(e)&&(t[""]=n)}}function rH(n,e,t,r,o){n.data[r]=o;const i=o.factory||(o.factory=Qu(o.type)),a=new hd(i,Wi(o),Q);n.blueprint[r]=a,t[r]=a,function K9(n,e,t,r,o){const i=o.hostBindings;if(i){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const s=~e.index;(function Y9(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=s&&a.push(s),a.push(t,r,i)}}(n,e,r,Td(n,t,o.hostVars,tt),o)}function iH(n,e,t,r,o,i){const a=i[e];if(null!==a){const s=r.setInput;for(let u=0;u<a.length;){const c=a[u++],l=a[u++],f=a[u++];null!==s?r.setInput(t,f,c,l):t[l]=f}}}function aH(n,e,t){let r=null,o=0;for(;o<t.length;){const i=t[o];if(0!==i)if(5!==i){if("number"==typeof i)break;if(n.hasOwnProperty(i)){null===r&&(r=[]);const a=n[i];for(let s=0;s<a.length;s+=2)if(a[s]===e){r.push(i,a[s+1],t[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function AI(n,e,t,r){return[n,!0,!1,e,null,0,r,t,null,null]}function cH(n,e){const t=Ko(e,n);if(og(t)){const r=t[ye];48&t[at]?Tg(r,t,r.template,t[Ln]):t[Zu]>0&&zy(t)}}function zy(n){for(let r=ry(n);null!==r;r=oy(r))for(let o=ro;o<r.length;o++){const i=r[o];if(og(i))if(512&i[at]){const a=i[ye];Tg(a,i,a.template,i[Ln])}else i[Zu]>0&&zy(i)}const t=n[ye].components;if(null!==t)for(let r=0;r<t.length;r++){const o=Ko(t[r],n);og(o)&&o[Zu]>0&&zy(o)}}function lH(n,e){const t=Ko(e,n),r=t[ye];(function fH(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),Fy(r,t,t[Ln])}function Rg(n,e){return n[ud]?n[nS][Ui]=e:n[ud]=e,n[nS]=e,e}function jy(n){for(;n;){n[at]|=32;const e=Cd(n);if(AV(n)&&!e)return n;n=e}return null}function Ng(n,e,t,r=!0){const o=e[Jp];o.begin&&o.begin();try{Tg(n,e,n.template,t)}catch(a){throw r&&RI(e,a),a}finally{o.end&&o.end()}}function $y(n,e,t){M1(0),e(n,t)}function II(n){return n[ll]||(n[ll]=[])}function DI(n){return n.cleanup||(n.cleanup=[])}function RI(n,e){const t=n[Qp],r=t?t.get(Tl,null):null;r&&r.handleError(e)}function qy(n,e,t,r,o){for(let i=0;i<t.length;){const a=t[i++],s=t[i++],u=e[a],c=n.data[a];null!==c.setInput?c.setInput(u,o,r,s):u[s]=o}}function gs(n,e,t){const r=rg(e,n);!function lA(n,e,t){n.setValue(e,t)}(n[dt],r,t)}function Og(n,e,t){let r=t?n.styles:null,o=t?n.classes:null,i=0;if(null!==e)for(let a=0;a<e.length;a++){const s=e[a];"number"==typeof s?i=s:1==i?o=g1(o,s):2==i&&(r=g1(r,s+": "+e[++a]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=o:n.classesWithoutHost=o}function Mg(n,e,t,r,o=!1){for(;null!==t;){const i=e[t.index];if(null!==i&&r.push(Sr(i)),Hi(i))for(let s=ro;s<i.length;s++){const u=i[s],c=u[ye].firstChild;null!==c&&Mg(u[ye],u,c,r)}const a=t.type;if(8&a)Mg(n,e,t.child,r);else if(32&a){const s=ny(t,e);let u;for(;u=s();)r.push(u)}else if(16&a){const s=_A(e,t);if(Array.isArray(s))r.push(...s);else{const u=Cd(e[Hr]);Mg(u[ye],u,s,r,!0)}}t=o?t.projectionNext:t.next}return r}class Rd{get rootNodes(){const e=this._lView,t=e[ye];return Mg(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ln]}set context(e){this._lView[Ln]=e}get destroyed(){return 128==(128&this._lView[at])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[Tn];if(Hi(e)){const t=e[tg],r=t?t.indexOf(this):-1;r>-1&&(sy(e,r),pg(t,r))}this._attachedToViewContainer=!1}dA(this._lView[ye],this._lView)}onDestroy(e){wI(this._lView[ye],this._lView,null,e)}markForCheck(){jy(this._cdRefInjectingView||this._lView)}detach(){this._lView[at]&=-65}reattach(){this._lView[at]|=64}detectChanges(){Ng(this._lView[ye],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ie(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function tU(n,e){Ed(n,e,e[dt],2,null,null)}(this._lView[ye],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ie(902,!1);this._appRef=e}}class dH extends Rd{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Ng(e[ye],e,e[Ln],!1)}checkNoChanges(){}get context(){return null}}class NI extends Il{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=qt(e);return new Nd(t,this.ngModule)}}function OI(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class pH{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){r=Kp(r);const o=this.injector.get(e,Dy,r);return o!==Dy||t===Dy?o:this.parentInjector.get(e,t,r)}}class Nd extends XA{get inputs(){return OI(this.componentDef.inputs)}get outputs(){return OI(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function w9(n){return n.map(x9).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,r,o){let i=(o=o||this.ngModule)instanceof Ca?o:o?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const a=i?new pH(e,i):e,s=a.get(YA,null);if(null===s)throw new ie(407,!1);const u=a.get(e9,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",f=r?function z9(n,e,t){return n.selectRootElement(e,t===xa.ShadowDom)}(c,r,this.componentDef.encapsulation):ay(c,l,function hH(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(l)),d=this.componentDef.onPush?288:272,h=Uy(0,null,null,1,0,null,null,null,null,null),p=Dg(null,h,null,d,null,null,s,c,u,a,null);let g,v;P1(p);try{const m=this.componentDef;let y,x=null;m.findHostDirectiveDefs?(y=[],x=new Map,m.findHostDirectiveDefs(m,y,x),y.push(m)):y=[m];const w=function vH(n,e){const t=n[ye],r=hn;return n[r]=e,Ol(t,r,2,"#host",null)}(p,f),_=function mH(n,e,t,r,o,i,a,s){const u=o[ye];!function yH(n,e,t,r){for(const o of n)e.mergedAttrs=pd(e.mergedAttrs,o.hostAttrs);null!==e.mergedAttrs&&(Og(e,e.mergedAttrs,!0),null!==t&&EA(r,t,e))}(r,n,e,a);const c=i.createRenderer(e,t),l=Dg(o,xI(t),null,t.onPush?32:16,o[n.index],n,i,c,s||null,null,null);return u.firstCreatePass&&Wy(u,n,r.length-1),Rg(o,l),o[n.index]=l}(w,f,m,y,p,s,c);v=dS(h,hn),f&&function wH(n,e,t,r){if(r)B1(n,t,["ng-version",t9.full]);else{const{attrs:o,classes:i}=function _9(n){const e=[],t=[];let r=1,o=2;for(;r<n.length;){let i=n[r];if("string"==typeof i)2===o?""!==i&&e.push(i,n[++r]):8===o&&t.push(i);else{if(!Gi(o))break;o=i}r++}return{attrs:e,classes:t}}(e.selectors[0]);o&&B1(n,t,o),i&&i.length>0&&CA(n,t,i.join(" "))}}(c,m,f,r),void 0!==t&&function _H(n,e,t){const r=n.projection=[];for(let o=0;o<e.length;o++){const i=t[o];r.push(null!=i?Array.from(i):null)}}(v,this.ngContentSelectors,t),g=function xH(n,e,t,r,o,i){const a=Ar(),s=o[ye],u=Xo(a,o);EI(s,o,a,t,null,r);for(let l=0;l<t.length;l++)Wr(ec(o,s,a.directiveStart+l,a),o);SI(s,o,a),u&&Wr(u,o);const c=ec(o,s,a.directiveStart+a.componentOffset,a);if(n[Ln]=o[Ln]=c,null!==i)for(const l of i)l(c,e);return Ly(s,a,n),c}(_,m,y,x,p,[bH]),Fy(h,p,null)}finally{k1()}return new gH(this.componentType,g,Dl(v,p),p,v)}}class gH extends XU{constructor(e,t,r,o,i){super(),this.location=r,this._rootLView=o,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new dH(o),this.componentType=e}setInput(e,t){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[e])){const i=this._rootLView;qy(i[ye],i,o,e,t),CI(i,this._tNode.index)}}get injector(){return new ml(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function bH(){const n=Ar();ig(ne()[ye],n)}function Jt(n){let e=function MI(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let o;if(Wi(n))o=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new ie(903,!1);o=e.\u0275dir}if(o){if(t){r.push(o);const a=n;a.inputs=Xy(n.inputs),a.declaredInputs=Xy(n.declaredInputs),a.outputs=Xy(n.outputs);const s=o.hostBindings;s&&AH(n,s);const u=o.viewQuery,c=o.contentQueries;if(u&&EH(n,u),c&&SH(n,c),p1(n.inputs,o.inputs),p1(n.declaredInputs,o.declaredInputs),p1(n.outputs,o.outputs),Wi(o)&&o.data.animation){const l=n.data;l.animation=(l.animation||[]).concat(o.data.animation)}}const i=o.features;if(i)for(let a=0;a<i.length;a++){const s=i[a];s&&s.ngInherit&&s(n),s===Jt&&(t=!1)}}e=Object.getPrototypeOf(e)}!function CH(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const o=n[r];o.hostVars=e+=o.hostVars,o.hostAttrs=pd(o.hostAttrs,t=pd(t,o.hostAttrs))}}(r)}function Xy(n){return n===us?{}:n===Bt?[]:n}function EH(n,e){const t=n.viewQuery;n.viewQuery=t?(r,o)=>{e(r,o),t(r,o)}:e}function SH(n,e){const t=n.contentQueries;n.contentQueries=t?(r,o,i)=>{e(r,o,i),t(r,o,i)}:e}function AH(n,e){const t=n.hostBindings;n.hostBindings=t?(r,o)=>{e(r,o),t(r,o)}:e}function Pg(n){return!!Ky(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function Ky(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Ia(n,e,t){return n[e]=t}function Gr(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Pl(n,e,t,r){return Gr(n,gl(),t)?e+Je(t)+r:tt}function kl(n,e,t,r,o,i){const s=function oc(n,e,t,r){const o=Gr(n,e,t);return Gr(n,e+1,r)||o}(n,function fs(){return et.lFrame.bindingIndex}(),t,o);return ds(2),s?e+Je(t)+r+Je(o)+i:tt}function pn(n,e,t,r,o,i,a,s){const u=ne(),c=St(),l=n+hn,f=c.firstCreatePass?function FH(n,e,t,r,o,i,a,s,u){const c=e.consts,l=Ol(e,n,4,a||null,Zs(c,s));Hy(e,t,l,Zs(c,u)),ig(e,l);const f=l.tView=Uy(2,l,r,o,i,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,l),f.queries=e.queries.embeddedTView(l)),l}(l,c,u,e,t,r,o,i,a):c.data[l];_a(f,!1);const d=u[dt].createComment("");xg(c,u,d,f),Wr(d,u),Rg(u,u[l]=AI(d,u,d,f)),ng(f)&&By(c,u,f),null!=a&&Vy(u,f,s)}function At(n,e,t){const r=ne();return Gr(r,gl(),e)&&Zo(St(),_n(),r,n,e,r[dt],t,!1),At}function Yy(n,e,t,r,o){const a=o?"class":"style";qy(n,t,e.inputs[a],a,r)}function J(n,e,t,r){const o=ne(),i=St(),a=hn+n,s=o[dt],u=i.firstCreatePass?function VH(n,e,t,r,o,i){const a=e.consts,u=Ol(e,n,2,r,Zs(a,o));return Hy(e,t,u,Zs(a,i)),null!==u.attrs&&Og(u,u.attrs,!1),null!==u.mergedAttrs&&Og(u,u.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,u),u}(a,i,o,e,t,r):i.data[a],c=o[a]=ay(s,e,function e7(){return et.lFrame.currentNamespace}()),l=ng(u);return _a(u,!0),EA(s,c,u),32!=(32&u.flags)&&xg(i,o,c,u),0===function BV(){return et.lFrame.elementDepthCount}()&&Wr(c,o),function VV(){et.lFrame.elementDepthCount++}(),l&&(By(i,o,u),Ly(i,u,o)),null!==r&&Vy(o,u),J}function ee(){let n=Ar();T1()?R1():(n=n.parent,_a(n,!1));const e=n;!function UV(){et.lFrame.elementDepthCount--}();const t=St();return t.firstCreatePass&&(ig(t,n),A1(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function o7(n){return 0!=(8&n.flags)}(e)&&Yy(t,e,ne(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function i7(n){return 0!=(16&n.flags)}(e)&&Yy(t,e,ne(),e.stylesWithoutHost,!1),ee}function sn(n,e,t,r){return J(n,e,t,r),ee(),sn}function Ta(n,e,t){const r=ne(),o=St(),i=n+hn,a=o.firstCreatePass?function UH(n,e,t,r,o){const i=e.consts,a=Zs(i,r),s=Ol(e,n,8,"ng-container",a);return null!==a&&Og(s,a,!0),Hy(e,t,s,Zs(i,o)),null!==e.queries&&e.queries.elementStart(e,s),s}(i,o,r,e,t):o.data[i];_a(a,!0);const s=r[i]=r[dt].createComment("");return xg(o,r,s,a),Wr(s,r),ng(a)&&(By(o,r,a),Ly(o,a,r)),null!=t&&Vy(r,a),Ta}function Ra(){let n=Ar();const e=St();return T1()?R1():(n=n.parent,_a(n,!1)),e.firstCreatePass&&(ig(e,n),A1(n)&&e.queries.elementEnd(n)),Ra}function Na(){return ne()}function Md(n){return!!n&&"function"==typeof n.then}const Zy=function qI(n){return!!n&&"function"==typeof n.subscribe};function de(n,e,t,r){const o=ne(),i=St(),a=Ar();return function KI(n,e,t,r,o,i,a){const s=ng(r),c=n.firstCreatePass&&DI(n),l=e[Ln],f=II(e);let d=!0;if(3&r.type||a){const g=Xo(r,e),v=a?a(g):g,m=f.length,y=a?w=>a(Sr(w[r.index])):r.index;let x=null;if(!a&&s&&(x=function HH(n,e,t,r){const o=n.cleanup;if(null!=o)for(let i=0;i<o.length-1;i+=2){const a=o[i];if(a===t&&o[i+1]===r){const s=e[ll],u=o[i+2];return s.length>u?s[u]:null}"string"==typeof a&&(i+=2)}return null}(n,e,o,r.index)),null!==x)(x.__ngLastListenerFn__||x).__ngNextListenerFn__=i,x.__ngLastListenerFn__=i,d=!1;else{i=ZI(r,e,l,i,!1);const w=t.listen(v,o,i);f.push(i,w),c&&c.push(o,y,m,m+1)}}else i=ZI(r,e,l,i,!1);const h=r.outputs;let p;if(d&&null!==h&&(p=h[o])){const g=p.length;if(g)for(let v=0;v<g;v+=2){const _=e[p[v]][p[v+1]].subscribe(i),b=f.length;f.push(i,_),c&&c.push(o,r.index,b,-(b+1))}}}(i,o,o[dt],a,n,e,r),de}function YI(n,e,t,r){try{return vi(6,e,t),!1!==t(r)}catch(o){return RI(n,o),!1}finally{vi(7,e,t)}}function ZI(n,e,t,r,o){return function i(a){if(a===Function)return r;jy(n.componentOffset>-1?Ko(n.index,e):e);let u=YI(e,t,r,a),c=i.__ngNextListenerFn__;for(;c;)u=YI(e,t,c,a)&&u,c=c.__ngNextListenerFn__;return o&&!1===u&&(a.preventDefault(),a.returnValue=!1),u}}function ue(n=1){return function XV(n){return(et.lFrame.contextLView=function KV(n,e){for(;n>0;)e=e[fl],n--;return e}(n,et.lFrame.contextLView))[Ln]}(n)}function Qy(n,e,t){return Jy(n,"",e,"",t),Qy}function Jy(n,e,t,r,o){const i=ne(),a=Pl(i,e,t,r);return a!==tt&&Zo(St(),_n(),i,n,a,i[dt],o,!1),Jy}function Fg(n,e){return n<<17|e<<2}function Js(n){return n>>17&32767}function ex(n){return 2|n}function ic(n){return(131068&n)>>2}function tx(n,e){return-131069&n|e<<2}function nx(n){return 1|n}function aD(n,e,t,r,o){const i=n[t+1],a=null===e;let s=r?Js(i):ic(i),u=!1;for(;0!==s&&(!1===u||a);){const l=n[s+1];YH(n[s],e)&&(u=!0,n[s+1]=r?nx(l):ex(l)),s=r?Js(l):ic(l)}u&&(n[t+1]=r?ex(i):nx(i))}function YH(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&bl(n,e)>=0}function rx(n,e,t){return zi(n,e,t,!1),rx}function Lg(n,e){return zi(n,e,null,!0),Lg}function zi(n,e,t,r){const o=ne(),i=St(),a=ds(2);i.firstUpdatePass&&function pD(n,e,t,r){const o=n.data;if(null===o[t+1]){const i=o[io()],a=function hD(n,e){return e>=n.expandoStartIndex}(n,t);(function yD(n,e){return 0!=(n.flags&(e?8:16))})(i,r)&&null===e&&!a&&(e=!1),e=function iW(n,e,t,r){const o=function O1(n){const e=et.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let i=r?e.residualClasses:e.residualStyles;if(null===o)0===(r?e.classBindings:e.styleBindings)&&(t=Pd(t=ox(null,n,e,t,r),e.attrs,r),i=null);else{const a=e.directiveStylingLast;if(-1===a||n[a]!==o)if(t=ox(o,n,e,t,r),null===i){let u=function aW(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==ic(r))return n[Js(r)]}(n,e,r);void 0!==u&&Array.isArray(u)&&(u=ox(null,n,e,u[1],r),u=Pd(u,e.attrs,r),function sW(n,e,t,r){n[Js(t?e.classBindings:e.styleBindings)]=r}(n,e,r,u))}else i=function uW(n,e,t){let r;const o=e.directiveEnd;for(let i=1+e.directiveStylingLast;i<o;i++)r=Pd(r,n[i].hostAttrs,t);return Pd(r,e.attrs,t)}(n,e,r)}return void 0!==i&&(r?e.residualClasses=i:e.residualStyles=i),t}(o,i,e,r),function XH(n,e,t,r,o,i){let a=i?e.classBindings:e.styleBindings,s=Js(a),u=ic(a);n[r]=t;let l,c=!1;if(Array.isArray(t)?(l=t[1],(null===l||bl(t,l)>0)&&(c=!0)):l=t,o)if(0!==u){const d=Js(n[s+1]);n[r+1]=Fg(d,s),0!==d&&(n[d+1]=tx(n[d+1],r)),n[s+1]=function $H(n,e){return 131071&n|e<<17}(n[s+1],r)}else n[r+1]=Fg(s,0),0!==s&&(n[s+1]=tx(n[s+1],r)),s=r;else n[r+1]=Fg(u,0),0===s?s=r:n[u+1]=tx(n[u+1],r),u=r;c&&(n[r+1]=ex(n[r+1])),aD(n,l,r,!0),aD(n,l,r,!1),function KH(n,e,t,r,o){const i=o?n.residualClasses:n.residualStyles;null!=i&&"string"==typeof e&&bl(i,e)>=0&&(t[r+1]=nx(t[r+1]))}(e,l,n,r,i),a=Fg(s,u),i?e.classBindings=a:e.styleBindings=a}(o,i,e,t,a,r)}}(i,n,a,r),e!==tt&&Gr(o,a,e)&&function vD(n,e,t,r,o,i,a,s){if(!(3&e.type))return;const u=n.data,c=u[s+1],l=function qH(n){return 1==(1&n)}(c)?mD(u,e,t,o,ic(c),a):void 0;Bg(l)||(Bg(i)||function jH(n){return 2==(2&n)}(c)&&(i=mD(u,null,t,o,s,a)),function fU(n,e,t,r,o){if(e)o?n.addClass(t,r):n.removeClass(t,r);else{let i=-1===r.indexOf("-")?void 0:So.DashCase;null==o?n.removeStyle(t,r,i):("string"==typeof o&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=So.Important),n.setStyle(t,r,o,i))}}(r,a,rg(io(),t),o,i))}(i,i.data[io()],o,o[dt],n,o[a+1]=function fW(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=on(Qs(n)))),n}(e,t),r,a)}function ox(n,e,t,r,o){let i=null;const a=t.directiveEnd;let s=t.directiveStylingLast;for(-1===s?s=t.directiveStart:s++;s<a&&(i=e[s],r=Pd(r,i.hostAttrs,o),i!==n);)s++;return null!==n&&(t.directiveStylingLast=s),r}function Pd(n,e,t){const r=t?1:2;let o=-1;if(null!==e)for(let i=0;i<e.length;i++){const a=e[i];"number"==typeof a?o=a:o===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Yo(n,a,!!t||e[++i]))}return void 0===n?null:n}function mD(n,e,t,r,o,i){const a=null===e;let s;for(;o>0;){const u=n[o],c=Array.isArray(u),l=c?u[1]:u,f=null===l;let d=t[o+1];d===tt&&(d=f?Bt:void 0);let h=f?$1(d,r):l===r?d:void 0;if(c&&!Bg(h)&&(h=$1(u,r)),Bg(h)&&(s=h,a))return s;const p=n[o+1];o=a?Js(p):ic(p)}if(null!==e){let u=i?e.residualClasses:e.residualStyles;null!=u&&(s=$1(u,r))}return s}function Bg(n){return void 0!==n}function ae(n,e=""){const t=ne(),r=St(),o=n+hn,i=r.firstCreatePass?Ol(r,o,1,e,null):r.data[o],a=t[o]=function iy(n,e){return n.createText(e)}(t[dt],e);xg(r,t,a,i),_a(i,!1)}function zr(n){return xi("",n,""),zr}function xi(n,e,t){const r=ne(),o=Pl(r,n,e,t);return o!==tt&&gs(r,io(),o),xi}function Vg(n,e,t,r,o){const i=ne(),a=kl(i,n,e,t,r,o);return a!==tt&&gs(i,io(),a),Vg}const zl="en-US";let VD=zl;function sx(n,e,t,r,o){if(n=We(n),Array.isArray(n))for(let i=0;i<n.length;i++)sx(n[i],e,t,r,o);else{const i=St(),a=ne();let s=rc(n)?n:We(n.provide),u=qA(n);const c=Ar(),l=1048575&c.providerIndexes,f=c.directiveStart,d=c.providerIndexes>>20;if(rc(n)||!n.multi){const h=new hd(u,o,Q),p=cx(s,e,o?l:l+d,f);-1===p?(W1(fg(c,a),i,s),ux(i,n,e.length),e.push(s),c.directiveStart++,c.directiveEnd++,o&&(c.providerIndexes+=1048576),t.push(h),a.push(h)):(t[p]=h,a[p]=h)}else{const h=cx(s,e,l+d,f),p=cx(s,e,l,l+d),v=p>=0&&t[p];if(o&&!v||!o&&!(h>=0&&t[h])){W1(fg(c,a),i,s);const m=function TG(n,e,t,r,o){const i=new hd(n,t,Q);return i.multi=[],i.index=e,i.componentProviders=0,lT(i,o,r&&!t),i}(o?DG:IG,t.length,o,r,u);!o&&v&&(t[p].providerFactory=m),ux(i,n,e.length,0),e.push(s),c.directiveStart++,c.directiveEnd++,o&&(c.providerIndexes+=1048576),t.push(m),a.push(m)}else ux(i,n,h>-1?h:p,lT(t[o?p:h],u,!o&&r));!o&&r&&v&&t[p].componentProviders++}}}function ux(n,e,t,r){const o=rc(e),i=function HU(n){return!!n.useClass}(e);if(o||i){const u=(i?We(e.useClass):e).prototype.ngOnDestroy;if(u){const c=n.destroyHooks||(n.destroyHooks=[]);if(!o&&e.multi){const l=c.indexOf(t);-1===l?c.push(t,[r,u]):c[l+1].push(r,u)}else c.push(t,u)}}}function lT(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function cx(n,e,t,r){for(let o=t;o<r;o++)if(e[o]===n)return o;return-1}function IG(n,e,t,r){return lx(this.multi,[])}function DG(n,e,t,r){const o=this.multi;let i;if(this.providerFactory){const a=this.providerFactory.componentProviders,s=ec(t,t[ye],this.providerFactory.index,r);i=s.slice(0,a),lx(o,i);for(let u=a;u<s.length;u++)i.push(s[u])}else i=[],lx(o,i);return i}function lx(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function xn(n,e=[]){return t=>{t.providersResolver=(r,o)=>function AG(n,e,t){const r=St();if(r.firstCreatePass){const o=Wi(n);sx(t,r.data,r.blueprint,o,!0),sx(e,r.data,r.blueprint,o,!1)}}(r,o?o(n):n,e)}}class jl{}class fT{}class dT extends jl{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new NI(this);const r=jo(e);this._bootstrapComponents=ps(r.bootstrap),this._r3Injector=cI(e,t,[{provide:jl,useValue:this},{provide:Il,useValue:this.componentFactoryResolver}],on(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class fx extends fT{constructor(e){super(),this.moduleType=e}create(e){return new dT(this.moduleType,e)}}class NG extends jl{constructor(e,t,r){super(),this.componentFactoryResolver=new NI(this),this.instance=null;const o=new $A([...e,{provide:jl,useValue:this},{provide:Il,useValue:this.componentFactoryResolver}],t||Ag(),r,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function zg(n,e,t=null){return new NG(n,e,t).injector}let OG=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const r=WA(0,t.type),o=r.length>0?zg([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,o)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Ae({token:n,providedIn:"environment",factory:()=>new n(me(Ca))}),n})();function hT(n){n.getStandaloneInjector=e=>e.get(OG).getOrCreateStandaloneInjector(n)}function _T(n,e,t,r,o,i){const a=e+t;return Gr(n,a,o)?Ia(n,a+1,i?r.call(i,o):r(o)):function Ud(n,e){const t=n[e];return t===tt?void 0:t}(n,a+1)}function IT(n,e,t){const r=n+hn,o=ne(),i=function pl(n,e){return n[e]}(o,r);return function Hd(n,e){return n[ye].data[e].pure}(o,r)?_T(o,oo(),e,i.transform,t,i):i.transform(t)}function hx(n){return e=>{setTimeout(n,void 0,e)}}const bt=class tz extends Li{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){let o=e,i=t||(()=>null),a=r;if(e&&"object"==typeof e){const u=e;o=u.next?.bind(u),i=u.error?.bind(u),a=u.complete?.bind(u)}this.__isAsync&&(i=hx(i),o&&(o=hx(o)),a&&(a=hx(a)));const s=super.subscribe({next:o,error:i,complete:a});return e instanceof gr&&e.add(s),s}};function nz(){return this._results[Symbol.iterator]()}class px{get changes(){return this._changes||(this._changes=new bt)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=px.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=nz)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const o=function mi(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function g7(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let o=n[r],i=e[r];if(t&&(o=t(o),i=t(i)),i!==o)return!1}return!0}(r._results,o,t))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let $i=(()=>{class n{}return n.__NG_ELEMENT_ID__=iz,n})();const rz=$i,oz=class extends rz{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e,t){const r=this._declarationTContainer.tView,o=Dg(this._declarationLView,r,e,16,null,r.declTNode,null,null,null,null,t||null);o[cd]=this._declarationLView[this._declarationTContainer.index];const a=this._declarationLView[wa];return null!==a&&(o[wa]=a.createEmbeddedView(r)),Fy(r,o,e),new Rd(o)}};function iz(){return jg(Ar(),ne())}function jg(n,e){return 4&n.type?new oz(e,n,Dl(n,e)):null}let wi=(()=>{class n{}return n.__NG_ELEMENT_ID__=az,n})();function az(){return RT(Ar(),ne())}const sz=wi,DT=class extends sz{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return Dl(this._hostTNode,this._hostLView)}get injector(){return new ml(this._hostTNode,this._hostLView)}get parentInjector(){const e=H1(this._hostTNode,this._hostLView);if(RS(e)){const t=cg(e,this._hostLView),r=ug(e);return new ml(t[ye].data[r+8],t)}return new ml(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=TT(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-ro}createEmbeddedView(e,t,r){let o,i;"number"==typeof r?o=r:null!=r&&(o=r.index,i=r.injector);const a=e.createEmbeddedView(t||{},i);return this.insert(a,o),a}createComponent(e,t,r,o,i){const a=e&&!function vd(n){return"function"==typeof n}(e);let s;if(a)s=t;else{const f=t||{};s=f.index,r=f.injector,o=f.projectableNodes,i=f.environmentInjector||f.ngModuleRef}const u=a?e:new Nd(qt(e)),c=r||this.parentInjector;if(!i&&null==u.ngModule){const d=(a?c:this.parentInjector).get(Ca,null);d&&(i=d)}const l=u.create(c,o,void 0,i);return this.insert(l.hostView,s),l}insert(e,t){const r=e._lView,o=r[ye];if(function LV(n){return Hi(n[Tn])}(r)){const l=this.indexOf(e);if(-1!==l)this.detach(l);else{const f=r[Tn],d=new DT(f,f[Ur],f[Tn]);d.detach(d.indexOf(e))}}const i=this._adjustIndex(t),a=this._lContainer;!function rU(n,e,t,r){const o=ro+r,i=t.length;r>0&&(t[o-1][Ui]=e),r<i-ro?(e[Ui]=t[o],WS(t,ro+r,e)):(t.push(e),e[Ui]=null),e[Tn]=t;const a=e[cd];null!==a&&t!==a&&function oU(n,e){const t=n[hl];e[Hr]!==e[Tn][Tn][Hr]&&(n[oS]=!0),null===t?n[hl]=[e]:t.push(e)}(a,e);const s=e[wa];null!==s&&s.insertView(n),e[at]|=64}(o,r,a,i);const s=ly(i,a),u=r[dt],c=yg(u,a[eg]);return null!==c&&function eU(n,e,t,r,o,i){r[ls]=o,r[Ur]=e,Ed(n,r,t,1,o,i)}(o,a[Ur],u,r,c,s),e.attachToViewContainerRef(),WS(gx(a),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=TT(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=sy(this._lContainer,t);r&&(pg(gx(this._lContainer),t),dA(r[ye],r))}detach(e){const t=this._adjustIndex(e,-1),r=sy(this._lContainer,t);return r&&null!=pg(gx(this._lContainer),t)?new Rd(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function TT(n){return n[tg]}function gx(n){return n[tg]||(n[tg]=[])}function RT(n,e){let t;const r=e[n.index];if(Hi(r))t=r;else{let o;if(8&n.type)o=Sr(r);else{const i=e[dt];o=i.createComment("");const a=Xo(n,e);nc(i,yg(i,a),o,function uU(n,e){return n.nextSibling(e)}(i,a),!1)}e[n.index]=t=AI(r,e,o,n),Rg(e,t)}return new DT(t,n,e)}class vx{constructor(e){this.queryList=e,this.matches=null}clone(){return new vx(this.queryList)}setDirty(){this.queryList.setDirty()}}class mx{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,o=[];for(let i=0;i<r;i++){const a=t.getByIndex(i);o.push(this.queries[a.indexInDeclarationView].clone())}return new mx(o)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==FT(e,t).matches&&this.queries[t].setDirty()}}class NT{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class yx{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const o=null!==t?t.length:0,i=this.getByIndex(r).embeddedTView(e,o);i&&(i.indexInDeclarationView=r,null!==t?t.push(i):t=[i])}return null!==t?new yx(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class xx{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new xx(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const i=r[o];this.matchTNodeWithReadOption(e,t,uz(t,i)),this.matchTNodeWithReadOption(e,t,dg(t,e,i,!1,!1))}else r===$i?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,dg(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===ao||o===wi||o===$i&&4&t.type)this.addMatch(t.index,-2);else{const i=dg(t,e,o,!1,!1);null!==i&&this.addMatch(t.index,i)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function uz(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function lz(n,e,t,r){return-1===t?function cz(n,e){return 11&n.type?Dl(n,e):4&n.type?jg(n,e):null}(e,n):-2===t?function fz(n,e,t){return t===ao?Dl(e,n):t===$i?jg(e,n):t===wi?RT(e,n):void 0}(n,e,r):ec(n,n[ye],t,e)}function OT(n,e,t,r){const o=e[wa].queries[r];if(null===o.matches){const i=n.data,a=t.matches,s=[];for(let u=0;u<a.length;u+=2){const c=a[u];s.push(c<0?null:lz(e,i[c],a[u+1],t.metadata.read))}o.matches=s}return o.matches}function wx(n,e,t,r){const o=n.queries.getByIndex(t),i=o.matches;if(null!==i){const a=OT(n,e,o,t);for(let s=0;s<i.length;s+=2){const u=i[s];if(u>0)r.push(a[s/2]);else{const c=i[s+1],l=e[-u];for(let f=ro;f<l.length;f++){const d=l[f];d[cd]===d[Tn]&&wx(d[ye],d,c,r)}if(null!==l[hl]){const f=l[hl];for(let d=0;d<f.length;d++){const h=f[d];wx(h[ye],h,c,r)}}}}}return r}function $l(n){const e=ne(),t=St(),r=wS();M1(r+1);const o=FT(t,r);if(n.dirty&&function FV(n){return 4==(4&n[at])}(e)===(2==(2&o.metadata.flags))){if(null===o.matches)n.reset([]);else{const i=o.crossesNgTemplate?wx(t,e,r,[]):OT(t,e,o,r);n.reset(i,QU),n.notifyOnChanges()}return!0}return!1}function Wd(n,e,t){const r=St();r.firstCreatePass&&(function kT(n,e,t){null===n.queries&&(n.queries=new yx),n.queries.track(new xx(e,t))}(r,new NT(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function PT(n,e,t){const r=new px(4==(4&t));wI(n,e,r,r.destroy),null===e[wa]&&(e[wa]=new mx),e[wa].queries.push(new vx(r))}(r,ne(),e)}function ql(){return function dz(n,e){return n[wa].queries[e].queryList}(ne(),wS())}function FT(n,e){return n.queries.getByIndex(e)}function qg(...n){}const Xg=new ge("Application Initializer");let Kg=(()=>{class n{constructor(t){this.appInits=t,this.resolve=qg,this.reject=qg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const i=this.appInits[o]();if(Md(i))t.push(i);else if(Zy(i)){const a=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});t.push(a)}}Promise.all(t).then(()=>{r()}).catch(o=>{this.reject(o)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(me(Xg,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const zd=new ge("AppId",{providedIn:"root",factory:function eR(){return`${Ax()}${Ax()}${Ax()}`}});function Ax(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const tR=new ge("Platform Initializer"),Yg=new ge("Platform ID",{providedIn:"platform",factory:()=>"unknown"});let Pz=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const vs=new ge("LocaleId",{providedIn:"root",factory:()=>ft(vs,Ge.Optional|Ge.SkipSelf)||function kz(){return typeof $localize<"u"&&$localize.locale||zl}()});class Lz{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let nR=(()=>{class n{compileModuleSync(t){return new fx(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),i=ps(jo(t).declarations).reduce((a,s)=>{const u=qt(s);return u&&a.push(new Nd(u)),a},[]);return new Lz(r,i)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Uz=(()=>Promise.resolve(0))();function Ix(n){typeof Zone>"u"?Uz.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Bn{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new bt(!1),this.onMicrotaskEmpty=new bt(!1),this.onStable=new bt(!1),this.onError=new bt(!1),typeof Zone>"u")throw new ie(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&t,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function Hz(){let n=dn.requestAnimationFrame,e=dn.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function zz(n){const e=()=>{!function Gz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(dn,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Tx(n),n.isCheckStableRunning=!0,Dx(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Tx(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,o,i,a,s)=>{try{return iR(n),t.invokeTask(o,i,a,s)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||n.shouldCoalesceRunChangeDetection)&&e(),aR(n)}},onInvoke:(t,r,o,i,a,s,u)=>{try{return iR(n),t.invoke(o,i,a,s,u)}finally{n.shouldCoalesceRunChangeDetection&&e(),aR(n)}},onHasTask:(t,r,o,i)=>{t.hasTask(o,i),r===o&&("microTask"==i.change?(n._hasPendingMicrotasks=i.microTask,Tx(n),Dx(n)):"macroTask"==i.change&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,r,o,i)=>(t.handleError(o,i),n.runOutsideAngular(()=>n.onError.emit(i)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Bn.isInAngularZone())throw new ie(909,!1)}static assertNotInAngularZone(){if(Bn.isInAngularZone())throw new ie(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,o){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+o,e,Wz,qg,qg);try{return i.runTask(a,t,r)}finally{i.cancelTask(a)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const Wz={};function Dx(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Tx(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function iR(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function aR(n){n._nesting--,Dx(n)}class jz{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new bt,this.onMicrotaskEmpty=new bt,this.onStable=new bt,this.onError=new bt}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,o){return e.apply(t,r)}}const sR=new ge(""),Zg=new ge("");let Ox,Rx=(()=>{class n{constructor(t,r,o){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ox||(function $z(n){Ox=n}(o),o.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Bn.assertNotInAngularZone(),Ix(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ix(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,o){let i=-1;r&&r>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==i),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:i,updateCb:o})}whenStable(t,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,o){return[]}}return n.\u0275fac=function(t){return new(t||n)(me(Bn),me(Nx),me(Zg))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),Nx=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return Ox?.findTestabilityInTree(this,t,r)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const ms=!1;let eu=null;const uR=new ge("AllowMultipleToken"),Mx=new ge("PlatformDestroyListeners"),cR=new ge("appBootstrapListener");class lR{constructor(e,t){this.name=e,this.token=t}}function dR(n,e,t=[]){const r=`Platform: ${e}`,o=new ge(r);return(i=[])=>{let a=Px();if(!a||a.injector.get(uR,!1)){const s=[...t,...i,{provide:o,useValue:!0}];n?n(s):function Kz(n){if(eu&&!eu.get(uR,!1))throw new ie(400,!1);eu=n;const e=n.get(pR);(function fR(n){const e=n.get(tR,null);e&&e.forEach(t=>t())})(n)}(function hR(n=[],e){return Sa.create({name:e,providers:[{provide:Ey,useValue:"platform"},{provide:Mx,useValue:new Set([()=>eu=null])},...n]})}(s,r))}return function Zz(n){const e=Px();if(!e)throw new ie(401,!1);return e}()}}function Px(){return eu?.get(pR)??null}let pR=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const o=function vR(n,e){let t;return t="noop"===n?new jz:("zone.js"===n?void 0:n)||new Bn(e),t}(r?.ngZone,function gR(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(r)),i=[{provide:Bn,useValue:o}];return o.run(()=>{const a=Sa.create({providers:i,parent:this.injector,name:t.moduleType.name}),s=t.create(a),u=s.injector.get(Tl,null);if(!u)throw new ie(402,!1);return o.runOutsideAngular(()=>{const c=o.onError.subscribe({next:l=>{u.handleError(l)}});s.onDestroy(()=>{Jg(this._modules,s),c.unsubscribe()})}),function mR(n,e,t){try{const r=t();return Md(r)?r.catch(o=>{throw e.runOutsideAngular(()=>n.handleError(o)),o}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(u,o,()=>{const c=s.injector.get(Kg);return c.runInitializers(),c.donePromise.then(()=>(function UD(n){pi(n,"Expected localeId to be defined"),"string"==typeof n&&(VD=n.toLowerCase().replace(/_/g,"-"))}(s.injector.get(vs,zl)||zl),this._moduleDoBootstrap(s),s))})})}bootstrapModule(t,r=[]){const o=yR({},r);return function qz(n,e,t){const r=new fx(t);return Promise.resolve(r)}(0,0,t).then(i=>this.bootstrapModuleFactory(i,o))}_moduleDoBootstrap(t){const r=t.injector.get(Qg);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!t.instance.ngDoBootstrap)throw new ie(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ie(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(Mx,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(me(Sa))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function yR(n,e){return Array.isArray(e)?e.reduce(yR,n):{...n,...e}}let Qg=(()=>{class n{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(t,r,o){this._zone=t,this._injector=r,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const i=new In(s=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{s.next(this._stable),s.complete()})}),a=new In(s=>{let u;this._zone.runOutsideAngular(()=>{u=this._zone.onStable.subscribe(()=>{Bn.assertNotInAngularZone(),Ix(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,s.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{Bn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{s.next(!1)}))});return()=>{u.unsubscribe(),c.unsubscribe()}});this.isStable=function nV(...n){const e=rd(n),t=function K5(n,e){return"number"==typeof d1(n)?n.pop():e}(n,1/0),r=n;return r.length?1===r.length?Go(r[0]):sl(t)(Dn(r,e)):Bi}(i,a.pipe(zE()))}bootstrap(t,r){const o=t instanceof XA;if(!this._injector.get(Kg).done){!o&&function cl(n){const e=qt(n)||Vr(n)||Eo(n);return null!==e&&e.standalone}(t);throw new ie(405,ms)}let a;a=o?t:this._injector.get(Il).resolveComponentFactory(t),this.componentTypes.push(a.componentType);const s=function Xz(n){return n.isBoundToModule}(a)?void 0:this._injector.get(jl),c=a.create(Sa.NULL,[],r||a.selector,s),l=c.location.nativeElement,f=c.injector.get(sR,null);return f?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),Jg(this.components,c),f?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new ie(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;Jg(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(cR,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Jg(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ie(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(me(Bn),me(Ca),me(Tl))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Jg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let jd=(()=>{class n{}return n.__NG_ELEMENT_ID__=ej,n})();function ej(n){return function tj(n,e,t){if(fd(n)&&!t){const r=Ko(n.index,e);return new Rd(r,r)}return 47&n.type?new Rd(e[Hr],e):null}(Ar(),ne(),16==(16&n))}class CR{constructor(){}supports(e){return Pg(e)}create(e){return new sj(e)}}const aj=(n,e)=>e;class sj{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||aj}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,o=0,i=null;for(;t||r;){const a=!r||t&&t.currentIndex<SR(r,o,i)?t:r,s=SR(a,o,i),u=a.currentIndex;if(a===r)o--,r=r._nextRemoved;else if(t=t._next,null==a.previousIndex)o++;else{i||(i=[]);const c=s-o,l=u-o;if(c!=l){for(let d=0;d<c;d++){const h=d<i.length?i[d]:i[d]=0,p=h+d;l<=p&&p<c&&(i[d]=h+1)}i[a.previousIndex]=l-c}}s!==u&&e(a,s,u)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Pg(e))throw new ie(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let o,i,a,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let s=0;s<this.length;s++)i=e[s],a=this._trackByFn(s,i),null!==t&&Object.is(t.trackById,a)?(r&&(t=this._verifyReinsertion(t,i,a,s)),Object.is(t.item,i)||this._addIdentityChange(t,i)):(t=this._mismatch(t,i,a,s),r=!0),t=t._next}else o=0,function MH(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,s=>{a=this._trackByFn(o,s),null!==t&&Object.is(t.trackById,a)?(r&&(t=this._verifyReinsertion(t,s,a,o)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,a,o),r=!0),t=t._next,o++}),this.length=o;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,o){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,o)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,o)):e=this._addAfter(new uj(t,r),i,o),e}_verifyReinsertion(e,t,r,o){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?e=this._reinsertAfter(i,e._prev,o):e.currentIndex!=o&&(e.currentIndex=o,this._addToMoves(e,o)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const o=e._prevRemoved,i=e._nextRemoved;return null===o?this._removalsHead=i:o._nextRemoved=i,null===i?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const o=null===t?this._itHead:t._next;return e._next=o,e._prev=t,null===o?this._itTail=e:o._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new ER),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ER),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class uj{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class cj{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class ER{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new cj,this.map.set(t,r)),r.add(e)}get(e,t){const o=this.map.get(e);return o?o.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function SR(n,e,t){const r=n.previousIndex;if(null===r)return r;let o=0;return t&&r<t.length&&(o=t[r]),r+e+o}class AR{constructor(){}supports(e){return e instanceof Map||Ky(e)}create(){return new lj}}class lj{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Ky(e)))throw new ie(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,o)=>{if(t&&t.key===o)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const i=this._getOrCreateRecordForKey(o,r);t=this._insertBeforeOrAppend(t,i)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const o=this._records.get(e);this._maybeAddToChanges(o,t);const i=o._prev,a=o._next;return i&&(i._next=a),a&&(a._prev=i),o._next=null,o._prev=null,o}const r=new fj(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class fj{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function IR(){return new nv([new CR])}let nv=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const o=r.factories.slice();t=t.concat(o)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||IR()),deps:[[n,new xd,new yd]]}}find(t){const r=this.factories.find(o=>o.supports(t));if(null!=r)return r;throw new ie(901,!1)}}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:IR}),n})();function DR(){return new $d([new AR])}let $d=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(r){const o=r.factories.slice();t=t.concat(o)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||DR()),deps:[[n,new xd,new yd]]}}find(t){const r=this.factories.find(o=>o.supports(t));if(r)return r;throw new ie(901,!1)}}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:DR}),n})();const pj=dR(null,"core",[]);let gj=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(me(Qg))},n.\u0275mod=bo({type:n}),n.\u0275inj=no({}),n})(),Vx=null;function ys(){return Vx}class yj{}const co=new ge("DocumentToken");let Ux=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return function xj(){return me(TR)}()},providedIn:"platform"}),n})();const wj=new ge("Location Initialized");let TR=(()=>{class n extends Ux{constructor(t){super(),this._doc=t,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ys().getBaseHref(this._doc)}onPopState(t){const r=ys().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=ys().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,o){RR()?this._history.pushState(t,r,o):this._location.hash=o}replaceState(t,r,o){RR()?this._history.replaceState(t,r,o):this._location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(me(co))},n.\u0275prov=Ae({token:n,factory:function(){return function _j(){return new TR(me(co))}()},providedIn:"platform"}),n})();function RR(){return!!window.history.pushState}function Hx(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function NR(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function xs(n){return n&&"?"!==n[0]?"?"+n:n}let uc=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ft(MR)},providedIn:"root"}),n})();const OR=new ge("appBaseHref");let MR=(()=>{class n extends uc{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ft(co).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Hx(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+xs(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${r}${o}`:r}pushState(t,r,o,i){const a=this.prepareExternalUrl(o+xs(i));this._platformLocation.pushState(t,r,a)}replaceState(t,r,o,i){const a=this.prepareExternalUrl(o+xs(i));this._platformLocation.replaceState(t,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(me(Ux),me(OR,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),bj=(()=>{class n extends uc{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Hx(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,o,i){let a=this.prepareExternalUrl(o+xs(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(t,r,a)}replaceState(t,r,o,i){let a=this.prepareExternalUrl(o+xs(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(me(Ux),me(OR,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),Wx=(()=>{class n{constructor(t){this._subject=new bt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function Sj(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(NR(PR(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+xs(r))}normalize(t){return n.stripTrailingSlash(function Ej(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,PR(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",o=null){this._locationStrategy.pushState(o,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+xs(r)),o)}replaceState(t,r="",o=null){this._locationStrategy.replaceState(o,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+xs(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(o=>o(t,r))}subscribe(t,r,o){return this._subject.subscribe({next:t,error:r,complete:o})}}return n.normalizeQueryParams=xs,n.joinWithSlash=Hx,n.stripTrailingSlash=NR,n.\u0275fac=function(t){return new(t||n)(me(uc))},n.\u0275prov=Ae({token:n,factory:function(){return function Cj(){return new Wx(me(uc))}()},providedIn:"root"}),n})();function PR(n){return n.replace(/\/index.html$/,"")}function GR(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[o,i]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(o.trim()===e)return decodeURIComponent(i)}return null}const Qx=/\s+/,zR=[];let jR=(()=>{class n{constructor(t,r,o,i){this._iterableDiffers=t,this._keyValueDiffers=r,this._ngEl=o,this._renderer=i,this.initialClasses=zR,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(Qx):zR}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(Qx):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,Boolean(t[r]));this._applyStateDiff()}_updateState(t,r){const o=this.stateMap.get(t);void 0!==o?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],o=t[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split(Qx).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}}return n.\u0275fac=function(t){return new(t||n)(Q(nv),Q($d),Q(ao),Q(Ea))},n.\u0275dir=je({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class c${constructor(e,t,r,o){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let XR=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,o){this._viewContainer=t,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((o,i,a)=>{if(null==o.previousIndex)r.createEmbeddedView(this._template,new c$(o.item,this._ngForOf,-1,-1),null===a?void 0:a);else if(null==a)r.remove(null===i?void 0:i);else if(null!==i){const s=r.get(i);r.move(s,a),KR(s,o)}});for(let o=0,i=r.length;o<i;o++){const s=r.get(o).context;s.index=o,s.count=i,s.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{KR(r.get(o.currentIndex),o)})}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(Q(wi),Q($i),Q(nv))},n.\u0275dir=je({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function KR(n,e){n.context.$implicit=e.item}let Kd=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new f$,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){YR("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){YR("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(Q(wi),Q($i))},n.\u0275dir=je({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class f${constructor(){this.$implicit=null,this.ngIf=null}}function YR(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${on(e)}'.`)}let QR=(()=>{class n{transform(t){return JSON.stringify(t,null,2)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=Co({name:"json",type:n,pure:!1,standalone:!0}),n})(),e3=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({}),n})();const t3="browser";let V$=(()=>{class n{}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:()=>new U$(me(co),window)}),n})();class U${constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function H$(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const i=o.shadowRoot;if(i){const a=i.getElementById(e)||i.querySelector(`[name="${e}"]`);if(a)return a}o=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,o=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],o-i[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=n3(this.window.history)||n3(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function n3(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class r3{}class pq extends yj{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class iw extends pq{static makeCurrent(){!function mj(n){Vx||(Vx=n)}(new iw)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function gq(){return Zd=Zd||document.querySelector("base"),Zd?Zd.getAttribute("href"):null}();return null==t?null:function vq(n){pv=pv||document.createElement("a"),pv.setAttribute("href",n);const e=pv.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Zd=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return GR(document.cookie,e)}}let pv,Zd=null;const u3=new ge("TRANSITION_ID"),yq=[{provide:Xg,useFactory:function mq(n,e,t){return()=>{t.get(Kg).donePromise.then(()=>{const r=ys(),o=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let i=0;i<o.length;i++)r.remove(o[i])})}},deps:[u3,co,Sa],multi:!0}];let wq=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const gv=new ge("EventManagerPlugins");let vv=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,o){return this._findPluginFor(r).addEventListener(t,r,o)}addGlobalEventListener(t,r,o){return this._findPluginFor(r).addGlobalEventListener(t,r,o)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const o=this._plugins;for(let i=0;i<o.length;i++){const a=o[i];if(a.supports(t))return this._eventNameToPlugin.set(t,a),a}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(me(gv),me(Bn))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();class c3{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const o=ys().getGlobalEventTarget(this._doc,e);if(!o)throw new Error(`Unsupported event target ${o} for event ${t}`);return this.addEventListener(o,t,r)}}let l3=(()=>{class n{constructor(){this.usageCount=new Map}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(t){}onStyleAdded(t){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(t,r){const o=this.usageCount;let i=o.get(t)??0;return i+=r,i>0?o.set(t,i):o.delete(t),i}ngOnDestroy(){for(const t of this.getAllStyles())this.onStyleRemoved(t);this.usageCount.clear()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),Qd=(()=>{class n extends l3{constructor(t){super(),this.doc=t,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.forEach(i=>i.remove()),r.delete(t)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}addStyleToHost(t,r){const o=this.doc.createElement("style");o.textContent=r,t.appendChild(o);const i=this.styleRef.get(r);i?i.push(o):this.styleRef.set(r,[o])}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(me(co))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const aw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},sw=/%COMP%/g,h3=new ge("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function p3(n,e){return e.flat(100).map(t=>t.replace(sw,n))}function g3(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let uw=(()=>{class n{constructor(t,r,o,i){this.eventManager=t,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestory=i,this.rendererByCompId=new Map,this.defaultRenderer=new cw(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;const o=this.getOrCreateRenderer(t,r);return o instanceof y3?o.applyToHost(t):o instanceof lw&&o.applyStyles(),o}getOrCreateRenderer(t,r){const o=this.rendererByCompId;let i=o.get(r.id);if(!i){const a=this.eventManager,s=this.sharedStylesHost,u=this.removeStylesOnCompDestory;switch(r.encapsulation){case xa.Emulated:i=new y3(a,s,r,this.appId,u);break;case xa.ShadowDom:return new Iq(a,s,t,r);default:i=new lw(a,s,r,u)}i.onDestroy=()=>o.delete(r.id),o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(me(vv),me(Qd),me(zd),me(h3))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();class cw{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(aw[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(m3(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(m3(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,o){if(o){t=o+":"+t;const i=aw[o];i?e.setAttributeNS(i,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const o=aw[r];o?e.removeAttributeNS(o,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,o){o&(So.DashCase|So.Important)?e.style.setProperty(t,r,o&So.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&So.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,g3(r)):this.eventManager.addEventListener(e,t,g3(r))}}function m3(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Iq extends cw{constructor(e,t,r,o){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=p3(o.id,o.styles);for(const a of i){const s=document.createElement("style");s.textContent=a,this.shadowRoot.appendChild(s)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class lw extends cw{constructor(e,t,r,o,i=r.id){super(e),this.sharedStylesHost=t,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=p3(i,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class y3 extends lw{constructor(e,t,r,o,i){const a=o+"-"+r.id;super(e,t,r,i,a),this.contentAttr=function Eq(n){return"_ngcontent-%COMP%".replace(sw,n)}(a),this.hostAttr=function Sq(n){return"_nghost-%COMP%".replace(sw,n)}(a)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}let Dq=(()=>{class n extends c3{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,o){return t.addEventListener(r,o,!1),()=>this.removeEventListener(t,r,o)}removeEventListener(t,r,o){return t.removeEventListener(r,o)}}return n.\u0275fac=function(t){return new(t||n)(me(co))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const x3=["alt","control","meta","shift"],Tq={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Rq={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Nq=(()=>{class n extends c3{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,o){const i=n.parseEventName(r),a=n.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ys().onAndCancel(t,i.domEventName,a))}static parseEventName(t){const r=t.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const i=n._normalizeKey(r.pop());let a="",s=r.indexOf("code");if(s>-1&&(r.splice(s,1),a="code."),x3.forEach(c=>{const l=r.indexOf(c);l>-1&&(r.splice(l,1),a+=c+".")}),a+=i,0!=r.length||0===i.length)return null;const u={};return u.domEventName=o,u.fullKey=a,u}static matchEventFullKeyCode(t,r){let o=Tq[t.key]||t.key,i="";return r.indexOf("code.")>-1&&(o=t.code,i="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),x3.forEach(a=>{a!==o&&(0,Rq[a])(t)&&(i+=a+".")}),i+=o,i===r)}static eventCallback(t,r,o){return i=>{n.matchEventFullKeyCode(i,t)&&o.runGuarded(()=>r(i))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(me(co))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const _3=[{provide:Yg,useValue:t3},{provide:tR,useValue:function Oq(){iw.makeCurrent()},multi:!0},{provide:co,useFactory:function Pq(){return function vU(n){py=n}(document),document},deps:[]}],kq=dR(pj,"browser",_3),b3=new ge(""),C3=[{provide:Zg,useClass:class xq{addToWindow(e){dn.getAngularTestability=(r,o=!0)=>{const i=e.findTestabilityInTree(r,o);if(null==i)throw new Error("Could not find testability for element.");return i},dn.getAllAngularTestabilities=()=>e.getAllTestabilities(),dn.getAllAngularRootElements=()=>e.getAllRootElements(),dn.frameworkStabilizers||(dn.frameworkStabilizers=[]),dn.frameworkStabilizers.push(r=>{const o=dn.getAllAngularTestabilities();let i=o.length,a=!1;const s=function(u){a=a||u,i--,0==i&&r(a)};o.forEach(function(u){u.whenStable(s)})})}findTestabilityInTree(e,t,r){return null==t?null:e.getTestability(t)??(r?ys().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:sR,useClass:Rx,deps:[Bn,Nx,Zg]},{provide:Rx,useClass:Rx,deps:[Bn,Nx,Zg]}],E3=[{provide:Ey,useValue:"root"},{provide:Tl,useFactory:function Mq(){return new Tl},deps:[]},{provide:gv,useClass:Dq,multi:!0,deps:[co,Bn,Yg]},{provide:gv,useClass:Nq,multi:!0,deps:[co]},{provide:uw,useClass:uw,deps:[vv,Qd,zd,h3]},{provide:YA,useExisting:uw},{provide:l3,useExisting:Qd},{provide:Qd,useClass:Qd,deps:[co]},{provide:vv,useClass:vv,deps:[gv,Bn]},{provide:r3,useClass:wq,deps:[]},[]];let Fq=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:zd,useValue:t.appId},{provide:u3,useExisting:zd},yq]}}}return n.\u0275fac=function(t){return new(t||n)(me(b3,12))},n.\u0275mod=bo({type:n}),n.\u0275inj=no({providers:[...E3,...C3],imports:[e3,gj]}),n})(),S3=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(me(co))},n.\u0275prov=Ae({token:n,factory:function(t){let r=null;return r=t?new t:function Bq(){return new S3(me(co))}(),r},providedIn:"root"}),n})();function Le(...n){return Dn(n,rd(n))}function nu(n,e){return Ze(e)?Er(n,e,1):Er(n,1)}function _s(n,e){return rr((t,r)=>{let o=0;t.subscribe(Fn(r,i=>n.call(e,i,o++)&&r.next(i)))})}typeof window<"u"&&window;class mv{}class hw{}class Yi{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const o=t.slice(0,r),i=o.toLowerCase(),a=t.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let r=e[t];const o=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(t,o))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Yi?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Yi;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Yi?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const o=("a"===e.op?this.headers.get(t):void 0)||[];o.push(...r),this.headers.set(t,o);break;case"d":const i=e.value;if(i){let a=this.headers.get(t);if(!a)return;a=a.filter(s=>-1===i.indexOf(s)),0===a.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class zq{encodeKey(e){return D3(e)}encodeValue(e){return D3(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const $q=/%(\d[a-f0-9])/gi,qq={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function D3(n){return encodeURIComponent(n).replace($q,(e,t)=>qq[t]??e)}function yv(n){return`${n}`}class ru{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new zq,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function jq(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(o=>{const i=o.indexOf("="),[a,s]=-1==i?[e.decodeKey(o),""]:[e.decodeKey(o.slice(0,i)),e.decodeValue(o.slice(i+1))],u=t.get(a)||[];u.push(s),t.set(a,u)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t],o=Array.isArray(r)?r.map(yv):[yv(r)];this.map.set(t,o)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(r=>{const o=e[r];Array.isArray(o)?o.forEach(i=>{t.push({param:r,value:i,op:"a"})}):t.push({param:r,value:o,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new ru({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(yv(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const o=r.indexOf(yv(e.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Xq{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function T3(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function R3(n){return typeof Blob<"u"&&n instanceof Blob}function N3(n){return typeof FormData<"u"&&n instanceof FormData}class Jd{constructor(e,t,r,o){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function Kq(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Yi),this.context||(this.context=new Xq),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=t;else{const s=t.indexOf("?");this.urlWithParams=t+(-1===s?"?":s<t.length-1?"&":"")+a}}else this.params=new ru,this.urlWithParams=t}serializeBody(){return null===this.body?null:T3(this.body)||R3(this.body)||N3(this.body)||function Yq(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ru?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||N3(this.body)?null:R3(this.body)?this.body.type||null:T3(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ru?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method||this.method,r=e.url||this.url,o=e.responseType||this.responseType,i=void 0!==e.body?e.body:this.body,a=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,s=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let u=e.headers||this.headers,c=e.params||this.params;const l=e.context??this.context;return void 0!==e.setHeaders&&(u=Object.keys(e.setHeaders).reduce((f,d)=>f.set(d,e.setHeaders[d]),u)),e.setParams&&(c=Object.keys(e.setParams).reduce((f,d)=>f.set(d,e.setParams[d]),c)),new Jd(t,r,i,{params:c,headers:u,context:l,reportProgress:s,responseType:o,withCredentials:a})}}var Kn=(()=>((Kn=Kn||{})[Kn.Sent=0]="Sent",Kn[Kn.UploadProgress=1]="UploadProgress",Kn[Kn.ResponseHeader=2]="ResponseHeader",Kn[Kn.DownloadProgress=3]="DownloadProgress",Kn[Kn.Response=4]="Response",Kn[Kn.User=5]="User",Kn))();class pw{constructor(e,t=200,r="OK"){this.headers=e.headers||new Yi,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class gw extends pw{constructor(e={}){super(e),this.type=Kn.ResponseHeader}clone(e={}){return new gw({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class xv extends pw{constructor(e={}){super(e),this.type=Kn.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new xv({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class O3 extends pw{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function vw(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let wv=(()=>{class n{constructor(t){this.handler=t}request(t,r,o={}){let i;if(t instanceof Jd)i=t;else{let u,c;u=o.headers instanceof Yi?o.headers:new Yi(o.headers),o.params&&(c=o.params instanceof ru?o.params:new ru({fromObject:o.params})),i=new Jd(t,r,void 0!==o.body?o.body:null,{headers:u,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const a=Le(i).pipe(nu(u=>this.handler.handle(u)));if(t instanceof Jd||"events"===o.observe)return a;const s=a.pipe(_s(u=>u instanceof xv));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return s.pipe($e(u=>{if(null!==u.body&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return s.pipe($e(u=>{if(null!==u.body&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return s.pipe($e(u=>{if(null!==u.body&&"string"!=typeof u.body)throw new Error("Response is not a string.");return u.body}));default:return s.pipe($e(u=>u.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new ru).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,o={}){return this.request("PATCH",t,vw(o,r))}post(t,r,o={}){return this.request("POST",t,vw(o,r))}put(t,r,o={}){return this.request("PUT",t,vw(o,r))}}return n.\u0275fac=function(t){return new(t||n)(me(mv))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();function M3(n,e){return e(n)}function Zq(n,e){return(t,r)=>e.intercept(t,{handle:o=>n(o,r)})}const Jq=new ge("HTTP_INTERCEPTORS"),eh=new ge("HTTP_INTERCEPTOR_FNS");function eX(){let n=null;return(e,t)=>(null===n&&(n=(ft(Jq,{optional:!0})??[]).reduceRight(Zq,M3)),n(e,t))}let P3=(()=>{class n extends mv{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null}handle(t){if(null===this.chain){const r=Array.from(new Set(this.injector.get(eh)));this.chain=r.reduceRight((o,i)=>function Qq(n,e,t){return(r,o)=>t.runInContext(()=>e(r,i=>n(i,o)))}(o,i,this.injector),M3)}return this.chain(t,r=>this.backend.handle(r))}}return n.\u0275fac=function(t){return new(t||n)(me(hw),me(Ca))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const oX=/^\)\]\}',?\n/;let F3=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new In(r=>{const o=this.xhrFactory.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((h,p)=>o.setRequestHeader(h,p.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const h=t.detectContentTypeHeader();null!==h&&o.setRequestHeader("Content-Type",h)}if(t.responseType){const h=t.responseType.toLowerCase();o.responseType="json"!==h?h:"text"}const i=t.serializeBody();let a=null;const s=()=>{if(null!==a)return a;const h=o.statusText||"OK",p=new Yi(o.getAllResponseHeaders()),g=function iX(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(o)||t.url;return a=new gw({headers:p,status:o.status,statusText:h,url:g}),a},u=()=>{let{headers:h,status:p,statusText:g,url:v}=s(),m=null;204!==p&&(m=typeof o.response>"u"?o.responseText:o.response),0===p&&(p=m?200:0);let y=p>=200&&p<300;if("json"===t.responseType&&"string"==typeof m){const x=m;m=m.replace(oX,"");try{m=""!==m?JSON.parse(m):null}catch(w){m=x,y&&(y=!1,m={error:w,text:m})}}y?(r.next(new xv({body:m,headers:h,status:p,statusText:g,url:v||void 0})),r.complete()):r.error(new O3({error:m,headers:h,status:p,statusText:g,url:v||void 0}))},c=h=>{const{url:p}=s(),g=new O3({error:h,status:o.status||0,statusText:o.statusText||"Unknown Error",url:p||void 0});r.error(g)};let l=!1;const f=h=>{l||(r.next(s()),l=!0);let p={type:Kn.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),"text"===t.responseType&&o.responseText&&(p.partialText=o.responseText),r.next(p)},d=h=>{let p={type:Kn.UploadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),r.next(p)};return o.addEventListener("load",u),o.addEventListener("error",c),o.addEventListener("timeout",c),o.addEventListener("abort",c),t.reportProgress&&(o.addEventListener("progress",f),null!==i&&o.upload&&o.upload.addEventListener("progress",d)),o.send(i),r.next({type:Kn.Sent}),()=>{o.removeEventListener("error",c),o.removeEventListener("abort",c),o.removeEventListener("load",u),o.removeEventListener("timeout",c),t.reportProgress&&(o.removeEventListener("progress",f),null!==i&&o.upload&&o.upload.removeEventListener("progress",d)),o.readyState!==o.DONE&&o.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(me(r3))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const mw=new ge("XSRF_ENABLED"),L3=new ge("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),B3=new ge("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class V3{}let uX=(()=>{class n{constructor(t,r,o){this.doc=t,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=GR(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(me(co),me(Yg),me(L3))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();function cX(n,e){const t=n.url.toLowerCase();if(!ft(mw)||"GET"===n.method||"HEAD"===n.method||t.startsWith("http://")||t.startsWith("https://"))return e(n);const r=ft(V3).getToken(),o=ft(B3);return null!=r&&!n.headers.has(o)&&(n=n.clone({headers:n.headers.set(o,r)})),e(n)}var Hn=(()=>((Hn=Hn||{})[Hn.Interceptors=0]="Interceptors",Hn[Hn.LegacyInterceptors=1]="LegacyInterceptors",Hn[Hn.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Hn[Hn.NoXsrfProtection=3]="NoXsrfProtection",Hn[Hn.JsonpSupport=4]="JsonpSupport",Hn[Hn.RequestsMadeViaParent=5]="RequestsMadeViaParent",Hn))();function Zl(n,e){return{\u0275kind:n,\u0275providers:e}}function lX(...n){const e=[wv,F3,P3,{provide:mv,useExisting:P3},{provide:hw,useExisting:F3},{provide:eh,useValue:cX,multi:!0},{provide:mw,useValue:!0},{provide:V3,useClass:uX}];for(const t of n)e.push(...t.\u0275providers);return function BU(n){return{\u0275providers:n}}(e)}const U3=new ge("LEGACY_INTERCEPTOR_FN");let dX=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({providers:[lX(Zl(Hn.LegacyInterceptors,[{provide:U3,useFactory:eX},{provide:eh,useExisting:U3,multi:!0}]))]}),n})(),yw=(()=>{class n{constructor(t){this.httpClient=t,this.defaultHeaders=new Yi,this.pathEvent="./services/postEvent.php",this.pathConfig="./services/getConfig.php"}canConsumeForm(t){for(const o of t)if("multipart/form-data"===o)return!0;return!1}oldEvent(t,r,o,i,a,s){let u=new URLSearchParams;u.set("image",o),u.set("type",i),u.set("rut",null==t?"":t.toString()),u.set("plate",null==r?"":r.toString()),u.set("deviceId",null!=s?s.toString():""),u.set("probe",a?a.toString():"false");let c={headers:(new Yi).set("Content-Type","application/x-www-form-urlencoded; charset=UTF-8;")};return this.httpClient.post(this.pathEvent,u.toString(),c)}getConfig(){return this.httpClient.get(this.pathConfig)}}return n.\u0275fac=function(t){return new(t||n)(me(wv))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),xw=(()=>{class n{constructor(){this._step=1,this._step=1}get device(){return this._device}set device(t){this._device=t}get hasPlate(){return this._hasPlate}set hasPlate(t){this._hasPlate=t}get pin(){return this._pin}set pin(t){this._pin=t}get rut(){return this._rut}set rut(t){this._rut=t}get plate(){return this._plate}set plate(t){this._plate=t}get requires_pin(){return this._requires_pin}set requires_pin(t){this._requires_pin=t}get confirm_identity(){return this._confirm_identity}set confirm_identity(t){this._confirm_identity=t}get useTime(){return this._useTime}set useTime(t){this._useTime=t}get timePhoto(){return this._timePhoto}set timePhoto(t){this._timePhoto=t}get step(){return this._step}set step(t){this._step=t}get has_callback(){return this._has_callback}set has_callback(t){this._has_callback=t}get callback_url(){return this._callback_url}set callback_url(t){this._callback_url=t}get sessionUUID(){return this._sessionUUID}set sessionUUID(t){this._sessionUUID=t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Qo extends Li{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}const _v=kn(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:hX}=Array,{getPrototypeOf:pX,prototype:gX,keys:vX}=Object;function H3(n){if(1===n.length){const e=n[0];if(hX(e))return{args:e,keys:null};if(function mX(n){return n&&"object"==typeof n&&pX(n)===gX}(e)){const t=vX(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}const{isArray:yX}=Array;function W3(n){return $e(e=>function xX(n,e){return yX(e)?n(...e):n(e)}(n,e))}function G3(n,e){return n.reduce((t,r,o)=>(t[r]=e[o],t),{})}function ww(...n){const e=rd(n),t=UE(n),{args:r,keys:o}=H3(n);if(0===r.length)return Dn([],e);const i=new In(function wX(n,e,t=Ks){return r=>{z3(e,()=>{const{length:o}=n,i=new Array(o);let a=o,s=o;for(let u=0;u<o;u++)z3(e,()=>{const c=Dn(n[u],e);let l=!1;c.subscribe(Fn(r,f=>{i[u]=f,l||(l=!0,s--),s||r.next(t(i.slice()))},()=>{--a||r.complete()}))},r)},r)}}(r,e,o?a=>G3(o,a):Ks));return t?i.pipe(W3(t)):i}function z3(n,e,t){n?as(t,n,e):e()}function _w(...n){return function _X(){return sl(1)}()(Dn(n,rd(n)))}function j3(n){return new In(e=>{Go(n()).subscribe(e)})}function th(n,e){const t=Ze(n)?n:()=>n,r=o=>o.error(t());return new In(e?o=>e.schedule(r,0,o):r)}function bw(){return rr((n,e)=>{let t=null;n._refCount++;const r=Fn(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const o=n._connection,i=t;t=null,o&&(!i||o===i)&&o.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}class $3 extends In{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,SE(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new gr;const t=this.getSubject();e.add(this.source.subscribe(Fn(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=gr.EMPTY)}return e}refCount(){return bw()(this)}}function Do(n,e){return rr((t,r)=>{let o=null,i=0,a=!1;const s=()=>a&&!o&&r.complete();t.subscribe(Fn(r,u=>{o?.unsubscribe();let c=0;const l=i++;Go(n(u,l)).subscribe(o=Fn(r,f=>r.next(e?e(u,f,l,c++):f),()=>{o=null,s()}))},()=>{a=!0,s()}))})}function Ql(n){return n<=0?()=>Bi:rr((e,t)=>{let r=0;e.subscribe(Fn(t,o=>{++r<=n&&(t.next(o),n<=r&&t.complete())}))})}function bv(n){return rr((e,t)=>{let r=!1;e.subscribe(Fn(t,o=>{r=!0,t.next(o)},()=>{r||t.next(n),t.complete()}))})}function q3(n=CX){return rr((e,t)=>{let r=!1;e.subscribe(Fn(t,o=>{r=!0,t.next(o)},()=>r?t.complete():t.error(n())))})}function CX(){return new _v}function ou(n,e){const t=arguments.length>=2;return r=>r.pipe(n?_s((o,i)=>n(o,i,r)):Ks,Ql(1),t?bv(e):q3(()=>new _v))}function Dr(n,e,t){const r=Ze(n)||e||t?{next:n,error:e,complete:t}:n;return r?rr((o,i)=>{var a;null===(a=r.subscribe)||void 0===a||a.call(r);let s=!0;o.subscribe(Fn(i,u=>{var c;null===(c=r.next)||void 0===c||c.call(r,u),i.next(u)},()=>{var u;s=!1,null===(u=r.complete)||void 0===u||u.call(r),i.complete()},u=>{var c;s=!1,null===(c=r.error)||void 0===c||c.call(r,u),i.error(u)},()=>{var u,c;s&&(null===(u=r.unsubscribe)||void 0===u||u.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):Ks}function bs(n){return rr((e,t)=>{let i,r=null,o=!1;r=e.subscribe(Fn(t,void 0,void 0,a=>{i=Go(n(a,bs(n)(e))),r?(r.unsubscribe(),r=null,i.subscribe(t)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(t))})}function X3(n,e){return rr(function EX(n,e,t,r,o){return(i,a)=>{let s=t,u=e,c=0;i.subscribe(Fn(a,l=>{const f=c++;u=s?n(u,l,f):(s=!0,l),r&&a.next(u)},o&&(()=>{s&&a.next(u),a.complete()})))}}(n,e,arguments.length>=2,!0))}function Cw(n){return n<=0?()=>Bi:rr((e,t)=>{let r=[];e.subscribe(Fn(t,o=>{r.push(o),n<r.length&&r.shift()},()=>{for(const o of r)t.next(o);t.complete()},void 0,()=>{r=null}))})}function K3(n,e){const t=arguments.length>=2;return r=>r.pipe(n?_s((o,i)=>n(o,i,r)):Ks,Cw(1),t?bv(e):q3(()=>new _v))}function Ew(n){return rr((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const ot="primary",nh=Symbol("RouteTitle");class IX{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Jl(n){return new IX(n)}function DX(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const o={};for(let i=0;i<r.length;i++){const a=r[i],s=n[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:n.slice(0,r.length),posParams:o}}function Pa(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let o;for(let i=0;i<t.length;i++)if(o=t[i],!Y3(n[o],e[o]))return!1;return!0}function Y3(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((o,i)=>r[i]===o)}return n===e}function Z3(n){return Array.prototype.concat.apply([],n)}function Q3(n){return n.length>0?n[n.length-1]:null}function Tr(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function iu(n){return Zy(n)?n:Md(n)?Dn(Promise.resolve(n)):Le(n)}const Cv=!1,RX={exact:function tN(n,e,t){if(!cc(n.segments,e.segments)||!Ev(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!tN(n.children[r],e.children[r],t))return!1;return!0},subset:nN},J3={exact:function NX(n,e){return Pa(n,e)},subset:function OX(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Y3(n[t],e[t]))},ignored:()=>!0};function eN(n,e,t){return RX[t.paths](n.root,e.root,t.matrixParams)&&J3[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function nN(n,e,t){return rN(n,e,e.segments,t)}function rN(n,e,t,r){if(n.segments.length>t.length){const o=n.segments.slice(0,t.length);return!(!cc(o,t)||e.hasChildren()||!Ev(o,t,r))}if(n.segments.length===t.length){if(!cc(n.segments,t)||!Ev(n.segments,t,r))return!1;for(const o in e.children)if(!n.children[o]||!nN(n.children[o],e.children[o],r))return!1;return!0}{const o=t.slice(0,n.segments.length),i=t.slice(n.segments.length);return!!(cc(n.segments,o)&&Ev(n.segments,o,r)&&n.children[ot])&&rN(n.children[ot],e,i,r)}}function Ev(n,e,t){return e.every((r,o)=>J3[t](n[o].parameters,r.parameters))}class au{constructor(e=new mt([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Jl(this.queryParams)),this._queryParamMap}toString(){return kX.serialize(this)}}class mt{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Tr(t,(r,o)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Sv(this)}}class rh{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Jl(this.parameters)),this._parameterMap}toString(){return aN(this)}}function cc(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}let oh=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return new Sw},providedIn:"root"}),n})();class Sw{parse(e){const t=new zX(e);return new au(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${ih(e.root,!0)}`,r=function BX(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(o=>`${Av(t)}=${Av(o)}`).join("&"):`${Av(t)}=${Av(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${r}${"string"==typeof e.fragment?`#${function FX(n){return encodeURI(n)}(e.fragment)}`:""}`}}const kX=new Sw;function Sv(n){return n.segments.map(e=>aN(e)).join("/")}function ih(n,e){if(!n.hasChildren())return Sv(n);if(e){const t=n.children[ot]?ih(n.children[ot],!1):"",r=[];return Tr(n.children,(o,i)=>{i!==ot&&r.push(`${i}:${ih(o,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function PX(n,e){let t=[];return Tr(n.children,(r,o)=>{o===ot&&(t=t.concat(e(r,o)))}),Tr(n.children,(r,o)=>{o!==ot&&(t=t.concat(e(r,o)))}),t}(n,(r,o)=>o===ot?[ih(n.children[ot],!1)]:[`${o}:${ih(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[ot]?`${Sv(n)}/${t[0]}`:`${Sv(n)}/(${t.join("//")})`}}function oN(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Av(n){return oN(n).replace(/%3B/gi,";")}function Aw(n){return oN(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Iv(n){return decodeURIComponent(n)}function iN(n){return Iv(n.replace(/\+/g,"%20"))}function aN(n){return`${Aw(n.path)}${function LX(n){return Object.keys(n).map(e=>`;${Aw(e)}=${Aw(n[e])}`).join("")}(n.parameters)}`}const VX=/^[^\/()?;=#]+/;function Dv(n){const e=n.match(VX);return e?e[0]:""}const UX=/^[^=?&#]+/,WX=/^[^&#]+/;class zX{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new mt([],{}):new mt([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[ot]=new mt(e,t)),r}parseSegment(){const e=Dv(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new ie(4009,Cv);return this.capture(e),new rh(Iv(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Dv(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const o=Dv(this.remaining);o&&(r=o,this.capture(r))}e[Iv(t)]=Iv(r)}parseQueryParam(e){const t=function HX(n){const e=n.match(UX);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const a=function GX(n){const e=n.match(WX);return e?e[0]:""}(this.remaining);a&&(r=a,this.capture(r))}const o=iN(t),i=iN(r);if(e.hasOwnProperty(o)){let a=e[o];Array.isArray(a)||(a=[a],e[o]=a),a.push(i)}else e[o]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Dv(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new ie(4010,Cv);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=ot);const a=this.parseChildren();t[i]=1===Object.keys(a).length?a[ot]:new mt([],a),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new ie(4011,Cv)}}function Iw(n){return n.segments.length>0?new mt([],{[ot]:n}):n}function Tv(n){const e={};for(const r of Object.keys(n.children)){const i=Tv(n.children[r]);(i.segments.length>0||i.hasChildren())&&(e[r]=i)}return function jX(n){if(1===n.numberOfChildren&&n.children[ot]){const e=n.children[ot];return new mt(n.segments.concat(e.segments),e.children)}return n}(new mt(n.segments,e))}function lc(n){return n instanceof au}const Dw=!1;function $X(n,e,t,r,o){if(0===t.length)return ef(e.root,e.root,e.root,r,o);const i=function fN(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new lN(!0,0,n);let e=0,t=!1;const r=n.reduce((o,i,a)=>{if("object"==typeof i&&null!=i){if(i.outlets){const s={};return Tr(i.outlets,(u,c)=>{s[c]="string"==typeof u?u.split("/"):u}),[...o,{outlets:s}]}if(i.segmentPath)return[...o,i.segmentPath]}return"string"!=typeof i?[...o,i]:0===a?(i.split("/").forEach((s,u)=>{0==u&&"."===s||(0==u&&""===s?t=!0:".."===s?e++:""!=s&&o.push(s))}),o):[...o,i]},[]);return new lN(t,e,r)}(t);return i.toRoot()?ef(e.root,e.root,new mt([],{}),r,o):function a(u){const c=function XX(n,e,t,r){if(n.isAbsolute)return new tf(e.root,!0,0);if(-1===r)return new tf(t,t===e.root,0);return function dN(n,e,t){let r=n,o=e,i=t;for(;i>o;){if(i-=o,r=r.parent,!r)throw new ie(4005,Dw&&"Invalid number of '../'");o=r.segments.length}return new tf(r,!1,o-i)}(t,r+(ah(n.commands[0])?0:1),n.numberOfDoubleDots)}(i,e,n.snapshot?._urlSegment,u),l=c.processChildren?nf(c.segmentGroup,c.index,i.commands):Tw(c.segmentGroup,c.index,i.commands);return ef(e.root,c.segmentGroup,l,r,o)}(n.snapshot?._lastPathIndex)}function ah(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function sh(n){return"object"==typeof n&&null!=n&&n.outlets}function ef(n,e,t,r,o){let a,i={};r&&Tr(r,(u,c)=>{i[c]=Array.isArray(u)?u.map(l=>`${l}`):`${u}`}),a=n===e?t:cN(n,e,t);const s=Iw(Tv(a));return new au(s,i,o)}function cN(n,e,t){const r={};return Tr(n.children,(o,i)=>{r[i]=o===e?t:cN(o,e,t)}),new mt(n.segments,r)}class lN{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&ah(r[0]))throw new ie(4003,Dw&&"Root segment cannot have matrix parameters");const o=r.find(sh);if(o&&o!==Q3(r))throw new ie(4004,Dw&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class tf{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function Tw(n,e,t){if(n||(n=new mt([],{})),0===n.segments.length&&n.hasChildren())return nf(n,e,t);const r=function YX(n,e,t){let r=0,o=e;const i={match:!1,pathIndex:0,commandIndex:0};for(;o<n.segments.length;){if(r>=t.length)return i;const a=n.segments[o],s=t[r];if(sh(s))break;const u=`${s}`,c=r<t.length-1?t[r+1]:null;if(o>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!pN(u,c,a))return i;r+=2}else{if(!pN(u,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(n,e,t),o=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const i=new mt(n.segments.slice(0,r.pathIndex),{});return i.children[ot]=new mt(n.segments.slice(r.pathIndex),n.children),nf(i,0,o)}return r.match&&0===o.length?new mt(n.segments,{}):r.match&&!n.hasChildren()?Rw(n,e,t):r.match?nf(n,0,o):Rw(n,e,t)}function nf(n,e,t){if(0===t.length)return new mt(n.segments,{});{const r=function KX(n){return sh(n[0])?n[0].outlets:{[ot]:n}}(t),o={};return!r[ot]&&n.children[ot]&&1===n.numberOfChildren&&0===n.children[ot].segments.length?nf(n.children[ot],e,t):(Tr(r,(i,a)=>{"string"==typeof i&&(i=[i]),null!==i&&(o[a]=Tw(n.children[a],e,i))}),Tr(n.children,(i,a)=>{void 0===r[a]&&(o[a]=i)}),new mt(n.segments,o))}}function Rw(n,e,t){const r=n.segments.slice(0,e);let o=0;for(;o<t.length;){const i=t[o];if(sh(i)){const u=ZX(i.outlets);return new mt(r,u)}if(0===o&&ah(t[0])){r.push(new rh(n.segments[e].path,hN(t[0]))),o++;continue}const a=sh(i)?i.outlets[ot]:`${i}`,s=o<t.length-1?t[o+1]:null;a&&s&&ah(s)?(r.push(new rh(a,hN(s))),o+=2):(r.push(new rh(a,{})),o++)}return new mt(r,{})}function ZX(n){const e={};return Tr(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=Rw(new mt([],{}),0,t))}),e}function hN(n){const e={};return Tr(n,(t,r)=>e[r]=`${t}`),e}function pN(n,e,t){return n==t.path&&Pa(e,t.parameters)}const uh="imperative";class ka{constructor(e,t){this.id=e,this.url=t}}class Nw extends ka{constructor(e,t,r="imperative",o=null){super(e,t),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class fc extends ka{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Rv extends ka{constructor(e,t,r,o){super(e,t),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Nv extends ka{constructor(e,t,r,o){super(e,t),this.reason=r,this.code=o,this.type=16}}class Ow extends ka{constructor(e,t,r,o){super(e,t),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class QX extends ka{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class JX extends ka{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class eK extends ka{constructor(e,t,r,o,i){super(e,t),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class tK extends ka{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class nK extends ka{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rK{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class oK{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class iK{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class aK{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class sK{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uK{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gN{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let fK=(()=>{class n{createUrlTree(t,r,o,i,a,s){return $X(t||r.root,o,i,a,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),hK=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(e){return fK.\u0275fac(e)},providedIn:"root"}),n})();class vN{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Mw(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=Mw(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Pw(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return Pw(e,this._root).map(t=>t.value)}}function Mw(n,e){if(n===e.value)return e;for(const t of e.children){const r=Mw(n,t);if(r)return r}return null}function Pw(n,e){if(n===e.value)return[e];for(const t of e.children){const r=Pw(n,t);if(r.length)return r.unshift(e),r}return[]}class Cs{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function rf(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class mN extends vN{constructor(e,t){super(e),this.snapshot=t,kw(this,e)}toString(){return this.snapshot.toString()}}function yN(n,e){const t=function pK(n,e){const a=new Ov([],{},{},"",{},ot,e,null,n.root,-1,{});return new wN("",new Cs(a,[]))}(n,e),r=new Qo([new rh("",{})]),o=new Qo({}),i=new Qo({}),a=new Qo({}),s=new Qo(""),u=new su(r,o,a,s,i,ot,e,t.root);return u.snapshot=t.root,new mN(new Cs(u,[]),t)}class su{constructor(e,t,r,o,i,a,s,u){this.url=e,this.params=t,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.title=this.data?.pipe($e(c=>c[nh]))??Le(void 0),this._futureSnapshot=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe($e(e=>Jl(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe($e(e=>Jl(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function xN(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const o=t[r],i=t[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(i.component)break;r--}}return function gK(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Ov{get title(){return this.data?.[nh]}constructor(e,t,r,o,i,a,s,u,c,l,f){this.url=e,this.params=t,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=f}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Jl(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Jl(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class wN extends vN{constructor(e,t){super(t),this.url=e,kw(this,t)}toString(){return _N(this._root)}}function kw(n,e){e.value._routerState=n,e.children.forEach(t=>kw(n,t))}function _N(n){const e=n.children.length>0?` { ${n.children.map(_N).join(", ")} } `:"";return`${n.value}${e}`}function Fw(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Pa(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),Pa(e.params,t.params)||n.params.next(t.params),function TX(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Pa(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),Pa(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function Lw(n,e){const t=Pa(n.params,e.params)&&function MX(n,e){return cc(n,e)&&n.every((t,r)=>Pa(t.parameters,e[r].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||Lw(n.parent,e.parent))}function ch(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const o=function mK(n,e,t){return e.children.map(r=>{for(const o of t.children)if(n.shouldReuseRoute(r.value,o.value.snapshot))return ch(n,r,o);return ch(n,r)})}(n,e,t);return new Cs(r,o)}{if(n.shouldAttach(e.value)){const i=n.retrieve(e.value);if(null!==i){const a=i.route;return a.value._futureSnapshot=e.value,a.children=e.children.map(s=>ch(n,s)),a}}const r=function yK(n){return new su(new Qo(n.url),new Qo(n.params),new Qo(n.queryParams),new Qo(n.fragment),new Qo(n.data),n.outlet,n.component,n)}(e.value),o=e.children.map(i=>ch(n,i));return new Cs(r,o)}}const Bw="ngNavigationCancelingError";function bN(n,e){const{redirectTo:t,navigationBehaviorOptions:r}=lc(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,o=CN(!1,0,e);return o.url=t,o.navigationBehaviorOptions=r,o}function CN(n,e,t){const r=new Error("NavigationCancelingError: "+(n||""));return r[Bw]=!0,r.cancellationCode=e,t&&(r.url=t),r}function EN(n){return SN(n)&&lc(n.url)}function SN(n){return n&&n[Bw]}class xK{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new lh,this.attachRef=null}}let lh=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const o=this.getOrCreateContext(t);o.outlet=r,this.contexts.set(t,o)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new xK,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Mv=!1;let Vw=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=ot,this.activateEvents=new bt,this.deactivateEvents=new bt,this.attachEvents=new bt,this.detachEvents=new bt,this.parentContexts=ft(lh),this.location=ft(wi),this.changeDetector=ft(jd),this.environmentInjector=ft(Ca)}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:o}=t.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ie(4012,Mv);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ie(4012,Mv);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ie(4012,Mv);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new ie(4013,Mv);this._activatedRoute=t;const o=this.location,a=t.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new wK(t,s,o.injector);if(r&&function _K(n){return!!n.resolveComponentFactory}(r)){const c=r.resolveComponentFactory(a);this.activated=o.createComponent(c,o.length,u)}else this.activated=o.createComponent(a,{index:o.length,injector:u,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=je({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[qo]}),n})();class wK{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===su?this.route:e===lh?this.childContexts:this.parent.get(e,t)}}let Uw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Vi({type:n,selectors:[["ng-component"]],standalone:!0,features:[hT],decls:1,vars:0,template:function(t,r){1&t&&sn(0,"router-outlet")},dependencies:[Vw],encapsulation:2}),n})();function AN(n,e){return n.providers&&!n._injector&&(n._injector=zg(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Ww(n){const e=n.children&&n.children.map(Ww),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ot&&(t.component=Uw),t}function Ci(n){return n.outlet||ot}function IN(n,e){const t=n.filter(r=>Ci(r)===e);return t.push(...n.filter(r=>Ci(r)!==e)),t}function fh(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class AK{constructor(e,t,r,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=o}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Fw(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const o=rf(t);e.children.forEach(i=>{const a=i.value.outlet;this.deactivateRoutes(i,o[a],r),delete o[a]}),Tr(o,(i,a)=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(e,t,r){const o=e.value,i=t?t.value:null;if(o===i)if(o.component){const a=r.getContext(o.outlet);a&&this.deactivateChildRoutes(e,t,a.children)}else this.deactivateChildRoutes(e,t,r);else i&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet),o=r&&e.value.component?r.children:t,i=rf(e);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);if(r&&r.outlet){const a=r.outlet.detach(),s=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:a,route:e,contexts:s})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),o=r&&e.value.component?r.children:t,i=rf(e);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const o=rf(t);e.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new uK(i.value.snapshot))}),e.children.length&&this.forwardEvent(new aK(e.value.snapshot))}activateRoutes(e,t,r){const o=e.value,i=t?t.value:null;if(Fw(o),o===i)if(o.component){const a=r.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,a.children)}else this.activateChildRoutes(e,t,r);else if(o.component){const a=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const s=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),a.children.onOutletReAttached(s.contexts),a.attachRef=s.componentRef,a.route=s.route.value,a.outlet&&a.outlet.attach(s.componentRef,s.route.value),Fw(s.route.value),this.activateChildRoutes(e,null,a.children)}else{const s=fh(o.snapshot),u=s?.get(Il)??null;a.attachRef=null,a.route=o,a.resolver=u,a.injector=s,a.outlet&&a.outlet.activateWith(o,a.injector),this.activateChildRoutes(e,null,a.children)}}else this.activateChildRoutes(e,null,r)}}class DN{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Pv{constructor(e,t){this.component=e,this.route=t}}function IK(n,e,t){const r=n._root;return dh(r,e?e._root:null,t,[r.value])}function af(n,e){const t=Symbol(),r=e.get(n,t);return r===t?"function"!=typeof n||function cV(n){return null!==$p(n)}(n)?e.get(n):n:r}function dh(n,e,t,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=rf(e);return n.children.forEach(a=>{(function TK(n,e,t,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=n.value,a=e?e.value:null,s=t?t.getContext(n.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){const u=function RK(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!cc(n.url,e.url);case"pathParamsOrQueryParamsChange":return!cc(n.url,e.url)||!Pa(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Lw(n,e)||!Pa(n.queryParams,e.queryParams);default:return!Lw(n,e)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new DN(r)):(i.data=a.data,i._resolvedData=a._resolvedData),dh(n,e,i.component?s?s.children:null:t,r,o),u&&s&&s.outlet&&s.outlet.isActivated&&o.canDeactivateChecks.push(new Pv(s.outlet.component,a))}else a&&hh(e,s,o),o.canActivateChecks.push(new DN(r)),dh(n,null,i.component?s?s.children:null:t,r,o)})(a,i[a.value.outlet],t,r.concat([a.value]),o),delete i[a.value.outlet]}),Tr(i,(a,s)=>hh(a,t.getContext(s),o)),o}function hh(n,e,t){const r=rf(n),o=n.value;Tr(r,(i,a)=>{hh(i,o.component?e?e.children.getContext(a):null:e,t)}),t.canDeactivateChecks.push(new Pv(o.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,o))}function ph(n){return"function"==typeof n}function Gw(n){return n instanceof _v||"EmptyError"===n?.name}const kv=Symbol("INITIAL_VALUE");function sf(){return Do(n=>ww(n.map(e=>e.pipe(Ql(1),function bX(...n){const e=rd(n);return rr((t,r)=>{(e?_w(n,t,e):_w(n,t)).subscribe(r)})}(kv)))).pipe($e(e=>{for(const t of e)if(!0!==t){if(t===kv)return kv;if(!1===t||t instanceof au)return t}return!0}),_s(e=>e!==kv),Ql(1)))}function TN(n){return function R5(...n){return bE(n)}(Dr(e=>{if(lc(e))throw bN(0,e)}),$e(e=>!0===e))}const zw={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function RN(n,e,t,r,o){const i=jw(n,e,t);return i.matched?function qK(n,e,t,r){const o=e.canMatch;return o&&0!==o.length?Le(o.map(a=>{const s=af(a,n);return iu(function FK(n){return n&&ph(n.canMatch)}(s)?s.canMatch(e,t):n.runInContext(()=>s(e,t)))})).pipe(sf(),TN()):Le(!0)}(r=AN(e,r),e,t).pipe($e(a=>!0===a?i:{...zw})):Le(i)}function jw(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...zw}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const o=(e.matcher||DX)(t,n,e);if(!o)return{...zw};const i={};Tr(o.posParams,(s,u)=>{i[u]=s.path});const a=o.consumed.length>0?{...i,...o.consumed[o.consumed.length-1].parameters}:i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:a,positionalParamSegments:o.posParams??{}}}function Fv(n,e,t,r){if(t.length>0&&function YK(n,e,t){return t.some(r=>Lv(n,e,r)&&Ci(r)!==ot)}(n,t,r)){const i=new mt(e,function KK(n,e,t,r){const o={};o[ot]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const i of t)if(""===i.path&&Ci(i)!==ot){const a=new mt([],{});a._sourceSegment=n,a._segmentIndexShift=e.length,o[Ci(i)]=a}return o}(n,e,r,new mt(t,n.children)));return i._sourceSegment=n,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===t.length&&function ZK(n,e,t){return t.some(r=>Lv(n,e,r))}(n,t,r)){const i=new mt(n.segments,function XK(n,e,t,r,o){const i={};for(const a of r)if(Lv(n,t,a)&&!o[Ci(a)]){const s=new mt([],{});s._sourceSegment=n,s._segmentIndexShift=e.length,i[Ci(a)]=s}return{...o,...i}}(n,e,t,r,n.children));return i._sourceSegment=n,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:t}}const o=new mt(n.segments,n.children);return o._sourceSegment=n,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:t}}function Lv(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function NN(n,e,t,r){return!!(Ci(n)===r||r!==ot&&Lv(e,t,n))&&("**"===n.path||jw(e,n,t).matched)}function ON(n,e,t){return 0===e.length&&!n.children[t]}const Bv=!1;class Vv{constructor(e){this.segmentGroup=e||null}}class MN{constructor(e){this.urlTree=e}}function gh(n){return th(new Vv(n))}function PN(n){return th(new MN(n))}class tY{constructor(e,t,r,o,i){this.injector=e,this.configLoader=t,this.urlSerializer=r,this.urlTree=o,this.config=i,this.allowRedirects=!0}apply(){const e=Fv(this.urlTree.root,[],[],this.config).segmentGroup,t=new mt(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,ot).pipe($e(i=>this.createUrlTree(Tv(i),this.urlTree.queryParams,this.urlTree.fragment))).pipe(bs(i=>{if(i instanceof MN)return this.allowRedirects=!1,this.match(i.urlTree);throw i instanceof Vv?this.noMatchError(i):i}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,ot).pipe($e(o=>this.createUrlTree(Tv(o),e.queryParams,e.fragment))).pipe(bs(o=>{throw o instanceof Vv?this.noMatchError(o):o}))}noMatchError(e){return new ie(4002,Bv)}createUrlTree(e,t,r){const o=Iw(e);return new au(o,t,r)}expandSegmentGroup(e,t,r,o){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe($e(i=>new mt([],i))):this.expandSegment(e,r,t,r.segments,o,!0)}expandChildren(e,t,r){const o=[];for(const i of Object.keys(r.children))"primary"===i?o.unshift(i):o.push(i);return Dn(o).pipe(nu(i=>{const a=r.children[i],s=IN(t,i);return this.expandSegmentGroup(e,s,a,i).pipe($e(u=>({segment:u,outlet:i})))}),X3((i,a)=>(i[a.outlet]=a.segment,i),{}),K3())}expandSegment(e,t,r,o,i,a){return Dn(r).pipe(nu(s=>this.expandSegmentAgainstRoute(e,t,r,s,o,i,a).pipe(bs(c=>{if(c instanceof Vv)return Le(null);throw c}))),ou(s=>!!s),bs((s,u)=>{if(Gw(s))return ON(t,o,i)?Le(new mt([],{})):gh(t);throw s}))}expandSegmentAgainstRoute(e,t,r,o,i,a,s){return NN(o,t,i,a)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(e,t,o,i,a):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,o,i,a):gh(t):gh(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,o,i,a){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,o,a):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,o,i,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,o){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?PN(i):this.lineralizeSegments(r,i).pipe(Er(a=>{const s=new mt(a,{});return this.expandSegment(e,s,t,a,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,o,i,a){const{matched:s,consumedSegments:u,remainingSegments:c,positionalParamSegments:l}=jw(t,o,i);if(!s)return gh(t);const f=this.applyRedirectCommands(u,o.redirectTo,l);return o.redirectTo.startsWith("/")?PN(f):this.lineralizeSegments(o,f).pipe(Er(d=>this.expandSegment(e,t,r,d.concat(c),a,!1)))}matchSegmentAgainstRoute(e,t,r,o,i){return"**"===r.path?(e=AN(r,e),r.loadChildren?(r._loadedRoutes?Le({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(e,r)).pipe($e(s=>(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,new mt(o,{})))):Le(new mt(o,{}))):RN(t,r,o,e).pipe(Do(({matched:a,consumedSegments:s,remainingSegments:u})=>a?this.getChildConfig(e=r._injector??e,r,o).pipe(Er(l=>{const f=l.injector??e,d=l.routes,{segmentGroup:h,slicedSegments:p}=Fv(t,s,u,d),g=new mt(h.segments,h.children);if(0===p.length&&g.hasChildren())return this.expandChildren(f,d,g).pipe($e(x=>new mt(s,x)));if(0===d.length&&0===p.length)return Le(new mt(s,{}));const v=Ci(r)===i;return this.expandSegment(f,g,d,p,v?ot:i,!0).pipe($e(y=>new mt(s.concat(y.segments),y.children)))})):gh(t)))}getChildConfig(e,t,r){return t.children?Le({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?Le({routes:t._loadedRoutes,injector:t._loadedInjector}):function $K(n,e,t,r){const o=e.canLoad;return void 0===o||0===o.length?Le(!0):Le(o.map(a=>{const s=af(a,n);return iu(function OK(n){return n&&ph(n.canLoad)}(s)?s.canLoad(e,t):n.runInContext(()=>s(e,t)))})).pipe(sf(),TN())}(e,t,r).pipe(Er(o=>o?this.configLoader.loadChildren(e,t).pipe(Dr(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):function JK(n){return th(CN(Bv,3))}())):Le({routes:[],injector:e})}lineralizeSegments(e,t){let r=[],o=t.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return Le(r);if(o.numberOfChildren>1||!o.children[ot])return e.redirectTo,th(new ie(4e3,Bv));o=o.children[ot]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreateUrlTree(e,t,r,o){const i=this.createSegmentGroup(e,t.root,r,o);return new au(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return Tr(e,(o,i)=>{if("string"==typeof o&&o.startsWith(":")){const s=o.substring(1);r[i]=t[s]}else r[i]=o}),r}createSegmentGroup(e,t,r,o){const i=this.createSegments(e,t.segments,r,o);let a={};return Tr(t.children,(s,u)=>{a[u]=this.createSegmentGroup(e,s,r,o)}),new mt(i,a)}createSegments(e,t,r,o){return t.map(i=>i.path.startsWith(":")?this.findPosParam(e,i,o):this.findOrReturn(i,r))}findPosParam(e,t,r){const o=r[t.path.substring(1)];if(!o)throw new ie(4001,Bv);return o}findOrReturn(e,t){let r=0;for(const o of t){if(o.path===e.path)return t.splice(r),o;r++}return e}}class rY{}class aY{constructor(e,t,r,o,i,a,s){this.injector=e,this.rootComponentType=t,this.config=r,this.urlTree=o,this.url=i,this.paramsInheritanceStrategy=a,this.urlSerializer=s}recognize(){const e=Fv(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,ot).pipe($e(t=>{if(null===t)return null;const r=new Ov([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ot,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new Cs(r,t),i=new wN(this.url,o);return this.inheritParamsAndData(i._root),i}))}inheritParamsAndData(e){const t=e.value,r=xN(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(e,t,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,o)}processChildren(e,t,r){return Dn(Object.keys(r.children)).pipe(nu(o=>{const i=r.children[o],a=IN(t,o);return this.processSegmentGroup(e,a,i,o)}),X3((o,i)=>o&&i?(o.push(...i),o):null),function SX(n,e=!1){return rr((t,r)=>{let o=0;t.subscribe(Fn(r,i=>{const a=n(i,o++);(a||e)&&r.next(i),!a&&r.complete()}))})}(o=>null!==o),bv(null),K3(),$e(o=>{if(null===o)return null;const i=FN(o);return function sY(n){n.sort((e,t)=>e.value.outlet===ot?-1:t.value.outlet===ot?1:e.value.outlet.localeCompare(t.value.outlet))}(i),i}))}processSegment(e,t,r,o,i){return Dn(t).pipe(nu(a=>this.processSegmentAgainstRoute(a._injector??e,a,r,o,i)),ou(a=>!!a),bs(a=>{if(Gw(a))return ON(r,o,i)?Le([]):Le(null);throw a}))}processSegmentAgainstRoute(e,t,r,o,i){if(t.redirectTo||!NN(t,r,o,i))return Le(null);let a;if("**"===t.path){const s=o.length>0?Q3(o).parameters:{},u=BN(r)+o.length;a=Le({snapshot:new Ov(o,s,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,VN(t),Ci(t),t.component??t._loadedComponent??null,t,LN(r),u,UN(t)),consumedSegments:[],remainingSegments:[]})}else a=RN(r,t,o,e).pipe($e(({matched:s,consumedSegments:u,remainingSegments:c,parameters:l})=>{if(!s)return null;const f=BN(r)+u.length;return{snapshot:new Ov(u,l,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,VN(t),Ci(t),t.component??t._loadedComponent??null,t,LN(r),f,UN(t)),consumedSegments:u,remainingSegments:c}}));return a.pipe(Do(s=>{if(null===s)return Le(null);const{snapshot:u,consumedSegments:c,remainingSegments:l}=s;e=t._injector??e;const f=t._loadedInjector??e,d=function uY(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:h,slicedSegments:p}=Fv(r,c,l,d.filter(v=>void 0===v.redirectTo));if(0===p.length&&h.hasChildren())return this.processChildren(f,d,h).pipe($e(v=>null===v?null:[new Cs(u,v)]));if(0===d.length&&0===p.length)return Le([new Cs(u,[])]);const g=Ci(t)===i;return this.processSegment(f,d,h,p,g?ot:i).pipe($e(v=>null===v?null:[new Cs(u,v)]))}))}}function cY(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function FN(n){const e=[],t=new Set;for(const r of n){if(!cY(r)){e.push(r);continue}const o=e.find(i=>r.value.routeConfig===i.value.routeConfig);void 0!==o?(o.children.push(...r.children),t.add(o)):e.push(r)}for(const r of t){const o=FN(r.children);e.push(new Cs(r.value,o))}return e.filter(r=>!t.has(r))}function LN(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function BN(n){let e=n,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function VN(n){return n.data||{}}function UN(n){return n.resolve||{}}function HN(n){return"string"==typeof n.title||null===n.title}function $w(n){return Do(e=>{const t=n(e);return t?Dn(t).pipe($e(()=>e)):Le(e)})}const uf=new ge("ROUTES");let qw=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ft(nR)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Le(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=iu(t.loadComponent()).pipe($e(GN),Dr(i=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=i}),Ew(()=>{this.componentLoaders.delete(t)})),o=new $3(r,()=>new Li).pipe(bw());return this.componentLoaders.set(t,o),o}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Le({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const i=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe($e(s=>{this.onLoadEndListener&&this.onLoadEndListener(r);let u,c,l=!1;Array.isArray(s)?c=s:(u=s.create(t).injector,c=Z3(u.get(uf,[],Ge.Self|Ge.Optional)));return{routes:c.map(Ww),injector:u}}),Ew(()=>{this.childrenLoaders.delete(r)})),a=new $3(i,()=>new Li).pipe(bw());return this.childrenLoaders.set(r,a),a}loadModuleFactoryOrRoutes(t){return iu(t()).pipe($e(GN),Er(r=>r instanceof fT||Array.isArray(r)?Le(r):Dn(this.compiler.compileModuleAsync(r))))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function GN(n){return function mY(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let Hv=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Li,this.configLoader=ft(qw),this.environmentInjector=ft(Ca),this.urlSerializer=ft(oh),this.rootContexts=ft(lh),this.navigationId=0,this.afterPreactivation=()=>Le(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new oK(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new rK(o))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t){return this.transitions=new Qo({id:0,targetPageId:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:uh,restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(_s(r=>0!==r.id),$e(r=>({...r,extractedUrl:t.urlHandlingStrategy.extract(r.rawUrl)})),Do(r=>{let o=!1,i=!1;return Le(r).pipe(Dr(a=>{this.currentNavigation={id:a.id,initialUrl:a.rawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Do(a=>{const s=t.browserUrlTree.toString(),u=!t.navigated||a.extractedUrl.toString()!==s||s!==t.currentUrlTree.toString();if(!u&&"reload"!==(a.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const l="";return this.events.next(new Nv(a.id,t.serializeUrl(r.rawUrl),l,0)),t.rawUrlTree=a.rawUrl,a.resolve(null),Bi}if(t.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return zN(a.source)&&(t.browserUrlTree=a.extractedUrl),Le(a).pipe(Do(l=>{const f=this.transitions?.getValue();return this.events.next(new Nw(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),f!==this.transitions?.getValue()?Bi:Promise.resolve(l)}),function nY(n,e,t,r){return Do(o=>function eY(n,e,t,r,o){return new tY(n,e,t,r,o).apply()}(n,e,t,o.extractedUrl,r).pipe($e(i=>({...o,urlAfterRedirects:i}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,t.config),Dr(l=>{this.currentNavigation={...this.currentNavigation,finalUrl:l.urlAfterRedirects},r.urlAfterRedirects=l.urlAfterRedirects}),function fY(n,e,t,r,o){return Er(i=>function iY(n,e,t,r,o,i,a="emptyOnly"){return new aY(n,e,t,r,o,a,i).recognize().pipe(Do(s=>null===s?function oY(n){return new In(e=>e.error(n))}(new rY):Le(s)))}(n,e,t,i.urlAfterRedirects,r.serialize(i.urlAfterRedirects),r,o).pipe($e(a=>({...i,targetSnapshot:a}))))}(this.environmentInjector,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),Dr(l=>{if(r.targetSnapshot=l.targetSnapshot,"eager"===t.urlUpdateStrategy){if(!l.extras.skipLocationChange){const d=t.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl);t.setBrowserUrl(d,l)}t.browserUrlTree=l.urlAfterRedirects}const f=new QX(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(f)}));if(u&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:l,extractedUrl:f,source:d,restoredState:h,extras:p}=a,g=new Nw(l,this.urlSerializer.serialize(f),d,h);this.events.next(g);const v=yN(f,this.rootComponentType).snapshot;return Le(r={...a,targetSnapshot:v,urlAfterRedirects:f,extras:{...p,skipLocationChange:!1,replaceUrl:!1}})}{const l="";return this.events.next(new Nv(a.id,t.serializeUrl(r.extractedUrl),l,1)),t.rawUrlTree=a.rawUrl,a.resolve(null),Bi}}),Dr(a=>{const s=new JX(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(s)}),$e(a=>r={...a,guards:IK(a.targetSnapshot,a.currentSnapshot,this.rootContexts)}),function BK(n,e){return Er(t=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:a}}=t;return 0===a.length&&0===i.length?Le({...t,guardsResult:!0}):function VK(n,e,t,r){return Dn(n).pipe(Er(o=>function jK(n,e,t,r,o){const i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return i&&0!==i.length?Le(i.map(s=>{const u=fh(e)??o,c=af(s,u);return iu(function kK(n){return n&&ph(n.canDeactivate)}(c)?c.canDeactivate(n,e,t,r):u.runInContext(()=>c(n,e,t,r))).pipe(ou())})).pipe(sf()):Le(!0)}(o.component,o.route,t,e,r)),ou(o=>!0!==o,!0))}(a,r,o,n).pipe(Er(s=>s&&function NK(n){return"boolean"==typeof n}(s)?function UK(n,e,t,r){return Dn(e).pipe(nu(o=>_w(function WK(n,e){return null!==n&&e&&e(new iK(n)),Le(!0)}(o.route.parent,r),function HK(n,e){return null!==n&&e&&e(new sK(n)),Le(!0)}(o.route,r),function zK(n,e,t){const r=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(a=>function DK(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(a)).filter(a=>null!==a).map(a=>j3(()=>Le(a.guards.map(u=>{const c=fh(a.node)??t,l=af(u,c);return iu(function PK(n){return n&&ph(n.canActivateChild)}(l)?l.canActivateChild(r,n):c.runInContext(()=>l(r,n))).pipe(ou())})).pipe(sf())));return Le(i).pipe(sf())}(n,o.path,t),function GK(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return Le(!0);const o=r.map(i=>j3(()=>{const a=fh(e)??t,s=af(i,a);return iu(function MK(n){return n&&ph(n.canActivate)}(s)?s.canActivate(e,n):a.runInContext(()=>s(e,n))).pipe(ou())}));return Le(o).pipe(sf())}(n,o.route,t))),ou(o=>!0!==o,!0))}(r,i,n,e):Le(s)),$e(s=>({...t,guardsResult:s})))})}(this.environmentInjector,a=>this.events.next(a)),Dr(a=>{if(r.guardsResult=a.guardsResult,lc(a.guardsResult))throw bN(0,a.guardsResult);const s=new eK(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.events.next(s)}),_s(a=>!!a.guardsResult||(t.restoreHistory(a),this.cancelNavigationTransition(a,"",3),!1)),$w(a=>{if(a.guards.canActivateChecks.length)return Le(a).pipe(Dr(s=>{const u=new tK(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(u)}),Do(s=>{let u=!1;return Le(s).pipe(function dY(n,e){return Er(t=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=t;if(!o.length)return Le(t);let i=0;return Dn(o).pipe(nu(a=>function hY(n,e,t,r){const o=n.routeConfig,i=n._resolve;return void 0!==o?.title&&!HN(o)&&(i[nh]=o.title),function pY(n,e,t,r){const o=function gY(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===o.length)return Le({});const i={};return Dn(o).pipe(Er(a=>function vY(n,e,t,r){const o=fh(e)??r,i=af(n,o);return iu(i.resolve?i.resolve(e,t):o.runInContext(()=>i(e,t)))}(n[a],e,t,r).pipe(ou(),Dr(s=>{i[a]=s}))),Cw(1),function AX(n){return $e(()=>n)}(i),bs(a=>Gw(a)?Bi:th(a)))}(i,n,e,r).pipe($e(a=>(n._resolvedData=a,n.data=xN(n,t).resolve,o&&HN(o)&&(n.data[nh]=o.title),null)))}(a.route,r,n,e)),Dr(()=>i++),Cw(1),Er(a=>i===o.length?Le(t):Bi))})}(t.paramsInheritanceStrategy,this.environmentInjector),Dr({next:()=>u=!0,complete:()=>{u||(t.restoreHistory(s),this.cancelNavigationTransition(s,"",2))}}))}),Dr(s=>{const u=new nK(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(u)}))}),$w(a=>{const s=u=>{const c=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(u.routeConfig).pipe(Dr(l=>{u.component=l}),$e(()=>{})));for(const l of u.children)c.push(...s(l));return c};return ww(s(a.targetSnapshot.root)).pipe(bv(),Ql(1))}),$w(()=>this.afterPreactivation()),$e(a=>{const s=function vK(n,e,t){const r=ch(n,e._root,t?t._root:void 0);return new mN(r,e)}(t.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return r={...a,targetRouterState:s}}),Dr(a=>{t.currentUrlTree=a.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),t.routerState=a.targetRouterState,"deferred"===t.urlUpdateStrategy&&(a.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,a),t.browserUrlTree=a.urlAfterRedirects)}),((n,e,t)=>$e(r=>(new AK(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,t.routeReuseStrategy,a=>this.events.next(a)),Dr({next:a=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new fc(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(a.targetRouterState.snapshot),a.resolve(!0)},complete:()=>{o=!0}}),Ew(()=>{o||i||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),bs(a=>{if(i=!0,SN(a)){EN(a)||(t.navigated=!0,t.restoreHistory(r,!0));const s=new Rv(r.id,this.urlSerializer.serialize(r.extractedUrl),a.message,a.cancellationCode);if(this.events.next(s),EN(a)){const u=t.urlHandlingStrategy.merge(a.url,t.rawUrlTree),c={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||zN(r.source)};t.scheduleNavigation(u,uh,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{t.restoreHistory(r,!0);const s=new Ow(r.id,this.urlSerializer.serialize(r.extractedUrl),a,r.targetSnapshot??void 0);this.events.next(s);try{r.resolve(t.errorHandler(a))}catch(u){r.reject(u)}}return Bi}))}))}cancelNavigationTransition(t,r,o){const i=new Rv(t.id,this.urlSerializer.serialize(t.extractedUrl),r,o);this.events.next(i),t.resolve(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function zN(n){return n!==uh}let jN=(()=>{class n{buildTitle(t){let r,o=t.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===ot);return r}getResolvedTitleForRoute(t){return t.data[nh]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ft(yY)},providedIn:"root"}),n})(),yY=(()=>{class n extends jN{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}}return n.\u0275fac=function(t){return new(t||n)(me(S3))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),xY=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ft(_Y)},providedIn:"root"}),n})();class wY{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let _Y=(()=>{class n extends wY{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Ir(n)))(r||n)}}(),n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Wv=new ge("",{providedIn:"root",factory:()=>({})});let CY=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ft(EY)},providedIn:"root"}),n})(),EY=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function SY(n){throw n}function AY(n,e,t){return e.parse("/")}const IY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},DY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let jr=(()=>{class n{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=ft(Pz),this.isNgZoneEnabled=!1,this.options=ft(Wv,{optional:!0})||{},this.errorHandler=this.options.errorHandler||SY,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||AY,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=ft(CY),this.routeReuseStrategy=ft(xY),this.urlCreationStrategy=ft(hK),this.titleStrategy=ft(jN),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Z3(ft(uf,{optional:!0})??[]),this.navigationTransitions=ft(Hv),this.urlSerializer=ft(oh),this.location=ft(Wx),this.isNgZoneEnabled=ft(Bn)instanceof Bn&&Bn.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new au,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=yN(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),uh,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,o){const i={replaceUrl:!0},a=o?.navigationId?o:null;if(o){const u={...o};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(i.state=u)}const s=this.parseUrl(t);this.scheduleNavigation(s,r,a,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(t){this.config=t.map(Ww),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:o,queryParams:i,fragment:a,queryParamsHandling:s,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:a;let l=null;switch(s){case"merge":l={...this.currentUrlTree.queryParams,...i};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}return null!==l&&(l=this.removeEmptyProps(l)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,t,l,c??null)}navigateByUrl(t,r={skipLocationChange:!1}){const o=lc(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,uh,null,r)}navigate(t,r={skipLocationChange:!1}){return function TY(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new ie(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,t)}return r}isActive(t,r){let o;if(o=!0===r?{...IY}:!1===r?{...DY}:r,lc(t))return eN(this.currentUrlTree,t,o);const i=this.parseUrl(t);return eN(this.currentUrlTree,i,o)}removeEmptyProps(t){return Object.keys(t).reduce((r,o)=>{const i=t[o];return null!=i&&(r[o]=i),r},{})}scheduleNavigation(t,r,o,i,a){if(this.disposed)return Promise.resolve(!1);let s,u,c,l;return a?(s=a.resolve,u=a.reject,c=a.promise):c=new Promise((f,d)=>{s=f,u=d}),l="computed"===this.canceledNavigationResolution?o&&o.\u0275routerPageId?o.\u0275routerPageId:i.replaceUrl||i.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:l,source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(f=>Promise.reject(f))}setBrowserUrl(t,r){const o=this.urlSerializer.serialize(t),i={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl?this.location.replaceState(o,"",i):this.location.go(o,"",i)}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===o?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class $N{}let OY=(()=>{class n{constructor(t,r,o,i,a){this.router=t,this.injector=o,this.preloadingStrategy=i,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(_s(t=>t instanceof fc),nu(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const o=[];for(const i of r){i.providers&&!i._injector&&(i._injector=zg(i.providers,t,`Route: ${i.path}`));const a=i._injector??t,s=i._loadedInjector??a;i.loadChildren&&!i._loadedRoutes&&void 0===i.canLoad||i.loadComponent&&!i._loadedComponent?o.push(this.preloadConfig(a,i)):(i.children||i._loadedRoutes)&&o.push(this.processRoutes(s,i.children??i._loadedRoutes))}return Dn(o).pipe(sl())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):Le(null);const i=o.pipe(Er(a=>null===a?Le(void 0):(r._loadedRoutes=a.routes,r._loadedInjector=a.injector,this.processRoutes(a.injector??t,a.routes))));return r.loadComponent&&!r._loadedComponent?Dn([i,this.loader.loadComponent(r)]).pipe(sl()):i})}}return n.\u0275fac=function(t){return new(t||n)(me(jr),me(nR),me(Ca),me($N),me(qw))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Yw=new ge("");let qN=(()=>{class n{constructor(t,r,o,i,a={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=o,this.zone=i,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Nw?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof fc&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof gN&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new gN(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return n.\u0275fac=function(t){!function vI(){throw new Error("invalid")}()},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();var Jo=(()=>((Jo=Jo||{})[Jo.COMPLETE=0]="COMPLETE",Jo[Jo.FAILED=1]="FAILED",Jo[Jo.REDIRECTING=2]="REDIRECTING",Jo))();const cf=!1;function uu(n,e){return{\u0275kind:n,\u0275providers:e}}const Zw=new ge("",{providedIn:"root",factory:()=>!1});function KN(){const n=ft(Sa);return e=>{const t=n.get(Qg);if(e!==t.components[0])return;const r=n.get(jr),o=n.get(YN);1===n.get(Qw)&&r.initialNavigation(),n.get(ZN,null,Ge.Optional)?.setUpPreloading(),n.get(Yw,null,Ge.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),o.closed||(o.next(),o.unsubscribe())}}const YN=new ge(cf?"bootstrap done indicator":"",{factory:()=>new Li}),Qw=new ge(cf?"initial navigation":"",{providedIn:"root",factory:()=>1});function LY(){let n=[];return n=cf?[{provide:Eg,multi:!0,useFactory:()=>{const e=ft(jr);return()=>e.events.subscribe(t=>{console.group?.(`Router Event: ${t.constructor.name}`),console.log(function cK(n){if(!("type"in n))return`Unknown Router Event: ${n.constructor.name}`;switch(n.type){case 14:return`ActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state}, shouldActivate: ${n.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 2:return`NavigationCancel(id: ${n.id}, url: '${n.url}')`;case 16:return`NavigationSkipped(id: ${n.id}, url: '${n.url}')`;case 1:return`NavigationEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${n.id}, url: '${n.url}', error: ${n.error})`;case 0:return`NavigationStart(id: ${n.id}, url: '${n.url}')`;case 6:return`ResolveEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 5:return`ResolveStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 10:return`RouteConfigLoadEnd(path: ${n.route.path})`;case 9:return`RouteConfigLoadStart(path: ${n.route.path})`;case 4:return`RoutesRecognized(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 15:return`Scroll(anchor: '${n.anchor}', position: '${n.position?`${n.position[0]}, ${n.position[1]}`:null}')`}}(t)),console.log(t),console.groupEnd?.()})}}]:[],uu(1,n)}const ZN=new ge(cf?"router preloader":"");function BY(n){return uu(0,[{provide:ZN,useExisting:OY},{provide:$N,useExisting:n}])}const vh=!1,QN=new ge(vh?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),VY=[Wx,{provide:oh,useClass:Sw},jr,lh,{provide:su,useFactory:function XN(n){return n.routerState.root},deps:[jr]},qw,vh?{provide:Zw,useValue:!0}:[]];function UY(){return new lR("Router",jr)}let HY=(()=>{class n{constructor(t){}static forRoot(t,r){return{ngModule:n,providers:[VY,vh&&r?.enableTracing?LY().\u0275providers:[],{provide:uf,multi:!0,useValue:t},{provide:QN,useFactory:jY,deps:[[jr,new yd,new xd]]},{provide:Wv,useValue:r||{}},r?.useHash?{provide:uc,useClass:bj}:{provide:uc,useClass:MR},{provide:Yw,useFactory:()=>{const n=ft(V$),e=ft(Bn),t=ft(Wv),r=ft(Hv),o=ft(oh);return t.scrollOffset&&n.setOffset(t.scrollOffset),new qN(o,r,n,e,t)}},r?.preloadingStrategy?BY(r.preloadingStrategy).\u0275providers:[],{provide:lR,multi:!0,useFactory:UY},r?.initialNavigation?$Y(r):[],[{provide:JN,useFactory:KN},{provide:cR,multi:!0,useExisting:JN}]]}}static forChild(t){return{ngModule:n,providers:[{provide:uf,multi:!0,useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)(me(QN,8))},n.\u0275mod=bo({type:n}),n.\u0275inj=no({imports:[Uw]}),n})();function jY(n){if(vh&&n)throw new ie(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function $Y(n){return["disabled"===n.initialNavigation?uu(3,[{provide:Xg,multi:!0,useFactory:()=>{const e=ft(jr);return()=>{e.setUpLocationChangeListener()}}},{provide:Qw,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?uu(2,[{provide:Qw,useValue:0},{provide:Xg,multi:!0,deps:[Sa],useFactory:e=>{const t=e.get(wj,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const o=e.get(jr),i=e.get(YN);(function MY(n,e){n.events.pipe(_s(t=>t instanceof fc||t instanceof Rv||t instanceof Ow||t instanceof Nv),$e(t=>t instanceof fc||t instanceof Nv?Jo.COMPLETE:t instanceof Rv&&(0===t.code||1===t.code)?Jo.REDIRECTING:Jo.FAILED),_s(t=>t!==Jo.REDIRECTING),Ql(1)).subscribe(()=>{e()})})(o,()=>{r(!0)}),e.get(Hv).afterPreactivation=()=>(r(!0),i.closed?Le(void 0):i),o.initialNavigation()}))}}]).\u0275providers:[]]}const JN=new ge(vh?"Router Initializer":"");let XY=(()=>{class n{constructor(t,r){this.service=t,this.detectService=r,this.title="identifica"}ngOnInit(){this.service.getConfig().subscribe(t=>{this.detectService.useTime=null===t.use_time_photo||t.use_time_photo,this.detectService.timePhoto=null!==t.time_photo_sec?t.time_photo_sec:3,this.detectService.confirm_identity=t.confirm_identity||!1,this.detectService.has_callback=null!==t.has_callback&&t.has_callback,this.detectService.callback_url=null!==t.callback_url?t.callback_url:""})}}return n.\u0275fac=function(t){return new(t||n)(Q(yw),Q(xw))},n.\u0275cmp=Vi({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(t,r){1&t&&sn(0,"router-outlet")},dependencies:[Vw]}),n})();function eO(n,e,t,r,o,i,a){try{var s=n[i](a),u=s.value}catch(c){return void t(c)}s.done?e(u):Promise.resolve(u).then(r,o)}function lo(n){return function(){var e=this,t=arguments;return new Promise(function(r,o){var i=n.apply(e,t);function a(u){eO(i,r,o,a,s,"next",u)}function s(u){eO(i,r,o,a,s,"throw",u)}a(void 0)})}}var Gv=(()=>{return(n=Gv||(Gv={}))[n.OTHER=0]="OTHER",n[n.PURE_BARCODE=1]="PURE_BARCODE",n[n.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",n[n.TRY_HARDER=3]="TRY_HARDER",n[n.CHARACTER_SET=4]="CHARACTER_SET",n[n.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",n[n.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",n[n.ASSUME_GS1=7]="ASSUME_GS1",n[n.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",n[n.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",n[n.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS",Gv;var n})();const tO=Gv;var n,YY=(n=function(t,r){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(o[a]=i[a])})(t,r)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),rO=function(n){function e(t,r){var o=this.constructor,i=n.call(this,t,r)||this;return Object.defineProperty(i,"name",{value:o.name,enumerable:!1,configurable:!0}),function KY(n,e){var t=Object.setPrototypeOf;t?t(n,e):n.__proto__=e}(i,o.prototype),function nO(n,e){void 0===e&&(e=n.constructor);var t=Error.captureStackTrace;t&&t(n,e)}(i),i}return YY(e,n),e}(Error);let oO=(()=>{class n extends rO{constructor(t){super(t),this.message=t}getKind(){return this.constructor.kind}}return n.kind="Exception",n})(),Jw=(()=>{class n extends oO{static getFormatInstance(){return new n}}return n.kind="FormatException",n})();var Xt=(()=>(function(n){n[n.Cp437=0]="Cp437",n[n.ISO8859_1=1]="ISO8859_1",n[n.ISO8859_2=2]="ISO8859_2",n[n.ISO8859_3=3]="ISO8859_3",n[n.ISO8859_4=4]="ISO8859_4",n[n.ISO8859_5=5]="ISO8859_5",n[n.ISO8859_6=6]="ISO8859_6",n[n.ISO8859_7=7]="ISO8859_7",n[n.ISO8859_8=8]="ISO8859_8",n[n.ISO8859_9=9]="ISO8859_9",n[n.ISO8859_10=10]="ISO8859_10",n[n.ISO8859_11=11]="ISO8859_11",n[n.ISO8859_13=12]="ISO8859_13",n[n.ISO8859_14=13]="ISO8859_14",n[n.ISO8859_15=14]="ISO8859_15",n[n.ISO8859_16=15]="ISO8859_16",n[n.SJIS=16]="SJIS",n[n.Cp1250=17]="Cp1250",n[n.Cp1251=18]="Cp1251",n[n.Cp1252=19]="Cp1252",n[n.Cp1256=20]="Cp1256",n[n.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",n[n.UTF8=22]="UTF8",n[n.ASCII=23]="ASCII",n[n.Big5=24]="Big5",n[n.GB18030=25]="GB18030",n[n.EUC_KR=26]="EUC_KR"}(Xt||(Xt={})),Xt))();class pe{constructor(e,t,r,...o){this.valueIdentifier=e,this.name=r,this.values="number"==typeof t?Int32Array.from([t]):t,this.otherEncodingNames=o,pe.VALUE_IDENTIFIER_TO_ECI.set(e,this),pe.NAME_TO_ECI.set(r,this);const i=this.values;for(let a=0,s=i.length;a!==s;a++)pe.VALUES_TO_ECI.set(i[a],this);for(const a of o)pe.NAME_TO_ECI.set(a,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new Jw("incorect value");const t=pe.VALUES_TO_ECI.get(e);if(void 0===t)throw new Jw("incorect value");return t}static getCharacterSetECIByName(e){const t=pe.NAME_TO_ECI.get(e);if(void 0===t)throw new Jw("incorect value");return t}equals(e){if(!(e instanceof pe))return!1;const t=e;return this.getName()===t.getName()}}pe.VALUE_IDENTIFIER_TO_ECI=new Map,pe.VALUES_TO_ECI=new Map,pe.NAME_TO_ECI=new Map,pe.Cp437=new pe(Xt.Cp437,Int32Array.from([0,2]),"Cp437"),pe.ISO8859_1=new pe(Xt.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),pe.ISO8859_2=new pe(Xt.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),pe.ISO8859_3=new pe(Xt.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),pe.ISO8859_4=new pe(Xt.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),pe.ISO8859_5=new pe(Xt.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),pe.ISO8859_6=new pe(Xt.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),pe.ISO8859_7=new pe(Xt.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),pe.ISO8859_8=new pe(Xt.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),pe.ISO8859_9=new pe(Xt.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),pe.ISO8859_10=new pe(Xt.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),pe.ISO8859_11=new pe(Xt.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),pe.ISO8859_13=new pe(Xt.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),pe.ISO8859_14=new pe(Xt.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),pe.ISO8859_15=new pe(Xt.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),pe.ISO8859_16=new pe(Xt.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),pe.SJIS=new pe(Xt.SJIS,20,"SJIS","Shift_JIS"),pe.Cp1250=new pe(Xt.Cp1250,21,"Cp1250","windows-1250"),pe.Cp1251=new pe(Xt.Cp1251,22,"Cp1251","windows-1251"),pe.Cp1252=new pe(Xt.Cp1252,23,"Cp1252","windows-1252"),pe.Cp1256=new pe(Xt.Cp1256,24,"Cp1256","windows-1256"),pe.UnicodeBigUnmarked=new pe(Xt.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),pe.UTF8=new pe(Xt.UTF8,26,"UTF8","UTF-8"),pe.ASCII=new pe(Xt.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),pe.Big5=new pe(Xt.Big5,28,"Big5"),pe.GB18030=new pe(Xt.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),pe.EUC_KR=new pe(Xt.EUC_KR,30,"EUC_KR","EUC-KR");let QY=(()=>{class n extends oO{}return n.kind="UnsupportedOperationException",n})();class mh{static decode(e,t){const r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)}static shouldDecodeOnFallback(e){return!mh.isBrowser()&&"ISO-8859-1"===e}static encode(e,t){const r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):typeof TextEncoder>"u"?this.encodeFallback(e):(new TextEncoder).encode(e)}static isBrowser(){return typeof window<"u"&&"[object Window]"==={}.toString.call(window)}static encodingName(e){return"string"==typeof e?e:e.getName()}static encodingCharacterSet(e){return e instanceof pe?e:pe.getCharacterSetECIByName(e)}static decodeFallback(e,t){const r=this.encodingCharacterSet(t);if(mh.isDecodeFallbackSupported(r)){let o="";for(let i=0,a=e.length;i<a;i++){let s=e[i].toString(16);s.length<2&&(s="0"+s),o+="%"+s}return decodeURIComponent(o)}if(r.equals(pe.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new QY(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(pe.UTF8)||e.equals(pe.ISO8859_1)||e.equals(pe.ASCII)}static encodeFallback(e){const r=btoa(unescape(encodeURIComponent(e))).split(""),o=[];for(let i=0;i<r.length;i++)o.push(r[i].charCodeAt(0));return new Uint8Array(o)}}class sr{static castAsNonUtf8Char(e,t=null){const r=t?t.getName():this.ISO88591;return mh.decode(new Uint8Array([e]),r)}static guessEncoding(e,t){if(null!=t&&void 0!==t.get(tO.CHARACTER_SET))return t.get(tO.CHARACTER_SET).toString();const r=e.length;let o=!0,i=!0,a=!0,s=0,u=0,c=0,l=0,f=0,d=0,h=0,p=0,g=0,v=0,m=0;const y=e.length>3&&239===e[0]&&187===e[1]&&191===e[2];for(let x=0;x<r&&(o||i||a);x++){const w=255&e[x];a&&(s>0?128&w?s--:a=!1:128&w&&(64&w?(s++,32&w?(s++,16&w?(s++,8&w?a=!1:l++):c++):u++):a=!1)),o&&(w>127&&w<160?o=!1:w>159&&(w<192||215===w||247===w)&&m++),i&&(f>0?w<64||127===w||w>252?i=!1:f--:128===w||160===w||w>239?i=!1:w>160&&w<224?(d++,p=0,h++,h>g&&(g=h)):w>127?(f++,h=0,p++,p>v&&(v=p)):(h=0,p=0))}return a&&s>0&&(a=!1),i&&f>0&&(i=!1),a&&(y||u+c+l>0)?sr.UTF8:i&&(sr.ASSUME_SHIFT_JIS||g>=3||v>=3)?sr.SHIFT_JIS:o&&i?2===g&&2===d||10*m>=r?sr.SHIFT_JIS:sr.ISO88591:o?sr.ISO88591:i?sr.SHIFT_JIS:a?sr.UTF8:sr.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let r=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function o(a,s,u,c,l,f){if("%%"===a)return"%";if(void 0===t[++r])return;a=c?parseInt(c.substr(1)):void 0;let h,d=l?parseInt(l.substr(1)):void 0;switch(f){case"s":h=t[r];break;case"c":h=t[r][0];break;case"f":h=parseFloat(t[r]).toFixed(a);break;case"p":h=parseFloat(t[r]).toPrecision(a);break;case"e":h=parseFloat(t[r]).toExponential(a);break;case"x":h=parseInt(t[r]).toString(d||16);break;case"d":h=parseFloat(parseInt(t[r],d||10).toPrecision(a)).toFixed(0)}h="object"==typeof h?JSON.stringify(h):(+h).toString(d);let p=parseInt(u),g=u&&u[0]+""=="0"?"0":" ";for(;h.length<p;)h=void 0!==s?h+g:g+h;return h})}static getBytes(e,t){return mh.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}sr.SHIFT_JIS=pe.SJIS.getName(),sr.GB2312="GB2312",sr.ISO88591=pe.ISO8859_1.getName(),sr.EUC_JP="EUC_JP",sr.UTF8=pe.UTF8.getName(),sr.PLATFORM_DEFAULT_ENCODING=sr.UTF8,sr.ASSUME_SHIFT_JIS=!1;class JY{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return this.value+="string"==typeof e?e.toString():this.encoding?sr.castAsNonUtf8Char(e,this.encoding):String.fromCharCode(e),this}appendChars(e,t,r){for(let o=t;t<t+r;o++)this.append(e[o]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substring(0,e)+t+this.value.substring(e)}}let eZ=(()=>{class n{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const t=new JY;return t.append("<<\n"),t.append(" mode: "),t.append(this.mode?this.mode.toString():"null"),t.append("\n ecLevel: "),t.append(this.ecLevel?this.ecLevel.toString():"null"),t.append("\n version: "),t.append(this.version?this.version.toString():"null"),t.append("\n maskPattern: "),t.append(this.maskPattern.toString()),this.matrix?(t.append("\n matrix:\n"),t.append(this.matrix.toString())):t.append("\n matrix: null\n"),t.append(">>\n"),t.toString()}setMode(t){this.mode=t}setECLevel(t){this.ecLevel=t}setVersion(t){this.version=t}setMaskPattern(t){this.maskPattern=t}setMatrix(t){this.matrix=t}static isValidMaskPattern(t){return t>=0&&t<n.NUM_MASK_PATTERNS}}return n.NUM_MASK_PATTERNS=8,n})();function e_(...n){const e=UE(n),{args:t,keys:r}=H3(n),o=new In(i=>{const{length:a}=t;if(!a)return void i.complete();const s=new Array(a);let u=a,c=a;for(let l=0;l<a;l++){let f=!1;Go(t[l]).subscribe(Fn(i,d=>{f||(f=!0,c--),s[l]=d},()=>u--,void 0,()=>{(!u||!f)&&(c||i.next(r?G3(r,s):s),i.complete())}))}});return e?o.pipe(W3(e)):o}class tZ extends gr{constructor(e,t){super()}schedule(e,t=0){return this}}const zv={setInterval(n,e,...t){const{delegate:r}=zv;return r?.setInterval?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=zv;return(e?.clearInterval||clearInterval)(n)},delegate:void 0},t_={now:()=>(t_.delegate||Date).now(),delegate:void 0};class yh{constructor(e,t=yh.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}}yh.now=t_.now;const oZ=new class rZ extends yh{constructor(e,t=yh.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}(class nZ extends tZ{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;const o=this.id,i=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(i,o,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,r=0){return zv.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&zv.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let o,r=!1;try{this.work(e)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,va(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});class uZ extends Li{constructor(e=1/0,t=1/0,r=t_){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:o,_timestampProvider:i,_windowTime:a}=this;t||(r.push(e),!o&&r.push(i.now()+a)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:o}=this,i=o.slice();for(let a=0;a<i.length&&!e.closed;a+=r?1:2)e.next(i[a]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:o}=this,i=(o?1:2)*e;if(e<1/0&&i<r.length&&r.splice(0,r.length-i),!o){const a=t.now();let s=0;for(let u=1;u<r.length&&r[u]<=a;u+=2)s=u;s&&r.splice(0,s+1)}}}var iO=xo(100);class lZ{constructor(e){this.translations=e}getTranslation(e){return Le(this.translations.get(e)||{})}}const aO=new ge("TRANSLOCO_LOADER");function sO(n,e){return n&&(Object.prototype.hasOwnProperty.call(n,e)?n[e]:e.split(".").reduce((t,r)=>t?.[r],n))}function uO(n){return n?Array.isArray(n)?n.length:n_(n)?Object.keys(n).length:n?n.length:0:0}function dc(n){return"string"==typeof n}function n_(n){return!!n&&"object"==typeof n&&!Array.isArray(n)}function cO(n){return n.replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>0==t?e.toLowerCase():e.toUpperCase()).replace(/\s+|_|-|\//g,"")}function r_(n){return null==n}function fO(n){return!1===r_(n)}function dO(n){return n&&"string"==typeof n.scope}function hO(n){return(0,iO.flatten)(n,{safe:!0})}const lf=new ge("TRANSLOCO_CONFIG",{providedIn:"root",factory:()=>({defaultLang:"en"})}),jv={defaultLang:"en",reRenderOnLangChange:!1,prodMode:!1,failedRetries:2,availableLangs:[],missingHandler:{logMissingKey:!0,useFallbackTranslation:!1,allowEmpty:!1},flatten:{aot:!1},interpolation:["{{","}}"]};function mZ(n=jv){return{...jv,...n}}const pO=new ge("TRANSLOCO_TRANSPILER");let yZ=(()=>{class n{constructor(t){this.interpolationMatcher=function xZ(n){const[e,t]=n&&n.interpolation?n.interpolation:jv.interpolation;return new RegExp(`${e}(.*?)${t}`,"g")}(t)}transpile(t,r={},o,i){return dc(t)?t.replace(this.interpolationMatcher,(a,s)=>(s=s.trim(),fO(r[s])?r[s]:fO(o[s])?this.transpile(o[s],r,o,i):"")):(r&&(n_(t)?t=this.handleObject(t,r,o,i):Array.isArray(t)&&(t=this.handleArray(t,r,o,i))),t)}handleObject(t,r={},o,i){let a=t;return Object.keys(r).forEach(s=>{const u=sO(a,s),c=sO(r,s),l=this.transpile(u,c,o,i);a=function fZ(n,e,t){n={...n};const r=e.split("."),o=r.length-1;return r.reduce((i,a,s)=>(i[a]=s===o?t:Array.isArray(i[a])?i[a].slice():{...i[a]},i&&i[a]),n),n}(a,s,l)}),a}handleArray(t,r={},o,i){return t.map(a=>this.transpile(a,r,o,i))}}return n.\u0275fac=function(t){return new(t||n)(me(lf,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const gO=new ge("TRANSLOCO_MISSING_HANDLER");let wZ=(()=>{class n{handle(t,r){return r.missingHandler.logMissingKey&&!r.prodMode&&console.warn(`%c Missing translation for '${t}'`,"font-size: 12px; color: red"),t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const vO=new ge("TRANSLOCO_INTERCEPTOR");let _Z=(()=>{class n{preSaveTranslation(t){return t}preSaveTranslationKey(t,r){return r}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const mO=new ge("TRANSLOCO_FALLBACK_STRATEGY");let a_,bZ=(()=>{class n{constructor(t){this.userConfig=t}getNextLangs(){const t=this.userConfig.fallbackLang;if(!t)throw new Error("When using the default fallback, a fallback language must be provided in the config!");return Array.isArray(t)?t:[t]}}return n.\u0275fac=function(t){return new(t||n)(me(lf))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();function xh(n){if(!n)return"";const e=n.split("/");return e.pop(),e.join("/")}function cu(n){return n?n.split("/").pop():""}function o_(n,e,t="|"){if(dc(n)){const r=n.split(t),o=r.pop();return o===e?[!0,r.toString()]:[!1,o]}return[!1,""]}function yO(n,e){return function gZ(n){return n&&n_(n.loader)}(n)?function AZ(n,e){return Object.keys(n).reduce((t,r)=>(t[`${e}/${r}`]=n[r],t),{})}(n.loader,e):void 0}function i_(n){return{scope:xh(n)||null,langName:cu(n)}}function xO(n){const{path:e,inlineLoader:t,mainLoader:r,data:o}=n;if(t){if(!1===function hZ(n){return"function"==typeof n}(t[e]))throw`You're using an inline loader but didn't provide a loader for ${e}`;return t[e]().then(a=>a.default?a.default:a)}return r.getTranslation(e,o)}let s_=(()=>{class n{constructor(t,r,o,i,a,s){this.loader=t,this.parser=r,this.missingHandler=o,this.interceptor=i,this.userConfig=a,this.fallbackStrategy=s,this.subscription=null,this.translations=new Map,this.cache=new Map,this.defaultLang="",this.availableLangs=[],this.isResolvedMissingOnce=!1,this.failedLangs=new Set,this.events=new Li,this.events$=this.events.asObservable(),this.loader||(this.loader=new lZ(this.translations)),a_=this,this.mergedConfig=function CZ(n,e){return{...n,...e,missingHandler:{...n.missingHandler,...e.missingHandler},flatten:{...n.flatten,...e.flatten}}}(jv,this.userConfig),this.setAvailableLangs(this.mergedConfig.availableLangs||[]),this.setFallbackLangForMissingTranslation(this.mergedConfig),this.setDefaultLang(this.mergedConfig.defaultLang),this.lang=new Qo(this.getDefaultLang()),this.langChanges$=this.lang.asObservable(),this.subscription=this.events$.subscribe(u=>{"translationLoadSuccess"===u.type&&u.wasFailure&&this.setActiveLang(u.payload.langName)})}get config(){return this.mergedConfig}getDefaultLang(){return this.defaultLang}setDefaultLang(t){this.defaultLang=t}getActiveLang(){return this.lang.getValue()}setActiveLang(t){return this.lang.next(t),this.parser.onLangChanged?.(t),this.events.next({type:"langChanged",payload:i_(t)}),this}setAvailableLangs(t){this.availableLangs=t}getAvailableLangs(){return this.availableLangs}load(t,r={}){const o=this.cache.get(t);if(o)return o;let i;const a=this._isLangScoped(t);let s;a&&(s=xh(t));const u={path:t,mainLoader:this.loader,inlineLoader:r.inlineLoader,data:a?{scope:s}:void 0};if(this.useFallbackTranslation(t)){const l=a?`${s}/${this.firstFallbackLang}`:this.firstFallbackLang,f=function IZ({mainLoader:n,path:e,data:t,fallbackPath:r,inlineLoader:o}){return(r?[e,r]:[e]).map(a=>Dn(xO({path:a,mainLoader:n,inlineLoader:o,data:t})).pipe($e(u=>({translation:u,lang:a}))))}({...u,fallbackPath:l});i=e_(f)}else i=Dn(xO(u));const c=i.pipe(function sZ(n=1/0){let e;e=n&&"object"==typeof n?n:{count:n};const{count:t=1/0,delay:r,resetOnSuccess:o=!1}=e;return t<=0?Ks:rr((i,a)=>{let u,s=0;const c=()=>{let l=!1;u=i.subscribe(Fn(a,f=>{o&&(s=0),a.next(f)},void 0,f=>{if(s++<t){const d=()=>{u?(u.unsubscribe(),u=null,c()):l=!0};if(null!=r){const h="number"==typeof r?function aZ(n=0,e,t=oZ){let r=-1;return null!=e&&(VE(e)?t=e:r=e),new In(o=>{let i=function iZ(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;i<0&&(i=0);let a=0;return t.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}(r):Go(r(f,s)),p=Fn(a,()=>{p.unsubscribe(),d()},()=>{a.complete()});h.subscribe(p)}else d()}else a.error(f)})),l&&(u.unsubscribe(),u=null,c())};c()})}(this.config.failedRetries),Dr(l=>{Array.isArray(l)?l.forEach(f=>{this.handleSuccess(f.lang,f.translation),f.lang!==t&&this.cache.set(f.lang,Le({}))}):this.handleSuccess(t,l)}),bs(l=>(this.mergedConfig.prodMode||console.error(`Error while trying to load "${t}"`,l),this.handleFailure(t,r))),function cZ(n,e,t){let r,o=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:o=!1,scheduler:t}=n):r=n??1/0,zE({connector:()=>new uZ(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}(1));return this.cache.set(t,c),c}translate(t,r={},o=this.getActiveLang()){if(!t)return t;const{scope:i,resolveLang:a}=this.resolveLangAndScope(o);if(Array.isArray(t))return t.map(c=>this.translate(i?`${i}.${c}`:c,r,a));t=i?`${i}.${t}`:t;const s=this.getTranslation(a),u=s[t];return u?this.parser.transpile(u,r,s,t):this._handleMissingKey(t,u,r)}selectTranslate(t,r,o,i=!1){let a;const s=(c,l)=>this.load(c,l).pipe($e(()=>i?this.translateObject(t,r,c):this.translate(t,r,c)));if(r_(o))return this.langChanges$.pipe(Do(c=>s(c)));if(dO(o)){const c=o;o=c.scope,a=yO(c,c.scope)}if(this.isLang(o)||this.isScopeWithLang(o))return s(o);const u=o;return this.langChanges$.pipe(Do(c=>s(`${u}/${c}`,{inlineLoader:a})))}isScopeWithLang(t){return this.isLang(cu(t))}translateObject(t,r={},o=this.getActiveLang()){if(dc(t)||Array.isArray(t)){const{resolveLang:a,scope:s}=this.resolveLangAndScope(o);if(Array.isArray(t))return t.map(l=>this.translateObject(s?`${s}.${l}`:l,r,a));const u=this.getTranslation(a),c=function vZ(n){return(0,iO.unflatten)(n)}(this.getObjectByKey(u,t=s?`${s}.${t}`:t));return function dZ(n){return 0===uO(n)}(c)?this.translate(t,r,o):this.parser.transpile(c,r,u,t)}const i=[];for(const[a,s]of this.getEntries(t))i.push(this.translateObject(a,s,o));return i}selectTranslateObject(t,r,o){if(dc(t)||Array.isArray(t))return this.selectTranslate(t,r,o,!0);const[[i,a],...s]=this.getEntries(t);return this.selectTranslateObject(i,a,o).pipe($e(u=>{const c=[u];for(const[l,f]of s)c.push(this.translateObject(l,f,o));return c}))}getTranslation(t){if(t){if(this.isLang(t))return this.translations.get(t)||{};{const{scope:r,resolveLang:o}=this.resolveLangAndScope(t),i=this.translations.get(o)||{};return this.getObjectByKey(i,r)}}return this.translations}selectTranslation(t){let r=this.langChanges$;if(t){const o=cu(t)!==t;r=this.isLang(t)||o?Le(t):this.langChanges$.pipe($e(i=>`${t}/${i}`))}return r.pipe(Do(o=>this.load(o).pipe($e(()=>this.getTranslation(o)))))}setTranslation(t,r=this.getActiveLang(),o={}){const a={merge:!0,emitChange:!0,...o},s=xh(r);let u=t;s&&(u=hO({[this.getMappedScope(s)]:t}));const c=s?cu(r):r,l={...a.merge&&this.getTranslation(c),...u},f=this.mergedConfig.flatten.aot?l:hO(l),d=this.interceptor.preSaveTranslation(f,c);this.translations.set(c,d),a.emitChange&&this.setActiveLang(this.getActiveLang())}setTranslationKey(t,r,o=this.getActiveLang(),i={}){const a=this.interceptor.preSaveTranslationKey(t,r,o);this.setTranslation({[t]:a},o,{...i,merge:!0})}setFallbackLangForMissingTranslation({fallbackLang:t}){const r=Array.isArray(t)?t[0]:t;t&&this.useFallbackTranslation(r)&&(this.firstFallbackLang=r)}_handleMissingKey(t,r,o){if(this.config.missingHandler.allowEmpty&&""===r)return"";if(!this.isResolvedMissingOnce&&this.useFallbackTranslation()){this.isResolvedMissingOnce=!0;const i=this.translate(t,o,this.firstFallbackLang);return this.isResolvedMissingOnce=!1,i}return this.missingHandler.handle(t,this.getMissingHandlerData(),o)}_isLangScoped(t){return-1===this.getAvailableLangsIds().indexOf(t)}isLang(t){return-1!==this.getAvailableLangsIds().indexOf(t)}_loadDependencies(t,r){const o=cu(t);return this._isLangScoped(t)&&!this.isLoadedTranslation(o)?ww(this.load(o),this.load(t,{inlineLoader:r})):this.load(t,{inlineLoader:r})}_completeScopeWithLang(t){return this._isLangScoped(t)&&!this.isLang(cu(t))?`${t}/${this.getActiveLang()}`:t}_setScopeAlias(t,r){this.mergedConfig.scopeMapping||(this.mergedConfig.scopeMapping={}),this.mergedConfig.scopeMapping[t]=r}ngOnDestroy(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.cache.clear()}isLoadedTranslation(t){return uO(this.getTranslation(t))}getAvailableLangsIds(){return dc(this.getAvailableLangs()[0])?this.getAvailableLangs():this.getAvailableLangs().map(r=>r.id)}getMissingHandlerData(){return{...this.config,activeLang:this.getActiveLang(),availableLangs:this.availableLangs,defaultLang:this.defaultLang}}useFallbackTranslation(t){return this.config.missingHandler.useFallbackTranslation&&t!==this.firstFallbackLang}handleSuccess(t,r){this.setTranslation(r,t,{emitChange:!1}),this.events.next({wasFailure:!!this.failedLangs.size,type:"translationLoadSuccess",payload:i_(t)}),this.failedLangs.forEach(o=>this.cache.delete(o)),this.failedLangs.clear()}handleFailure(t,r){r_(r.failedCounter)&&(r.failedCounter=0,r.fallbackLangs||(r.fallbackLangs=this.fallbackStrategy.getNextLangs(t)));const o=t.split("/"),a=r.fallbackLangs[r.failedCounter];if(this.failedLangs.add(t),this.cache.has(a))return this.handleSuccess(a,this.getTranslation(a)),Bi;if(!a||a===o[o.length-1]){let c="Unable to load translation and all the fallback languages";throw o.length>1&&(c+=", did you misspelled the scope name?"),new Error(c)}let u=a;return o.length>1&&(o[o.length-1]=a,u=o.join("/")),r.failedCounter++,this.events.next({type:"translationLoadFailure",payload:i_(t)}),this.load(u,r)}getMappedScope(t){const{scopeMapping:r={}}=this.config;return r[t]||cO(t)}resolveLangAndScope(t){let o,r=t;if(this._isLangScoped(t)){const i=cu(t),a=this.isLang(i);r=a?i:this.getActiveLang(),o=this.getMappedScope(a?xh(t):t)}return{scope:o,resolveLang:r}}getObjectByKey(t,r){const o={},i=`${r}.`;for(const a in t)a.startsWith(i)&&(o[a.replace(i,"")]=t[a]);return o}getEntries(t){return t instanceof Map?t.entries():Object.entries(t)}}return n.\u0275fac=function(t){return new(t||n)(me(aO,8),me(pO),me(gO),me(vO),me(lf),me(mO))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),DZ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Vi({type:n,selectors:[["ng-component"]],inputs:{html:"html"},decls:1,vars:1,consts:[[1,"transloco-loader-template",3,"innerHTML"]],template:function(t,r){1&t&&sn(0,"div",0),2&t&&At("innerHTML",r.html,wy)},encapsulation:2}),n})();class TZ{constructor(e,t){this.view=e,this.vcr=t,this.injector=this.vcr.injector}attachView(){if(this.view instanceof $i)this.vcr.createEmbeddedView(this.view);else if(dc(this.view)){const e=this.createComponent(DZ);e.instance.html=this.view,e.hostView.detectChanges()}else this.createComponent(this.view)}detachView(){this.vcr.clear()}createComponent(e){const r=this.injector.get(Il).resolveComponentFactory(e);return this.vcr.createComponent(r)}}const RZ=new ge("TRANSLOCO_LANG"),NZ=new ge("TRANSLOCO_LOADING_TEMPLATE"),OZ=new ge("TRANSLOCO_SCOPE");class MZ{constructor(){this.initialized=!1}resolve({inline:e,provider:t,active:r}){let o=r;if(this.initialized)return o=r,o;if(t){const[,i]=o_(t,"static");o=i}if(e){const[,i]=o_(e,"static");o=i}return this.initialized=!0,o}resolveLangBasedOnScope(e){return xh(e)?cu(e):e}resolveLangPath(e,t){return t?`${t}/${e}`:e}}class PZ{constructor(e){this.translocoService=e}resolve({inline:e,provider:t}={inline:void 0,provider:void 0}){if(e)return e;if(t){if(dO(t)){const{scope:r,alias:o=cO(r)}=t;return this.translocoService._setScopeAlias(r,o),r}return t}}}let $v=(()=>{class n{constructor(t,r,o,i,a,s,u,c,l){this.translocoService=t,this.tpl=r,this.providerScope=o,this.providerLang=i,this.providedLoadingTpl=a,this.vcr=s,this.cdr=u,this.host=c,this.renderer=l,this.subscription=null,this.translationMemo={},this.params={},this.initialized=!1,this.langResolver=new MZ,this.scopeResolver=new PZ(this.translocoService),this.strategy=null===this.tpl?"attribute":"structural"}static ngTemplateContextGuard(t,r){return!0}ngOnInit(){const t=function EZ(n,e){const[t]=o_(e,"static");return!t&&!!n.config.reRenderOnLangChange}(this.translocoService,this.providerLang||this.inlineLang);this.subscription=this.translocoService.langChanges$.pipe(Do(o=>{const i=this.langResolver.resolve({inline:this.inlineLang,provider:this.providerLang,active:o});return Array.isArray(this.providerScope)?e_(this.providerScope.map(a=>this.resolveScope(i,a))):this.resolveScope(i,this.providerScope)}),function SZ(n){return n?e=>e:Ql(1)}(t)).subscribe(()=>{this.currentLang=this.langResolver.resolveLangBasedOnScope(this.path),"attribute"===this.strategy?this.attributeStrategy():this.structuralStrategy(this.currentLang,this.inlineRead),this.cdr.markForCheck(),this.initialized=!0});const r=this.getLoadingTpl();!this.initialized&&r&&(this.loaderTplHandler=new TZ(r,this.vcr),this.loaderTplHandler.attachView())}ngOnChanges(t){"attribute"===this.strategy&&Object.keys(t).some(o=>!t[o].firstChange)&&this.attributeStrategy()}attributeStrategy(){this.detachLoader(),this.renderer.setProperty(this.host.nativeElement,"innerText",this.translocoService.translate(this.key,this.params,this.currentLang))}structuralStrategy(t,r){this.translationMemo={},this.view?(this.view.context.$implicit=this.getTranslateFn(t,r),this.view.context.currentLang=this.currentLang):(this.detachLoader(),this.view=this.vcr.createEmbeddedView(this.tpl,{$implicit:this.getTranslateFn(t,r),currentLang:this.currentLang}))}getTranslateFn(t,r){return(o,i)=>{const a=r?`${r}.${o}`:o,s=i?`${a}${JSON.stringify(i)}`:a;return Object.prototype.hasOwnProperty.call(this.translationMemo,s)||(this.translationMemo[s]={params:i,value:this.translocoService.translate(a,i,t)}),this.translationMemo[s].value}}getLoadingTpl(){return this.inlineTpl||this.providedLoadingTpl}ngOnDestroy(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}detachLoader(){this.loaderTplHandler?.detachView()}resolveScope(t,r){const o=this.scopeResolver.resolve({inline:this.inlineScope,provider:r});this.path=this.langResolver.resolveLangPath(t,o);const i=yO(r,o);return this.translocoService._loadDependencies(this.path,i)}}return n.\u0275fac=function(t){return new(t||n)(Q(s_),Q($i,8),Q(OZ,8),Q(RZ,8),Q(NZ,8),Q(wi),Q(jd),Q(ao),Q(Ea))},n.\u0275dir=je({type:n,selectors:[["","transloco",""]],inputs:{key:["transloco","key"],params:["translocoParams","params"],inlineScope:["translocoScope","inlineScope"],inlineRead:["translocoRead","inlineRead"],inlineLang:["translocoLang","inlineLang"],inlineTpl:["translocoLoadingTpl","inlineTpl"]},features:[qo]}),n})();const kZ=[{provide:pO,useClass:yZ,deps:[lf]},{provide:gO,useClass:wZ},{provide:vO,useClass:_Z},{provide:mO,useClass:bZ,deps:[lf]}];let wO=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({providers:[kZ]}),n})();new ge("TRANSLOCO_TEST_LANGS - Available testing languages"),new ge("TRANSLOCO_TEST_OPTIONS - Testing options");let _O=(()=>{class n{constructor(){this.getDeviceFromLocalStorage(),this.getCameraFromLocalStorage()}getDeviceFromLocalStorage(){let t=parseInt(localStorage.getItem("deviceId")||"-1");this.deviceId=-1==t?null:t}getCameraFromLocalStorage(){this.cameraDefault=localStorage.getItem("cameraDefault")??""}setDevice(t){this.deviceId=t,localStorage.setItem("deviceId",t?t.toString():"")}setCamera(t){this.cameraDefault=t,localStorage.setItem("cameraDefault",t)}getDevice(){return this.deviceId}getCameraKey(){return localStorage.getItem("cameraDefault")??""}reset(){localStorage.removeItem("deviceId"),localStorage.removeItem("cameraDefault")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),LZ=(()=>{class n{constructor(t){this.httpclient=t}getDetail(t){return this.httpclient.get("../services/device/getOne.php?id="+t).pipe($e(r=>r.device)).pipe($e(r=>this.mappingFromJson(r)))}mappingFromJson(t){let r;return r={id:t.id,name:t.name,hasDependency:"1"==t.hasDependency,hasPlate:"1"==t.hasPlate,dependencyId:t.dependencyId,maxMinutes:t.maxMinutes,created:t.created,updated:t.updated},r}}return n.\u0275fac=function(t){return new(t||n)(me(wv))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),bO=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(Q(Ea),Q(ao))},n.\u0275dir=je({type:n}),n})(),hc=(()=>{class n extends bO{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Ir(n)))(r||n)}}(),n.\u0275dir=je({type:n,features:[Jt]}),n})();const Fa=new ge("NgValueAccessor"),VZ={provide:Fa,useExisting:an(()=>qv),multi:!0},HZ=new ge("CompositionEventMode");let qv=(()=>{class n extends bO{constructor(t,r,o){super(t,r),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function UZ(){const n=ys()?ys().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(Q(Ea),Q(ao),Q(HZ,8))},n.\u0275dir=je({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,r){1&t&&de("input",function(i){return r._handleInput(i.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(i){return r._compositionEnd(i.target.value)})},features:[xn([VZ]),Jt]}),n})();const WZ=!1,$r=new ge("NgValidators"),fu=new ge("NgAsyncValidators");function MO(n){return null!=n}function PO(n){const e=Md(n)?Dn(n):n;if(WZ&&!Zy(e)){let t="Expected async validator to return Promise or Observable.";throw"object"==typeof n&&(t+=" Are you using a synchronous validator where an async validator is expected?"),new ie(-1101,t)}return e}function kO(n){let e={};return n.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function FO(n,e){return e.map(t=>t(n))}function LO(n){return n.map(e=>function zZ(n){return!n.validate}(e)?e:t=>e.validate(t))}function u_(n){return null!=n?function BO(n){if(!n)return null;const e=n.filter(MO);return 0==e.length?null:function(t){return kO(FO(t,e))}}(LO(n)):null}function c_(n){return null!=n?function VO(n){if(!n)return null;const e=n.filter(MO);return 0==e.length?null:function(t){return e_(FO(t,e).map(PO)).pipe($e(kO))}}(LO(n)):null}function UO(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function HO(n){return n._rawValidators}function WO(n){return n._rawAsyncValidators}function l_(n){return n?Array.isArray(n)?n:[n]:[]}function Kv(n,e){return Array.isArray(n)?n.includes(e):n===e}function GO(n,e){const t=l_(e);return l_(n).forEach(o=>{Kv(t,o)||t.push(o)}),t}function zO(n,e){return l_(e).filter(t=>!Kv(n,t))}class jO{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=u_(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=c_(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class du extends jO{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class $O{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let qO=(()=>{class n extends $O{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Q(du,2))},n.\u0275dir=je({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,r){2&t&&Lg("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Jt]}),n})();function XO(n,e){return n?`with name: '${e}'`:`at index: ${e}`}const h_=!1,wh="VALID",Zv="INVALID",ff="PENDING",_h="DISABLED";function p_(n){return(Qv(n)?n.validators:n)||null}function g_(n,e){return(Qv(e)?e.asyncValidators:n)||null}function Qv(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}function KO(n,e,t){const r=n.controls;if(!(e?Object.keys(r):r).length)throw new ie(1e3,h_?function KZ(n){return`\n    There are no form controls registered with this ${n?"group":"array"} yet. If you're using ngModel,\n    you may want to check next tick (e.g. use setTimeout).\n  `}(e):"");if(!r[t])throw new ie(1001,h_?function YZ(n,e){return`Cannot find form control ${XO(n,e)}`}(e,t):"")}function YO(n,e,t){n._forEachChild((r,o)=>{if(void 0===t[o])throw new ie(1002,h_?function ZZ(n,e){return`Must supply a value for form control ${XO(n,e)}`}(e,o):"")})}class Jv{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===wh}get invalid(){return this.status===Zv}get pending(){return this.status==ff}get disabled(){return this.status===_h}get enabled(){return this.status!==_h}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(GO(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(GO(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(zO(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(zO(e,this._rawAsyncValidators))}hasValidator(e){return Kv(this._rawValidators,e)}hasAsyncValidator(e){return Kv(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ff,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=_h,this.errors=null,this._forEachChild(r=>{r.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=wh,this._forEachChild(r=>{r.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===wh||this.status===ff)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?_h:wh}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ff,this._hasOwnPendingAsyncValidator=!0;const t=PO(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,o)=>r&&r._find(o),this)}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new bt,this.statusChanges=new bt}_calculateStatus(){return this._allControlsDisabled()?_h:this.errors?Zv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ff)?ff:this._anyControlsHaveStatus(Zv)?Zv:wh}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Qv(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function QZ(n){return Array.isArray(n)?u_(n):n||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function JZ(n){return Array.isArray(n)?c_(n):n||null}(this._rawAsyncValidators)}}class bh extends Jv{constructor(e,t,r){super(p_(t),g_(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){YO(this,!0,e),Object.keys(e).forEach(r=>{KO(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{const o=this.controls[r];o&&o.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,o)=>{r.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,o)=>((r.enabled||this.disabled)&&(t[o]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((o,i)=>{r=t(r,o,i)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}class ZO extends bh{}const pc=new ge("CallSetDisabledState",{providedIn:"root",factory:()=>Ch}),Ch="always";function Eh(n,e,t=Ch){(function v_(n,e){const t=HO(n);null!==e.validator?n.setValidators(UO(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const r=WO(n);null!==e.asyncValidator?n.setAsyncValidators(UO(r,e.asyncValidator)):"function"==typeof r&&n.setAsyncValidators([r]);const o=()=>n.updateValueAndValidity();n0(e._rawValidators,o),n0(e._rawAsyncValidators,o)})(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||"always"===t)&&e.valueAccessor.setDisabledState?.(n.disabled),function tQ(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&QO(n,e)})}(n,e),function rQ(n,e){const t=(r,o)=>{e.valueAccessor.writeValue(r),o&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function nQ(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&QO(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function eQ(n,e){if(e.valueAccessor.setDisabledState){const t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function t0(n,e,t=!0){const r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),function r0(n,e){let t=!1;if(null!==n){if(null!==e.validator){const o=HO(n);if(Array.isArray(o)&&o.length>0){const i=o.filter(a=>a!==e.validator);i.length!==o.length&&(t=!0,n.setValidators(i))}}if(null!==e.asyncValidator){const o=WO(n);if(Array.isArray(o)&&o.length>0){const i=o.filter(a=>a!==e.asyncValidator);i.length!==o.length&&(t=!0,n.setAsyncValidators(i))}}}const r=()=>{};return n0(e._rawValidators,r),n0(e._rawAsyncValidators,r),t}(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function n0(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function QO(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function tM(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}function nM(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const gc=class extends Jv{constructor(e=null,t,r){super(p_(t),g_(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Qv(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=nM(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){tM(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){tM(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){nM(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};let uM=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({}),n})();const __=new ge("NgModelWithFormControlWarning"),mQ={provide:du,useExisting:an(()=>b_)};let b_=(()=>{class n extends du{set isDisabled(t){}constructor(t,r,o,i,a){super(),this._ngModelWarningConfig=i,this.callSetDisabledState=a,this.update=new bt,this._ngModelWarningSent=!1,this._setValidators(t),this._setAsyncValidators(r),this.valueAccessor=function x_(n,e){if(!e)return null;let t,r,o;return Array.isArray(e),e.forEach(i=>{i.constructor===qv?t=i:function aQ(n){return Object.getPrototypeOf(n.constructor)===hc}(i)?r=i:o=i}),o||r||t||null}(0,o)}ngOnChanges(t){if(this._isControlChanged(t)){const r=t.form.previousValue;r&&t0(r,this,!1),Eh(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}(function y_(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)})(t,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&t0(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_isControlChanged(t){return t.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(t){return new(t||n)(Q($r,10),Q(fu,10),Q(Fa,10),Q(__,8),Q(pc,8))},n.\u0275dir=je({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[xn([mQ]),Jt,qo]}),n})();const bQ={provide:Fa,useExisting:an(()=>o0),multi:!0};function hM(n,e){return null==n?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let o0=(()=>{class n extends hc{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const o=hM(this._getOptionId(t),t);this.setProperty("value",o)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function CQ(n){return n.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Ir(n)))(r||n)}}(),n.\u0275dir=je({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,r){1&t&&de("change",function(i){return r.onChange(i.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[xn([bQ]),Jt]}),n})(),pM=(()=>{class n{constructor(t,r,o){this._element=t,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(hM(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(Q(ao),Q(Ea),Q(o0,9))},n.\u0275dir=je({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})();const EQ={provide:Fa,useExisting:an(()=>A_),multi:!0};function gM(n,e){return null==n?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let A_=(()=>{class n extends hc{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const o=t.map(i=>this._getOptionId(i));r=(i,a)=>{i._setSelected(o.indexOf(a.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const o=[],i=r.selectedOptions;if(void 0!==i){const a=i;for(let s=0;s<a.length;s++){const c=this._getOptionValue(a[s].value);o.push(c)}}else{const a=r.options;for(let s=0;s<a.length;s++){const u=a[s];if(u.selected){const c=this._getOptionValue(u.value);o.push(c)}}}this.value=o,t(o)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function SQ(n){return n.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Ir(n)))(r||n)}}(),n.\u0275dir=je({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,r){1&t&&de("change",function(i){return r.onChange(i.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[xn([EQ]),Jt]}),n})(),vM=(()=>{class n{constructor(t,r,o){this._element=t,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(gM(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(gM(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(Q(ao),Q(Ea),Q(A_,9))},n.\u0275dir=je({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})(),AM=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({imports:[uM]}),n})();class IM extends Jv{constructor(e,t,r){super(p_(t),g_(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let o=this._adjustIndex(e);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),t&&(this.controls.splice(o,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){YO(this,!1,e),e.forEach((r,o)=>{KO(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,o)=>{r.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}}function DM(n){return!!n&&(void 0!==n.asyncValidators||void 0!==n.validators||void 0!==n.updateOn)}let PQ=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new n;return t.useNonNullable=!0,t}group(t,r=null){const o=this._reduceControls(t);let i={};return DM(r)?i=r:null!==r&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new bh(o,i)}record(t,r=null){const o=this._reduceControls(t);return new ZO(o,r)}control(t,r,o){let i={};return this.useNonNullable?(DM(r)?i=r:(i.validators=r,i.asyncValidators=o),new gc(t,{...i,nonNullable:!0})):new gc(t,r,o)}array(t,r,o){const i=t.map(a=>this._createControl(a));return new IM(i,r,o)}_reduceControls(t){const r={};return Object.keys(t).forEach(o=>{r[o]=this._createControl(t[o])}),r}_createControl(t){return t instanceof gc||t instanceof Jv?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),kQ=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:pc,useValue:t.callSetDisabledState??Ch}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({imports:[AM]}),n})(),FQ=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:__,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:pc,useValue:t.callSetDisabledState??Ch}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({imports:[AM]}),n})();var LQ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),BQ=function(n){function e(t){void 0===t&&(t=void 0);var r=n.call(this,t)||this;return r.message=t,r}return LQ(e,n),e.prototype.getKind=function(){return this.constructor.kind},e.kind="Exception",e}(rO);const To=BQ;var VQ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),UQ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return VQ(e,n),e.kind="ArgumentException",e}(To);const Wn=UQ;var HQ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),WQ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return HQ(e,n),e.kind="IllegalArgumentException",e}(To);const Ie=WQ;var GQ=function(){function n(e){if(this.binarizer=e,null===e)throw new Ie("Binarizer must be non-null.")}return n.prototype.getWidth=function(){return this.binarizer.getWidth()},n.prototype.getHeight=function(){return this.binarizer.getHeight()},n.prototype.getBlackRow=function(e,t){return this.binarizer.getBlackRow(e,t)},n.prototype.getBlackMatrix=function(){return null==this.matrix&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix},n.prototype.isCropSupported=function(){return this.binarizer.getLuminanceSource().isCropSupported()},n.prototype.crop=function(e,t,r,o){var i=this.binarizer.getLuminanceSource().crop(e,t,r,o);return new n(this.binarizer.createBinarizer(i))},n.prototype.isRotateSupported=function(){return this.binarizer.getLuminanceSource().isRotateSupported()},n.prototype.rotateCounterClockwise=function(){var e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new n(this.binarizer.createBinarizer(e))},n.prototype.rotateCounterClockwise45=function(){var e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new n(this.binarizer.createBinarizer(e))},n.prototype.toString=function(){try{return this.getBlackMatrix().toString()}catch{return""}},n}();const TM=GQ;var zQ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),jQ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return zQ(e,n),e.getChecksumInstance=function(){return new e},e.kind="ChecksumException",e}(To);const Gn=jQ;var $Q=function(){function n(e){this.source=e}return n.prototype.getLuminanceSource=function(){return this.source},n.prototype.getWidth=function(){return this.source.getWidth()},n.prototype.getHeight=function(){return this.source.getHeight()},n}();const qQ=$Q;var XQ=function(){function n(){}return n.arraycopy=function(e,t,r,o,i){for(;i--;)r[o++]=e[t++]},n.currentTimeMillis=function(){return Date.now()},n}();const cn=XQ;var KQ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),YQ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return KQ(e,n),e.kind="IndexOutOfBoundsException",e}(To);const D_=YQ;var ZQ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),QQ=function(n){function e(t,r){void 0===t&&(t=void 0),void 0===r&&(r=void 0);var o=n.call(this,r)||this;return o.index=t,o.message=r,o}return ZQ(e,n),e.kind="ArrayIndexOutOfBoundsException",e}(D_);const RM=QQ;var eJ=function(){function n(){}return n.fill=function(e,t){for(var r=0,o=e.length;r<o;r++)e[r]=t},n.fillWithin=function(e,t,r,o){n.rangeCheck(e.length,t,r);for(var i=t;i<r;i++)e[i]=o},n.rangeCheck=function(e,t,r){if(t>r)throw new Ie("fromIndex("+t+") > toIndex("+r+")");if(t<0)throw new RM(t);if(r>e)throw new RM(r)},n.asList=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},n.create=function(e,t,r){return Array.from({length:e}).map(function(i){return Array.from({length:t}).fill(r)})},n.createInt32Array=function(e,t,r){return Array.from({length:e}).map(function(i){return Int32Array.from({length:t}).fill(r)})},n.equals=function(e,t){if(!(e&&t&&e.length&&t.length&&e.length===t.length))return!1;for(var r=0,o=e.length;r<o;r++)if(e[r]!==t[r])return!1;return!0},n.hashCode=function(e){var t,r;if(null===e)return 0;var o=1;try{for(var i=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),a=i.next();!a.done;a=i.next())o=31*o+a.value}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return o},n.fillUint8Array=function(e,t){for(var r=0;r!==e.length;r++)e[r]=t},n.copyOf=function(e,t){return e.slice(0,t)},n.copyOfUint8Array=function(e,t){if(e.length<=t){var r=new Uint8Array(t);return r.set(e),r}return e.slice(0,t)},n.copyOfRange=function(e,t,r){var o=r-t,i=new Int32Array(o);return cn.arraycopy(e,t,i,0,o),i},n.binarySearch=function(e,t,r){void 0===r&&(r=n.numberComparator);for(var o=0,i=e.length-1;o<=i;){var a=i+o>>1,s=r(t,e[a]);if(s>0)o=a+1;else{if(!(s<0))return a;i=a-1}}return-o-1},n.numberComparator=function(e,t){return e-t},n}();const Yn=eJ;var tJ=function(){function n(){}return n.numberOfTrailingZeros=function(e){var t;if(0===e)return 32;var r=31;return 0!=(t=e<<16)&&(r-=16,e=t),0!=(t=e<<8)&&(r-=8,e=t),0!=(t=e<<4)&&(r-=4,e=t),0!=(t=e<<2)&&(r-=2,e=t),r-(e<<1>>>31)},n.numberOfLeadingZeros=function(e){if(0===e)return 32;var t=1;return e>>>16||(t+=16,e<<=16),e>>>24||(t+=8,e<<=8),e>>>28||(t+=4,e<<=4),e>>>30||(t+=2,e<<=2),t-(e>>>31)},n.toHexString=function(e){return e.toString(16)},n.toBinaryString=function(e){return String(parseInt(String(e),2))},n.bitCount=function(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,63&(e+=e>>>8)+(e>>>16)},n.truncDivision=function(e,t){return Math.trunc(e/t)},n.parseInt=function(e,t){return void 0===t&&(t=void 0),parseInt(e,t)},n.MIN_VALUE_32_BITS=-2147483648,n.MAX_VALUE=Number.MAX_SAFE_INTEGER,n}();const ut=tJ;var nJ=function(){function n(e,t){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,this.bits=null==t?n.makeArray(e):t)}return n.prototype.getSize=function(){return this.size},n.prototype.getSizeInBytes=function(){return Math.floor((this.size+7)/8)},n.prototype.ensureCapacity=function(e){if(e>32*this.bits.length){var t=n.makeArray(e);cn.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}},n.prototype.get=function(e){return 0!=(this.bits[Math.floor(e/32)]&1<<(31&e))},n.prototype.set=function(e){this.bits[Math.floor(e/32)]|=1<<(31&e)},n.prototype.flip=function(e){this.bits[Math.floor(e/32)]^=1<<(31&e)},n.prototype.getNextSet=function(e){var t=this.size;if(e>=t)return t;var r=this.bits,o=Math.floor(e/32),i=r[o];i&=~((1<<(31&e))-1);for(var a=r.length;0===i;){if(++o===a)return t;i=r[o]}var s=32*o+ut.numberOfTrailingZeros(i);return s>t?t:s},n.prototype.getNextUnset=function(e){var t=this.size;if(e>=t)return t;var r=this.bits,o=Math.floor(e/32),i=~r[o];i&=~((1<<(31&e))-1);for(var a=r.length;0===i;){if(++o===a)return t;i=~r[o]}var s=32*o+ut.numberOfTrailingZeros(i);return s>t?t:s},n.prototype.setBulk=function(e,t){this.bits[Math.floor(e/32)]=t},n.prototype.setRange=function(e,t){if(t<e||e<0||t>this.size)throw new Ie;if(t!==e){t--;for(var r=Math.floor(e/32),o=Math.floor(t/32),i=this.bits,a=r;a<=o;a++)i[a]|=(2<<(a<o?31:31&t))-(1<<(a>r?0:31&e))}},n.prototype.clear=function(){for(var e=this.bits.length,t=this.bits,r=0;r<e;r++)t[r]=0},n.prototype.isRange=function(e,t,r){if(t<e||e<0||t>this.size)throw new Ie;if(t===e)return!0;t--;for(var o=Math.floor(e/32),i=Math.floor(t/32),a=this.bits,s=o;s<=i;s++){var l=(2<<(s<i?31:31&t))-(1<<(s>o?0:31&e))&4294967295;if((a[s]&l)!==(r?l:0))return!1}return!0},n.prototype.appendBit=function(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++},n.prototype.appendBits=function(e,t){if(t<0||t>32)throw new Ie("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(var r=t;r>0;r--)this.appendBit(1==(e>>r-1&1))},n.prototype.appendBitArray=function(e){var t=e.size;this.ensureCapacity(this.size+t);for(var r=0;r<t;r++)this.appendBit(e.get(r))},n.prototype.xor=function(e){if(this.size!==e.size)throw new Ie("Sizes don't match");for(var t=this.bits,r=0,o=t.length;r<o;r++)t[r]^=e.bits[r]},n.prototype.toBytes=function(e,t,r,o){for(var i=0;i<o;i++){for(var a=0,s=0;s<8;s++)this.get(e)&&(a|=1<<7-s),e++;t[r+i]=a}},n.prototype.getBitArray=function(){return this.bits},n.prototype.reverse=function(){for(var e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),r=t+1,o=this.bits,i=0;i<r;i++){var a=o[i];e[t-i]=a=(a=(a=(a=(a=a>>1&1431655765|(1431655765&a)<<1)>>2&858993459|(858993459&a)<<2)>>4&252645135|(252645135&a)<<4)>>8&16711935|(16711935&a)<<8)>>16&65535|(65535&a)<<16}if(this.size!==32*r){var s=32*r-this.size,u=e[0]>>>s;for(i=1;i<r;i++){var c=e[i];e[i-1]=u|=c<<32-s,u=c>>>s}e[r-1]=u}this.bits=e},n.makeArray=function(e){return new Int32Array(Math.floor((e+31)/32))},n.prototype.equals=function(e){return e instanceof n&&(this.size===e.size&&Yn.equals(this.bits,e.bits))},n.prototype.hashCode=function(){return 31*this.size+Yn.hashCode(this.bits)},n.prototype.toString=function(){for(var e="",t=0,r=this.size;t<r;t++)7&t||(e+=" "),e+=this.get(t)?"X":".";return e},n.prototype.clone=function(){return new n(this.size,this.bits.slice())},n.prototype.toArray=function(){for(var e=[],t=0,r=this.size;t<r;t++)e.push(this.get(t));return e},n}();const vr=nJ;var a0=(()=>(function(n){n[n.OTHER=0]="OTHER",n[n.PURE_BARCODE=1]="PURE_BARCODE",n[n.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",n[n.TRY_HARDER=3]="TRY_HARDER",n[n.CHARACTER_SET=4]="CHARACTER_SET",n[n.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",n[n.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",n[n.ASSUME_GS1=7]="ASSUME_GS1",n[n.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",n[n.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",n[n.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"}(a0||(a0={})),a0))();const Kt=a0;var rJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),oJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return rJ(e,n),e.getFormatInstance=function(){return new e},e.kind="FormatException",e}(To);const le=oJ;var iJ=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Yt=(()=>(function(n){n[n.Cp437=0]="Cp437",n[n.ISO8859_1=1]="ISO8859_1",n[n.ISO8859_2=2]="ISO8859_2",n[n.ISO8859_3=3]="ISO8859_3",n[n.ISO8859_4=4]="ISO8859_4",n[n.ISO8859_5=5]="ISO8859_5",n[n.ISO8859_6=6]="ISO8859_6",n[n.ISO8859_7=7]="ISO8859_7",n[n.ISO8859_8=8]="ISO8859_8",n[n.ISO8859_9=9]="ISO8859_9",n[n.ISO8859_10=10]="ISO8859_10",n[n.ISO8859_11=11]="ISO8859_11",n[n.ISO8859_13=12]="ISO8859_13",n[n.ISO8859_14=13]="ISO8859_14",n[n.ISO8859_15=14]="ISO8859_15",n[n.ISO8859_16=15]="ISO8859_16",n[n.SJIS=16]="SJIS",n[n.Cp1250=17]="Cp1250",n[n.Cp1251=18]="Cp1251",n[n.Cp1252=19]="Cp1252",n[n.Cp1256=20]="Cp1256",n[n.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",n[n.UTF8=22]="UTF8",n[n.ASCII=23]="ASCII",n[n.Big5=24]="Big5",n[n.GB18030=25]="GB18030",n[n.EUC_KR=26]="EUC_KR"}(Yt||(Yt={})),Yt))(),aJ=function(){function n(e,t,r){for(var o,i,a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];this.valueIdentifier=e,this.name=r,this.values="number"==typeof t?Int32Array.from([t]):t,this.otherEncodingNames=a,n.VALUE_IDENTIFIER_TO_ECI.set(e,this),n.NAME_TO_ECI.set(r,this);for(var u=this.values,c=0,l=u.length;c!==l;c++)n.VALUES_TO_ECI.set(u[c],this);try{for(var d=iJ(a),h=d.next();!h.done;h=d.next())n.NAME_TO_ECI.set(h.value,this)}catch(g){o={error:g}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}}return n.prototype.getValueIdentifier=function(){return this.valueIdentifier},n.prototype.getName=function(){return this.name},n.prototype.getValue=function(){return this.values[0]},n.getCharacterSetECIByValue=function(e){if(e<0||e>=900)throw new le("incorect value");var t=n.VALUES_TO_ECI.get(e);if(void 0===t)throw new le("incorect value");return t},n.getCharacterSetECIByName=function(e){var t=n.NAME_TO_ECI.get(e);if(void 0===t)throw new le("incorect value");return t},n.prototype.equals=function(e){if(!(e instanceof n))return!1;var t=e;return this.getName()===t.getName()},n.VALUE_IDENTIFIER_TO_ECI=new Map,n.VALUES_TO_ECI=new Map,n.NAME_TO_ECI=new Map,n.Cp437=new n(Yt.Cp437,Int32Array.from([0,2]),"Cp437"),n.ISO8859_1=new n(Yt.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),n.ISO8859_2=new n(Yt.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),n.ISO8859_3=new n(Yt.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),n.ISO8859_4=new n(Yt.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),n.ISO8859_5=new n(Yt.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),n.ISO8859_6=new n(Yt.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),n.ISO8859_7=new n(Yt.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),n.ISO8859_8=new n(Yt.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),n.ISO8859_9=new n(Yt.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),n.ISO8859_10=new n(Yt.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),n.ISO8859_11=new n(Yt.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),n.ISO8859_13=new n(Yt.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),n.ISO8859_14=new n(Yt.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),n.ISO8859_15=new n(Yt.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),n.ISO8859_16=new n(Yt.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),n.SJIS=new n(Yt.SJIS,20,"SJIS","Shift_JIS"),n.Cp1250=new n(Yt.Cp1250,21,"Cp1250","windows-1250"),n.Cp1251=new n(Yt.Cp1251,22,"Cp1251","windows-1251"),n.Cp1252=new n(Yt.Cp1252,23,"Cp1252","windows-1252"),n.Cp1256=new n(Yt.Cp1256,24,"Cp1256","windows-1256"),n.UnicodeBigUnmarked=new n(Yt.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),n.UTF8=new n(Yt.UTF8,26,"UTF8","UTF-8"),n.ASCII=new n(Yt.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),n.Big5=new n(Yt.Big5,28,"Big5"),n.GB18030=new n(Yt.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),n.EUC_KR=new n(Yt.EUC_KR,30,"EUC_KR","EUC-KR"),n}();const ur=aJ;var sJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),uJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return sJ(e,n),e.kind="UnsupportedOperationException",e}(To);const s0=uJ;var cJ=function(){function n(){}return n.decode=function(e,t){var r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)},n.shouldDecodeOnFallback=function(e){return!n.isBrowser()&&"ISO-8859-1"===e},n.encode=function(e,t){var r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):typeof TextEncoder>"u"?this.encodeFallback(e):(new TextEncoder).encode(e)},n.isBrowser=function(){return typeof window<"u"&&"[object Window]"==={}.toString.call(window)},n.encodingName=function(e){return"string"==typeof e?e:e.getName()},n.encodingCharacterSet=function(e){return e instanceof ur?e:ur.getCharacterSetECIByName(e)},n.decodeFallback=function(e,t){var r=this.encodingCharacterSet(t);if(n.isDecodeFallbackSupported(r)){for(var o="",i=0,a=e.length;i<a;i++){var s=e[i].toString(16);s.length<2&&(s="0"+s),o+="%"+s}return decodeURIComponent(o)}if(r.equals(ur.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new s0("Encoding "+this.encodingName(t)+" not supported by fallback.")},n.isDecodeFallbackSupported=function(e){return e.equals(ur.UTF8)||e.equals(ur.ISO8859_1)||e.equals(ur.ASCII)},n.encodeFallback=function(e){for(var r=btoa(unescape(encodeURIComponent(e))).split(""),o=[],i=0;i<r.length;i++)o.push(r[i].charCodeAt(0));return new Uint8Array(o)},n}();const Ei=cJ;var lJ=function(){function n(){}return n.castAsNonUtf8Char=function(e,t){void 0===t&&(t=null);var r=t?t.getName():this.ISO88591;return Ei.decode(new Uint8Array([e]),r)},n.guessEncoding=function(e,t){if(null!=t&&void 0!==t.get(Kt.CHARACTER_SET))return t.get(Kt.CHARACTER_SET).toString();for(var r=e.length,o=!0,i=!0,a=!0,s=0,u=0,c=0,l=0,f=0,d=0,h=0,p=0,g=0,v=0,m=0,y=e.length>3&&239===e[0]&&187===e[1]&&191===e[2],x=0;x<r&&(o||i||a);x++){var w=255&e[x];a&&(s>0?128&w?s--:a=!1:128&w&&(64&w?(s++,32&w?(s++,16&w?(s++,8&w?a=!1:l++):c++):u++):a=!1)),o&&(w>127&&w<160?o=!1:w>159&&(w<192||215===w||247===w)&&m++),i&&(f>0?w<64||127===w||w>252?i=!1:f--:128===w||160===w||w>239?i=!1:w>160&&w<224?(d++,p=0,++h>g&&(g=h)):w>127?(f++,h=0,++p>v&&(v=p)):(h=0,p=0))}return a&&s>0&&(a=!1),i&&f>0&&(i=!1),a&&(y||u+c+l>0)?n.UTF8:i&&(n.ASSUME_SHIFT_JIS||g>=3||v>=3)?n.SHIFT_JIS:o&&i?2===g&&2===d||10*m>=r?n.SHIFT_JIS:n.ISO88591:o?n.ISO88591:i?n.SHIFT_JIS:a?n.UTF8:n.PLATFORM_DEFAULT_ENCODING},n.format=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function i(s,u,c,l,f,d){if("%%"===s)return"%";if(void 0!==t[++o]){s=l?parseInt(l.substr(1)):void 0;var p,h=f?parseInt(f.substr(1)):void 0;switch(d){case"s":p=t[o];break;case"c":p=t[o][0];break;case"f":p=parseFloat(t[o]).toFixed(s);break;case"p":p=parseFloat(t[o]).toPrecision(s);break;case"e":p=parseFloat(t[o]).toExponential(s);break;case"x":p=parseInt(t[o]).toString(h||16);break;case"d":p=parseFloat(parseInt(t[o],h||10).toPrecision(s)).toFixed(0)}p="object"==typeof p?JSON.stringify(p):(+p).toString(h);for(var g=parseInt(c),v=c&&c[0]+""=="0"?"0":" ";p.length<g;)p=void 0!==u?p+v:v+p;return p}})},n.getBytes=function(e,t){return Ei.encode(e,t)},n.getCharCode=function(e,t){return void 0===t&&(t=0),e.charCodeAt(t)},n.getCharAt=function(e){return String.fromCharCode(e)},n.SHIFT_JIS=ur.SJIS.getName(),n.GB2312="GB2312",n.ISO88591=ur.ISO8859_1.getName(),n.EUC_JP="EUC_JP",n.UTF8=ur.UTF8.getName(),n.PLATFORM_DEFAULT_ENCODING=n.UTF8,n.ASSUME_SHIFT_JIS=!1,n}();const Et=lJ;var fJ=function(){function n(e){void 0===e&&(e=""),this.value=e}return n.prototype.enableDecoding=function(e){return this.encoding=e,this},n.prototype.append=function(e){return this.value+="string"==typeof e?e.toString():this.encoding?Et.castAsNonUtf8Char(e,this.encoding):String.fromCharCode(e),this},n.prototype.appendChars=function(e,t,r){for(var o=t;t<t+r;o++)this.append(e[o]);return this},n.prototype.length=function(){return this.value.length},n.prototype.charAt=function(e){return this.value.charAt(e)},n.prototype.deleteCharAt=function(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)},n.prototype.setCharAt=function(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)},n.prototype.substring=function(e,t){return this.value.substring(e,t)},n.prototype.setLengthToZero=function(){this.value=""},n.prototype.toString=function(){return this.value},n.prototype.insert=function(e,t){this.value=this.value.substring(0,e)+t+this.value.substring(e)},n}();const ct=fJ;var dJ=function(){function n(e,t,r,o){if(this.width=e,this.height=t,this.rowSize=r,this.bits=o,null==t&&(t=e),this.height=t,e<1||t<1)throw new Ie("Both dimensions must be greater than 0");null==r&&(r=Math.floor((e+31)/32)),this.rowSize=r,null==o&&(this.bits=new Int32Array(this.rowSize*this.height))}return n.parseFromBooleanArray=function(e){for(var t=e.length,r=e[0].length,o=new n(r,t),i=0;i<t;i++)for(var a=e[i],s=0;s<r;s++)a[s]&&o.set(s,i);return o},n.parseFromString=function(e,t,r){if(null===e)throw new Ie("stringRepresentation cannot be null");for(var o=new Array(e.length),i=0,a=0,s=-1,u=0,c=0;c<e.length;)if("\n"===e.charAt(c)||"\r"===e.charAt(c)){if(i>a){if(-1===s)s=i-a;else if(i-a!==s)throw new Ie("row lengths do not match");a=i,u++}c++}else if(e.substring(c,c+t.length)===t)c+=t.length,o[i]=!0,i++;else{if(e.substring(c,c+r.length)!==r)throw new Ie("illegal character encountered: "+e.substring(c));c+=r.length,o[i]=!1,i++}if(i>a){if(-1===s)s=i-a;else if(i-a!==s)throw new Ie("row lengths do not match");u++}for(var l=new n(s,u),f=0;f<i;f++)o[f]&&l.set(Math.floor(f%s),Math.floor(f/s));return l},n.prototype.get=function(e,t){var r=t*this.rowSize+Math.floor(e/32);return 0!=(this.bits[r]>>>(31&e)&1)},n.prototype.set=function(e,t){var r=t*this.rowSize+Math.floor(e/32);this.bits[r]|=1<<(31&e)&4294967295},n.prototype.unset=function(e,t){var r=t*this.rowSize+Math.floor(e/32);this.bits[r]&=~(1<<(31&e)&4294967295)},n.prototype.flip=function(e,t){var r=t*this.rowSize+Math.floor(e/32);this.bits[r]^=1<<(31&e)&4294967295},n.prototype.xor=function(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new Ie("input matrix dimensions do not match");for(var t=new vr(Math.floor(this.width/32)+1),r=this.rowSize,o=this.bits,i=0,a=this.height;i<a;i++)for(var s=i*r,u=e.getRow(i,t).getBitArray(),c=0;c<r;c++)o[s+c]^=u[c]},n.prototype.clear=function(){for(var e=this.bits,t=e.length,r=0;r<t;r++)e[r]=0},n.prototype.setRegion=function(e,t,r,o){if(t<0||e<0)throw new Ie("Left and top must be nonnegative");if(o<1||r<1)throw new Ie("Height and width must be at least 1");var i=e+r,a=t+o;if(a>this.height||i>this.width)throw new Ie("The region must fit inside the matrix");for(var s=this.rowSize,u=this.bits,c=t;c<a;c++)for(var l=c*s,f=e;f<i;f++)u[l+Math.floor(f/32)]|=1<<(31&f)&4294967295},n.prototype.getRow=function(e,t){null==t||t.getSize()<this.width?t=new vr(this.width):t.clear();for(var r=this.rowSize,o=this.bits,i=e*r,a=0;a<r;a++)t.setBulk(32*a,o[i+a]);return t},n.prototype.setRow=function(e,t){cn.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)},n.prototype.rotate180=function(){for(var e=this.getWidth(),t=this.getHeight(),r=new vr(e),o=new vr(e),i=0,a=Math.floor((t+1)/2);i<a;i++)r=this.getRow(i,r),o=this.getRow(t-1-i,o),r.reverse(),o.reverse(),this.setRow(i,o),this.setRow(t-1-i,r)},n.prototype.getEnclosingRectangle=function(){for(var t=this.height,r=this.rowSize,o=this.bits,i=this.width,a=t,s=-1,u=-1,c=0;c<t;c++)for(var l=0;l<r;l++){var f=o[c*r+l];if(0!==f){if(c<a&&(a=c),c>u&&(u=c),32*l<i){for(var d=0;!(f<<31-d&4294967295);)d++;32*l+d<i&&(i=32*l+d)}if(32*l+31>s){for(d=31;!(f>>>d);)d--;32*l+d>s&&(s=32*l+d)}}}return s<i||u<a?null:Int32Array.from([i,a,s-i+1,u-a+1])},n.prototype.getTopLeftOnBit=function(){for(var e=this.rowSize,t=this.bits,r=0;r<t.length&&0===t[r];)r++;if(r===t.length)return null;for(var o=r/e,i=r%e*32,a=t[r],s=0;!(a<<31-s&4294967295);)s++;return Int32Array.from([i+=s,o])},n.prototype.getBottomRightOnBit=function(){for(var e=this.rowSize,t=this.bits,r=t.length-1;r>=0&&0===t[r];)r--;if(r<0)return null;for(var o=Math.floor(r/e),i=32*Math.floor(r%e),a=t[r],s=31;!(a>>>s);)s--;return Int32Array.from([i+=s,o])},n.prototype.getWidth=function(){return this.width},n.prototype.getHeight=function(){return this.height},n.prototype.getRowSize=function(){return this.rowSize},n.prototype.equals=function(e){return e instanceof n&&(this.width===e.width&&this.height===e.height&&this.rowSize===e.rowSize&&Yn.equals(this.bits,e.bits))},n.prototype.hashCode=function(){var e=this.width;return 31*(e=31*(e=31*(e=31*e+this.width)+this.height)+this.rowSize)+Yn.hashCode(this.bits)},n.prototype.toString=function(e,t,r){return void 0===e&&(e="X "),void 0===t&&(t="  "),void 0===r&&(r="\n"),this.buildToString(e,t,r)},n.prototype.buildToString=function(e,t,r){for(var o=new ct,i=0,a=this.height;i<a;i++){for(var s=0,u=this.width;s<u;s++)o.append(this.get(s,i)?e:t);o.append(r)}return o.toString()},n.prototype.clone=function(){return new n(this.width,this.height,this.rowSize,this.bits.slice())},n}();const Ro=dJ;var hJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),pJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return hJ(e,n),e.getNotFoundInstance=function(){return new e},e.kind="NotFoundException",e}(To);const Z=pJ;var gJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),vJ=function(n){function e(t){var r=n.call(this,t)||this;return r.luminances=e.EMPTY,r.buckets=new Int32Array(e.LUMINANCE_BUCKETS),r}return gJ(e,n),e.prototype.getBlackRow=function(t,r){var o=this.getLuminanceSource(),i=o.getWidth();null==r||r.getSize()<i?r=new vr(i):r.clear(),this.initArrays(i);for(var a=o.getRow(t,this.luminances),s=this.buckets,u=0;u<i;u++)s[(255&a[u])>>e.LUMINANCE_SHIFT]++;var c=e.estimateBlackPoint(s);if(i<3)for(u=0;u<i;u++)(255&a[u])<c&&r.set(u);else{var l=255&a[0],f=255&a[1];for(u=1;u<i-1;u++){var d=255&a[u+1];(4*f-l-d)/2<c&&r.set(u),l=f,f=d}}return r},e.prototype.getBlackMatrix=function(){var t=this.getLuminanceSource(),r=t.getWidth(),o=t.getHeight(),i=new Ro(r,o);this.initArrays(r);for(var a=this.buckets,s=1;s<5;s++)for(var u=Math.floor(o*s/5),c=t.getRow(u,this.luminances),l=Math.floor(4*r/5),f=Math.floor(r/5);f<l;f++)a[(255&c[f])>>e.LUMINANCE_SHIFT]++;var h=e.estimateBlackPoint(a),p=t.getMatrix();for(s=0;s<o;s++){var g=s*r;for(f=0;f<r;f++)(255&p[g+f])<h&&i.set(f,s)}return i},e.prototype.createBinarizer=function(t){return new e(t)},e.prototype.initArrays=function(t){this.luminances.length<t&&(this.luminances=new Uint8ClampedArray(t));for(var r=this.buckets,o=0;o<e.LUMINANCE_BUCKETS;o++)r[o]=0},e.estimateBlackPoint=function(t){for(var r=t.length,o=0,i=0,a=0,s=0;s<r;s++)t[s]>a&&(i=s,a=t[s]),t[s]>o&&(o=t[s]);var u=0,c=0;for(s=0;s<r;s++){var l=s-i;(f=t[s]*l*l)>c&&(u=s,c=f)}if(i>u){var d=i;i=u,u=d}if(u-i<=r/16)throw new Z;var h=u-1,p=-1;for(s=u-1;s>i;s--){var f,g=s-i;(f=g*g*(u-s)*(o-t[s]))>p&&(h=s,p=f)}return h<<e.LUMINANCE_SHIFT},e.LUMINANCE_SHIFT=8-(e.LUMINANCE_BITS=5),e.LUMINANCE_BUCKETS=1<<e.LUMINANCE_BITS,e.EMPTY=Uint8ClampedArray.from([0]),e}(qQ);const mJ=vJ;var yJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),xJ=function(n){function e(t){var r=n.call(this,t)||this;return r.matrix=null,r}return yJ(e,n),e.prototype.getBlackMatrix=function(){if(null!==this.matrix)return this.matrix;var t=this.getLuminanceSource(),r=t.getWidth(),o=t.getHeight();if(r>=e.MINIMUM_DIMENSION&&o>=e.MINIMUM_DIMENSION){var i=t.getMatrix(),a=r>>e.BLOCK_SIZE_POWER;r&e.BLOCK_SIZE_MASK&&a++;var s=o>>e.BLOCK_SIZE_POWER;o&e.BLOCK_SIZE_MASK&&s++;var u=e.calculateBlackPoints(i,a,s,r,o),c=new Ro(r,o);e.calculateThresholdForBlock(i,a,s,r,o,u,c),this.matrix=c}else this.matrix=n.prototype.getBlackMatrix.call(this);return this.matrix},e.prototype.createBinarizer=function(t){return new e(t)},e.calculateThresholdForBlock=function(t,r,o,i,a,s,u){for(var c=a-e.BLOCK_SIZE,l=i-e.BLOCK_SIZE,f=0;f<o;f++){var d=f<<e.BLOCK_SIZE_POWER;d>c&&(d=c);for(var h=e.cap(f,2,o-3),p=0;p<r;p++){var g=p<<e.BLOCK_SIZE_POWER;g>l&&(g=l);for(var v=e.cap(p,2,r-3),m=0,y=-2;y<=2;y++){var x=s[h+y];m+=x[v-2]+x[v-1]+x[v]+x[v+1]+x[v+2]}e.thresholdBlock(t,g,d,m/25,i,u)}}},e.cap=function(t,r,o){return t<r?r:t>o?o:t},e.thresholdBlock=function(t,r,o,i,a,s){for(var u=0,c=o*a+r;u<e.BLOCK_SIZE;u++,c+=a)for(var l=0;l<e.BLOCK_SIZE;l++)(255&t[c+l])<=i&&s.set(r+l,o+u)},e.calculateBlackPoints=function(t,r,o,i,a){for(var s=a-e.BLOCK_SIZE,u=i-e.BLOCK_SIZE,c=new Array(o),l=0;l<o;l++){c[l]=new Int32Array(r);var f=l<<e.BLOCK_SIZE_POWER;f>s&&(f=s);for(var d=0;d<r;d++){var h=d<<e.BLOCK_SIZE_POWER;h>u&&(h=u);for(var p=0,g=255,v=0,m=0,y=f*i+h;m<e.BLOCK_SIZE;m++,y+=i){for(var x=0;x<e.BLOCK_SIZE;x++){var w=255&t[y+x];p+=w,w<g&&(g=w),w>v&&(v=w)}if(v-g>e.MIN_DYNAMIC_RANGE)for(m++,y+=i;m<e.BLOCK_SIZE;m++,y+=i)for(x=0;x<e.BLOCK_SIZE;x++)p+=255&t[y+x]}var _=p>>2*e.BLOCK_SIZE_POWER;if(v-g<=e.MIN_DYNAMIC_RANGE&&(_=g/2,l>0&&d>0)){var b=(c[l-1][d]+2*c[l][d-1]+c[l-1][d-1])/4;g<b&&(_=b)}c[l][d]=_}}return c},e.BLOCK_SIZE_MASK=(e.BLOCK_SIZE=1<<(e.BLOCK_SIZE_POWER=3))-1,e.MINIMUM_DIMENSION=5*e.BLOCK_SIZE,e.MIN_DYNAMIC_RANGE=24,e}(mJ);const NM=xJ;var wJ=function(){function n(e,t){this.width=e,this.height=t}return n.prototype.getWidth=function(){return this.width},n.prototype.getHeight=function(){return this.height},n.prototype.isCropSupported=function(){return!1},n.prototype.crop=function(e,t,r,o){throw new s0("This luminance source does not support cropping.")},n.prototype.isRotateSupported=function(){return!1},n.prototype.rotateCounterClockwise=function(){throw new s0("This luminance source does not support rotation by 90 degrees.")},n.prototype.rotateCounterClockwise45=function(){throw new s0("This luminance source does not support rotation by 45 degrees.")},n.prototype.toString=function(){for(var e=new Uint8ClampedArray(this.width),t=new ct,r=0;r<this.height;r++){for(var o=this.getRow(r,e),i=0;i<this.width;i++){var a=255&o[i];t.append(a<64?"#":a<128?"+":a<192?".":" ")}t.append("\n")}return t.toString()},n}();const Ah=wJ;var _J=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),bJ=function(n){function e(t){var r=n.call(this,t.getWidth(),t.getHeight())||this;return r.delegate=t,r}return _J(e,n),e.prototype.getRow=function(t,r){for(var o=this.delegate.getRow(t,r),i=this.getWidth(),a=0;a<i;a++)o[a]=255-(255&o[a]);return o},e.prototype.getMatrix=function(){for(var t=this.delegate.getMatrix(),r=this.getWidth()*this.getHeight(),o=new Uint8ClampedArray(r),i=0;i<r;i++)o[i]=255-(255&t[i]);return o},e.prototype.isCropSupported=function(){return this.delegate.isCropSupported()},e.prototype.crop=function(t,r,o,i){return new e(this.delegate.crop(t,r,o,i))},e.prototype.isRotateSupported=function(){return this.delegate.isRotateSupported()},e.prototype.invert=function(){return this.delegate},e.prototype.rotateCounterClockwise=function(){return new e(this.delegate.rotateCounterClockwise())},e.prototype.rotateCounterClockwise45=function(){return new e(this.delegate.rotateCounterClockwise45())},e}(Ah);const u0=bJ;var CJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),EJ=function(n){function e(t){var r=n.call(this,t.width,t.height)||this;return r.canvas=t,r.tempCanvasElement=null,r.buffer=e.makeBufferFromCanvasImageData(t),r}return CJ(e,n),e.makeBufferFromCanvasImageData=function(t){var r=t.getContext("2d").getImageData(0,0,t.width,t.height);return e.toGrayscaleBuffer(r.data,t.width,t.height)},e.toGrayscaleBuffer=function(t,r,o){var i=new Uint8ClampedArray(r*o);if(e.FRAME_INDEX=!e.FRAME_INDEX)for(var a=0,s=0,u=t.length;a<u;a+=4,s++){i[s]=0===t[a+3]?255:306*t[a]+601*t[a+1]+117*t[a+2]+512>>10}else{a=0,s=0;for(var p=t.length;a<p;a+=4,s++)void 0,i[s]=255-(0===t[a+3]?255:306*t[a]+601*t[a+1]+117*t[a+2]+512>>10)}return i},e.prototype.getRow=function(t,r){if(t<0||t>=this.getHeight())throw new Ie("Requested row is outside the image: "+t);var o=this.getWidth(),i=t*o;return null===r?r=this.buffer.slice(i,i+o):(r.length<o&&(r=new Uint8ClampedArray(o)),r.set(this.buffer.slice(i,i+o))),r},e.prototype.getMatrix=function(){return this.buffer},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(t,r,o,i){return n.prototype.crop.call(this,t,r,o,i),this},e.prototype.isRotateSupported=function(){return!0},e.prototype.rotateCounterClockwise=function(){return this.rotate(-90),this},e.prototype.rotateCounterClockwise45=function(){return this.rotate(-45),this},e.prototype.getTempCanvasElement=function(){if(null===this.tempCanvasElement){var t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement},e.prototype.rotate=function(t){var r=this.getTempCanvasElement(),o=r.getContext("2d"),i=t*e.DEGREE_TO_RADIANS,a=this.canvas.width,s=this.canvas.height,u=Math.ceil(Math.abs(Math.cos(i))*a+Math.abs(Math.sin(i))*s),c=Math.ceil(Math.abs(Math.sin(i))*a+Math.abs(Math.cos(i))*s);return r.width=u,r.height=c,o.translate(u/2,c/2),o.rotate(i),o.drawImage(this.canvas,a/-2,s/-2),this.buffer=e.makeBufferFromCanvasImageData(r),this},e.prototype.invert=function(){return new u0(this)},e.DEGREE_TO_RADIANS=Math.PI/180,e.FRAME_INDEX=!0,e}(Ah),SJ=function(){function n(e,t,r){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=r||void 0}return n.prototype.toJSON=function(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}},n}(),ho=function(n,e,t,r){return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):function o(i){return i instanceof t?i:new t(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})},po=function(n,e){var r,o,i,a,t={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(!(i=(i=t.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){t=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(6===c[0]&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}},df=function(){function n(e,t,r){void 0===t&&(t=500),this.reader=e,this.timeBetweenScansMillis=t,this._hints=r,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}return Object.defineProperty(n.prototype,"hasNavigator",{get:function(){return typeof navigator<"u"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isMediaDevicesSuported",{get:function(){return this.hasNavigator&&!!navigator.mediaDevices},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canEnumerateDevices",{get:function(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"timeBetweenDecodingAttempts",{get:function(){return this._timeBetweenDecodingAttempts},set:function(e){this._timeBetweenDecodingAttempts=e<0?0:e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hints",{get:function(){return this._hints},set:function(e){this._hints=e||null},enumerable:!1,configurable:!0}),n.prototype.listVideoInputDevices=function(){return ho(this,void 0,void 0,function(){var e,t,r,o,i,a,f,d;return po(this,function(h){switch(h.label){case 0:if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:e=h.sent(),t=[];try{for(r=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),o=r.next();!o.done;o=r.next())"videoinput"===(a="video"===(i=o.value).kind?"videoinput":i.kind)&&t.push({deviceId:i.deviceId||i.id,label:i.label||"Video device "+(t.length+1),kind:a,groupId:i.groupId})}catch(p){f={error:p}}finally{try{o&&!o.done&&(d=r.return)&&d.call(r)}finally{if(f)throw f.error}}return[2,t]}})})},n.prototype.getVideoInputDevices=function(){return ho(this,void 0,void 0,function(){return po(this,function(t){switch(t.label){case 0:return[4,this.listVideoInputDevices()];case 1:return[2,t.sent().map(function(r){return new SJ(r.deviceId,r.label)})]}})})},n.prototype.findDeviceById=function(e){return ho(this,void 0,void 0,function(){var t;return po(this,function(r){switch(r.label){case 0:return[4,this.listVideoInputDevices()];case 1:return(t=r.sent())?[2,t.find(function(o){return o.deviceId===e})]:[2,null]}})})},n.prototype.decodeFromInputVideoDevice=function(e,t){return ho(this,void 0,void 0,function(){return po(this,function(r){switch(r.label){case 0:return[4,this.decodeOnceFromVideoDevice(e,t)];case 1:return[2,r.sent()]}})})},n.prototype.decodeOnceFromVideoDevice=function(e,t){return ho(this,void 0,void 0,function(){return po(this,function(i){switch(i.label){case 0:return this.reset(),[4,this.decodeOnceFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},t)];case 1:return[2,i.sent()]}})})},n.prototype.decodeOnceFromConstraints=function(e,t){return ho(this,void 0,void 0,function(){var r;return po(this,function(o){switch(o.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return r=o.sent(),[4,this.decodeOnceFromStream(r,t)];case 2:return[2,o.sent()]}})})},n.prototype.decodeOnceFromStream=function(e,t){return ho(this,void 0,void 0,function(){var r;return po(this,function(i){switch(i.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,t)];case 1:return r=i.sent(),[4,this.decodeOnce(r)];case 2:return[2,i.sent()]}})})},n.prototype.decodeFromInputVideoDeviceContinuously=function(e,t,r){return ho(this,void 0,void 0,function(){return po(this,function(o){switch(o.label){case 0:return[4,this.decodeFromVideoDevice(e,t,r)];case 1:return[2,o.sent()]}})})},n.prototype.decodeFromVideoDevice=function(e,t,r){return ho(this,void 0,void 0,function(){return po(this,function(a){switch(a.label){case 0:return[4,this.decodeFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},t,r)];case 1:return[2,a.sent()]}})})},n.prototype.decodeFromConstraints=function(e,t,r){return ho(this,void 0,void 0,function(){var o;return po(this,function(i){switch(i.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return o=i.sent(),[4,this.decodeFromStream(o,t,r)];case 2:return[2,i.sent()]}})})},n.prototype.decodeFromStream=function(e,t,r){return ho(this,void 0,void 0,function(){var o;return po(this,function(i){switch(i.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,t)];case 1:return o=i.sent(),[4,this.decodeContinuously(o,r)];case 2:return[2,i.sent()]}})})},n.prototype.stopAsyncDecode=function(){this._stopAsyncDecode=!0},n.prototype.stopContinuousDecode=function(){this._stopContinuousDecode=!0},n.prototype.attachStreamToVideo=function(e,t){return ho(this,void 0,void 0,function(){var r;return po(this,function(o){switch(o.label){case 0:return r=this.prepareVideoElement(t),this.addVideoSource(r,e),this.videoElement=r,this.stream=e,[4,this.playVideoOnLoadAsync(r)];case 1:return o.sent(),[2,r]}})})},n.prototype.playVideoOnLoadAsync=function(e){var t=this;return new Promise(function(r,o){return t.playVideoOnLoad(e,function(){return r()})})},n.prototype.playVideoOnLoad=function(e,t){var r=this;this.videoEndedListener=function(){return r.stopStreams()},this.videoCanPlayListener=function(){return r.tryPlayVideo(e)},e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)},n.prototype.isVideoPlaying=function(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2},n.prototype.tryPlayVideo=function(e){return ho(this,void 0,void 0,function(){return po(this,function(r){switch(r.label){case 0:if(this.isVideoPlaying(e))return console.warn("Trying to play video that is already playing."),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.play()];case 2:return r.sent(),[3,4];case 3:return r.sent(),console.warn("It was not possible to play the video."),[3,4];case 4:return[2]}})})},n.prototype.getMediaElement=function(e,t){var r=document.getElementById(e);if(!r)throw new Wn("element with id '"+e+"' not found");if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new Wn("element with id '"+e+"' must be an "+t+" element");return r},n.prototype.decodeFromImage=function(e,t){if(!e&&!t)throw new Wn("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)},n.prototype.decodeFromVideo=function(e,t){if(!e&&!t)throw new Wn("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)},n.prototype.decodeFromVideoContinuously=function(e,t,r){if(void 0===e&&void 0===t)throw new Wn("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,r):this.decodeFromVideoElementContinuously(e,r)},n.prototype.decodeFromImageElement=function(e){if(!e)throw new Wn("An image element must be provided.");this.reset();var t=this.prepareImageElement(e);return this.imageElement=t,this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t)},n.prototype.decodeFromVideoElement=function(e){var t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)},n.prototype.decodeFromVideoElementContinuously=function(e,t){var r=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(r,t)},n.prototype._decodeFromVideoElementSetup=function(e){if(!e)throw new Wn("A video element must be provided.");this.reset();var t=this.prepareVideoElement(e);return this.videoElement=t,t},n.prototype.decodeFromImageUrl=function(e){if(!e)throw new Wn("An URL must be provided.");this.reset();var t=this.prepareImageElement();this.imageElement=t;var r=this._decodeOnLoadImage(t);return t.src=e,r},n.prototype.decodeFromVideoUrl=function(e){if(!e)throw new Wn("An URL must be provided.");this.reset();var t=this.prepareVideoElement(),r=this.decodeFromVideoElement(t);return t.src=e,r},n.prototype.decodeFromVideoUrlContinuously=function(e,t){if(!e)throw new Wn("An URL must be provided.");this.reset();var r=this.prepareVideoElement(),o=this.decodeFromVideoElementContinuously(r,t);return r.src=e,o},n.prototype._decodeOnLoadImage=function(e){var t=this;return new Promise(function(r,o){t.imageLoadedListener=function(){return t.decodeOnce(e,!1,!0).then(r,o)},e.addEventListener("load",t.imageLoadedListener)})},n.prototype._decodeOnLoadVideo=function(e){return ho(this,void 0,void 0,function(){return po(this,function(t){switch(t.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return t.sent(),[4,this.decodeOnce(e)];case 2:return[2,t.sent()]}})})},n.prototype._decodeOnLoadVideoContinuously=function(e,t){return ho(this,void 0,void 0,function(){return po(this,function(r){switch(r.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return r.sent(),this.decodeContinuously(e,t),[2]}})})},n.prototype.isImageLoaded=function(e){return!(!e.complete||0===e.naturalWidth)},n.prototype.prepareImageElement=function(e){var t;return typeof e>"u"&&((t=document.createElement("img")).width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t},n.prototype.prepareVideoElement=function(e){var t;return!e&&typeof document<"u"&&((t=document.createElement("video")).width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t},n.prototype.decodeOnce=function(e,t,r){var o=this;void 0===t&&(t=!0),void 0===r&&(r=!0),this._stopAsyncDecode=!1;var i=function(a,s){if(o._stopAsyncDecode)return s(new Z("Video stream has ended before any code could be detected.")),void(o._stopAsyncDecode=void 0);try{a(o.decode(e))}catch(d){if(t&&d instanceof Z||(d instanceof Gn||d instanceof le)&&r)return setTimeout(i,o._timeBetweenDecodingAttempts,a,s);s(d)}};return new Promise(function(a,s){return i(a,s)})},n.prototype.decodeContinuously=function(e,t){var r=this;this._stopContinuousDecode=!1;var o=function(){if(r._stopContinuousDecode)r._stopContinuousDecode=void 0;else try{var i=r.decode(e);t(i,null),setTimeout(o,r.timeBetweenScansMillis)}catch(u){t(null,u),(u instanceof Gn||u instanceof le||u instanceof Z)&&setTimeout(o,r._timeBetweenDecodingAttempts)}};o()},n.prototype.decode=function(e){var t=this.createBinaryBitmap(e);return this.decodeBitmap(t)},n.prototype.createBinaryBitmap=function(e){this.getCaptureCanvasContext(e),e instanceof HTMLVideoElement?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);var r=this.getCaptureCanvas(e),o=new EJ(r),i=new NM(o);return new TM(i)},n.prototype.getCaptureCanvasContext=function(e){if(!this.captureCanvasContext){var t=this.getCaptureCanvas(e),r=void 0;try{r=t.getContext("2d",{willReadFrequently:!0})}catch{r=t.getContext("2d")}this.captureCanvasContext=r}return this.captureCanvasContext},n.prototype.getCaptureCanvas=function(e){if(!this.captureCanvas){var t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas},n.prototype.drawFrameOnCanvas=function(e,t,r){void 0===t&&(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),void 0===r&&(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)},n.prototype.drawImageOnCanvas=function(e,t,r){void 0===t&&(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),void 0===r&&(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)},n.prototype.decodeBitmap=function(e){return this.reader.decode(e,this._hints)},n.prototype.createCaptureCanvas=function(e){if(typeof document>"u")return this._destroyCaptureCanvas(),null;var r,o,t=document.createElement("canvas");return typeof e<"u"&&(e instanceof HTMLVideoElement?(r=e.videoWidth,o=e.videoHeight):e instanceof HTMLImageElement&&(r=e.naturalWidth||e.width,o=e.naturalHeight||e.height)),t.style.width=r+"px",t.style.height=o+"px",t.width=r,t.height=o,t},n.prototype.stopStreams=function(){this.stream&&(this.stream.getVideoTracks().forEach(function(e){return e.stop()}),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()},n.prototype.reset=function(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()},n.prototype._destroyVideoElement=function(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)},n.prototype._destroyImageElement=function(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)},n.prototype._destroyCaptureCanvas=function(){this.captureCanvasContext=void 0,this.captureCanvas=void 0},n.prototype.addVideoSource=function(e,t){try{e.srcObject=t}catch{e.src=URL.createObjectURL(t)}},n.prototype.cleanVideoSource=function(e){try{e.srcObject=null}catch{e.src=""}this.videoElement.removeAttribute("src")},n}(),IJ=function(){function n(e,t,r,o,i,a){void 0===r&&(r=null==t?0:8*t.length),void 0===a&&(a=cn.currentTimeMillis()),this.text=e,this.rawBytes=t,this.numBits=r,this.resultPoints=o,this.format=i,this.timestamp=a,this.text=e,this.rawBytes=t,this.numBits=null==r?null==t?0:8*t.length:r,this.resultPoints=o,this.format=i,this.resultMetadata=null,this.timestamp=null==a?cn.currentTimeMillis():a}return n.prototype.getText=function(){return this.text},n.prototype.getRawBytes=function(){return this.rawBytes},n.prototype.getNumBits=function(){return this.numBits},n.prototype.getResultPoints=function(){return this.resultPoints},n.prototype.getBarcodeFormat=function(){return this.format},n.prototype.getResultMetadata=function(){return this.resultMetadata},n.prototype.putMetadata=function(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)},n.prototype.putAllMetadata=function(e){null!==e&&(this.resultMetadata=null===this.resultMetadata?e:new Map(e))},n.prototype.addResultPoints=function(e){var t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){var r=new Array(t.length+e.length);cn.arraycopy(t,0,r,0,t.length),cn.arraycopy(e,0,r,t.length,e.length),this.resultPoints=r}},n.prototype.getTimestamp=function(){return this.timestamp},n.prototype.toString=function(){return this.text},n}();const qr=IJ;var c0=(()=>(function(n){n[n.AZTEC=0]="AZTEC",n[n.CODABAR=1]="CODABAR",n[n.CODE_39=2]="CODE_39",n[n.CODE_93=3]="CODE_93",n[n.CODE_128=4]="CODE_128",n[n.DATA_MATRIX=5]="DATA_MATRIX",n[n.EAN_8=6]="EAN_8",n[n.EAN_13=7]="EAN_13",n[n.ITF=8]="ITF",n[n.MAXICODE=9]="MAXICODE",n[n.PDF_417=10]="PDF_417",n[n.QR_CODE=11]="QR_CODE",n[n.RSS_14=12]="RSS_14",n[n.RSS_EXPANDED=13]="RSS_EXPANDED",n[n.UPC_A=14]="UPC_A",n[n.UPC_E=15]="UPC_E",n[n.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"}(c0||(c0={})),c0))();const Me=c0;var l0=(()=>(function(n){n[n.OTHER=0]="OTHER",n[n.ORIENTATION=1]="ORIENTATION",n[n.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",n[n.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",n[n.ISSUE_NUMBER=4]="ISSUE_NUMBER",n[n.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",n[n.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",n[n.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",n[n.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",n[n.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",n[n.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"}(l0||(l0={})),l0))();const Rr=l0;var DJ=function(){function n(e,t,r,o,i,a){void 0===i&&(i=-1),void 0===a&&(a=-1),this.rawBytes=e,this.text=t,this.byteSegments=r,this.ecLevel=o,this.structuredAppendSequenceNumber=i,this.structuredAppendParity=a,this.numBits=null==e?0:8*e.length}return n.prototype.getRawBytes=function(){return this.rawBytes},n.prototype.getNumBits=function(){return this.numBits},n.prototype.setNumBits=function(e){this.numBits=e},n.prototype.getText=function(){return this.text},n.prototype.getByteSegments=function(){return this.byteSegments},n.prototype.getECLevel=function(){return this.ecLevel},n.prototype.getErrorsCorrected=function(){return this.errorsCorrected},n.prototype.setErrorsCorrected=function(e){this.errorsCorrected=e},n.prototype.getErasures=function(){return this.erasures},n.prototype.setErasures=function(e){this.erasures=e},n.prototype.getOther=function(){return this.other},n.prototype.setOther=function(e){this.other=e},n.prototype.hasStructuredAppend=function(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0},n.prototype.getStructuredAppendParity=function(){return this.structuredAppendParity},n.prototype.getStructuredAppendSequenceNumber=function(){return this.structuredAppendSequenceNumber},n}();const f0=DJ;var TJ=function(){function n(){}return n.prototype.exp=function(e){return this.expTable[e]},n.prototype.log=function(e){if(0===e)throw new Ie;return this.logTable[e]},n.addOrSubtract=function(e,t){return e^t},n}();const Ih=TJ;var RJ=function(){function n(e,t){if(0===t.length)throw new Ie;this.field=e;var r=t.length;if(r>1&&0===t[0]){for(var o=1;o<r&&0===t[o];)o++;o===r?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(r-o),cn.arraycopy(t,o,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}return n.prototype.getCoefficients=function(){return this.coefficients},n.prototype.getDegree=function(){return this.coefficients.length-1},n.prototype.isZero=function(){return 0===this.coefficients[0]},n.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},n.prototype.evaluateAt=function(e){if(0===e)return this.getCoefficient(0);var r,t=this.coefficients;if(1===e){r=0;for(var o=0,i=t.length;o!==i;o++)r=Ih.addOrSubtract(r,t[o]);return r}r=t[0];var s=t.length,u=this.field;for(o=1;o<s;o++)r=Ih.addOrSubtract(u.multiply(e,r),t[o]);return r},n.prototype.addOrSubtract=function(e){if(!this.field.equals(e.field))throw new Ie("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;var t=this.coefficients,r=e.coefficients;if(t.length>r.length){var o=t;t=r,r=o}var i=new Int32Array(r.length),a=r.length-t.length;cn.arraycopy(r,0,i,0,a);for(var s=a;s<r.length;s++)i[s]=Ih.addOrSubtract(t[s-a],r[s]);return new n(this.field,i)},n.prototype.multiply=function(e){if(!this.field.equals(e.field))throw new Ie("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();for(var t=this.coefficients,r=t.length,o=e.coefficients,i=o.length,a=new Int32Array(r+i-1),s=this.field,u=0;u<r;u++)for(var c=t[u],l=0;l<i;l++)a[u+l]=Ih.addOrSubtract(a[u+l],s.multiply(c,o[l]));return new n(s,a)},n.prototype.multiplyScalar=function(e){if(0===e)return this.field.getZero();if(1===e)return this;for(var t=this.coefficients.length,r=this.field,o=new Int32Array(t),i=this.coefficients,a=0;a<t;a++)o[a]=r.multiply(i[a],e);return new n(r,o)},n.prototype.multiplyByMonomial=function(e,t){if(e<0)throw new Ie;if(0===t)return this.field.getZero();for(var r=this.coefficients,o=r.length,i=new Int32Array(o+e),a=this.field,s=0;s<o;s++)i[s]=a.multiply(r[s],t);return new n(a,i)},n.prototype.divide=function(e){if(!this.field.equals(e.field))throw new Ie("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new Ie("Divide by 0");for(var t=this.field,r=t.getZero(),o=this,i=e.getCoefficient(e.getDegree()),a=t.inverse(i);o.getDegree()>=e.getDegree()&&!o.isZero();){var s=o.getDegree()-e.getDegree(),u=t.multiply(o.getCoefficient(o.getDegree()),a),c=e.multiplyByMonomial(s,u),l=t.buildMonomial(s,u);r=r.addOrSubtract(l),o=o.addOrSubtract(c)}return[r,o]},n.prototype.toString=function(){for(var e="",t=this.getDegree();t>=0;t--){var r=this.getCoefficient(t);if(0!==r){if(r<0?(e+=" - ",r=-r):e.length>0&&(e+=" + "),0===t||1!==r){var o=this.field.log(r);0===o?e+="1":1===o?e+="a":(e+="a^",e+=o)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e},n}();const hu=RJ;var NJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),OJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return NJ(e,n),e.kind="ArithmeticException",e}(To);const OM=OJ;var MJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),PJ=function(n){function e(t,r,o){var i=n.call(this)||this;i.primitive=t,i.size=r,i.generatorBase=o;for(var a=new Int32Array(r),s=1,u=0;u<r;u++)a[u]=s,(s*=2)>=r&&(s^=t,s&=r-1);i.expTable=a;var c=new Int32Array(r);for(u=0;u<r-1;u++)c[a[u]]=u;return i.logTable=c,i.zero=new hu(i,Int32Array.from([0])),i.one=new hu(i,Int32Array.from([1])),i}return MJ(e,n),e.prototype.getZero=function(){return this.zero},e.prototype.getOne=function(){return this.one},e.prototype.buildMonomial=function(t,r){if(t<0)throw new Ie;if(0===r)return this.zero;var o=new Int32Array(t+1);return o[0]=r,new hu(this,o)},e.prototype.inverse=function(t){if(0===t)throw new OM;return this.expTable[this.size-this.logTable[t]-1]},e.prototype.multiply=function(t,r){return 0===t||0===r?0:this.expTable[(this.logTable[t]+this.logTable[r])%(this.size-1)]},e.prototype.getSize=function(){return this.size},e.prototype.getGeneratorBase=function(){return this.generatorBase},e.prototype.toString=function(){return"GF(0x"+ut.toHexString(this.primitive)+","+this.size+")"},e.prototype.equals=function(t){return t===this},e.AZTEC_DATA_12=new e(4201,4096,1),e.AZTEC_DATA_10=new e(1033,1024,1),e.AZTEC_DATA_6=new e(67,64,1),e.AZTEC_PARAM=new e(19,16,1),e.QR_CODE_FIELD_256=new e(285,256,0),e.DATA_MATRIX_FIELD_256=new e(301,256,1),e.AZTEC_DATA_8=e.DATA_MATRIX_FIELD_256,e.MAXICODE_FIELD_64=e.AZTEC_DATA_6,e}(Ih);const No=PJ;var kJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),FJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return kJ(e,n),e.kind="ReedSolomonException",e}(To);const d0=FJ;var LJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),BJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return LJ(e,n),e.kind="IllegalStateException",e}(To);const La=BJ;var VJ=function(){function n(e){this.field=e}return n.prototype.decode=function(e,t){for(var r=this.field,o=new hu(r,e),i=new Int32Array(t),a=!0,s=0;s<t;s++){var u=o.evaluateAt(r.exp(s+r.getGeneratorBase()));i[i.length-1-s]=u,0!==u&&(a=!1)}if(!a){var c=new hu(r,i),l=this.runEuclideanAlgorithm(r.buildMonomial(t,1),c,t),d=l[1],h=this.findErrorLocations(l[0]),p=this.findErrorMagnitudes(d,h);for(s=0;s<h.length;s++){var g=e.length-1-r.log(h[s]);if(g<0)throw new d0("Bad error location");e[g]=No.addOrSubtract(e[g],p[s])}}},n.prototype.runEuclideanAlgorithm=function(e,t,r){if(e.getDegree()<t.getDegree()){var o=e;e=t,t=o}for(var i=this.field,a=e,s=t,u=i.getZero(),c=i.getOne();s.getDegree()>=(r/2|0);){var l=a,f=u;if(u=c,(a=s).isZero())throw new d0("r_{i-1} was zero");s=l;for(var d=i.getZero(),h=a.getCoefficient(a.getDegree()),p=i.inverse(h);s.getDegree()>=a.getDegree()&&!s.isZero();){var g=s.getDegree()-a.getDegree(),v=i.multiply(s.getCoefficient(s.getDegree()),p);d=d.addOrSubtract(i.buildMonomial(g,v)),s=s.addOrSubtract(a.multiplyByMonomial(g,v))}if(c=d.multiply(u).addOrSubtract(f),s.getDegree()>=a.getDegree())throw new La("Division algorithm failed to reduce polynomial?")}var m=c.getCoefficient(0);if(0===m)throw new d0("sigmaTilde(0) was zero");var y=i.inverse(m);return[c.multiplyScalar(y),s.multiplyScalar(y)]},n.prototype.findErrorLocations=function(e){var t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);for(var r=new Int32Array(t),o=0,i=this.field,a=1;a<i.getSize()&&o<t;a++)0===e.evaluateAt(a)&&(r[o]=i.inverse(a),o++);if(o!==t)throw new d0("Error locator degree does not match number of roots");return r},n.prototype.findErrorMagnitudes=function(e,t){for(var r=t.length,o=new Int32Array(r),i=this.field,a=0;a<r;a++){for(var s=i.inverse(t[a]),u=1,c=0;c<r;c++)if(a!==c){var l=i.multiply(t[c],s);u=i.multiply(u,1&l?-2&l:1|l)}o[a]=i.multiply(e.evaluateAt(s),i.inverse(u)),0!==i.getGeneratorBase()&&(o[a]=i.multiply(o[a],s))}return o},n}();const h0=VJ;var mr=(()=>(function(n){n[n.UPPER=0]="UPPER",n[n.LOWER=1]="LOWER",n[n.MIXED=2]="MIXED",n[n.DIGIT=3]="DIGIT",n[n.PUNCT=4]="PUNCT",n[n.BINARY=5]="BINARY"}(mr||(mr={})),mr))(),UJ=function(){function n(){}return n.prototype.decode=function(e){this.ddata=e;var t=e.getBits(),r=this.extractBits(t),o=this.correctBits(r),i=n.convertBoolArrayToByteArray(o),a=n.getEncodedData(o),s=new f0(i,a,null,null);return s.setNumBits(o.length),s},n.highLevelDecode=function(e){return this.getEncodedData(e)},n.getEncodedData=function(e){for(var t=e.length,r=mr.UPPER,o=mr.UPPER,i="",a=0;a<t;)if(o===mr.BINARY){if(t-a<5)break;var s=n.readCode(e,a,5);if(a+=5,0===s){if(t-a<11)break;s=n.readCode(e,a,11)+31,a+=11}for(var u=0;u<s;u++){if(t-a<8){a=t;break}var c=n.readCode(e,a,8);i+=Et.castAsNonUtf8Char(c),a+=8}o=r}else{var l=o===mr.DIGIT?4:5;if(t-a<l)break;c=n.readCode(e,a,l),a+=l;var f=n.getCharacter(o,c);f.startsWith("CTRL_")?(r=o,o=n.getTable(f.charAt(5)),"L"===f.charAt(6)&&(r=o)):(i+=f,o=r)}return i},n.getTable=function(e){switch(e){case"L":return mr.LOWER;case"P":return mr.PUNCT;case"M":return mr.MIXED;case"D":return mr.DIGIT;case"B":return mr.BINARY;default:return mr.UPPER}},n.getCharacter=function(e,t){switch(e){case mr.UPPER:return n.UPPER_TABLE[t];case mr.LOWER:return n.LOWER_TABLE[t];case mr.MIXED:return n.MIXED_TABLE[t];case mr.PUNCT:return n.PUNCT_TABLE[t];case mr.DIGIT:return n.DIGIT_TABLE[t];default:throw new La("Bad table")}},n.prototype.correctBits=function(e){var t,r;this.ddata.getNbLayers()<=2?(r=6,t=No.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(r=8,t=No.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(r=10,t=No.AZTEC_DATA_10):(r=12,t=No.AZTEC_DATA_12);var o=this.ddata.getNbDatablocks(),i=e.length/r;if(i<o)throw new le;for(var a=e.length%r,s=new Int32Array(i),u=0;u<i;u++,a+=r)s[u]=n.readCode(e,a,r);try{new h0(t).decode(s,i-o)}catch(v){throw new le(v)}var l=(1<<r)-1,f=0;for(u=0;u<o;u++){if(0===(d=s[u])||d===l)throw new le;(1===d||d===l-1)&&f++}var h=new Array(o*r-f),p=0;for(u=0;u<o;u++){var d;if(1===(d=s[u])||d===l-1)h.fill(d>1,p,p+r-1),p+=r-1;else for(var g=r-1;g>=0;--g)h[p++]=0!=(d&1<<g)}return h},n.prototype.extractBits=function(e){var t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),o=(t?11:14)+4*r,i=new Int32Array(o),a=new Array(this.totalBitsInLayer(r,t));if(t)for(var s=0;s<i.length;s++)i[s]=s;else{var u=o+1+2*ut.truncDivision(ut.truncDivision(o,2)-1,15),c=o/2,l=ut.truncDivision(u,2);for(s=0;s<c;s++){var f=s+ut.truncDivision(s,15);i[c-s-1]=l-f-1,i[c+s]=l+f+1}}s=0;for(var d=0;s<r;s++){for(var h=4*(r-s)+(t?9:12),p=2*s,g=o-1-p,v=0;v<h;v++)for(var m=2*v,y=0;y<2;y++)a[d+m+y]=e.get(i[p+y],i[p+v]),a[d+2*h+m+y]=e.get(i[p+v],i[g-y]),a[d+4*h+m+y]=e.get(i[g-y],i[g-v]),a[d+6*h+m+y]=e.get(i[g-v],i[p+y]);d+=8*h}return a},n.readCode=function(e,t,r){for(var o=0,i=t;i<t+r;i++)o<<=1,e[i]&&(o|=1);return o},n.readByte=function(e,t){var r=e.length-t;return r>=8?n.readCode(e,t,8):n.readCode(e,t,r)<<8-r},n.convertBoolArrayToByteArray=function(e){for(var t=new Uint8Array((e.length+7)/8),r=0;r<t.length;r++)t[r]=n.readByte(e,8*r);return t},n.prototype.totalBitsInLayer=function(e,t){return((t?88:112)+16*e)*e},n.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],n.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],n.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],n.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],n.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],n}();const MM=UJ;var HJ=function(){function n(){}return n.round=function(e){return isNaN(e)?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0},n.distance=function(e,t,r,o){var i=e-r,a=t-o;return Math.sqrt(i*i+a*a)},n.sum=function(e){for(var t=0,r=0,o=e.length;r!==o;r++)t+=e[r];return t},n}();const Pt=HJ;var WJ=function(){function n(){}return n.floatToIntBits=function(e){return e},n.MAX_VALUE=Number.MAX_SAFE_INTEGER,n}();const T_=WJ;var GJ=function(){function n(e,t){this.x=e,this.y=t}return n.prototype.getX=function(){return this.x},n.prototype.getY=function(){return this.y},n.prototype.equals=function(e){return e instanceof n&&(this.x===e.x&&this.y===e.y)},n.prototype.hashCode=function(){return 31*T_.floatToIntBits(this.x)+T_.floatToIntBits(this.y)},n.prototype.toString=function(){return"("+this.x+","+this.y+")"},n.orderBestPatterns=function(e){var i,a,s,t=this.distance(e[0],e[1]),r=this.distance(e[1],e[2]),o=this.distance(e[0],e[2]);if(r>=t&&r>=o?(a=e[0],i=e[1],s=e[2]):o>=r&&o>=t?(a=e[1],i=e[0],s=e[2]):(a=e[2],i=e[0],s=e[1]),this.crossProductZ(i,a,s)<0){var u=i;i=s,s=u}e[0]=i,e[1]=a,e[2]=s},n.distance=function(e,t){return Pt.distance(e.x,e.y,t.x,t.y)},n.crossProductZ=function(e,t,r){var o=t.x,i=t.y;return(r.x-o)*(e.y-i)-(r.y-i)*(e.x-o)},n}();const Ne=GJ;var zJ=function(){function n(e,t){this.bits=e,this.points=t}return n.prototype.getBits=function(){return this.bits},n.prototype.getPoints=function(){return this.points},n}();const R_=zJ;var jJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),$J=function(n){function e(t,r,o,i,a){var s=n.call(this,t,r)||this;return s.compact=o,s.nbDatablocks=i,s.nbLayers=a,s}return jJ(e,n),e.prototype.getNbLayers=function(){return this.nbLayers},e.prototype.getNbDatablocks=function(){return this.nbDatablocks},e.prototype.isCompact=function(){return this.compact},e}(R_);const qJ=$J;var XJ=function(){function n(e,t,r,o){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),null==t&&(t=n.INIT_SIZE),null==r&&(r=e.getWidth()/2|0),null==o&&(o=e.getHeight()/2|0);var i=t/2|0;if(this.leftInit=r-i,this.rightInit=r+i,this.upInit=o-i,this.downInit=o+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Z}return n.prototype.detect=function(){for(var e=this.leftInit,t=this.rightInit,r=this.upInit,o=this.downInit,i=!1,a=!0,s=!1,u=!1,c=!1,l=!1,f=!1,d=this.width,h=this.height;a;){a=!1;for(var p=!0;(p||!u)&&t<d;)(p=this.containsBlackPoint(r,o,t,!1))?(t++,a=!0,u=!0):u||t++;if(t>=d){i=!0;break}for(var g=!0;(g||!c)&&o<h;)(g=this.containsBlackPoint(e,t,o,!0))?(o++,a=!0,c=!0):c||o++;if(o>=h){i=!0;break}for(var v=!0;(v||!l)&&e>=0;)(v=this.containsBlackPoint(r,o,e,!1))?(e--,a=!0,l=!0):l||e--;if(e<0){i=!0;break}for(var m=!0;(m||!f)&&r>=0;)(m=this.containsBlackPoint(e,t,r,!0))?(r--,a=!0,f=!0):f||r--;if(r<0){i=!0;break}a&&(s=!0)}if(!i&&s){for(var y=t-e,x=null,w=1;null===x&&w<y;w++)x=this.getBlackPointOnSegment(e,o-w,e+w,o);if(null==x)throw new Z;var _=null;for(w=1;null===_&&w<y;w++)_=this.getBlackPointOnSegment(e,r+w,e+w,r);if(null==_)throw new Z;var b=null;for(w=1;null===b&&w<y;w++)b=this.getBlackPointOnSegment(t,r+w,t-w,r);if(null==b)throw new Z;var C=null;for(w=1;null===C&&w<y;w++)C=this.getBlackPointOnSegment(t,o-w,t-w,o);if(null==C)throw new Z;return this.centerEdges(C,x,b,_)}throw new Z},n.prototype.getBlackPointOnSegment=function(e,t,r,o){for(var i=Pt.round(Pt.distance(e,t,r,o)),a=(r-e)/i,s=(o-t)/i,u=this.image,c=0;c<i;c++){var l=Pt.round(e+c*a),f=Pt.round(t+c*s);if(u.get(l,f))return new Ne(l,f)}return null},n.prototype.centerEdges=function(e,t,r,o){var i=e.getX(),a=e.getY(),s=t.getX(),u=t.getY(),c=r.getX(),l=r.getY(),f=o.getX(),d=o.getY(),h=n.CORR;return i<this.width/2?[new Ne(f-h,d+h),new Ne(s+h,u+h),new Ne(c-h,l-h),new Ne(i+h,a-h)]:[new Ne(f+h,d+h),new Ne(s+h,u-h),new Ne(c-h,l+h),new Ne(i-h,a-h)]},n.prototype.containsBlackPoint=function(e,t,r,o){var i=this.image;if(o){for(var a=e;a<=t;a++)if(i.get(a,r))return!0}else for(var s=e;s<=t;s++)if(i.get(r,s))return!0;return!1},n.INIT_SIZE=10,n.CORR=1,n}();const N_=XJ;var KJ=function(){function n(){}return n.checkAndNudgePoints=function(e,t){for(var r=e.getWidth(),o=e.getHeight(),i=!0,a=0;a<t.length&&i;a+=2){var s=Math.floor(t[a]),u=Math.floor(t[a+1]);if(s<-1||s>r||u<-1||u>o)throw new Z;i=!1,-1===s?(t[a]=0,i=!0):s===r&&(t[a]=r-1,i=!0),-1===u?(t[a+1]=0,i=!0):u===o&&(t[a+1]=o-1,i=!0)}for(i=!0,a=t.length-2;a>=0&&i;a-=2){if(s=Math.floor(t[a]),u=Math.floor(t[a+1]),s<-1||s>r||u<-1||u>o)throw new Z;i=!1,-1===s?(t[a]=0,i=!0):s===r&&(t[a]=r-1,i=!0),-1===u?(t[a+1]=0,i=!0):u===o&&(t[a+1]=o-1,i=!0)}},n}();const PM=KJ;var YJ=function(){function n(e,t,r,o,i,a,s,u,c){this.a11=e,this.a21=t,this.a31=r,this.a12=o,this.a22=i,this.a32=a,this.a13=s,this.a23=u,this.a33=c}return n.quadrilateralToQuadrilateral=function(e,t,r,o,i,a,s,u,c,l,f,d,h,p,g,v){var m=n.quadrilateralToSquare(e,t,r,o,i,a,s,u);return n.squareToQuadrilateral(c,l,f,d,h,p,g,v).times(m)},n.prototype.transformPoints=function(e){for(var t=e.length,r=this.a11,o=this.a12,i=this.a13,a=this.a21,s=this.a22,u=this.a23,c=this.a31,l=this.a32,f=this.a33,d=0;d<t;d+=2){var h=e[d],p=e[d+1],g=i*h+u*p+f;e[d]=(r*h+a*p+c)/g,e[d+1]=(o*h+s*p+l)/g}},n.prototype.transformPointsWithValues=function(e,t){for(var r=this.a11,o=this.a12,i=this.a13,a=this.a21,s=this.a22,u=this.a23,c=this.a31,l=this.a32,f=this.a33,d=e.length,h=0;h<d;h++){var p=e[h],g=t[h],v=i*p+u*g+f;e[h]=(r*p+a*g+c)/v,t[h]=(o*p+s*g+l)/v}},n.squareToQuadrilateral=function(e,t,r,o,i,a,s,u){var c=e-r+i-s,l=t-o+a-u;if(0===c&&0===l)return new n(r-e,i-r,e,o-t,a-o,t,0,0,1);var f=r-i,d=s-i,h=o-a,p=u-a,g=f*p-d*h,v=(c*p-d*l)/g,m=(f*l-c*h)/g;return new n(r-e+v*r,s-e+m*s,e,o-t+v*o,u-t+m*u,t,v,m,1)},n.quadrilateralToSquare=function(e,t,r,o,i,a,s,u){return n.squareToQuadrilateral(e,t,r,o,i,a,s,u).buildAdjoint()},n.prototype.buildAdjoint=function(){return new n(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},n.prototype.times=function(e){return new n(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)},n}();const kM=YJ;var ZJ=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),QJ=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ZJ(e,n),e.prototype.sampleGrid=function(t,r,o,i,a,s,u,c,l,f,d,h,p,g,v,m,y,x,w){var _=kM.quadrilateralToQuadrilateral(i,a,s,u,c,l,f,d,h,p,g,v,m,y,x,w);return this.sampleGridWithTransform(t,r,o,_)},e.prototype.sampleGridWithTransform=function(t,r,o,i){if(r<=0||o<=0)throw new Z;for(var a=new Ro(r,o),s=new Float32Array(2*r),u=0;u<o;u++){for(var c=s.length,l=u+.5,f=0;f<c;f+=2)s[f]=f/2+.5,s[f+1]=l;i.transformPoints(s),PM.checkAndNudgePoints(t,s);try{for(f=0;f<c;f+=2)t.get(Math.floor(s[f]),Math.floor(s[f+1]))&&a.set(f/2,u)}catch{throw new Z}}return a},e}(PM);const JJ=QJ;var eee=function(){function n(){}return n.setGridSampler=function(e){n.gridSampler=e},n.getInstance=function(){return n.gridSampler},n.gridSampler=new JJ,n}();const O_=eee;var Oo=function(){function n(e,t){this.x=e,this.y=t}return n.prototype.toResultPoint=function(){return new Ne(this.getX(),this.getY())},n.prototype.getX=function(){return this.x},n.prototype.getY=function(){return this.y},n}(),tee=function(){function n(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}return n.prototype.detect=function(){return this.detectMirror(!1)},n.prototype.detectMirror=function(e){var t=this.getMatrixCenter(),r=this.getBullsEyeCorners(t);if(e){var o=r[0];r[0]=r[2],r[2]=o}this.extractParameters(r);var i=this.sampleGrid(this.image,r[this.shift%4],r[(this.shift+1)%4],r[(this.shift+2)%4],r[(this.shift+3)%4]),a=this.getMatrixCornerPoints(r);return new qJ(i,a,this.compact,this.nbDataBlocks,this.nbLayers)},n.prototype.extractParameters=function(e){if(!(this.isValidPoint(e[0])&&this.isValidPoint(e[1])&&this.isValidPoint(e[2])&&this.isValidPoint(e[3])))throw new Z;var t=2*this.nbCenterLayers,r=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(r,t);for(var o=0,i=0;i<4;i++){var a=r[(this.shift+i)%4];this.compact?(o<<=7,o+=a>>1&127):(o<<=10,o+=(a>>2&992)+(a>>1&31))}var s=this.getCorrectedParameterData(o,this.compact);this.compact?(this.nbLayers=1+(s>>6),this.nbDataBlocks=1+(63&s)):(this.nbLayers=1+(s>>11),this.nbDataBlocks=1+(2047&s))},n.prototype.getRotation=function(e,t){var r=0;e.forEach(function(i,a,s){r=(i>>t-2<<1)+(1&i)+(r<<3)}),r=((1&r)<<11)+(r>>1);for(var o=0;o<4;o++)if(ut.bitCount(r^this.EXPECTED_CORNER_BITS[o])<=2)return o;throw new Z},n.prototype.getCorrectedParameterData=function(e,t){var r,o;t?(r=7,o=2):(r=10,o=4);for(var i=r-o,a=new Int32Array(r),s=r-1;s>=0;--s)a[s]=15&e,e>>=4;try{new h0(No.AZTEC_PARAM).decode(a,i)}catch{throw new Z}var c=0;for(s=0;s<o;s++)c=(c<<4)+a[s];return c},n.prototype.getBullsEyeCorners=function(e){var t=e,r=e,o=e,i=e,a=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){var s=this.getFirstDifferent(t,a,1,-1),u=this.getFirstDifferent(r,a,1,1),c=this.getFirstDifferent(o,a,-1,1),l=this.getFirstDifferent(i,a,-1,-1);if(this.nbCenterLayers>2){var f=this.distancePoint(l,s)*this.nbCenterLayers/(this.distancePoint(i,t)*(this.nbCenterLayers+2));if(f<.75||f>1.25||!this.isWhiteOrBlackRectangle(s,u,c,l))break}t=s,r=u,o=c,i=l,a=!a}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new Z;this.compact=5===this.nbCenterLayers;var d=new Ne(t.getX()+.5,t.getY()-.5),h=new Ne(r.getX()+.5,r.getY()+.5),p=new Ne(o.getX()-.5,o.getY()+.5),g=new Ne(i.getX()-.5,i.getY()-.5);return this.expandSquare([d,h,p,g],2*this.nbCenterLayers-3,2*this.nbCenterLayers)},n.prototype.getMatrixCenter=function(){var e,t,r,o;try{e=(i=new N_(this.image).detect())[0],t=i[1],r=i[2],o=i[3]}catch{var a=this.image.getWidth()/2,s=this.image.getHeight()/2;e=this.getFirstDifferent(new Oo(a+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new Oo(a+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new Oo(a-7,s+7),!1,-1,1).toResultPoint(),o=this.getFirstDifferent(new Oo(a-7,s-7),!1,-1,-1).toResultPoint()}var u=Pt.round((e.getX()+o.getX()+t.getX()+r.getX())/4),c=Pt.round((e.getY()+o.getY()+t.getY()+r.getY())/4);try{var i;e=(i=new N_(this.image,15,u,c).detect())[0],t=i[1],r=i[2],o=i[3]}catch{e=this.getFirstDifferent(new Oo(u+7,c-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new Oo(u+7,c+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new Oo(u-7,c+7),!1,-1,1).toResultPoint(),o=this.getFirstDifferent(new Oo(u-7,c-7),!1,-1,-1).toResultPoint()}return u=Pt.round((e.getX()+o.getX()+t.getX()+r.getX())/4),c=Pt.round((e.getY()+o.getY()+t.getY()+r.getY())/4),new Oo(u,c)},n.prototype.getMatrixCornerPoints=function(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())},n.prototype.sampleGrid=function(e,t,r,o,i){var a=O_.getInstance(),s=this.getDimension(),u=s/2-this.nbCenterLayers,c=s/2+this.nbCenterLayers;return a.sampleGrid(e,s,s,u,u,c,u,c,c,u,c,t.getX(),t.getY(),r.getX(),r.getY(),o.getX(),o.getY(),i.getX(),i.getY())},n.prototype.sampleLine=function(e,t,r){for(var o=0,i=this.distanceResultPoint(e,t),a=i/r,s=e.getX(),u=e.getY(),c=a*(t.getX()-e.getX())/i,l=a*(t.getY()-e.getY())/i,f=0;f<r;f++)this.image.get(Pt.round(s+f*c),Pt.round(u+f*l))&&(o|=1<<r-f-1);return o},n.prototype.isWhiteOrBlackRectangle=function(e,t,r,o){e=new Oo(e.getX()-3,e.getY()+3),t=new Oo(t.getX()-3,t.getY()-3),r=new Oo(r.getX()+3,r.getY()-3),o=new Oo(o.getX()+3,o.getY()+3);var a=this.getColor(o,e);if(0===a)return!1;var s=this.getColor(e,t);return s===a&&(s=this.getColor(t,r))===a&&(s=this.getColor(r,o))===a},n.prototype.getColor=function(e,t){for(var r=this.distancePoint(e,t),o=(t.getX()-e.getX())/r,i=(t.getY()-e.getY())/r,a=0,s=e.getX(),u=e.getY(),c=this.image.get(e.getX(),e.getY()),l=Math.ceil(r),f=0;f<l;f++)u+=i,this.image.get(Pt.round(s+=o),Pt.round(u))!==c&&a++;var d=a/r;return d>.1&&d<.9?0:d<=.1===c?1:-1},n.prototype.getFirstDifferent=function(e,t,r,o){for(var i=e.getX()+r,a=e.getY()+o;this.isValid(i,a)&&this.image.get(i,a)===t;)i+=r,a+=o;for(i-=r,a-=o;this.isValid(i,a)&&this.image.get(i,a)===t;)i+=r;for(i-=r;this.isValid(i,a)&&this.image.get(i,a)===t;)a+=o;return new Oo(i,a-=o)},n.prototype.expandSquare=function(e,t,r){var o=r/(2*t),i=e[0].getX()-e[2].getX(),a=e[0].getY()-e[2].getY(),s=(e[0].getX()+e[2].getX())/2,u=(e[0].getY()+e[2].getY())/2,c=new Ne(s+o*i,u+o*a),l=new Ne(s-o*i,u-o*a);return i=e[1].getX()-e[3].getX(),a=e[1].getY()-e[3].getY(),s=(e[1].getX()+e[3].getX())/2,u=(e[1].getY()+e[3].getY())/2,[c,new Ne(s+o*i,u+o*a),l,new Ne(s-o*i,u-o*a)]},n.prototype.isValid=function(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()},n.prototype.isValidPoint=function(e){var t=Pt.round(e.getX()),r=Pt.round(e.getY());return this.isValid(t,r)},n.prototype.distancePoint=function(e,t){return Pt.distance(e.getX(),e.getY(),t.getX(),t.getY())},n.prototype.distanceResultPoint=function(e,t){return Pt.distance(e.getX(),e.getY(),t.getX(),t.getY())},n.prototype.getDimension=function(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(ut.truncDivision(this.nbLayers-4,8)+1)+15},n}();const nee=tee;var ree=function(){function n(){}return n.prototype.decode=function(e,t){void 0===t&&(t=null);var r=null,o=new nee(e.getBlackMatrix()),i=null,a=null;try{i=(s=o.detectMirror(!1)).getPoints(),this.reportFoundResultPoints(t,i),a=(new MM).decode(s)}catch(f){r=f}if(null==a)try{var s;i=(s=o.detectMirror(!0)).getPoints(),this.reportFoundResultPoints(t,i),a=(new MM).decode(s)}catch(f){throw r??f}var u=new qr(a.getText(),a.getRawBytes(),a.getNumBits(),i,Me.AZTEC,cn.currentTimeMillis()),c=a.getByteSegments();null!=c&&u.putMetadata(Rr.BYTE_SEGMENTS,c);var l=a.getECLevel();return null!=l&&u.putMetadata(Rr.ERROR_CORRECTION_LEVEL,l),u},n.prototype.reportFoundResultPoints=function(e,t){if(null!=e){var r=e.get(Kt.NEED_RESULT_POINT_CALLBACK);null!=r&&t.forEach(function(o,i,a){r.foundPossibleResultPoint(o)})}},n.prototype.reset=function(){},n}();const p0=ree;var oee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),iee=(function(n){oee(function e(t){return void 0===t&&(t=500),n.call(this,new p0,t)||this},n)}(df),function(){function n(){}return n.prototype.decode=function(e,t){try{return this.doDecode(e,t)}catch{if(t&&!0===t.get(Kt.TRY_HARDER)&&e.isRotateSupported()){var o=e.rotateCounterClockwise(),i=this.doDecode(o,t),a=i.getResultMetadata(),s=270;null!==a&&!0===a.get(Rr.ORIENTATION)&&(s+=a.get(Rr.ORIENTATION)%360),i.putMetadata(Rr.ORIENTATION,s);var u=i.getResultPoints();if(null!==u)for(var c=o.getHeight(),l=0;l<u.length;l++)u[l]=new Ne(c-u[l].getY()-1,u[l].getX());return i}throw new Z}},n.prototype.reset=function(){},n.prototype.doDecode=function(e,t){var u,r=e.getWidth(),o=e.getHeight(),i=new vr(r),a=t&&!0===t.get(Kt.TRY_HARDER),s=Math.max(1,o>>(a?8:5));u=a?o:15;for(var c=Math.trunc(o/2),l=0;l<u;l++){var f=Math.trunc((l+1)/2),h=c+s*(0==(1&l)?f:-f);if(h<0||h>=o)break;try{i=e.getBlackRow(h,i)}catch{continue}for(var p=function(y){if(1===y&&(i.reverse(),t&&!0===t.get(Kt.NEED_RESULT_POINT_CALLBACK))){var x=new Map;t.forEach(function(b,C){return x.set(C,b)}),x.delete(Kt.NEED_RESULT_POINT_CALLBACK),t=x}try{var w=g.decodeRow(h,i,t);if(1===y){w.putMetadata(Rr.ORIENTATION,180);var _=w.getResultPoints();null!==_&&(_[0]=new Ne(r-_[0].getX()-1,_[0].getY()),_[1]=new Ne(r-_[1].getX()-1,_[1].getY()))}return{value:w}}catch{}},g=this,v=0;v<2;v++){var m=p(v);if("object"==typeof m)return m.value}}throw new Z},n.recordPattern=function(e,t,r){for(var o=r.length,i=0;i<o;i++)r[i]=0;var a=e.getSize();if(t>=a)throw new Z;for(var s=!e.get(t),u=0,c=t;c<a;){if(e.get(c)!==s)r[u]++;else{if(++u===o)break;r[u]=1,s=!s}c++}if(u!==o&&(u!==o-1||c!==a))throw new Z},n.recordPatternInReverse=function(e,t,r){for(var o=r.length,i=e.get(t);t>0&&o>=0;)e.get(--t)!==i&&(o--,i=!i);if(o>=0)throw new Z;n.recordPattern(e,t+1,r)},n.patternMatchVariance=function(e,t,r){for(var o=e.length,i=0,a=0,s=0;s<o;s++)i+=e[s],a+=t[s];if(i<a)return Number.POSITIVE_INFINITY;var u=i/a;r*=u;for(var c=0,l=0;l<o;l++){var f=e[l],d=t[l]*u,h=f>d?f-d:d-f;if(h>r)return Number.POSITIVE_INFINITY;c+=h}return c/i},n}());const cr=iee;var aee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),see=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return aee(e,n),e.findStartPattern=function(t){for(var r=t.getSize(),o=t.getNextSet(0),i=0,a=Int32Array.from([0,0,0,0,0,0]),s=o,u=!1,l=o;l<r;l++)if(t.get(l)!==u)a[i]++;else{if(5===i){for(var f=e.MAX_AVG_VARIANCE,d=-1,h=e.CODE_START_A;h<=e.CODE_START_C;h++){var p=cr.patternMatchVariance(a,e.CODE_PATTERNS[h],e.MAX_INDIVIDUAL_VARIANCE);p<f&&(f=p,d=h)}if(d>=0&&t.isRange(Math.max(0,s-(l-s)/2),s,!1))return Int32Array.from([s,l,d]);s+=a[0]+a[1],(a=a.slice(2,a.length-1))[i-1]=0,a[i]=0,i--}else i++;a[i]=1,u=!u}throw new Z},e.decodeCode=function(t,r,o){cr.recordPattern(t,o,r);for(var i=e.MAX_AVG_VARIANCE,a=-1,s=0;s<e.CODE_PATTERNS.length;s++){var c=this.patternMatchVariance(r,e.CODE_PATTERNS[s],e.MAX_INDIVIDUAL_VARIANCE);c<i&&(i=c,a=s)}if(a>=0)return a;throw new Z},e.prototype.decodeRow=function(t,r,o){var l,i=o&&!0===o.get(Kt.ASSUME_GS1),a=e.findStartPattern(r),s=a[2],u=0,c=new Uint8Array(20);switch(c[u++]=s,s){case e.CODE_START_A:l=e.CODE_CODE_A;break;case e.CODE_START_B:l=e.CODE_CODE_B;break;case e.CODE_START_C:l=e.CODE_CODE_C;break;default:throw new le}for(var f=!1,d=!1,h="",p=a[0],g=a[1],v=Int32Array.from([0,0,0,0,0,0]),m=0,y=0,x=s,w=0,_=!0,b=!1,C=!1;!f;){var E=d;switch(d=!1,m=y,y=e.decodeCode(r,v,g),c[u++]=y,y!==e.CODE_STOP&&(_=!0),y!==e.CODE_STOP&&(x+=++w*y),p=g,g+=v.reduce(function(H,W){return H+W},0),y){case e.CODE_START_A:case e.CODE_START_B:case e.CODE_START_C:throw new le}switch(l){case e.CODE_CODE_A:if(y<64)h+=String.fromCharCode(C===b?" ".charCodeAt(0)+y:" ".charCodeAt(0)+y+128),C=!1;else if(y<96)h+=String.fromCharCode(C===b?y-64:y+64),C=!1;else switch(y!==e.CODE_STOP&&(_=!1),y){case e.CODE_FNC_1:i&&(h+=0===h.length?"]C1":String.fromCharCode(29));break;case e.CODE_FNC_2:case e.CODE_FNC_3:break;case e.CODE_FNC_4_A:!b&&C?(b=!0,C=!1):b&&C?(b=!1,C=!1):C=!0;break;case e.CODE_SHIFT:d=!0,l=e.CODE_CODE_B;break;case e.CODE_CODE_B:l=e.CODE_CODE_B;break;case e.CODE_CODE_C:l=e.CODE_CODE_C;break;case e.CODE_STOP:f=!0}break;case e.CODE_CODE_B:if(y<96)h+=String.fromCharCode(C===b?" ".charCodeAt(0)+y:" ".charCodeAt(0)+y+128),C=!1;else switch(y!==e.CODE_STOP&&(_=!1),y){case e.CODE_FNC_1:i&&(h+=0===h.length?"]C1":String.fromCharCode(29));break;case e.CODE_FNC_2:case e.CODE_FNC_3:break;case e.CODE_FNC_4_B:!b&&C?(b=!0,C=!1):b&&C?(b=!1,C=!1):C=!0;break;case e.CODE_SHIFT:d=!0,l=e.CODE_CODE_A;break;case e.CODE_CODE_A:l=e.CODE_CODE_A;break;case e.CODE_CODE_C:l=e.CODE_CODE_C;break;case e.CODE_STOP:f=!0}break;case e.CODE_CODE_C:if(y<100)y<10&&(h+="0"),h+=y;else switch(y!==e.CODE_STOP&&(_=!1),y){case e.CODE_FNC_1:i&&(h+=0===h.length?"]C1":String.fromCharCode(29));break;case e.CODE_CODE_A:l=e.CODE_CODE_A;break;case e.CODE_CODE_B:l=e.CODE_CODE_B;break;case e.CODE_STOP:f=!0}}E&&(l=l===e.CODE_CODE_A?e.CODE_CODE_B:e.CODE_CODE_A)}var S=g-p;if(g=r.getNextUnset(g),!r.isRange(g,Math.min(r.getSize(),g+(g-p)/2),!1))throw new Z;if((x-=w*m)%103!==m)throw new Gn;var A=h.length;if(0===A)throw new Z;A>0&&_&&(h=h.substring(0,l===e.CODE_CODE_C?A-2:A-1));for(var D=(a[1]+a[0])/2,M=p+S/2,L=c.length,B=new Uint8Array(L),U=0;U<L;U++)B[U]=c[U];var G=[new Ne(D,t),new Ne(M,t)];return new qr(h,B,0,G,Me.CODE_128,(new Date).getTime())},e.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],e.MAX_AVG_VARIANCE=.25,e.MAX_INDIVIDUAL_VARIANCE=.7,e.CODE_SHIFT=98,e.CODE_CODE_C=99,e.CODE_CODE_B=100,e.CODE_CODE_A=101,e.CODE_FNC_1=102,e.CODE_FNC_2=97,e.CODE_FNC_3=96,e.CODE_FNC_4_A=101,e.CODE_FNC_4_B=100,e.CODE_START_A=103,e.CODE_START_B=104,e.CODE_START_C=105,e.CODE_STOP=106,e}(cr);const FM=see;var uee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),M_=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},cee=function(n){function e(t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var o=n.call(this)||this;return o.usingCheckDigit=t,o.extendedMode=r,o.decodeRowResult="",o.counters=new Int32Array(9),o}return uee(e,n),e.prototype.decodeRow=function(t,r,o){var i,a,s,u,c=this.counters;c.fill(0),this.decodeRowResult="";var h,p,l=e.findAsteriskPattern(r,c),f=r.getNextSet(l[1]),d=r.getSize();do{e.recordPattern(r,f,c);var g=e.toNarrowWidePattern(c);if(g<0)throw new Z;h=e.patternToChar(g),this.decodeRowResult+=h,p=f;try{for(var v=(i=void 0,M_(c)),m=v.next();!m.done;m=v.next())f+=m.value}catch(L){i={error:L}}finally{try{m&&!m.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}f=r.getNextSet(f)}while("*"!==h);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var A,x=0;try{for(var w=M_(c),_=w.next();!_.done;_=w.next())x+=_.value}catch(L){s={error:L}}finally{try{_&&!_.done&&(u=w.return)&&u.call(w)}finally{if(s)throw s.error}}if(f!==d&&2*(f-p-x)<x)throw new Z;if(this.usingCheckDigit){for(var C=this.decodeRowResult.length-1,E=0,S=0;S<C;S++)E+=e.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(S));if(this.decodeRowResult.charAt(C)!==e.ALPHABET_STRING.charAt(E%43))throw new Gn;this.decodeRowResult=this.decodeRowResult.substring(0,C)}if(0===this.decodeRowResult.length)throw new Z;A=this.extendedMode?e.decodeExtended(this.decodeRowResult):this.decodeRowResult;var M=p+x/2;return new qr(A,null,0,[new Ne((l[1]+l[0])/2,t),new Ne(M,t)],Me.CODE_39,(new Date).getTime())},e.findAsteriskPattern=function(t,r){for(var o=t.getSize(),i=t.getNextSet(0),a=0,s=i,u=!1,c=r.length,l=i;l<o;l++)if(t.get(l)!==u)r[a]++;else{if(a===c-1){if(this.toNarrowWidePattern(r)===e.ASTERISK_ENCODING&&t.isRange(Math.max(0,s-Math.floor((l-s)/2)),s,!1))return[s,l];s+=r[0]+r[1],r.copyWithin(0,2,2+a-1),r[a-1]=0,r[a]=0,a--}else a++;r[a]=1,u=!u}throw new Z},e.toNarrowWidePattern=function(t){var r,o,s,i=t.length,a=0;do{var u=2147483647;try{for(var c=(r=void 0,M_(t)),l=c.next();!l.done;l=c.next())(f=l.value)<u&&f>a&&(u=f)}catch(g){r={error:g}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}a=u,s=0;for(var d=0,h=0,p=0;p<i;p++)(f=t[p])>a&&(h|=1<<i-1-p,s++,d+=f);if(3===s){for(p=0;p<i&&s>0;p++){var f;if((f=t[p])>a&&(s--,2*f>=d))return-1}return h}}while(s>3);return-1},e.patternToChar=function(t){for(var r=0;r<e.CHARACTER_ENCODINGS.length;r++)if(e.CHARACTER_ENCODINGS[r]===t)return e.ALPHABET_STRING.charAt(r);if(t===e.ASTERISK_ENCODING)return"*";throw new Z},e.decodeExtended=function(t){for(var r=t.length,o="",i=0;i<r;i++){var a=t.charAt(i);if("+"===a||"$"===a||"%"===a||"/"===a){var s=t.charAt(i+1),u="\0";switch(a){case"+":if(!(s>="A"&&s<="Z"))throw new le;u=String.fromCharCode(s.charCodeAt(0)+32);break;case"$":if(!(s>="A"&&s<="Z"))throw new le;u=String.fromCharCode(s.charCodeAt(0)-64);break;case"%":if(s>="A"&&s<="E")u=String.fromCharCode(s.charCodeAt(0)-38);else if(s>="F"&&s<="J")u=String.fromCharCode(s.charCodeAt(0)-11);else if(s>="K"&&s<="O")u=String.fromCharCode(s.charCodeAt(0)+16);else if(s>="P"&&s<="T")u=String.fromCharCode(s.charCodeAt(0)+43);else if("U"===s)u="\0";else if("V"===s)u="@";else if("W"===s)u="`";else{if("X"!==s&&"Y"!==s&&"Z"!==s)throw new le;u="\x7f"}break;case"/":if(s>="A"&&s<="O")u=String.fromCharCode(s.charCodeAt(0)-32);else{if("Z"!==s)throw new le;u=":"}}o+=u,i++}else o+=a}return o},e.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",e.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],e.ASTERISK_ENCODING=148,e}(cr);const LM=cee;var lee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),P_=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},fee=function(n){function e(){var t=n.call(this)||this;return t.decodeRowResult="",t.counters=new Int32Array(6),t}return lee(e,n),e.prototype.decodeRow=function(t,r,o){var i,a,s,u,h,p,c=this.findAsteriskPattern(r),l=r.getNextSet(c[1]),f=r.getSize(),d=this.counters;d.fill(0),this.decodeRowResult="";do{e.recordPattern(r,l,d);var g=this.toPattern(d);if(g<0)throw new Z;h=this.patternToChar(g),this.decodeRowResult+=h,p=l;try{for(var v=(i=void 0,P_(d)),m=v.next();!m.done;m=v.next())l+=m.value}catch(S){i={error:S}}finally{try{m&&!m.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}l=r.getNextSet(l)}while("*"!==h);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var x=0;try{for(var w=P_(d),_=w.next();!_.done;_=w.next())x+=_.value}catch(S){s={error:S}}finally{try{_&&!_.done&&(u=w.return)&&u.call(w)}finally{if(s)throw s.error}}if(l===f||!r.get(l))throw new Z;if(this.decodeRowResult.length<2)throw new Z;this.checkChecksums(this.decodeRowResult),this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-2);var b=this.decodeExtended(this.decodeRowResult),E=p+x/2;return new qr(b,null,0,[new Ne((c[1]+c[0])/2,t),new Ne(E,t)],Me.CODE_93,(new Date).getTime())},e.prototype.findAsteriskPattern=function(t){var r=t.getSize(),o=t.getNextSet(0);this.counters.fill(0);for(var i=this.counters,a=o,s=!1,u=i.length,c=0,l=o;l<r;l++)if(t.get(l)!==s)i[c]++;else{if(c===u-1){if(this.toPattern(i)===e.ASTERISK_ENCODING)return new Int32Array([a,l]);a+=i[0]+i[1],i.copyWithin(0,2,2+c-1),i[c-1]=0,i[c]=0,c--}else c++;i[c]=1,s=!s}throw new Z},e.prototype.toPattern=function(t){var r,o,i=0;try{for(var a=P_(t),s=a.next();!s.done;s=a.next())i+=s.value}catch(p){r={error:p}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}for(var c=0,l=t.length,f=0;f<l;f++){var d=Math.round(9*t[f]/i);if(d<1||d>4)return-1;if(1&f)c<<=d;else for(var h=0;h<d;h++)c=c<<1|1}return c},e.prototype.patternToChar=function(t){for(var r=0;r<e.CHARACTER_ENCODINGS.length;r++)if(e.CHARACTER_ENCODINGS[r]===t)return e.ALPHABET_STRING.charAt(r);throw new Z},e.prototype.decodeExtended=function(t){for(var r=t.length,o="",i=0;i<r;i++){var a=t.charAt(i);if(a>="a"&&a<="d"){if(i>=r-1)throw new le;var s=t.charAt(i+1),u="\0";switch(a){case"d":if(!(s>="A"&&s<="Z"))throw new le;u=String.fromCharCode(s.charCodeAt(0)+32);break;case"a":if(!(s>="A"&&s<="Z"))throw new le;u=String.fromCharCode(s.charCodeAt(0)-64);break;case"b":if(s>="A"&&s<="E")u=String.fromCharCode(s.charCodeAt(0)-38);else if(s>="F"&&s<="J")u=String.fromCharCode(s.charCodeAt(0)-11);else if(s>="K"&&s<="O")u=String.fromCharCode(s.charCodeAt(0)+16);else if(s>="P"&&s<="T")u=String.fromCharCode(s.charCodeAt(0)+43);else if("U"===s)u="\0";else if("V"===s)u="@";else if("W"===s)u="`";else{if(!(s>="X"&&s<="Z"))throw new le;u=String.fromCharCode(127)}break;case"c":if(s>="A"&&s<="O")u=String.fromCharCode(s.charCodeAt(0)-32);else{if("Z"!==s)throw new le;u=":"}}o+=u,i++}else o+=a}return o},e.prototype.checkChecksums=function(t){var r=t.length;this.checkOneChecksum(t,r-2,20),this.checkOneChecksum(t,r-1,15)},e.prototype.checkOneChecksum=function(t,r,o){for(var i=1,a=0,s=r-1;s>=0;s--)a+=i*e.ALPHABET_STRING.indexOf(t.charAt(s)),++i>o&&(i=1);if(t.charAt(r)!==e.ALPHABET_STRING[a%47])throw new Gn},e.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%abcd*",e.ASTERISK_ENCODING=(e.CHARACTER_ENCODINGS=[276,328,324,322,296,292,290,336,274,266,424,420,418,404,402,394,360,356,354,308,282,344,332,326,300,278,436,434,428,422,406,410,364,358,310,314,302,468,466,458,366,374,430,294,474,470,306,350])[47],e}(cr);const BM=fee;var dee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),pee=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.narrowLineWidth=-1,t}return dee(e,n),e.prototype.decodeRow=function(t,r,o){var i,a,s=this.decodeStart(r),u=this.decodeEnd(r),c=new ct;e.decodeMiddle(r,s[1],u[0],c);var l=c.toString(),f=null;null!=o&&(f=o.get(Kt.ALLOWED_LENGTHS)),null==f&&(f=e.DEFAULT_ALLOWED_LENGTHS);var d=l.length,h=!1,p=0;try{for(var g=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(f),v=g.next();!v.done;v=g.next()){var m=v.value;if(d===m){h=!0;break}m>p&&(p=m)}}catch(w){i={error:w}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}if(!h&&d>p&&(h=!0),!h)throw new le;var y=[new Ne(s[1],t),new Ne(u[0],t)];return new qr(l,null,0,y,Me.ITF,(new Date).getTime())},e.decodeMiddle=function(t,r,o,i){var a=new Int32Array(10),s=new Int32Array(5),u=new Int32Array(5);for(a.fill(0),s.fill(0),u.fill(0);r<o;){cr.recordPattern(t,r,a);for(var c=0;c<5;c++){var l=2*c;s[c]=a[l],u[c]=a[l+1]}var f=e.decodeDigit(s);i.append(f.toString()),f=this.decodeDigit(u),i.append(f.toString()),a.forEach(function(d){r+=d})}},e.prototype.decodeStart=function(t){var r=e.skipWhiteSpace(t),o=e.findGuardPattern(t,r,e.START_PATTERN);return this.narrowLineWidth=(o[1]-o[0])/4,this.validateQuietZone(t,o[0]),o},e.prototype.validateQuietZone=function(t,r){var o=10*this.narrowLineWidth;o=o<r?o:r;for(var i=r-1;o>0&&i>=0&&!t.get(i);i--)o--;if(0!==o)throw new Z},e.skipWhiteSpace=function(t){var r=t.getSize(),o=t.getNextSet(0);if(o===r)throw new Z;return o},e.prototype.decodeEnd=function(t){t.reverse();try{var r=e.skipWhiteSpace(t),o=void 0;try{o=e.findGuardPattern(t,r,e.END_PATTERN_REVERSED[0])}catch(a){a instanceof Z&&(o=e.findGuardPattern(t,r,e.END_PATTERN_REVERSED[1]))}this.validateQuietZone(t,o[0]);var i=o[0];return o[0]=t.getSize()-o[1],o[1]=t.getSize()-i,o}finally{t.reverse()}},e.findGuardPattern=function(t,r,o){var i=o.length,a=new Int32Array(i),s=t.getSize(),u=!1,c=0,l=r;a.fill(0);for(var f=r;f<s;f++)if(t.get(f)!==u)a[c]++;else{if(c===i-1){if(cr.patternMatchVariance(a,o,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return[l,f];l+=a[0]+a[1],cn.arraycopy(a,2,a,0,c-1),a[c-1]=0,a[c]=0,c--}else c++;a[c]=1,u=!u}throw new Z},e.decodeDigit=function(t){for(var r=e.MAX_AVG_VARIANCE,o=-1,i=e.PATTERNS.length,a=0;a<i;a++){var u=cr.patternMatchVariance(t,e.PATTERNS[a],e.MAX_INDIVIDUAL_VARIANCE);u<r?(r=u,o=a):u===r&&(o=-1)}if(o>=0)return o%10;throw new Z},e.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],e.MAX_AVG_VARIANCE=.38,e.MAX_INDIVIDUAL_VARIANCE=.5,e.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],e.START_PATTERN=Int32Array.from([1,1,1,1]),e.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])],e}(cr);const VM=pee;var gee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),vee=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.decodeRowStringBuffer="",t}return gee(e,n),e.findStartGuardPattern=function(t){for(var o,r=!1,i=0,a=Int32Array.from([0,0,0]);!r;){a=Int32Array.from([0,0,0]);var s=(o=e.findGuardPattern(t,i,!1,this.START_END_PATTERN,a))[0],u=s-((i=o[1])-s);u>=0&&(r=t.isRange(u,s,!1))}return o},e.checkChecksum=function(t){return e.checkStandardUPCEANChecksum(t)},e.checkStandardUPCEANChecksum=function(t){var r=t.length;if(0===r)return!1;var o=parseInt(t.charAt(r-1),10);return e.getStandardUPCEANChecksum(t.substring(0,r-1))===o},e.getStandardUPCEANChecksum=function(t){for(var r=t.length,o=0,i=r-1;i>=0;i-=2){if((a=t.charAt(i).charCodeAt(0)-"0".charCodeAt(0))<0||a>9)throw new le;o+=a}for(o*=3,i=r-2;i>=0;i-=2){var a;if((a=t.charAt(i).charCodeAt(0)-"0".charCodeAt(0))<0||a>9)throw new le;o+=a}return(1e3-o)%10},e.decodeEnd=function(t,r){return e.findGuardPattern(t,r,!1,e.START_END_PATTERN,new Int32Array(e.START_END_PATTERN.length).fill(0))},e.findGuardPatternWithoutCounters=function(t,r,o,i){return this.findGuardPattern(t,r,o,i,new Int32Array(i.length))},e.findGuardPattern=function(t,r,o,i,a){for(var s=t.getSize(),u=0,c=r=o?t.getNextUnset(r):t.getNextSet(r),l=i.length,f=o,d=r;d<s;d++)if(t.get(d)!==f)a[u]++;else{if(u===l-1){if(cr.patternMatchVariance(a,i,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return Int32Array.from([c,d]);c+=a[0]+a[1];for(var h=a.slice(2,a.length),p=0;p<u-1;p++)a[p]=h[p];a[u-1]=0,a[u]=0,u--}else u++;a[u]=1,f=!f}throw new Z},e.decodeDigit=function(t,r,o,i){this.recordPattern(t,o,r);for(var a=this.MAX_AVG_VARIANCE,s=-1,u=i.length,c=0;c<u;c++){var f=cr.patternMatchVariance(r,i[c],e.MAX_INDIVIDUAL_VARIANCE);f<a&&(a=f,s=c)}if(s>=0)return s;throw new Z},e.MAX_AVG_VARIANCE=.48,e.MAX_INDIVIDUAL_VARIANCE=.7,e.START_END_PATTERN=Int32Array.from([1,1,1]),e.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),e.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),e.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])],e}(cr);const hf=vee;var mee=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yee=function(){function n(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return n.prototype.decodeRow=function(e,t,r){var o=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,o),a=o.toString(),s=n.parseExtensionString(a),u=[new Ne((r[0]+r[1])/2,e),new Ne(i,e)],c=new qr(a,null,0,u,Me.UPC_EAN_EXTENSION,(new Date).getTime());return null!=s&&c.putAllMetadata(s),c},n.prototype.decodeMiddle=function(e,t,r){var o,i,a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;for(var s=e.getSize(),u=t[1],c=0,l=0;l<5&&u<s;l++){var f=hf.decodeDigit(e,a,u,hf.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+f%10);try{for(var d=(o=void 0,mee(a)),h=d.next();!h.done;h=d.next())u+=h.value}catch(v){o={error:v}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}f>=10&&(c|=1<<4-l),4!==l&&(u=e.getNextSet(u),u=e.getNextUnset(u))}if(5!==r.length)throw new Z;var g=this.determineCheckDigit(c);if(n.extensionChecksum(r.toString())!==g)throw new Z;return u},n.extensionChecksum=function(e){for(var t=e.length,r=0,o=t-2;o>=0;o-=2)r+=e.charAt(o).charCodeAt(0)-"0".charCodeAt(0);for(r*=3,o=t-1;o>=0;o-=2)r+=e.charAt(o).charCodeAt(0)-"0".charCodeAt(0);return(r*=3)%10},n.prototype.determineCheckDigit=function(e){for(var t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new Z},n.parseExtensionString=function(e){if(5!==e.length)return null;var t=n.parseExtension5String(e);return null==t?null:new Map([[Rr.SUGGESTED_PRICE,t]])},n.parseExtension5String=function(e){var t;switch(e.charAt(0)){case"0":t="\xa3";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}var r=parseInt(e.substring(1)),i=r%100;return t+(r/100).toString()+"."+(i<10?"0"+i:i.toString())},n}();const xee=yee;var wee=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_ee=function(){function n(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return n.prototype.decodeRow=function(e,t,r){var o=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,o),a=o.toString(),s=n.parseExtensionString(a),u=[new Ne((r[0]+r[1])/2,e),new Ne(i,e)],c=new qr(a,null,0,u,Me.UPC_EAN_EXTENSION,(new Date).getTime());return null!=s&&c.putAllMetadata(s),c},n.prototype.decodeMiddle=function(e,t,r){var o,i,a=this.decodeMiddleCounters;a[0]=0,a[1]=0,a[2]=0,a[3]=0;for(var s=e.getSize(),u=t[1],c=0,l=0;l<2&&u<s;l++){var f=hf.decodeDigit(e,a,u,hf.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+f%10);try{for(var d=(o=void 0,wee(a)),h=d.next();!h.done;h=d.next())u+=h.value}catch(g){o={error:g}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}f>=10&&(c|=1<<1-l),1!==l&&(u=e.getNextSet(u),u=e.getNextUnset(u))}if(2!==r.length)throw new Z;if(parseInt(r.toString())%4!==c)throw new Z;return u},n.parseExtensionString=function(e){return 2!==e.length?null:new Map([[Rr.ISSUE_NUMBER,parseInt(e)]])},n}();const bee=_ee;var Cee=function(){function n(){}return n.decodeRow=function(e,t,r){var o=hf.findGuardPattern(t,r,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new xee).decodeRow(e,t,o)}catch{return(new bee).decodeRow(e,t,o)}},n.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]),n}();const Eee=Cee;var See=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Aee=function(n){function e(){var t=n.call(this)||this;t.decodeRowStringBuffer="",e.L_AND_G_PATTERNS=e.L_PATTERNS.map(function(s){return Int32Array.from(s)});for(var r=10;r<20;r++){for(var o=e.L_PATTERNS[r-10],i=new Int32Array(o.length),a=0;a<o.length;a++)i[a]=o[o.length-a-1];e.L_AND_G_PATTERNS[r]=i}return t}return See(e,n),e.prototype.decodeRow=function(t,r,o){var i=e.findStartGuardPattern(r),a=null==o?null:o.get(Kt.NEED_RESULT_POINT_CALLBACK);if(null!=a){var s=new Ne((i[0]+i[1])/2,t);a.foundPossibleResultPoint(s)}var u=this.decodeMiddle(r,i,this.decodeRowStringBuffer),c=u.rowOffset,l=u.resultString;if(null!=a){var f=new Ne(c,t);a.foundPossibleResultPoint(f)}var d=e.decodeEnd(r,c);if(null!=a){var h=new Ne((d[0]+d[1])/2,t);a.foundPossibleResultPoint(h)}var p=d[1],g=p+(p-d[0]);if(g>=r.getSize()||!r.isRange(p,g,!1))throw new Z;var v=l.toString();if(v.length<8)throw new le;if(!e.checkChecksum(v))throw new Gn;var m=(i[1]+i[0])/2,y=(d[1]+d[0])/2,x=this.getBarcodeFormat(),w=[new Ne(m,t),new Ne(y,t)],_=new qr(v,null,0,w,x,(new Date).getTime()),b=0;try{var C=Eee.decodeRow(t,r,d[1]);_.putMetadata(Rr.UPC_EAN_EXTENSION,C.getText()),_.putAllMetadata(C.getResultMetadata()),_.addResultPoints(C.getResultPoints()),b=C.getText().length}catch{}var E=null==o?null:o.get(Kt.ALLOWED_EAN_EXTENSIONS);if(null!=E){var S=!1;for(var A in E)if(b.toString()===A){S=!0;break}if(!S)throw new Z}return _},e.checkChecksum=function(t){return e.checkStandardUPCEANChecksum(t)},e.checkStandardUPCEANChecksum=function(t){var r=t.length;if(0===r)return!1;var o=parseInt(t.charAt(r-1),10);return e.getStandardUPCEANChecksum(t.substring(0,r-1))===o},e.getStandardUPCEANChecksum=function(t){for(var r=t.length,o=0,i=r-1;i>=0;i-=2){if((a=t.charAt(i).charCodeAt(0)-"0".charCodeAt(0))<0||a>9)throw new le;o+=a}for(o*=3,i=r-2;i>=0;i-=2){var a;if((a=t.charAt(i).charCodeAt(0)-"0".charCodeAt(0))<0||a>9)throw new le;o+=a}return(1e3-o)%10},e.decodeEnd=function(t,r){return e.findGuardPattern(t,r,!1,e.START_END_PATTERN,new Int32Array(e.START_END_PATTERN.length).fill(0))},e}(hf);const lr=Aee;var Iee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),UM=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dee=function(n){function e(){var t=n.call(this)||this;return t.decodeMiddleCounters=Int32Array.from([0,0,0,0]),t}return Iee(e,n),e.prototype.decodeMiddle=function(t,r,o){var i,a,s,u,c=this.decodeMiddleCounters;c[0]=0,c[1]=0,c[2]=0,c[3]=0;for(var l=t.getSize(),f=r[1],d=0,h=0;h<6&&f<l;h++){var p=lr.decodeDigit(t,c,f,lr.L_AND_G_PATTERNS);o+=String.fromCharCode("0".charCodeAt(0)+p%10);try{for(var g=(i=void 0,UM(c)),v=g.next();!v.done;v=g.next())f+=v.value}catch(_){i={error:_}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}p>=10&&(d|=1<<5-h)}for(o=e.determineFirstDigit(o,d),f=lr.findGuardPattern(t,f,!0,lr.MIDDLE_PATTERN,new Int32Array(lr.MIDDLE_PATTERN.length).fill(0))[1],h=0;h<6&&f<l;h++){p=lr.decodeDigit(t,c,f,lr.L_PATTERNS),o+=String.fromCharCode("0".charCodeAt(0)+p);try{for(var x=(s=void 0,UM(c)),w=x.next();!w.done;w=x.next())f+=w.value}catch(C){s={error:C}}finally{try{w&&!w.done&&(u=x.return)&&u.call(x)}finally{if(s)throw s.error}}}return{rowOffset:f,resultString:o}},e.prototype.getBarcodeFormat=function(){return Me.EAN_13},e.determineFirstDigit=function(t,r){for(var o=0;o<10;o++)if(r===this.FIRST_DIGIT_ENCODINGS[o])return String.fromCharCode("0".charCodeAt(0)+o)+t;throw new Z},e.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26],e}(lr);const k_=Dee;var Tee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),HM=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ree=function(n){function e(){var t=n.call(this)||this;return t.decodeMiddleCounters=Int32Array.from([0,0,0,0]),t}return Tee(e,n),e.prototype.decodeMiddle=function(t,r,o){var i,a,s,u,c=this.decodeMiddleCounters;c[0]=0,c[1]=0,c[2]=0,c[3]=0;for(var l=t.getSize(),f=r[1],d=0;d<4&&f<l;d++){var h=lr.decodeDigit(t,c,f,lr.L_PATTERNS);o+=String.fromCharCode("0".charCodeAt(0)+h);try{for(var p=(i=void 0,HM(c)),g=p.next();!g.done;g=p.next())f+=g.value}catch(w){i={error:w}}finally{try{g&&!g.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}for(f=lr.findGuardPattern(t,f,!0,lr.MIDDLE_PATTERN,new Int32Array(lr.MIDDLE_PATTERN.length).fill(0))[1],d=0;d<4&&f<l;d++){h=lr.decodeDigit(t,c,f,lr.L_PATTERNS),o+=String.fromCharCode("0".charCodeAt(0)+h);try{for(var y=(s=void 0,HM(c)),x=y.next();!x.done;x=y.next())f+=x.value}catch(b){s={error:b}}finally{try{x&&!x.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}}return{rowOffset:f,resultString:o}},e.prototype.getBarcodeFormat=function(){return Me.EAN_8},e}(lr);const WM=Ree;var Nee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Oee=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.ean13Reader=new k_,t}return Nee(e,n),e.prototype.getBarcodeFormat=function(){return Me.UPC_A},e.prototype.decode=function(t,r){return this.maybeReturnResult(this.ean13Reader.decode(t))},e.prototype.decodeRow=function(t,r,o){return this.maybeReturnResult(this.ean13Reader.decodeRow(t,r,o))},e.prototype.decodeMiddle=function(t,r,o){return this.ean13Reader.decodeMiddle(t,r,o)},e.prototype.maybeReturnResult=function(t){var r=t.getText();if("0"===r.charAt(0)){var o=new qr(r.substring(1),null,null,t.getResultPoints(),Me.UPC_A);return null!=t.getResultMetadata()&&o.putAllMetadata(t.getResultMetadata()),o}throw new Z},e.prototype.reset=function(){this.ean13Reader.reset()},e}(lr);const GM=Oee;var Mee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Pee=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},kee=function(n){function e(){var t=n.call(this)||this;return t.decodeMiddleCounters=new Int32Array(4),t}return Mee(e,n),e.prototype.decodeMiddle=function(t,r,o){var i,a,s=this.decodeMiddleCounters.map(function(v){return v});s[0]=0,s[1]=0,s[2]=0,s[3]=0;for(var u=t.getSize(),c=r[1],l=0,f=0;f<6&&c<u;f++){var d=e.decodeDigit(t,s,c,e.L_AND_G_PATTERNS);o+=String.fromCharCode("0".charCodeAt(0)+d%10);try{for(var h=(i=void 0,Pee(s)),p=h.next();!p.done;p=h.next())c+=p.value}catch(v){i={error:v}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}d>=10&&(l|=1<<5-f)}return e.determineNumSysAndCheckDigit(new ct(o),l),c},e.prototype.decodeEnd=function(t,r){return e.findGuardPatternWithoutCounters(t,r,!0,e.MIDDLE_END_PATTERN)},e.prototype.checkChecksum=function(t){return lr.checkChecksum(e.convertUPCEtoUPCA(t))},e.determineNumSysAndCheckDigit=function(t,r){for(var o=0;o<=1;o++)for(var i=0;i<10;i++)if(r===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[o][i])return t.insert(0,"0"+o),void t.append("0"+i);throw Z.getNotFoundInstance()},e.prototype.getBarcodeFormat=function(){return Me.UPC_E},e.convertUPCEtoUPCA=function(t){var r=t.slice(1,7).split("").map(function(a){return a.charCodeAt(0)}),o=new ct;o.append(t.charAt(0));var i=r[5];switch(i){case 0:case 1:case 2:o.appendChars(r,0,2),o.append(i),o.append("0000"),o.appendChars(r,2,3);break;case 3:o.appendChars(r,0,3),o.append("00000"),o.appendChars(r,3,2);break;case 4:o.appendChars(r,0,4),o.append("00000"),o.append(r[4]);break;default:o.appendChars(r,0,5),o.append("0000"),o.append(i)}return t.length>=8&&o.append(t.charAt(7)),o.toString()},e.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),e.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,1])],e}(lr);const zM=kee;var Fee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),jM=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Lee=function(n){function e(t){var r=n.call(this)||this,o=null==t?null:t.get(Kt.POSSIBLE_FORMATS),i=[];return null!=o&&(o.indexOf(Me.EAN_13)>-1&&i.push(new k_),o.indexOf(Me.UPC_A)>-1&&i.push(new GM),o.indexOf(Me.EAN_8)>-1&&i.push(new WM),o.indexOf(Me.UPC_E)>-1&&i.push(new zM)),0===i.length&&(i.push(new k_),i.push(new GM),i.push(new WM),i.push(new zM)),r.readers=i,r}return Fee(e,n),e.prototype.decodeRow=function(t,r,o){var i,a;try{for(var s=jM(this.readers),u=s.next();!u.done;u=s.next()){var c=u.value;try{var l=c.decodeRow(t,r,o),f=l.getBarcodeFormat()===Me.EAN_13&&"0"===l.getText().charAt(0),d=null==o?null:o.get(Kt.POSSIBLE_FORMATS),h=null==d||d.includes(Me.UPC_A);if(f&&h){var p=l.getRawBytes(),g=new qr(l.getText().substring(1),p,p?p.length:null,l.getResultPoints(),Me.UPC_A);return g.putAllMetadata(l.getResultMetadata()),g}return l}catch{}}}catch(v){i={error:v}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}throw new Z},e.prototype.reset=function(){var t,r;try{for(var o=jM(this.readers),i=o.next();!i.done;i=o.next())i.value.reset()}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e}(cr);const F_=Lee;var Bee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vee=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.CODA_BAR_CHAR_SET={nnnnnww:"0",nnnnwwn:"1",nnnwnnw:"2",wwnnnnn:"3",nnwnnwn:"4",wnnnnwn:"5",nwnnnnw:"6",nwnnwnn:"7",nwwnnnn:"8",wnnwnnn:"9",nnnwwnn:"-",nnwwnnn:"$",wnnnwnw:":",wnwnnnw:"/",wnwnwnn:".",nnwwwww:"+",nnwwnwn:"A",nwnwnnw:"B",nnnwnww:"C",nnnwwwn:"D"},t}return Bee(e,n),e.prototype.decodeRow=function(t,r,o){var i=this.getValidRowData(r);if(!i)throw new Z;var a=this.codaBarDecodeRow(i.row);if(!a)throw new Z;return new qr(a,null,0,[new Ne(i.left,t),new Ne(i.right,t)],Me.CODABAR,(new Date).getTime())},e.prototype.getValidRowData=function(t){var r=t.toArray(),o=r.indexOf(!0);if(-1===o)return null;var i=r.lastIndexOf(!0);if(i<=o)return null;for(var a=[],s=(r=r.slice(o,i+1))[0],u=1,c=1;c<r.length;c++)r[c]===s?u++:(s=r[c],a.push(u),u=1);return a.push(u),a.length<23&&(a.length+1)%8!=0?null:{row:a,left:o,right:i}},e.prototype.codaBarDecodeRow=function(t){for(var r=[],o=Math.ceil(t.reduce(function(u,c){return(u+c)/2},0));t.length>0;){var a=t.splice(0,8).splice(0,7).map(function(u){return u<o?"n":"w"}).join("");if(void 0===this.CODA_BAR_CHAR_SET[a])return null;r.push(this.CODA_BAR_CHAR_SET[a])}var s=r.join("");return this.validCodaBarString(s)?s:null},e.prototype.validCodaBarString=function(t){return/^[A-D].{1,}[A-D]$/.test(t)},e}(cr);const Uee=Vee;var Hee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gee=function(n){function e(){var t=n.call(this)||this;return t.decodeFinderCounters=new Int32Array(4),t.dataCharacterCounters=new Int32Array(8),t.oddRoundingErrors=new Array(4),t.evenRoundingErrors=new Array(4),t.oddCounts=new Array(t.dataCharacterCounters.length/2),t.evenCounts=new Array(t.dataCharacterCounters.length/2),t}return Hee(e,n),e.prototype.getDecodeFinderCounters=function(){return this.decodeFinderCounters},e.prototype.getDataCharacterCounters=function(){return this.dataCharacterCounters},e.prototype.getOddRoundingErrors=function(){return this.oddRoundingErrors},e.prototype.getEvenRoundingErrors=function(){return this.evenRoundingErrors},e.prototype.getOddCounts=function(){return this.oddCounts},e.prototype.getEvenCounts=function(){return this.evenCounts},e.prototype.parseFinderValue=function(t,r){for(var o=0;o<r.length;o++)if(cr.patternMatchVariance(t,r[o],e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return o;throw new Z},e.count=function(t){return Pt.sum(new Int32Array(t))},e.increment=function(t,r){for(var o=0,i=r[0],a=1;a<t.length;a++)r[a]>i&&(i=r[a],o=a);t[o]++},e.decrement=function(t,r){for(var o=0,i=r[0],a=1;a<t.length;a++)r[a]<i&&(i=r[a],o=a);t[o]--},e.isFinderPattern=function(t){var r,o,i=t[0]+t[1],s=i/(i+t[2]+t[3]);if(s>=e.MIN_FINDER_PATTERN_RATIO&&s<=e.MAX_FINDER_PATTERN_RATIO){var u=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;try{for(var l=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),f=l.next();!f.done;f=l.next()){var d=f.value;d>c&&(c=d),d<u&&(u=d)}}catch(h){r={error:h}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return c<10*u}return!1},e.MAX_AVG_VARIANCE=.2,e.MAX_INDIVIDUAL_VARIANCE=.45,e.MIN_FINDER_PATTERN_RATIO=9.5/12,e.MAX_FINDER_PATTERN_RATIO=12.5/14,e}(cr);const mc=Gee;var zee=function(){function n(e,t){this.value=e,this.checksumPortion=t}return n.prototype.getValue=function(){return this.value},n.prototype.getChecksumPortion=function(){return this.checksumPortion},n.prototype.toString=function(){return this.value+"("+this.checksumPortion+")"},n.prototype.equals=function(e){return e instanceof n&&(this.value===e.value&&this.checksumPortion===e.checksumPortion)},n.prototype.hashCode=function(){return this.value^this.checksumPortion},n}();const g0=zee;var jee=function(){function n(e,t,r,o,i){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new Ne(r,i)),this.resultPoints.push(new Ne(o,i))}return n.prototype.getValue=function(){return this.value},n.prototype.getStartEnd=function(){return this.startEnd},n.prototype.getResultPoints=function(){return this.resultPoints},n.prototype.equals=function(e){return e instanceof n&&this.value===e.value},n.prototype.hashCode=function(){return this.value},n}();const $M=jee;var qee=function(){function n(){}return n.getRSSvalue=function(e,t,r){var o,i,a=0;try{for(var s=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),u=s.next();!u.done;u=s.next())a+=u.value}catch(y){o={error:y}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}for(var l=0,f=0,d=e.length,h=0;h<d-1;h++){var p=void 0;for(p=1,f|=1<<h;p<e[h];p++,f&=~(1<<h)){var g=n.combins(a-p-1,d-h-2);if(r&&0===f&&a-p-(d-h-1)>=d-h-1&&(g-=n.combins(a-p-(d-h),d-h-2)),d-h-1>1){for(var v=0,m=a-p-(d-h-2);m>t;m--)v+=n.combins(a-p-m-1,d-h-3);g-=v*(d-1-h)}else a-p>t&&g--;l+=g}a-=p}return l},n.combins=function(e,t){var r,o;e-t>t?(o=t,r=e-t):(o=e-t,r=t);for(var i=1,a=1,s=e;s>r;s--)i*=s,a<=o&&(i/=a,a++);for(;a<=o;)i/=a,a++;return i},n}();const pf=qee;var Xee=function(){function n(){}return n.buildBitArray=function(e){var t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);for(var o=new vr(12*t),i=0,s=e[0].getRightChar().getValue(),u=11;u>=0;--u)s&1<<u&&o.set(i),i++;for(u=1;u<e.length;++u){for(var c=e[u],l=c.getLeftChar().getValue(),f=11;f>=0;--f)l&1<<f&&o.set(i),i++;if(null!==c.getRightChar()){var d=c.getRightChar().getValue();for(f=11;f>=0;--f)d&1<<f&&o.set(i),i++}}return o},n}();const Kee=Xee;var Yee=function(){function n(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}return n.prototype.getDecodedInformation=function(){return this.decodedInformation},n.prototype.isFinished=function(){return this.finished},n}();const yc=Yee;var Zee=function(){function n(e){this.newPosition=e}return n.prototype.getNewPosition=function(){return this.newPosition},n}();const L_=Zee;var Qee=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Jee=function(n){function e(t,r){var o=n.call(this,t)||this;return o.value=r,o}return Qee(e,n),e.prototype.getValue=function(){return this.value},e.prototype.isFNC1=function(){return this.value===e.FNC1},e.FNC1="$",e}(L_);const Zi=Jee;var ete=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),tte=function(n){function e(t,r,o){var i=n.call(this,t)||this;return o?(i.remaining=!0,i.remainingValue=i.remainingValue):(i.remaining=!1,i.remainingValue=0),i.newString=r,i}return ete(e,n),e.prototype.getNewString=function(){return this.newString},e.prototype.isRemaining=function(){return this.remaining},e.prototype.getRemainingValue=function(){return this.remainingValue},e}(L_);const xc=tte;var nte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),rte=function(n){function e(t,r,o){var i=n.call(this,t)||this;if(r<0||r>10||o<0||o>10)throw new le;return i.firstDigit=r,i.secondDigit=o,i}return nte(e,n),e.prototype.getFirstDigit=function(){return this.firstDigit},e.prototype.getSecondDigit=function(){return this.secondDigit},e.prototype.getValue=function(){return 10*this.firstDigit+this.secondDigit},e.prototype.isFirstDigitFNC1=function(){return this.firstDigit===e.FNC1},e.prototype.isSecondDigitFNC1=function(){return this.secondDigit===e.FNC1},e.prototype.isAnyFNC1=function(){return this.firstDigit===e.FNC1||this.secondDigit===e.FNC1},e.FNC1=10,e}(L_);const gf=rte;var v0=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ote=function(){function n(){}return n.parseFieldsInGeneralPurpose=function(e){var t,r,o,i,a,s,u,c;if(!e)return null;if(e.length<2)throw new Z;var l=e.substring(0,2);try{for(var f=v0(n.TWO_DIGIT_DATA_LENGTH),d=f.next();!d.done;d=f.next())if((h=d.value)[0]===l)return h[1]===n.VARIABLE_LENGTH?n.processVariableAI(2,h[2],e):n.processFixedAI(2,h[1],e)}catch(b){t={error:b}}finally{try{d&&!d.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}if(e.length<3)throw new Z;var p=e.substring(0,3);try{for(var g=v0(n.THREE_DIGIT_DATA_LENGTH),v=g.next();!v.done;v=g.next())if((h=v.value)[0]===p)return h[1]===n.VARIABLE_LENGTH?n.processVariableAI(3,h[2],e):n.processFixedAI(3,h[1],e)}catch(b){o={error:b}}finally{try{v&&!v.done&&(i=g.return)&&i.call(g)}finally{if(o)throw o.error}}try{for(var m=v0(n.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH),y=m.next();!y.done;y=m.next())if((h=y.value)[0]===p)return h[1]===n.VARIABLE_LENGTH?n.processVariableAI(4,h[2],e):n.processFixedAI(4,h[1],e)}catch(b){a={error:b}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(a)throw a.error}}if(e.length<4)throw new Z;var x=e.substring(0,4);try{for(var w=v0(n.FOUR_DIGIT_DATA_LENGTH),_=w.next();!_.done;_=w.next()){var h;if((h=_.value)[0]===x)return h[1]===n.VARIABLE_LENGTH?n.processVariableAI(4,h[2],e):n.processFixedAI(4,h[1],e)}}catch(b){u={error:b}}finally{try{_&&!_.done&&(c=w.return)&&c.call(w)}finally{if(u)throw u.error}}throw new Z},n.processFixedAI=function(e,t,r){if(r.length<e)throw new Z;var o=r.substring(0,e);if(r.length<e+t)throw new Z;var i=r.substring(e,e+t),a=r.substring(e+t),s="("+o+")"+i,u=n.parseFieldsInGeneralPurpose(a);return null==u?s:s+u},n.processVariableAI=function(e,t,r){var i,o=r.substring(0,e),a=r.substring(e,i=r.length<e+t?r.length:e+t),s=r.substring(i),u="("+o+")"+a,c=n.parseFieldsInGeneralPurpose(s);return null==c?u:u+c},n.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",n.VARIABLE_LENGTH=[],20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",n.VARIABLE_LENGTH,20],["22",n.VARIABLE_LENGTH,29],["30",n.VARIABLE_LENGTH,8],["37",n.VARIABLE_LENGTH,8],["90",n.VARIABLE_LENGTH,30],["91",n.VARIABLE_LENGTH,30],["92",n.VARIABLE_LENGTH,30],["93",n.VARIABLE_LENGTH,30],["94",n.VARIABLE_LENGTH,30],["95",n.VARIABLE_LENGTH,30],["96",n.VARIABLE_LENGTH,30],["97",n.VARIABLE_LENGTH,3],["98",n.VARIABLE_LENGTH,30],["99",n.VARIABLE_LENGTH,30]],n.THREE_DIGIT_DATA_LENGTH=[["240",n.VARIABLE_LENGTH,30],["241",n.VARIABLE_LENGTH,30],["242",n.VARIABLE_LENGTH,6],["250",n.VARIABLE_LENGTH,30],["251",n.VARIABLE_LENGTH,30],["253",n.VARIABLE_LENGTH,17],["254",n.VARIABLE_LENGTH,20],["400",n.VARIABLE_LENGTH,30],["401",n.VARIABLE_LENGTH,30],["402",17],["403",n.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",n.VARIABLE_LENGTH,20],["421",n.VARIABLE_LENGTH,15],["422",3],["423",n.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],n.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",n.VARIABLE_LENGTH,15],["391",n.VARIABLE_LENGTH,18],["392",n.VARIABLE_LENGTH,15],["393",n.VARIABLE_LENGTH,18],["703",n.VARIABLE_LENGTH,30]],n.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",n.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",n.VARIABLE_LENGTH,20],["8003",n.VARIABLE_LENGTH,30],["8004",n.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",n.VARIABLE_LENGTH,30],["8008",n.VARIABLE_LENGTH,12],["8018",18],["8020",n.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",n.VARIABLE_LENGTH,70],["8200",n.VARIABLE_LENGTH,70]],n}();const ite=ote;var ate=function(){function n(e){this.buffer=new ct,this.information=e}return n.prototype.decodeAllCodes=function(e,t){for(var r=t,o=null;;){var i=this.decodeGeneralPurposeField(r,o),a=ite.parseFieldsInGeneralPurpose(i.getNewString());if(null!=a&&e.append(a),o=i.isRemaining()?""+i.getRemainingValue():null,r===i.getNewPosition())break;r=i.getNewPosition()}return e.toString()},n.prototype.isStillNumeric=function(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(var t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)},n.prototype.decodeNumeric=function(e){if(e+7>this.information.getSize()){var t=this.extractNumericValueFromBitArray(e,4);return new gf(this.information.getSize(),0===t?gf.FNC1:t-1,gf.FNC1)}var r=this.extractNumericValueFromBitArray(e,7);return new gf(e+7,(r-8)/11,(r-8)%11)},n.prototype.extractNumericValueFromBitArray=function(e,t){return n.extractNumericValueFromBitArray(this.information,e,t)},n.extractNumericValueFromBitArray=function(e,t,r){for(var o=0,i=0;i<r;++i)e.get(t+i)&&(o|=1<<r-i-1);return o},n.prototype.decodeGeneralPurposeField=function(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);var r=this.parseBlocks();return null!=r&&r.isRemaining()?new xc(this.current.getPosition(),this.buffer.toString(),r.getRemainingValue()):new xc(this.current.getPosition(),this.buffer.toString())},n.prototype.parseBlocks=function(){var e,t;do{var r=this.current.getPosition();if(e=this.current.isAlpha()?(t=this.parseAlphaBlock()).isFinished():this.current.isIsoIec646()?(t=this.parseIsoIec646Block()).isFinished():(t=this.parseNumericBlock()).isFinished(),r===this.current.getPosition()&&!e)break}while(!e);return t.getDecodedInformation()},n.prototype.parseNumericBlock=function(){for(;this.isStillNumeric(this.current.getPosition());){var e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){var t=void 0;return t=e.isSecondDigitFNC1()?new xc(this.current.getPosition(),this.buffer.toString()):new xc(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new yc(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1())return t=new xc(this.current.getPosition(),this.buffer.toString()),new yc(!0,t);this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new yc(!1)},n.prototype.parseIsoIec646Block=function(){for(;this.isStillIsoIec646(this.current.getPosition());){var e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var t=new xc(this.current.getPosition(),this.buffer.toString());return new yc(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new yc(!1)},n.prototype.parseAlphaBlock=function(){for(;this.isStillAlpha(this.current.getPosition());){var e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var t=new xc(this.current.getPosition(),this.buffer.toString());return new yc(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new yc(!1)},n.prototype.isStillIsoIec646=function(e){if(e+5>this.information.getSize())return!1;var t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;var r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<116)return!0;if(e+8>this.information.getSize())return!1;var o=this.extractNumericValueFromBitArray(e,8);return o>=232&&o<253},n.prototype.decodeIsoIec646=function(e){var t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Zi(e+5,Zi.FNC1);if(t>=5&&t<15)return new Zi(e+5,"0"+(t-5));var i,r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<90)return new Zi(e+7,""+(r+1));if(r>=90&&r<116)return new Zi(e+7,""+(r+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:i="!";break;case 233:i='"';break;case 234:i="%";break;case 235:i="&";break;case 236:i="'";break;case 237:i="(";break;case 238:i=")";break;case 239:i="*";break;case 240:i="+";break;case 241:i=",";break;case 242:i="-";break;case 243:i=".";break;case 244:i="/";break;case 245:i=":";break;case 246:i=";";break;case 247:i="<";break;case 248:i="=";break;case 249:i=">";break;case 250:i="?";break;case 251:i="_";break;case 252:i=" ";break;default:throw new le}return new Zi(e+8,i)},n.prototype.isStillAlpha=function(e){if(e+5>this.information.getSize())return!1;var t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;var r=this.extractNumericValueFromBitArray(e,6);return r>=16&&r<63},n.prototype.decodeAlphanumeric=function(e){var t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Zi(e+5,Zi.FNC1);if(t>=5&&t<15)return new Zi(e+5,"0"+(t-5));var o,r=this.extractNumericValueFromBitArray(e,6);if(r>=32&&r<58)return new Zi(e+6,""+(r+33));switch(r){case 58:o="*";break;case 59:o=",";break;case 60:o="-";break;case 61:o=".";break;case 62:o="/";break;default:throw new La("Decoding invalid alphanumeric value: "+r)}return new Zi(e+6,o)},n.prototype.isAlphaTo646ToAlphaLatch=function(e){if(e+1>this.information.getSize())return!1;for(var t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0},n.prototype.isAlphaOr646ToNumericLatch=function(e){if(e+3>this.information.getSize())return!1;for(var t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0},n.prototype.isNumericToAlphaNumericLatch=function(e){if(e+1>this.information.getSize())return!1;for(var t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0},n}();const m0=ate;var ste=function(){function n(e){this.information=e,this.generalDecoder=new m0(e)}return n.prototype.getInformation=function(){return this.information},n.prototype.getGeneralDecoder=function(){return this.generalDecoder},n}();const qM=ste;var ute=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),cte=function(n){function e(t){return n.call(this,t)||this}return ute(e,n),e.prototype.encodeCompressedGtin=function(t,r){t.append("(01)");var o=t.length();t.append("9"),this.encodeCompressedGtinWithoutAI(t,r,o)},e.prototype.encodeCompressedGtinWithoutAI=function(t,r,o){for(var i=0;i<4;++i){var a=this.getGeneralDecoder().extractNumericValueFromBitArray(r+10*i,10);a/100==0&&t.append("0"),a/10==0&&t.append("0"),t.append(a)}e.appendCheckDigit(t,o)},e.appendCheckDigit=function(t,r){for(var o=0,i=0;i<13;i++){var a=t.charAt(i+r).charCodeAt(0)-"0".charCodeAt(0);o+=1&i?a:3*a}10==(o=10-o%10)&&(o=0),t.append(o)},e.GTIN_SIZE=40,e}(qM);const Qi=cte;var lte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),fte=function(n){function e(t){return n.call(this,t)||this}return lte(e,n),e.prototype.parseInformation=function(){var t=new ct;t.append("(01)");var r=t.length(),o=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE,4);return t.append(o),this.encodeCompressedGtinWithoutAI(t,e.HEADER_SIZE+4,r),this.getGeneralDecoder().decodeAllCodes(t,e.HEADER_SIZE+44)},e.HEADER_SIZE=4,e}(Qi);const dte=fte;var hte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),pte=function(n){function e(t){return n.call(this,t)||this}return hte(e,n),e.prototype.parseInformation=function(){var t=new ct;return this.getGeneralDecoder().decodeAllCodes(t,e.HEADER_SIZE)},e.HEADER_SIZE=5,e}(qM);const gte=pte;var vte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),mte=function(n){function e(t){return n.call(this,t)||this}return vte(e,n),e.prototype.encodeCompressedWeight=function(t,r,o){var i=this.getGeneralDecoder().extractNumericValueFromBitArray(r,o);this.addWeightCode(t,i);for(var a=this.checkWeight(i),s=1e5,u=0;u<5;++u)a/s==0&&t.append("0"),s/=10;t.append(a)},e}(Qi);const y0=mte;var yte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),xte=function(n){function e(t){return n.call(this,t)||this}return yte(e,n),e.prototype.parseInformation=function(){if(this.getInformation().getSize()!==e.HEADER_SIZE+y0.GTIN_SIZE+e.WEIGHT_SIZE)throw new Z;var t=new ct;return this.encodeCompressedGtin(t,e.HEADER_SIZE),this.encodeCompressedWeight(t,e.HEADER_SIZE+y0.GTIN_SIZE,e.WEIGHT_SIZE),t.toString()},e.HEADER_SIZE=5,e.WEIGHT_SIZE=15,e}(y0);const XM=xte;var wte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),_te=function(n){function e(t){return n.call(this,t)||this}return wte(e,n),e.prototype.addWeightCode=function(t,r){t.append("(3103)")},e.prototype.checkWeight=function(t){return t},e}(XM);const bte=_te;var Cte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ete=function(n){function e(t){return n.call(this,t)||this}return Cte(e,n),e.prototype.addWeightCode=function(t,r){t.append(r<1e4?"(3202)":"(3203)")},e.prototype.checkWeight=function(t){return t<1e4?t:t-1e4},e}(XM);const Ste=Ete;var Ate=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ite=function(n){function e(t){return n.call(this,t)||this}return Ate(e,n),e.prototype.parseInformation=function(){if(this.getInformation().getSize()<e.HEADER_SIZE+Qi.GTIN_SIZE)throw new Z;var t=new ct;this.encodeCompressedGtin(t,e.HEADER_SIZE);var r=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+Qi.GTIN_SIZE,e.LAST_DIGIT_SIZE);t.append("(392"),t.append(r),t.append(")");var o=this.getGeneralDecoder().decodeGeneralPurposeField(e.HEADER_SIZE+Qi.GTIN_SIZE+e.LAST_DIGIT_SIZE,null);return t.append(o.getNewString()),t.toString()},e.HEADER_SIZE=8,e.LAST_DIGIT_SIZE=2,e}(Qi);const Dte=Ite;var Tte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Rte=function(n){function e(t){return n.call(this,t)||this}return Tte(e,n),e.prototype.parseInformation=function(){if(this.getInformation().getSize()<e.HEADER_SIZE+Qi.GTIN_SIZE)throw new Z;var t=new ct;this.encodeCompressedGtin(t,e.HEADER_SIZE);var r=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+Qi.GTIN_SIZE,e.LAST_DIGIT_SIZE);t.append("(393"),t.append(r),t.append(")");var o=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+Qi.GTIN_SIZE+e.LAST_DIGIT_SIZE,e.FIRST_THREE_DIGITS_SIZE);o/100==0&&t.append("0"),o/10==0&&t.append("0"),t.append(o);var i=this.getGeneralDecoder().decodeGeneralPurposeField(e.HEADER_SIZE+Qi.GTIN_SIZE+e.LAST_DIGIT_SIZE+e.FIRST_THREE_DIGITS_SIZE,null);return t.append(i.getNewString()),t.toString()},e.HEADER_SIZE=8,e.LAST_DIGIT_SIZE=2,e.FIRST_THREE_DIGITS_SIZE=10,e}(Qi);const Nte=Rte;var Ote=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Mte=function(n){function e(t,r,o){var i=n.call(this,t)||this;return i.dateCode=o,i.firstAIdigits=r,i}return Ote(e,n),e.prototype.parseInformation=function(){if(this.getInformation().getSize()!==e.HEADER_SIZE+e.GTIN_SIZE+e.WEIGHT_SIZE+e.DATE_SIZE)throw new Z;var t=new ct;return this.encodeCompressedGtin(t,e.HEADER_SIZE),this.encodeCompressedWeight(t,e.HEADER_SIZE+e.GTIN_SIZE,e.WEIGHT_SIZE),this.encodeCompressedDate(t,e.HEADER_SIZE+e.GTIN_SIZE+e.WEIGHT_SIZE),t.toString()},e.prototype.encodeCompressedDate=function(t,r){var o=this.getGeneralDecoder().extractNumericValueFromBitArray(r,e.DATE_SIZE);if(38400!==o){t.append("("),t.append(this.dateCode),t.append(")");var i=o%32,a=(o/=32)%12+1,s=o/=12;s/10==0&&t.append("0"),t.append(s),a/10==0&&t.append("0"),t.append(a),i/10==0&&t.append("0"),t.append(i)}},e.prototype.addWeightCode=function(t,r){t.append("("),t.append(this.firstAIdigits),t.append(r/1e5),t.append(")")},e.prototype.checkWeight=function(t){return t%1e5},e.HEADER_SIZE=8,e.WEIGHT_SIZE=20,e.DATE_SIZE=16,e}(y0);const pu=Mte;var kte=function(){function n(e,t,r,o){this.leftchar=e,this.rightchar=t,this.finderpattern=r,this.maybeLast=o}return n.prototype.mayBeLast=function(){return this.maybeLast},n.prototype.getLeftChar=function(){return this.leftchar},n.prototype.getRightChar=function(){return this.rightchar},n.prototype.getFinderPattern=function(){return this.finderpattern},n.prototype.mustBeLast=function(){return null==this.rightchar},n.prototype.toString=function(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"},n.equals=function(e,t){return e instanceof n&&n.equalsOrNull(e.leftchar,t.leftchar)&&n.equalsOrNull(e.rightchar,t.rightchar)&&n.equalsOrNull(e.finderpattern,t.finderpattern)},n.equalsOrNull=function(e,t){return null===e?null===t:n.equals(e,t)},n.prototype.hashCode=function(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()},n}();const KM=kte;var Fte=function(){function n(e,t,r){this.pairs=e,this.rowNumber=t,this.wasReversed=r}return n.prototype.getPairs=function(){return this.pairs},n.prototype.getRowNumber=function(){return this.rowNumber},n.prototype.isReversed=function(){return this.wasReversed},n.prototype.isEquivalent=function(e){return this.checkEqualitity(this,e)},n.prototype.toString=function(){return"{ "+this.pairs+" }"},n.prototype.equals=function(e,t){return e instanceof n&&this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed},n.prototype.checkEqualitity=function(e,t){var r;if(e&&t)return e.forEach(function(o,i){t.forEach(function(a){o.getLeftChar().getValue()===a.getLeftChar().getValue()&&o.getRightChar().getValue()===a.getRightChar().getValue()&&o.getFinderPatter().getValue()===a.getFinderPatter().getValue()&&(r=!0)})}),r},n}();const Lte=Fte;var Bte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),gu=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Vte=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.pairs=new Array(e.MAX_PAIRS),t.rows=new Array,t.startEnd=[2],t}return Bte(e,n),e.prototype.decodeRow=function(t,r,o){this.pairs.length=0,this.startFromEven=!1;try{return e.constructResult(this.decodeRow2pairs(t,r))}catch{}return this.pairs.length=0,this.startFromEven=!0,e.constructResult(this.decodeRow2pairs(t,r))},e.prototype.reset=function(){this.pairs.length=0,this.rows.length=0},e.prototype.decodeRow2pairs=function(t,r){for(var o=!1;!o;)try{this.pairs.push(this.retrieveNextPair(r,this.pairs,t))}catch(s){if(s instanceof Z){if(!this.pairs.length)throw new Z;o=!0}}if(this.checkChecksum())return this.pairs;var i;if(i=!!this.rows.length,this.storeRow(t,!1),i){var a=this.checkRowsBoolean(!1);if(null!=a||null!=(a=this.checkRowsBoolean(!0)))return a}throw new Z},e.prototype.checkRowsBoolean=function(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());var r=null;try{r=this.checkRows(new Array,0)}catch(o){console.log(o)}return t&&(this.rows=this.rows.reverse()),r},e.prototype.checkRows=function(t,r){for(var o,i,a=r;a<this.rows.length;a++){var s=this.rows[a];this.pairs.length=0;try{for(var u=(o=void 0,gu(t)),c=u.next();!c.done;c=u.next())this.pairs.push(c.value.getPairs())}catch(d){o={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}if(this.pairs.push(s.getPairs()),e.isValidSequence(this.pairs)){if(this.checkChecksum())return this.pairs;var f=new Array(t);f.push(s);try{return this.checkRows(f,a+1)}catch(d){console.log(d)}}}throw new Z},e.isValidSequence=function(t){var r,o;try{for(var i=gu(e.FINDER_PATTERN_SEQUENCES),a=i.next();!a.done;a=i.next()){var s=a.value;if(!(t.length>s.length)){for(var u=!0,c=0;c<t.length;c++)if(t[c].getFinderPattern().getValue()!==s[c]){u=!1;break}if(u)return!0}}}catch(l){r={error:l}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return!1},e.prototype.storeRow=function(t,r){for(var o=0,i=!1,a=!1;o<this.rows.length;){var s=this.rows[o];if(s.getRowNumber()>t){a=s.isEquivalent(this.pairs);break}i=s.isEquivalent(this.pairs),o++}a||i||e.isPartialRow(this.pairs,this.rows)||(this.rows.push(o,new Lte(this.pairs,t,r)),this.removePartialRows(this.pairs,this.rows))},e.prototype.removePartialRows=function(t,r){var o,i,a,s,u,c;try{for(var l=gu(r),f=l.next();!f.done;f=l.next()){var d=f.value;if(d.getPairs().length!==t.length)try{for(var p=(a=void 0,gu(d.getPairs())),g=p.next();!g.done;g=p.next()){var v=g.value;try{for(var y=(u=void 0,gu(t)),x=y.next();!x.done;x=y.next())if(KM.equals(v,x.value)){!0;break}}catch(_){u={error:_}}finally{try{x&&!x.done&&(c=y.return)&&c.call(y)}finally{if(u)throw u.error}}}}catch(_){a={error:_}}finally{try{g&&!g.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}}}catch(_){o={error:_}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}},e.isPartialRow=function(t,r){var o,i,a,s,u,c;try{for(var l=gu(r),f=l.next();!f.done;f=l.next()){var d=f.value,h=!0;try{for(var p=(a=void 0,gu(t)),g=p.next();!g.done;g=p.next()){var v=g.value,m=!1;try{for(var y=(u=void 0,gu(d.getPairs())),x=y.next();!x.done;x=y.next())if(v.equals(x.value)){m=!0;break}}catch(_){u={error:_}}finally{try{x&&!x.done&&(c=y.return)&&c.call(y)}finally{if(u)throw u.error}}if(!m){h=!1;break}}}catch(_){a={error:_}}finally{try{g&&!g.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}if(h)return!0}}catch(_){o={error:_}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}return!1},e.prototype.getRows=function(){return this.rows},e.constructResult=function(t){var o=function Pte(n){try{if(n.get(1))return new dte(n);if(!n.get(2))return new gte(n);switch(m0.extractNumericValueFromBitArray(n,1,4)){case 4:return new bte(n);case 5:return new Ste(n)}switch(m0.extractNumericValueFromBitArray(n,1,5)){case 12:return new Dte(n);case 13:return new Nte(n)}switch(m0.extractNumericValueFromBitArray(n,1,7)){case 56:return new pu(n,"310","11");case 57:return new pu(n,"320","11");case 58:return new pu(n,"310","13");case 59:return new pu(n,"320","13");case 60:return new pu(n,"310","15");case 61:return new pu(n,"320","15");case 62:return new pu(n,"310","17");case 63:return new pu(n,"320","17")}}catch(o){throw console.log(o),new La("unknown decoder: "+n)}}(Kee.buildBitArray(t)),i=o.parseInformation(),a=t[0].getFinderPattern().getResultPoints(),s=t[t.length-1].getFinderPattern().getResultPoints();return new qr(i,null,null,[a[0],a[1],s[0],s[1]],Me.RSS_EXPANDED,null)},e.prototype.checkChecksum=function(){var t=this.pairs.get(0),r=t.getLeftChar(),o=t.getRightChar();if(null===o)return!1;for(var i=o.getChecksumPortion(),a=2,s=1;s<this.pairs.size();++s){var u=this.pairs.get(s);i+=u.getLeftChar().getChecksumPortion(),a++;var c=u.getRightChar();null!=c&&(i+=c.getChecksumPortion(),a++)}return 211*(a-4)+(i%=211)===r.getValue()},e.getNextSecondBar=function(t,r){var o;return t.get(r)?(o=t.getNextUnset(r),o=t.getNextSet(o)):(o=t.getNextSet(r),o=t.getNextUnset(o)),o},e.prototype.retrieveNextPair=function(t,r,o){var i=r.length%2==0;this.startFromEven&&(i=!i);var a,s=!0,u=-1;do{this.findNextPair(t,r,u),null===(a=this.parseFoundFinderPattern(t,o,i))?u=e.getNextSecondBar(t,this.startEnd[0]):s=!1}while(s);var l,c=this.decodeDataCharacter(t,a,i,!0);if(!this.isEmptyPair(r)&&r[r.length-1].mustBeLast())throw new Z;try{l=this.decodeDataCharacter(t,a,i,!1)}catch(f){l=null,console.log(f)}return new KM(c,l,a,!0)},e.prototype.isEmptyPair=function(t){return 0===t.length},e.prototype.findNextPair=function(t,r,o){var i=this.getDecodeFinderCounters();i[0]=0,i[1]=0,i[2]=0,i[3]=0;var s,a=t.getSize();s=o>=0?o:this.isEmptyPair(r)?0:r[r.length-1].getFinderPattern().getStartEnd()[1];var c=r.length%2!=0;this.startFromEven&&(c=!c);for(var l=!1;s<a&&(l=!t.get(s));)s++;for(var f=0,d=s,h=s;h<a;h++)if(t.get(h)!==l)i[f]++;else{if(3===f){if(c&&e.reverseCounters(i),e.isFinderPattern(i))return this.startEnd[0]=d,void(this.startEnd[1]=h);c&&e.reverseCounters(i),d+=i[0]+i[1],i[0]=i[2],i[1]=i[3],i[2]=0,i[3]=0,f--}else f++;i[f]=1,l=!l}throw new Z},e.reverseCounters=function(t){for(var r=t.length,o=0;o<r/2;++o){var i=t[o];t[o]=t[r-o-1],t[r-o-1]=i}},e.prototype.parseFoundFinderPattern=function(t,r,o){var i,a,s;if(o){for(var u=this.startEnd[0]-1;u>=0&&!t.get(u);)u--;u++,i=this.startEnd[0]-u,a=u,s=this.startEnd[1]}else a=this.startEnd[0],i=(s=t.getNextUnset(this.startEnd[1]+1))-this.startEnd[1];var l,c=this.getDecodeFinderCounters();cn.arraycopy(c,0,c,1,c.length-1),c[0]=i;try{l=this.parseFinderValue(c,e.FINDER_PATTERNS)}catch{return null}return new $M(l,[a,s],a,s,r)},e.prototype.decodeDataCharacter=function(t,r,o,i){for(var a=this.getDataCharacterCounters(),s=0;s<a.length;s++)a[s]=0;if(i)e.recordPatternInReverse(t,r.getStartEnd()[0],a);else{e.recordPattern(t,r.getStartEnd()[1],a);for(var u=0,c=a.length-1;u<c;u++,c--){var l=a[u];a[u]=a[c],a[c]=l}}var d=Pt.sum(new Int32Array(a))/17,h=(r.getStartEnd()[1]-r.getStartEnd()[0])/15;if(Math.abs(d-h)/h>.3)throw new Z;var p=this.getOddCounts(),g=this.getEvenCounts(),v=this.getOddRoundingErrors(),m=this.getEvenRoundingErrors();for(u=0;u<a.length;u++){var y=1*a[u]/d,x=y+.5;if(x<1){if(y<.3)throw new Z;x=1}else if(x>8){if(y>8.7)throw new Z;x=8}var w=u/2;1&u?(g[w]=x,m[w]=y-x):(p[w]=x,v[w]=y-x)}this.adjustOddEvenCounts(17);var _=4*r.getValue()+(o?0:2)+(i?0:1)-1,b=0,C=0;for(u=p.length-1;u>=0;u--)e.isNotA1left(r,o,i)&&(C+=p[u]*e.WEIGHTS[_][2*u]),b+=p[u];var S=0;for(u=g.length-1;u>=0;u--)e.isNotA1left(r,o,i)&&(S+=g[u]*e.WEIGHTS[_][2*u+1]);var A=C+S;if(1&b||b>13||b<4)throw new Z;var D=(13-b)/2,M=e.SYMBOL_WIDEST[D],L=9-M,B=pf.getRSSvalue(p,M,!0),U=pf.getRSSvalue(g,L,!1);return new g0(B*e.EVEN_TOTAL_SUBSET[D]+U+e.GSUM[D],A)},e.isNotA1left=function(t,r,o){return!(0===t.getValue()&&r&&o)},e.prototype.adjustOddEvenCounts=function(t){var r=Pt.sum(new Int32Array(this.getOddCounts())),o=Pt.sum(new Int32Array(this.getEvenCounts())),i=!1,a=!1;r>13?a=!0:r<4&&(i=!0);var s=!1,u=!1;o>13?u=!0:o<4&&(s=!0);var c=r+o-t,l=1==(1&r),f=0==(1&o);if(1===c)if(l){if(f)throw new Z;a=!0}else{if(!f)throw new Z;u=!0}else if(-1===c)if(l){if(f)throw new Z;i=!0}else{if(!f)throw new Z;s=!0}else{if(0!==c)throw new Z;if(l){if(!f)throw new Z;r<o?(i=!0,u=!0):(a=!0,s=!0)}else if(f)throw new Z}if(i){if(a)throw new Z;e.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(a&&e.decrement(this.getOddCounts(),this.getOddRoundingErrors()),s){if(u)throw new Z;e.increment(this.getEvenCounts(),this.getOddRoundingErrors())}u&&e.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.SYMBOL_WIDEST=[7,5,4,3,1],e.EVEN_TOTAL_SUBSET=[4,20,52,104,204],e.GSUM=[0,348,1388,2948,3988],e.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],e.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],e.FINDER_PATTERN_SEQUENCES=[[e.FINDER_PAT_A=0,e.FINDER_PAT_A],[e.FINDER_PAT_A,e.FINDER_PAT_B=1,e.FINDER_PAT_B],[e.FINDER_PAT_A,e.FINDER_PAT_C=2,e.FINDER_PAT_B,e.FINDER_PAT_D=3],[e.FINDER_PAT_A,e.FINDER_PAT_E=4,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_C],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_F=5],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F]],e.MAX_PAIRS=11,e}(mc);const Ute=Vte;var Hte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wte=function(n){function e(t,r,o){var i=n.call(this,t,r)||this;return i.count=0,i.finderPattern=o,i}return Hte(e,n),e.prototype.getFinderPattern=function(){return this.finderPattern},e.prototype.getCount=function(){return this.count},e.prototype.incrementCount=function(){this.count++},e}(g0);const Gte=Wte;var zte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),B_=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},jte=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.possibleLeftPairs=[],t.possibleRightPairs=[],t}return zte(e,n),e.prototype.decodeRow=function(t,r,o){var i,a,s,u,c=this.decodePair(r,!1,t,o);e.addOrTally(this.possibleLeftPairs,c),r.reverse();var l=this.decodePair(r,!0,t,o);e.addOrTally(this.possibleRightPairs,l),r.reverse();try{for(var f=B_(this.possibleLeftPairs),d=f.next();!d.done;d=f.next()){var h=d.value;if(h.getCount()>1)try{for(var p=(s=void 0,B_(this.possibleRightPairs)),g=p.next();!g.done;g=p.next()){var v=g.value;if(v.getCount()>1&&e.checkChecksum(h,v))return e.constructResult(h,v)}}catch(m){s={error:m}}finally{try{g&&!g.done&&(u=p.return)&&u.call(p)}finally{if(s)throw s.error}}}}catch(m){i={error:m}}finally{try{d&&!d.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}throw new Z},e.addOrTally=function(t,r){var o,i;if(null!=r){var a=!1;try{for(var s=B_(t),u=s.next();!u.done;u=s.next()){var c=u.value;if(c.getValue()===r.getValue()){c.incrementCount(),a=!0;break}}}catch(l){o={error:l}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}a||t.push(r)}},e.prototype.reset=function(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0},e.constructResult=function(t,r){for(var o=4537077*t.getValue()+r.getValue(),i=new String(o).toString(),a=new ct,s=13-i.length;s>0;s--)a.append("0");a.append(i);var u=0;for(s=0;s<13;s++){var c=a.charAt(s).charCodeAt(0)-"0".charCodeAt(0);u+=1&s?c:3*c}10==(u=10-u%10)&&(u=0),a.append(u.toString());var l=t.getFinderPattern().getResultPoints(),f=r.getFinderPattern().getResultPoints();return new qr(a.toString(),null,0,[l[0],l[1],f[0],f[1]],Me.RSS_14,(new Date).getTime())},e.checkChecksum=function(t,r){var o=(t.getChecksumPortion()+16*r.getChecksumPortion())%79,i=9*t.getFinderPattern().getValue()+r.getFinderPattern().getValue();return i>72&&i--,i>8&&i--,o===i},e.prototype.decodePair=function(t,r,o,i){try{var a=this.findFinderPattern(t,r),s=this.parseFoundFinderPattern(t,o,r,a),u=null==i?null:i.get(Kt.NEED_RESULT_POINT_CALLBACK);if(null!=u){var c=(a[0]+a[1])/2;r&&(c=t.getSize()-1-c),u.foundPossibleResultPoint(new Ne(c,o))}var l=this.decodeDataCharacter(t,s,!0),f=this.decodeDataCharacter(t,s,!1);return new Gte(1597*l.getValue()+f.getValue(),l.getChecksumPortion()+4*f.getChecksumPortion(),s)}catch{return null}},e.prototype.decodeDataCharacter=function(t,r,o){for(var i=this.getDataCharacterCounters(),a=0;a<i.length;a++)i[a]=0;if(o)cr.recordPatternInReverse(t,r.getStartEnd()[0],i);else{cr.recordPattern(t,r.getStartEnd()[1]+1,i);for(var s=0,u=i.length-1;s<u;s++,u--){var c=i[s];i[s]=i[u],i[u]=c}}var l=o?16:15,f=Pt.sum(new Int32Array(i))/l,d=this.getOddCounts(),h=this.getEvenCounts(),p=this.getOddRoundingErrors(),g=this.getEvenRoundingErrors();for(s=0;s<i.length;s++){var v=i[s]/f,m=Math.floor(v+.5);m<1?m=1:m>8&&(m=8);var y=Math.floor(s/2);1&s?(h[y]=m,g[y]=v-m):(d[y]=m,p[y]=v-m)}this.adjustOddEvenCounts(o,l);var x=0,w=0;for(s=d.length-1;s>=0;s--)w*=9,w+=d[s],x+=d[s];var _=0,b=0;for(s=h.length-1;s>=0;s--)_*=9,_+=h[s],b+=h[s];var E,S,C=w+3*_;if(o){if(1&x||x>12||x<4)throw new Z;var A=9-(S=e.OUTSIDE_ODD_WIDEST[E=(12-x)/2]),D=pf.getRSSvalue(d,S,!1),M=pf.getRSSvalue(h,A,!0);return new g0(D*e.OUTSIDE_EVEN_TOTAL_SUBSET[E]+M+e.OUTSIDE_GSUM[E],C)}if(1&b||b>10||b<4)throw new Z;return A=9-(S=e.INSIDE_ODD_WIDEST[E=(10-b)/2]),D=pf.getRSSvalue(d,S,!0),M=pf.getRSSvalue(h,A,!1),new g0(M*e.INSIDE_ODD_TOTAL_SUBSET[E]+D+e.INSIDE_GSUM[E],C)},e.prototype.findFinderPattern=function(t,r){var o=this.getDecodeFinderCounters();o[0]=0,o[1]=0,o[2]=0,o[3]=0;for(var i=t.getSize(),a=!1,s=0;s<i&&r!==(a=!t.get(s));)s++;for(var u=0,c=s,l=s;l<i;l++)if(t.get(l)!==a)o[u]++;else{if(3===u){if(mc.isFinderPattern(o))return[c,l];c+=o[0]+o[1],o[0]=o[2],o[1]=o[3],o[2]=0,o[3]=0,u--}else u++;o[u]=1,a=!a}throw new Z},e.prototype.parseFoundFinderPattern=function(t,r,o,i){for(var a=t.get(i[0]),s=i[0]-1;s>=0&&a!==t.get(s);)s--;s++;var u=i[0]-s,c=this.getDecodeFinderCounters(),l=new Int32Array(c.length);cn.arraycopy(c,0,l,1,c.length-1),l[0]=u;var f=this.parseFinderValue(l,e.FINDER_PATTERNS),d=s,h=i[1];return o&&(d=t.getSize()-1-d,h=t.getSize()-1-h),new $M(f,[s,i[1]],d,h,r)},e.prototype.adjustOddEvenCounts=function(t,r){var o=Pt.sum(new Int32Array(this.getOddCounts())),i=Pt.sum(new Int32Array(this.getEvenCounts())),a=!1,s=!1,u=!1,c=!1;t?(o>12?s=!0:o<4&&(a=!0),i>12?c=!0:i<4&&(u=!0)):(o>11?s=!0:o<5&&(a=!0),i>10?c=!0:i<4&&(u=!0));var l=o+i-r,f=(1&o)==(t?1:0),d=1==(1&i);if(1===l)if(f){if(d)throw new Z;s=!0}else{if(!d)throw new Z;c=!0}else if(-1===l)if(f){if(d)throw new Z;a=!0}else{if(!d)throw new Z;u=!0}else{if(0!==l)throw new Z;if(f){if(!d)throw new Z;o<i?(a=!0,c=!0):(s=!0,u=!0)}else if(d)throw new Z}if(a){if(s)throw new Z;mc.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(s&&mc.decrement(this.getOddCounts(),this.getOddRoundingErrors()),u){if(c)throw new Z;mc.increment(this.getEvenCounts(),this.getOddRoundingErrors())}c&&mc.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],e.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],e.OUTSIDE_GSUM=[0,161,961,2015,2715],e.INSIDE_GSUM=[0,336,1036,1516],e.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],e.INSIDE_ODD_WIDEST=[2,4,6,8],e.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])],e}(mc);const YM=jte;var $te=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),qte=function(n){function e(t){var r=n.call(this)||this;r.readers=[];var o=t?t.get(Kt.POSSIBLE_FORMATS):null,i=t&&void 0!==t.get(Kt.ASSUME_CODE_39_CHECK_DIGIT);return o&&((o.includes(Me.EAN_13)||o.includes(Me.UPC_A)||o.includes(Me.EAN_8)||o.includes(Me.UPC_E))&&r.readers.push(new F_(t)),o.includes(Me.CODE_39)&&r.readers.push(new LM(i)),o.includes(Me.CODE_93)&&r.readers.push(new BM),o.includes(Me.CODE_128)&&r.readers.push(new FM),o.includes(Me.ITF)&&r.readers.push(new VM),o.includes(Me.CODABAR)&&r.readers.push(new Uee),o.includes(Me.RSS_14)&&r.readers.push(new YM),o.includes(Me.RSS_EXPANDED)&&(console.warn("RSS Expanded reader IS NOT ready for production yet! use at your own risk."),r.readers.push(new Ute))),0===r.readers.length&&(r.readers.push(new F_(t)),r.readers.push(new LM),r.readers.push(new BM),r.readers.push(new F_(t)),r.readers.push(new FM),r.readers.push(new VM),r.readers.push(new YM)),r}return $te(e,n),e.prototype.decodeRow=function(t,r,o){for(var i=0;i<this.readers.length;i++)try{return this.readers[i].decodeRow(t,r,o)}catch{}throw new Z},e.prototype.reset=function(){this.readers.forEach(function(t){return t.reset()})},e}(cr);const vf=qte;var Xte=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),ZM=(function(n){Xte(function e(t,r){return void 0===t&&(t=500),n.call(this,new vf(r),t,r)||this},n)}(df),function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}),Zt=function(){function n(e,t,r){this.ecCodewords=e,this.ecBlocks=[t],r&&this.ecBlocks.push(r)}return n.prototype.getECCodewords=function(){return this.ecCodewords},n.prototype.getECBlocks=function(){return this.ecBlocks},n}(),Vt=function(){function n(e,t){this.count=e,this.dataCodewords=t}return n.prototype.getCount=function(){return this.count},n.prototype.getDataCodewords=function(){return this.dataCodewords},n}(),Kte=function(){function n(e,t,r,o,i,a){var s,u;this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=r,this.dataRegionSizeRows=o,this.dataRegionSizeColumns=i,this.ecBlocks=a;var c=0,l=a.getECCodewords(),f=a.getECBlocks();try{for(var d=ZM(f),h=d.next();!h.done;h=d.next()){var p=h.value;c+=p.getCount()*(p.getDataCodewords()+l)}}catch(g){s={error:g}}finally{try{h&&!h.done&&(u=d.return)&&u.call(d)}finally{if(s)throw s.error}}this.totalCodewords=c}return n.prototype.getVersionNumber=function(){return this.versionNumber},n.prototype.getSymbolSizeRows=function(){return this.symbolSizeRows},n.prototype.getSymbolSizeColumns=function(){return this.symbolSizeColumns},n.prototype.getDataRegionSizeRows=function(){return this.dataRegionSizeRows},n.prototype.getDataRegionSizeColumns=function(){return this.dataRegionSizeColumns},n.prototype.getTotalCodewords=function(){return this.totalCodewords},n.prototype.getECBlocks=function(){return this.ecBlocks},n.getVersionForDimensions=function(e,t){var r,o;if(1&e||1&t)throw new le;try{for(var i=ZM(n.VERSIONS),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.symbolSizeRows===e&&s.symbolSizeColumns===t)return s}}catch(u){r={error:u}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}throw new le},n.prototype.toString=function(){return""+this.versionNumber},n.buildVersions=function(){return[new n(1,10,10,8,8,new Zt(5,new Vt(1,3))),new n(2,12,12,10,10,new Zt(7,new Vt(1,5))),new n(3,14,14,12,12,new Zt(10,new Vt(1,8))),new n(4,16,16,14,14,new Zt(12,new Vt(1,12))),new n(5,18,18,16,16,new Zt(14,new Vt(1,18))),new n(6,20,20,18,18,new Zt(18,new Vt(1,22))),new n(7,22,22,20,20,new Zt(20,new Vt(1,30))),new n(8,24,24,22,22,new Zt(24,new Vt(1,36))),new n(9,26,26,24,24,new Zt(28,new Vt(1,44))),new n(10,32,32,14,14,new Zt(36,new Vt(1,62))),new n(11,36,36,16,16,new Zt(42,new Vt(1,86))),new n(12,40,40,18,18,new Zt(48,new Vt(1,114))),new n(13,44,44,20,20,new Zt(56,new Vt(1,144))),new n(14,48,48,22,22,new Zt(68,new Vt(1,174))),new n(15,52,52,24,24,new Zt(42,new Vt(2,102))),new n(16,64,64,14,14,new Zt(56,new Vt(2,140))),new n(17,72,72,16,16,new Zt(36,new Vt(4,92))),new n(18,80,80,18,18,new Zt(48,new Vt(4,114))),new n(19,88,88,20,20,new Zt(56,new Vt(4,144))),new n(20,96,96,22,22,new Zt(68,new Vt(4,174))),new n(21,104,104,24,24,new Zt(56,new Vt(6,136))),new n(22,120,120,18,18,new Zt(68,new Vt(6,175))),new n(23,132,132,20,20,new Zt(62,new Vt(8,163))),new n(24,144,144,22,22,new Zt(62,new Vt(8,156),new Vt(2,155))),new n(25,8,18,6,16,new Zt(7,new Vt(1,5))),new n(26,8,32,6,14,new Zt(11,new Vt(1,10))),new n(27,12,26,10,24,new Zt(14,new Vt(1,16))),new n(28,12,36,10,16,new Zt(18,new Vt(1,22))),new n(29,16,36,14,16,new Zt(24,new Vt(1,32))),new n(30,16,48,14,22,new Zt(28,new Vt(1,49)))]},n.VERSIONS=n.buildVersions(),n}();const Yte=Kte;var Zte=function(){function n(e){var t=e.getHeight();if(t<8||t>144||1&t)throw new le;this.version=n.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new Ro(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}return n.prototype.getVersion=function(){return this.version},n.readVersion=function(e){var t=e.getHeight(),r=e.getWidth();return Yte.getVersionForDimensions(t,r)},n.prototype.readCodewords=function(){var e=new Int8Array(this.version.getTotalCodewords()),t=0,r=4,o=0,i=this.mappingBitMatrix.getHeight(),a=this.mappingBitMatrix.getWidth(),s=!1,u=!1,c=!1,l=!1;do{if(r!==i||0!==o||s)if(r===i-2&&0===o&&3&a&&!u)e[t++]=255&this.readCorner2(i,a),r-=2,o+=2,u=!0;else if(r!==i+4||2!==o||7&a||c)if(r!==i-2||0!==o||4!=(7&a)||l){do{r<i&&o>=0&&!this.readMappingMatrix.get(o,r)&&(e[t++]=255&this.readUtah(r,o,i,a)),r-=2,o+=2}while(r>=0&&o<a);r+=1,o+=3;do{r>=0&&o<a&&!this.readMappingMatrix.get(o,r)&&(e[t++]=255&this.readUtah(r,o,i,a)),r+=2,o-=2}while(r<i&&o>=0);r+=3,o+=1}else e[t++]=255&this.readCorner4(i,a),r-=2,o+=2,l=!0;else e[t++]=255&this.readCorner3(i,a),r-=2,o+=2,c=!0;else e[t++]=255&this.readCorner1(i,a),r-=2,o+=2,s=!0}while(r<i||o<a);if(t!==this.version.getTotalCodewords())throw new le;return e},n.prototype.readModule=function(e,t,r,o){return e<0&&(e+=r,t+=4-(r+4&7)),t<0&&(t+=o,e+=4-(o+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)},n.prototype.readUtah=function(e,t,r,o){var i=0;return this.readModule(e-2,t-2,r,o)&&(i|=1),i<<=1,this.readModule(e-2,t-1,r,o)&&(i|=1),i<<=1,this.readModule(e-1,t-2,r,o)&&(i|=1),i<<=1,this.readModule(e-1,t-1,r,o)&&(i|=1),i<<=1,this.readModule(e-1,t,r,o)&&(i|=1),i<<=1,this.readModule(e,t-2,r,o)&&(i|=1),i<<=1,this.readModule(e,t-1,r,o)&&(i|=1),i<<=1,this.readModule(e,t,r,o)&&(i|=1),i},n.prototype.readCorner1=function(e,t){var r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,1,e,t)&&(r|=1),r<<=1,this.readModule(e-1,2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r},n.prototype.readCorner2=function(e,t){var r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-4,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r},n.prototype.readCorner3=function(e,t){var r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-3,e,t)&&(r|=1),r<<=1,this.readModule(1,t-2,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r},n.prototype.readCorner4=function(e,t){var r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r},n.prototype.extractDataRegion=function(e){var t=this.version.getSymbolSizeRows(),r=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new Ie("Dimension of bitMatrix must match the version size");for(var o=this.version.getDataRegionSizeRows(),i=this.version.getDataRegionSizeColumns(),a=t/o|0,s=r/i|0,l=new Ro(s*i,a*o),f=0;f<a;++f)for(var d=f*o,h=0;h<s;++h)for(var p=h*i,g=0;g<o;++g)for(var v=f*(o+2)+1+g,m=d+g,y=0;y<i;++y)e.get(h*(i+2)+1+y,v)&&l.set(p+y,m);return l},n}();const Qte=Zte;var QM=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jte=function(){function n(e,t){this.numDataCodewords=e,this.codewords=t}return n.getDataBlocks=function(e,t){var r,o,i,a,s=t.getECBlocks(),u=0,c=s.getECBlocks();try{for(var l=QM(c),f=l.next();!f.done;f=l.next())u+=(d=f.value).getCount()}catch(B){r={error:B}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}var h=new Array(u),p=0;try{for(var g=QM(c),v=g.next();!v.done;v=g.next())for(var d=v.value,m=0;m<d.getCount();m++){var y=d.getDataCodewords(),x=s.getECCodewords()+y;h[p++]=new n(y,new Uint8Array(x))}}catch(B){i={error:B}}finally{try{v&&!v.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}var _=h[0].codewords.length-s.getECCodewords(),b=_-1,C=0;for(m=0;m<b;m++)for(var E=0;E<p;E++)h[E].codewords[m]=e[C++];var S=24===t.getVersionNumber(),A=S?8:p;for(E=0;E<A;E++)h[E].codewords[_-1]=e[C++];var D=h[0].codewords.length;for(m=_;m<D;m++)for(E=0;E<p;E++){var M=S?(E+8)%p:E;h[M].codewords[S&&M>7?m-1:m]=e[C++]}if(C!==e.length)throw new Ie;return h},n.prototype.getNumDataCodewords=function(){return this.numDataCodewords},n.prototype.getCodewords=function(){return this.codewords},n}();const ene=Jte;var tne=function(){function n(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}return n.prototype.getBitOffset=function(){return this.bitOffset},n.prototype.getByteOffset=function(){return this.byteOffset},n.prototype.readBits=function(e){if(e<1||e>32||e>this.available())throw new Ie(""+e);var t=0,r=this.bitOffset,o=this.byteOffset,i=this.bytes;if(r>0){var a=8-r,s=e<a?e:a;t=(i[o]&255>>8-s<<(u=a-s))>>u,e-=s,8===(r+=s)&&(r=0,o++)}if(e>0){for(;e>=8;)t=t<<8|255&i[o],o++,e-=8;var u;e>0&&(t=t<<e|(i[o]&255>>(u=8-e)<<u)>>u,r+=e)}return this.bitOffset=r,this.byteOffset=o,t},n.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},n}();const JM=tne;var Zn=(()=>(function(n){n[n.PAD_ENCODE=0]="PAD_ENCODE",n[n.ASCII_ENCODE=1]="ASCII_ENCODE",n[n.C40_ENCODE=2]="C40_ENCODE",n[n.TEXT_ENCODE=3]="TEXT_ENCODE",n[n.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",n[n.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",n[n.BASE256_ENCODE=6]="BASE256_ENCODE"}(Zn||(Zn={})),Zn))(),nne=function(){function n(){}return n.decode=function(e){var t=new JM(e),r=new ct,o=new ct,i=new Array,a=Zn.ASCII_ENCODE;do{if(a===Zn.ASCII_ENCODE)a=this.decodeAsciiSegment(t,r,o);else{switch(a){case Zn.C40_ENCODE:this.decodeC40Segment(t,r);break;case Zn.TEXT_ENCODE:this.decodeTextSegment(t,r);break;case Zn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,r);break;case Zn.EDIFACT_ENCODE:this.decodeEdifactSegment(t,r);break;case Zn.BASE256_ENCODE:this.decodeBase256Segment(t,r,i);break;default:throw new le}a=Zn.ASCII_ENCODE}}while(a!==Zn.PAD_ENCODE&&t.available()>0);return o.length()>0&&r.append(o.toString()),new f0(e,r.toString(),0===i.length?null:i,null)},n.decodeAsciiSegment=function(e,t,r){var o=!1;do{var i=e.readBits(8);if(0===i)throw new le;if(i<=128)return o&&(i+=128),t.append(String.fromCharCode(i-1)),Zn.ASCII_ENCODE;if(129===i)return Zn.PAD_ENCODE;if(i<=229){var a=i-130;a<10&&t.append("0"),t.append(""+a)}else switch(i){case 230:return Zn.C40_ENCODE;case 231:return Zn.BASE256_ENCODE;case 232:t.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:o=!0;break;case 236:t.append("[)>\x1e05\x1d"),r.insert(0,"\x1e\x04");break;case 237:t.append("[)>\x1e06\x1d"),r.insert(0,"\x1e\x04");break;case 238:return Zn.ANSIX12_ENCODE;case 239:return Zn.TEXT_ENCODE;case 240:return Zn.EDIFACT_ENCODE;default:if(254!==i||0!==e.available())throw new le}}while(e.available()>0);return Zn.ASCII_ENCODE},n.decodeC40Segment=function(e,t){var r=!1,o=[],i=0;do{if(8===e.available())return;var a=e.readBits(8);if(254===a)return;this.parseTwoBytes(a,e.readBits(8),o);for(var s=0;s<3;s++){var u=o[s];switch(i){case 0:if(u<3)i=u+1;else{if(!(u<this.C40_BASIC_SET_CHARS.length))throw new le;var c=this.C40_BASIC_SET_CHARS[u];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c)}break;case 1:r?(t.append(String.fromCharCode(u+128)),r=!1):t.append(String.fromCharCode(u)),i=0;break;case 2:if(u<this.C40_SHIFT2_SET_CHARS.length)c=this.C40_SHIFT2_SET_CHARS[u],r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c);else switch(u){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new le}i=0;break;case 3:r?(t.append(String.fromCharCode(u+224)),r=!1):t.append(String.fromCharCode(u+96)),i=0;break;default:throw new le}}}while(e.available()>0)},n.decodeTextSegment=function(e,t){var r=!1,o=[],i=0;do{if(8===e.available())return;var a=e.readBits(8);if(254===a)return;this.parseTwoBytes(a,e.readBits(8),o);for(var s=0;s<3;s++){var u=o[s];switch(i){case 0:if(u<3)i=u+1;else{if(!(u<this.TEXT_BASIC_SET_CHARS.length))throw new le;var c=this.TEXT_BASIC_SET_CHARS[u];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c)}break;case 1:r?(t.append(String.fromCharCode(u+128)),r=!1):t.append(String.fromCharCode(u)),i=0;break;case 2:if(u<this.TEXT_SHIFT2_SET_CHARS.length)c=this.TEXT_SHIFT2_SET_CHARS[u],r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c);else switch(u){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new le}i=0;break;case 3:if(!(u<this.TEXT_SHIFT3_SET_CHARS.length))throw new le;c=this.TEXT_SHIFT3_SET_CHARS[u],r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c),i=0;break;default:throw new le}}}while(e.available()>0)},n.decodeAnsiX12Segment=function(e,t){var r=[];do{if(8===e.available())return;var o=e.readBits(8);if(254===o)return;this.parseTwoBytes(o,e.readBits(8),r);for(var i=0;i<3;i++){var a=r[i];switch(a){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(a<14)t.append(String.fromCharCode(a+44));else{if(!(a<40))throw new le;t.append(String.fromCharCode(a+51))}}}}while(e.available()>0)},n.parseTwoBytes=function(e,t,r){var o=(e<<8)+t-1,i=Math.floor(o/1600);r[0]=i,o-=1600*i,i=Math.floor(o/40),r[1]=i,r[2]=o-40*i},n.decodeEdifactSegment=function(e,t){do{if(e.available()<=16)return;for(var r=0;r<4;r++){var o=e.readBits(6);if(31===o){var i=8-e.getBitOffset();return void(8!==i&&e.readBits(i))}32&o||(o|=64),t.append(String.fromCharCode(o))}}while(e.available()>0)},n.decodeBase256Segment=function(e,t,r){var a,o=1+e.getByteOffset(),i=this.unrandomize255State(e.readBits(8),o++);if((a=0===i?e.available()/8|0:i<250?i:250*(i-249)+this.unrandomize255State(e.readBits(8),o++))<0)throw new le;for(var s=new Uint8Array(a),u=0;u<a;u++){if(e.available()<8)throw new le;s[u]=this.unrandomize255State(e.readBits(8),o++)}r.push(s);try{t.append(Ei.decode(s,Et.ISO88591))}catch(c){throw new La("Platform does not support required encoding: "+c.message)}},n.unrandomize255State=function(e,t){var o=e-(149*t%255+1);return o>=0?o:o+256},n.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],n.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n.TEXT_SHIFT2_SET_CHARS=n.C40_SHIFT2_SET_CHARS,n.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)],n}();const rne=nne;var ine=function(){function n(){this.rsDecoder=new h0(No.DATA_MATRIX_FIELD_256)}return n.prototype.decode=function(e){var t,r,o=new Qte(e),i=o.getVersion(),a=o.readCodewords(),s=ene.getDataBlocks(a,i),u=0;try{for(var c=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),l=c.next();!l.done;l=c.next())u+=l.value.getNumDataCodewords()}catch(x){t={error:x}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}for(var d=new Uint8Array(u),h=s.length,p=0;p<h;p++){var g=s[p],v=g.getCodewords(),m=g.getNumDataCodewords();this.correctErrors(v,m);for(var y=0;y<m;y++)d[y*h+p]=v[y]}return rne.decode(d)},n.prototype.correctErrors=function(e,t){var r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch{throw new Gn}for(var o=0;o<t;o++)e[o]=r[o]},n}();const ane=ine;var sne=function(){function n(e){this.image=e,this.rectangleDetector=new N_(this.image)}return n.prototype.detect=function(){var e=this.rectangleDetector.detect(),t=this.detectSolid1(e);if((t=this.detectSolid2(t))[3]=this.correctTopRight(t),!t[3])throw new Z;var r=(t=this.shiftToModuleCenter(t))[0],o=t[1],i=t[2],a=t[3],s=this.transitionsBetween(r,a)+1,u=this.transitionsBetween(i,a)+1;1==(1&s)&&(s+=1),1==(1&u)&&(u+=1),4*s<7*u&&4*u<7*s&&(s=u=Math.max(s,u));var c=n.sampleGrid(this.image,r,o,i,a,s,u);return new R_(c,[r,o,i,a])},n.shiftPoint=function(e,t,r){var o=(t.getX()-e.getX())/(r+1),i=(t.getY()-e.getY())/(r+1);return new Ne(e.getX()+o,e.getY()+i)},n.moveAway=function(e,t,r){var o=e.getX(),i=e.getY();return o<t?o-=1:o+=1,i<r?i-=1:i+=1,new Ne(o,i)},n.prototype.detectSolid1=function(e){var t=e[0],r=e[1],o=e[3],i=e[2],a=this.transitionsBetween(t,r),s=this.transitionsBetween(r,o),u=this.transitionsBetween(o,i),c=this.transitionsBetween(i,t),l=a,f=[i,t,r,o];return l>s&&(l=s,f[0]=t,f[1]=r,f[2]=o,f[3]=i),l>u&&(l=u,f[0]=r,f[1]=o,f[2]=i,f[3]=t),l>c&&(f[0]=o,f[1]=i,f[2]=t,f[3]=r),f},n.prototype.detectSolid2=function(e){var t=e[0],r=e[1],o=e[2],i=e[3],a=this.transitionsBetween(t,i),s=n.shiftPoint(r,o,4*(a+1)),u=n.shiftPoint(o,r,4*(a+1));return this.transitionsBetween(s,t)<this.transitionsBetween(u,i)?(e[0]=t,e[1]=r,e[2]=o,e[3]=i):(e[0]=r,e[1]=o,e[2]=i,e[3]=t),e},n.prototype.correctTopRight=function(e){var t=e[0],r=e[1],o=e[2],i=e[3],a=this.transitionsBetween(t,i),s=this.transitionsBetween(r,i),u=n.shiftPoint(t,r,4*(s+1)),c=n.shiftPoint(o,r,4*(a+1));a=this.transitionsBetween(u,i),s=this.transitionsBetween(c,i);var l=new Ne(i.getX()+(o.getX()-r.getX())/(a+1),i.getY()+(o.getY()-r.getY())/(a+1)),f=new Ne(i.getX()+(t.getX()-r.getX())/(s+1),i.getY()+(t.getY()-r.getY())/(s+1));return this.isValid(l)?this.isValid(f)?this.transitionsBetween(u,l)+this.transitionsBetween(c,l)>this.transitionsBetween(u,f)+this.transitionsBetween(c,f)?l:f:l:this.isValid(f)?f:null},n.prototype.shiftToModuleCenter=function(e){var t=e[0],r=e[1],o=e[2],i=e[3],a=this.transitionsBetween(t,i)+1,s=this.transitionsBetween(o,i)+1,u=n.shiftPoint(t,r,4*s),c=n.shiftPoint(o,r,4*a);1==(1&(a=this.transitionsBetween(u,i)+1))&&(a+=1),1==(1&(s=this.transitionsBetween(c,i)+1))&&(s+=1);var d,h,l=(t.getX()+r.getX()+o.getX()+i.getX())/4,f=(t.getY()+r.getY()+o.getY()+i.getY())/4;return t=n.moveAway(t,l,f),r=n.moveAway(r,l,f),o=n.moveAway(o,l,f),i=n.moveAway(i,l,f),u=n.shiftPoint(t,r,4*s),u=n.shiftPoint(u,i,4*a),d=n.shiftPoint(r,t,4*s),d=n.shiftPoint(d,o,4*a),c=n.shiftPoint(o,i,4*s),c=n.shiftPoint(c,r,4*a),h=n.shiftPoint(i,o,4*s),[u,d,c,h=n.shiftPoint(h,t,4*a)]},n.prototype.isValid=function(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()},n.sampleGrid=function(e,t,r,o,i,a,s){return O_.getInstance().sampleGrid(e,a,s,.5,.5,a-.5,.5,a-.5,s-.5,.5,s-.5,t.getX(),t.getY(),i.getX(),i.getY(),o.getX(),o.getY(),r.getX(),r.getY())},n.prototype.transitionsBetween=function(e,t){var r=Math.trunc(e.getX()),o=Math.trunc(e.getY()),i=Math.trunc(t.getX()),a=Math.trunc(t.getY()),s=Math.abs(a-o)>Math.abs(i-r);if(s){var u=r;r=o,o=u,u=i,i=a,a=u}for(var c=Math.abs(i-r),l=Math.abs(a-o),f=-c/2,d=o<a?1:-1,h=r<i?1:-1,p=0,g=this.image.get(s?o:r,s?r:o),v=r,m=o;v!==i;v+=h){var y=this.image.get(s?m:v,s?v:m);if(y!==g&&(p++,g=y),(f+=l)>0){if(m===a)break;m+=d,f-=c}}return p},n}();const une=sne;var cne=function(){function n(){this.decoder=new ane}return n.prototype.decode=function(e,t){var r,o;if(void 0===t&&(t=null),null!=t&&t.has(Kt.PURE_BARCODE)){var i=n.extractPureBits(e.getBlackMatrix());r=this.decoder.decode(i),o=n.NO_POINTS}else{var a=new une(e.getBlackMatrix()).detect();r=this.decoder.decode(a.getBits()),o=a.getPoints()}var s=r.getRawBytes(),u=new qr(r.getText(),s,8*s.length,o,Me.DATA_MATRIX,cn.currentTimeMillis()),c=r.getByteSegments();null!=c&&u.putMetadata(Rr.BYTE_SEGMENTS,c);var l=r.getECLevel();return null!=l&&u.putMetadata(Rr.ERROR_CORRECTION_LEVEL,l),u},n.prototype.reset=function(){},n.extractPureBits=function(e){var t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null==t||null==r)throw new Z;var o=this.moduleSize(t,e),i=t[1],s=t[0],c=(r[0]-s+1)/o,l=(r[1]-i+1)/o;if(c<=0||l<=0)throw new Z;var f=o/2;i+=f,s+=f;for(var d=new Ro(c,l),h=0;h<l;h++)for(var p=i+h*o,g=0;g<c;g++)e.get(s+g*o,p)&&d.set(g,h);return d},n.moduleSize=function(e,t){for(var r=t.getWidth(),o=e[0],i=e[1];o<r&&t.get(o,i);)o++;if(o===r)throw new Z;var a=o-e[0];if(0===a)throw new Z;return a},n.NO_POINTS=[],n}();const x0=cne;var lne=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),wc=(function(n){lne(function e(t){return void 0===t&&(t=500),n.call(this,new x0,t)||this},n)}(df),(()=>(function(n){n[n.L=0]="L",n[n.M=1]="M",n[n.Q=2]="Q",n[n.H=3]="H"}(wc||(wc={})),wc))()),fne=function(){function n(e,t,r){this.value=e,this.stringValue=t,this.bits=r,n.FOR_BITS.set(r,this),n.FOR_VALUE.set(e,this)}return n.prototype.getValue=function(){return this.value},n.prototype.getBits=function(){return this.bits},n.fromString=function(e){switch(e){case"L":return n.L;case"M":return n.M;case"Q":return n.Q;case"H":return n.H;default:throw new Wn(e+"not available")}},n.prototype.toString=function(){return this.stringValue},n.prototype.equals=function(e){return e instanceof n&&this.value===e.value},n.forBits=function(e){if(e<0||e>=n.FOR_BITS.size)throw new Ie;return n.FOR_BITS.get(e)},n.FOR_BITS=new Map,n.FOR_VALUE=new Map,n.L=new n(wc.L,"L",1),n.M=new n(wc.M,"M",0),n.Q=new n(wc.Q,"Q",3),n.H=new n(wc.H,"H",2),n}();const Es=fne;var hne=function(){function n(e){this.errorCorrectionLevel=Es.forBits(e>>3&3),this.dataMask=7&e}return n.numBitsDiffering=function(e,t){return ut.bitCount(e^t)},n.decodeFormatInformation=function(e,t){var r=n.doDecodeFormatInformation(e,t);return null!==r?r:n.doDecodeFormatInformation(e^n.FORMAT_INFO_MASK_QR,t^n.FORMAT_INFO_MASK_QR)},n.doDecodeFormatInformation=function(e,t){var r,o,i=Number.MAX_SAFE_INTEGER,a=0;try{for(var s=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n.FORMAT_INFO_DECODE_LOOKUP),u=s.next();!u.done;u=s.next()){var c=u.value,l=c[0];if(l===e||l===t)return new n(c[1]);var f=n.numBitsDiffering(e,l);f<i&&(a=c[1],i=f),e!==t&&(f=n.numBitsDiffering(t,l))<i&&(a=c[1],i=f)}}catch(d){r={error:d}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return i<=3?new n(a):null},n.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},n.prototype.getDataMask=function(){return this.dataMask},n.prototype.hashCode=function(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask},n.prototype.equals=function(e){return e instanceof n&&(this.errorCorrectionLevel===e.errorCorrectionLevel&&this.dataMask===e.dataMask)},n.FORMAT_INFO_MASK_QR=21522,n.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])],n}();const eP=hne;var gne=function(){function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.ecCodewordsPerBlock=e,this.ecBlocks=t}return n.prototype.getECCodewordsPerBlock=function(){return this.ecCodewordsPerBlock},n.prototype.getNumBlocks=function(){var e,t,r=0,o=this.ecBlocks;try{for(var i=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),a=i.next();!a.done;a=i.next())r+=a.value.getCount()}catch(u){e={error:u}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},n.prototype.getTotalECCodewords=function(){return this.ecCodewordsPerBlock*this.getNumBlocks()},n.prototype.getECBlocks=function(){return this.ecBlocks},n}();const z=gne;var vne=function(){function n(e,t){this.count=e,this.dataCodewords=t}return n.prototype.getCount=function(){return this.count},n.prototype.getDataCodewords=function(){return this.dataCodewords},n}();const R=vne;var mne=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yne=function(){function n(e,t){for(var r,o,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=i;var s=0,u=i[0].getECCodewordsPerBlock(),c=i[0].getECBlocks();try{for(var l=mne(c),f=l.next();!f.done;f=l.next()){var d=f.value;s+=d.getCount()*(d.getDataCodewords()+u)}}catch(h){r={error:h}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}this.totalCodewords=s}return n.prototype.getVersionNumber=function(){return this.versionNumber},n.prototype.getAlignmentPatternCenters=function(){return this.alignmentPatternCenters},n.prototype.getTotalCodewords=function(){return this.totalCodewords},n.prototype.getDimensionForVersion=function(){return 17+4*this.versionNumber},n.prototype.getECBlocksForLevel=function(e){return this.ecBlocks[e.getValue()]},n.getProvisionalVersionForDimension=function(e){if(e%4!=1)throw new le;try{return this.getVersionForNumber((e-17)/4)}catch{throw new le}},n.getVersionForNumber=function(e){if(e<1||e>40)throw new Ie;return n.VERSIONS[e-1]},n.decodeVersionInformation=function(e){for(var t=Number.MAX_SAFE_INTEGER,r=0,o=0;o<n.VERSION_DECODE_INFO.length;o++){var i=n.VERSION_DECODE_INFO[o];if(i===e)return n.getVersionForNumber(o+7);var a=eP.numBitsDiffering(e,i);a<t&&(r=o+7,t=a)}return t<=3?n.getVersionForNumber(r):null},n.prototype.buildFunctionPattern=function(){var e=this.getDimensionForVersion(),t=new Ro(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);for(var r=this.alignmentPatternCenters.length,o=0;o<r;o++)for(var i=this.alignmentPatternCenters[o]-2,a=0;a<r;a++)0===o&&(0===a||a===r-1)||o===r-1&&0===a||t.setRegion(this.alignmentPatternCenters[a]-2,i,5,5);return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t},n.prototype.toString=function(){return""+this.versionNumber},n.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),n.VERSIONS=[new n(1,new Int32Array(0),new z(7,new R(1,19)),new z(10,new R(1,16)),new z(13,new R(1,13)),new z(17,new R(1,9))),new n(2,Int32Array.from([6,18]),new z(10,new R(1,34)),new z(16,new R(1,28)),new z(22,new R(1,22)),new z(28,new R(1,16))),new n(3,Int32Array.from([6,22]),new z(15,new R(1,55)),new z(26,new R(1,44)),new z(18,new R(2,17)),new z(22,new R(2,13))),new n(4,Int32Array.from([6,26]),new z(20,new R(1,80)),new z(18,new R(2,32)),new z(26,new R(2,24)),new z(16,new R(4,9))),new n(5,Int32Array.from([6,30]),new z(26,new R(1,108)),new z(24,new R(2,43)),new z(18,new R(2,15),new R(2,16)),new z(22,new R(2,11),new R(2,12))),new n(6,Int32Array.from([6,34]),new z(18,new R(2,68)),new z(16,new R(4,27)),new z(24,new R(4,19)),new z(28,new R(4,15))),new n(7,Int32Array.from([6,22,38]),new z(20,new R(2,78)),new z(18,new R(4,31)),new z(18,new R(2,14),new R(4,15)),new z(26,new R(4,13),new R(1,14))),new n(8,Int32Array.from([6,24,42]),new z(24,new R(2,97)),new z(22,new R(2,38),new R(2,39)),new z(22,new R(4,18),new R(2,19)),new z(26,new R(4,14),new R(2,15))),new n(9,Int32Array.from([6,26,46]),new z(30,new R(2,116)),new z(22,new R(3,36),new R(2,37)),new z(20,new R(4,16),new R(4,17)),new z(24,new R(4,12),new R(4,13))),new n(10,Int32Array.from([6,28,50]),new z(18,new R(2,68),new R(2,69)),new z(26,new R(4,43),new R(1,44)),new z(24,new R(6,19),new R(2,20)),new z(28,new R(6,15),new R(2,16))),new n(11,Int32Array.from([6,30,54]),new z(20,new R(4,81)),new z(30,new R(1,50),new R(4,51)),new z(28,new R(4,22),new R(4,23)),new z(24,new R(3,12),new R(8,13))),new n(12,Int32Array.from([6,32,58]),new z(24,new R(2,92),new R(2,93)),new z(22,new R(6,36),new R(2,37)),new z(26,new R(4,20),new R(6,21)),new z(28,new R(7,14),new R(4,15))),new n(13,Int32Array.from([6,34,62]),new z(26,new R(4,107)),new z(22,new R(8,37),new R(1,38)),new z(24,new R(8,20),new R(4,21)),new z(22,new R(12,11),new R(4,12))),new n(14,Int32Array.from([6,26,46,66]),new z(30,new R(3,115),new R(1,116)),new z(24,new R(4,40),new R(5,41)),new z(20,new R(11,16),new R(5,17)),new z(24,new R(11,12),new R(5,13))),new n(15,Int32Array.from([6,26,48,70]),new z(22,new R(5,87),new R(1,88)),new z(24,new R(5,41),new R(5,42)),new z(30,new R(5,24),new R(7,25)),new z(24,new R(11,12),new R(7,13))),new n(16,Int32Array.from([6,26,50,74]),new z(24,new R(5,98),new R(1,99)),new z(28,new R(7,45),new R(3,46)),new z(24,new R(15,19),new R(2,20)),new z(30,new R(3,15),new R(13,16))),new n(17,Int32Array.from([6,30,54,78]),new z(28,new R(1,107),new R(5,108)),new z(28,new R(10,46),new R(1,47)),new z(28,new R(1,22),new R(15,23)),new z(28,new R(2,14),new R(17,15))),new n(18,Int32Array.from([6,30,56,82]),new z(30,new R(5,120),new R(1,121)),new z(26,new R(9,43),new R(4,44)),new z(28,new R(17,22),new R(1,23)),new z(28,new R(2,14),new R(19,15))),new n(19,Int32Array.from([6,30,58,86]),new z(28,new R(3,113),new R(4,114)),new z(26,new R(3,44),new R(11,45)),new z(26,new R(17,21),new R(4,22)),new z(26,new R(9,13),new R(16,14))),new n(20,Int32Array.from([6,34,62,90]),new z(28,new R(3,107),new R(5,108)),new z(26,new R(3,41),new R(13,42)),new z(30,new R(15,24),new R(5,25)),new z(28,new R(15,15),new R(10,16))),new n(21,Int32Array.from([6,28,50,72,94]),new z(28,new R(4,116),new R(4,117)),new z(26,new R(17,42)),new z(28,new R(17,22),new R(6,23)),new z(30,new R(19,16),new R(6,17))),new n(22,Int32Array.from([6,26,50,74,98]),new z(28,new R(2,111),new R(7,112)),new z(28,new R(17,46)),new z(30,new R(7,24),new R(16,25)),new z(24,new R(34,13))),new n(23,Int32Array.from([6,30,54,78,102]),new z(30,new R(4,121),new R(5,122)),new z(28,new R(4,47),new R(14,48)),new z(30,new R(11,24),new R(14,25)),new z(30,new R(16,15),new R(14,16))),new n(24,Int32Array.from([6,28,54,80,106]),new z(30,new R(6,117),new R(4,118)),new z(28,new R(6,45),new R(14,46)),new z(30,new R(11,24),new R(16,25)),new z(30,new R(30,16),new R(2,17))),new n(25,Int32Array.from([6,32,58,84,110]),new z(26,new R(8,106),new R(4,107)),new z(28,new R(8,47),new R(13,48)),new z(30,new R(7,24),new R(22,25)),new z(30,new R(22,15),new R(13,16))),new n(26,Int32Array.from([6,30,58,86,114]),new z(28,new R(10,114),new R(2,115)),new z(28,new R(19,46),new R(4,47)),new z(28,new R(28,22),new R(6,23)),new z(30,new R(33,16),new R(4,17))),new n(27,Int32Array.from([6,34,62,90,118]),new z(30,new R(8,122),new R(4,123)),new z(28,new R(22,45),new R(3,46)),new z(30,new R(8,23),new R(26,24)),new z(30,new R(12,15),new R(28,16))),new n(28,Int32Array.from([6,26,50,74,98,122]),new z(30,new R(3,117),new R(10,118)),new z(28,new R(3,45),new R(23,46)),new z(30,new R(4,24),new R(31,25)),new z(30,new R(11,15),new R(31,16))),new n(29,Int32Array.from([6,30,54,78,102,126]),new z(30,new R(7,116),new R(7,117)),new z(28,new R(21,45),new R(7,46)),new z(30,new R(1,23),new R(37,24)),new z(30,new R(19,15),new R(26,16))),new n(30,Int32Array.from([6,26,52,78,104,130]),new z(30,new R(5,115),new R(10,116)),new z(28,new R(19,47),new R(10,48)),new z(30,new R(15,24),new R(25,25)),new z(30,new R(23,15),new R(25,16))),new n(31,Int32Array.from([6,30,56,82,108,134]),new z(30,new R(13,115),new R(3,116)),new z(28,new R(2,46),new R(29,47)),new z(30,new R(42,24),new R(1,25)),new z(30,new R(23,15),new R(28,16))),new n(32,Int32Array.from([6,34,60,86,112,138]),new z(30,new R(17,115)),new z(28,new R(10,46),new R(23,47)),new z(30,new R(10,24),new R(35,25)),new z(30,new R(19,15),new R(35,16))),new n(33,Int32Array.from([6,30,58,86,114,142]),new z(30,new R(17,115),new R(1,116)),new z(28,new R(14,46),new R(21,47)),new z(30,new R(29,24),new R(19,25)),new z(30,new R(11,15),new R(46,16))),new n(34,Int32Array.from([6,34,62,90,118,146]),new z(30,new R(13,115),new R(6,116)),new z(28,new R(14,46),new R(23,47)),new z(30,new R(44,24),new R(7,25)),new z(30,new R(59,16),new R(1,17))),new n(35,Int32Array.from([6,30,54,78,102,126,150]),new z(30,new R(12,121),new R(7,122)),new z(28,new R(12,47),new R(26,48)),new z(30,new R(39,24),new R(14,25)),new z(30,new R(22,15),new R(41,16))),new n(36,Int32Array.from([6,24,50,76,102,128,154]),new z(30,new R(6,121),new R(14,122)),new z(28,new R(6,47),new R(34,48)),new z(30,new R(46,24),new R(10,25)),new z(30,new R(2,15),new R(64,16))),new n(37,Int32Array.from([6,28,54,80,106,132,158]),new z(30,new R(17,122),new R(4,123)),new z(28,new R(29,46),new R(14,47)),new z(30,new R(49,24),new R(10,25)),new z(30,new R(24,15),new R(46,16))),new n(38,Int32Array.from([6,32,58,84,110,136,162]),new z(30,new R(4,122),new R(18,123)),new z(28,new R(13,46),new R(32,47)),new z(30,new R(48,24),new R(14,25)),new z(30,new R(42,15),new R(32,16))),new n(39,Int32Array.from([6,26,54,82,110,138,166]),new z(30,new R(20,117),new R(4,118)),new z(28,new R(40,47),new R(7,48)),new z(30,new R(43,24),new R(22,25)),new z(30,new R(10,15),new R(67,16))),new n(40,Int32Array.from([6,30,58,86,114,142,170]),new z(30,new R(19,118),new R(6,119)),new z(28,new R(18,47),new R(31,48)),new z(30,new R(34,24),new R(34,25)),new z(30,new R(20,15),new R(61,16)))],n}();const _c=yne;var fr=(()=>(function(n){n[n.DATA_MASK_000=0]="DATA_MASK_000",n[n.DATA_MASK_001=1]="DATA_MASK_001",n[n.DATA_MASK_010=2]="DATA_MASK_010",n[n.DATA_MASK_011=3]="DATA_MASK_011",n[n.DATA_MASK_100=4]="DATA_MASK_100",n[n.DATA_MASK_101=5]="DATA_MASK_101",n[n.DATA_MASK_110=6]="DATA_MASK_110",n[n.DATA_MASK_111=7]="DATA_MASK_111"}(fr||(fr={})),fr))(),xne=function(){function n(e,t){this.value=e,this.isMasked=t}return n.prototype.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var o=0;o<t;o++)this.isMasked(r,o)&&e.flip(o,r)},n.values=new Map([[fr.DATA_MASK_000,new n(fr.DATA_MASK_000,function(e,t){return 0==(e+t&1)})],[fr.DATA_MASK_001,new n(fr.DATA_MASK_001,function(e,t){return 0==(1&e)})],[fr.DATA_MASK_010,new n(fr.DATA_MASK_010,function(e,t){return t%3==0})],[fr.DATA_MASK_011,new n(fr.DATA_MASK_011,function(e,t){return(e+t)%3==0})],[fr.DATA_MASK_100,new n(fr.DATA_MASK_100,function(e,t){return 0==(Math.floor(e/2)+Math.floor(t/3)&1)})],[fr.DATA_MASK_101,new n(fr.DATA_MASK_101,function(e,t){return e*t%6==0})],[fr.DATA_MASK_110,new n(fr.DATA_MASK_110,function(e,t){return e*t%6<3})],[fr.DATA_MASK_111,new n(fr.DATA_MASK_111,function(e,t){return 0==(e+t+e*t%3&1)})]]),n}();const tP=xne;var wne=function(){function n(e){var t=e.getHeight();if(t<21||1!=(3&t))throw new le;this.bitMatrix=e}return n.prototype.readFormatInformation=function(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;for(var e=0,t=0;t<6;t++)e=this.copyBit(t,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(var r=5;r>=0;r--)e=this.copyBit(8,r,e);var o=this.bitMatrix.getHeight(),i=0,a=o-7;for(r=o-1;r>=a;r--)i=this.copyBit(8,r,i);for(t=o-8;t<o;t++)i=this.copyBit(t,8,i);if(this.parsedFormatInfo=eP.decodeFormatInformation(e,i),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new le},n.prototype.readVersion=function(){if(null!=this.parsedVersion)return this.parsedVersion;var e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return _c.getVersionForNumber(t);for(var r=0,o=e-11,i=5;i>=0;i--)for(var a=e-9;a>=o;a--)r=this.copyBit(a,i,r);var s=_c.decodeVersionInformation(r);if(null!==s&&s.getDimensionForVersion()===e)return this.parsedVersion=s,s;for(r=0,a=5;a>=0;a--)for(i=e-9;i>=o;i--)r=this.copyBit(a,i,r);if(null!==(s=_c.decodeVersionInformation(r))&&s.getDimensionForVersion()===e)return this.parsedVersion=s,s;throw new le},n.prototype.copyBit=function(e,t,r){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?r<<1|1:r<<1},n.prototype.readCodewords=function(){var e=this.readFormatInformation(),t=this.readVersion(),r=tP.values.get(e.getDataMask()),o=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,o);for(var i=t.buildFunctionPattern(),a=!0,s=new Uint8Array(t.getTotalCodewords()),u=0,c=0,l=0,f=o-1;f>0;f-=2){6===f&&f--;for(var d=0;d<o;d++)for(var h=a?o-1-d:d,p=0;p<2;p++)i.get(f-p,h)||(l++,c<<=1,this.bitMatrix.get(f-p,h)&&(c|=1),8===l&&(s[u++]=c,l=0,c=0));a=!a}if(u!==t.getTotalCodewords())throw new le;return s},n.prototype.remask=function(){if(null!==this.parsedFormatInfo){var e=tP.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}},n.prototype.setMirror=function(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e},n.prototype.mirror=function(){for(var e=this.bitMatrix,t=0,r=e.getWidth();t<r;t++)for(var o=t+1,i=e.getHeight();o<i;o++)e.get(t,o)!==e.get(o,t)&&(e.flip(o,t),e.flip(t,o))},n}();const _ne=wne;var nP=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},bne=function(){function n(e,t){this.numDataCodewords=e,this.codewords=t}return n.getDataBlocks=function(e,t,r){var o,i,a,s;if(e.length!==t.getTotalCodewords())throw new Ie;var u=t.getECBlocksForLevel(r),c=0,l=u.getECBlocks();try{for(var f=nP(l),d=f.next();!d.done;d=f.next())c+=(h=d.value).getCount()}catch(L){o={error:L}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}var p=new Array(c),g=0;try{for(var v=nP(l),m=v.next();!m.done;m=v.next())for(var h=m.value,y=0;y<h.getCount();y++){var x=h.getDataCodewords(),w=u.getECCodewordsPerBlock()+x;p[g++]=new n(x,new Uint8Array(w))}}catch(L){a={error:L}}finally{try{m&&!m.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}for(var _=p[0].codewords.length,b=p.length-1;b>=0&&p[b].codewords.length!==_;)b--;b++;var E=_-u.getECCodewordsPerBlock(),S=0;for(y=0;y<E;y++)for(var A=0;A<g;A++)p[A].codewords[y]=e[S++];for(A=b;A<g;A++)p[A].codewords[E]=e[S++];var D=p[0].codewords.length;for(y=E;y<D;y++)for(A=0;A<g;A++)p[A].codewords[A<b?y:y+1]=e[S++];return p},n.prototype.getNumDataCodewords=function(){return this.numDataCodewords},n.prototype.getCodewords=function(){return this.codewords},n}();const Cne=bne;var ei=(()=>(function(n){n[n.TERMINATOR=0]="TERMINATOR",n[n.NUMERIC=1]="NUMERIC",n[n.ALPHANUMERIC=2]="ALPHANUMERIC",n[n.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",n[n.BYTE=4]="BYTE",n[n.ECI=5]="ECI",n[n.KANJI=6]="KANJI",n[n.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",n[n.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",n[n.HANZI=9]="HANZI"}(ei||(ei={})),ei))(),Ene=function(){function n(e,t,r,o){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=r,this.bits=o,n.FOR_BITS.set(o,this),n.FOR_VALUE.set(e,this)}return n.forBits=function(e){var t=n.FOR_BITS.get(e);if(void 0===t)throw new Ie;return t},n.prototype.getCharacterCountBits=function(e){var t=e.getVersionNumber();return this.characterCountBitsForVersions[t<=9?0:t<=26?1:2]},n.prototype.getValue=function(){return this.value},n.prototype.getBits=function(){return this.bits},n.prototype.equals=function(e){return e instanceof n&&this.value===e.value},n.prototype.toString=function(){return this.stringValue},n.FOR_BITS=new Map,n.FOR_VALUE=new Map,n.TERMINATOR=new n(ei.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),n.NUMERIC=new n(ei.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),n.ALPHANUMERIC=new n(ei.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),n.STRUCTURED_APPEND=new n(ei.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),n.BYTE=new n(ei.BYTE,"BYTE",Int32Array.from([8,16,16]),4),n.ECI=new n(ei.ECI,"ECI",Int32Array.from([0,0,0]),7),n.KANJI=new n(ei.KANJI,"KANJI",Int32Array.from([8,10,12]),8),n.FNC1_FIRST_POSITION=new n(ei.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),n.FNC1_SECOND_POSITION=new n(ei.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),n.HANZI=new n(ei.HANZI,"HANZI",Int32Array.from([8,10,12]),13),n}();const gn=Ene;var Sne=function(){function n(){}return n.decode=function(e,t,r,o){var i=new JM(e),a=new ct,s=new Array,u=-1,c=-1;try{var l=null,f=!1,d=void 0;do{if(i.available()<4)d=gn.TERMINATOR;else{var h=i.readBits(4);d=gn.forBits(h)}switch(d){case gn.TERMINATOR:break;case gn.FNC1_FIRST_POSITION:case gn.FNC1_SECOND_POSITION:f=!0;break;case gn.STRUCTURED_APPEND:if(i.available()<16)throw new le;u=i.readBits(8),c=i.readBits(8);break;case gn.ECI:var p=n.parseECIValue(i);if(null===(l=ur.getCharacterSetECIByValue(p)))throw new le;break;case gn.HANZI:var g=i.readBits(4),v=i.readBits(d.getCharacterCountBits(t));g===n.GB2312_SUBSET&&n.decodeHanziSegment(i,a,v);break;default:var m=i.readBits(d.getCharacterCountBits(t));switch(d){case gn.NUMERIC:n.decodeNumericSegment(i,a,m);break;case gn.ALPHANUMERIC:n.decodeAlphanumericSegment(i,a,m,f);break;case gn.BYTE:n.decodeByteSegment(i,a,m,l,s,o);break;case gn.KANJI:n.decodeKanjiSegment(i,a,m);break;default:throw new le}}}while(d!==gn.TERMINATOR)}catch{throw new le}return new f0(e,a.toString(),0===s.length?null:s,null===r?null:r.toString(),u,c)},n.decodeHanziSegment=function(e,t,r){if(13*r>e.available())throw new le;for(var o=new Uint8Array(2*r),i=0;r>0;){var a=e.readBits(13),s=a/96<<8&4294967295|a%96;o[i]=(s+=s<959?41377:42657)>>8&255,o[i+1]=255&s,i+=2,r--}try{t.append(Ei.decode(o,Et.GB2312))}catch(u){throw new le(u)}},n.decodeKanjiSegment=function(e,t,r){if(13*r>e.available())throw new le;for(var o=new Uint8Array(2*r),i=0;r>0;){var a=e.readBits(13),s=a/192<<8&4294967295|a%192;o[i]=(s+=s<7936?33088:49472)>>8,o[i+1]=s,i+=2,r--}try{t.append(Ei.decode(o,Et.SHIFT_JIS))}catch(u){throw new le(u)}},n.decodeByteSegment=function(e,t,r,o,i,a){if(8*r>e.available())throw new le;for(var s=new Uint8Array(r),u=0;u<r;u++)s[u]=e.readBits(8);var c;c=null===o?Et.guessEncoding(s,a):o.getName();try{t.append(Ei.decode(s,c))}catch(l){throw new le(l)}i.push(s)},n.toAlphaNumericChar=function(e){if(e>=n.ALPHANUMERIC_CHARS.length)throw new le;return n.ALPHANUMERIC_CHARS[e]},n.decodeAlphanumericSegment=function(e,t,r,o){for(var i=t.length();r>1;){if(e.available()<11)throw new le;var a=e.readBits(11);t.append(n.toAlphaNumericChar(Math.floor(a/45))),t.append(n.toAlphaNumericChar(a%45)),r-=2}if(1===r){if(e.available()<6)throw new le;t.append(n.toAlphaNumericChar(e.readBits(6)))}if(o)for(var s=i;s<t.length();s++)"%"===t.charAt(s)&&(s<t.length()-1&&"%"===t.charAt(s+1)?t.deleteCharAt(s+1):t.setCharAt(s,String.fromCharCode(29)))},n.decodeNumericSegment=function(e,t,r){for(;r>=3;){if(e.available()<10)throw new le;var o=e.readBits(10);if(o>=1e3)throw new le;t.append(n.toAlphaNumericChar(Math.floor(o/100))),t.append(n.toAlphaNumericChar(Math.floor(o/10)%10)),t.append(n.toAlphaNumericChar(o%10)),r-=3}if(2===r){if(e.available()<7)throw new le;var i=e.readBits(7);if(i>=100)throw new le;t.append(n.toAlphaNumericChar(Math.floor(i/10))),t.append(n.toAlphaNumericChar(i%10))}else if(1===r){if(e.available()<4)throw new le;var a=e.readBits(4);if(a>=10)throw new le;t.append(n.toAlphaNumericChar(a))}},n.parseECIValue=function(e){var t=e.readBits(8);if(!(128&t))return 127&t;if(128==(192&t))return(63&t)<<8&4294967295|e.readBits(8);if(192==(224&t))return(31&t)<<16&4294967295|e.readBits(16);throw new le},n.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",n.GB2312_SUBSET=1,n}();const Ane=Sne;var Ine=function(){function n(e){this.mirrored=e}return n.prototype.isMirrored=function(){return this.mirrored},n.prototype.applyMirroredCorrection=function(e){if(this.mirrored&&null!==e&&!(e.length<3)){var t=e[0];e[0]=e[2],e[2]=t}},n}();const rP=Ine;var oP=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dne=function(){function n(){this.rsDecoder=new h0(No.QR_CODE_FIELD_256)}return n.prototype.decodeBooleanArray=function(e,t){return this.decodeBitMatrix(Ro.parseFromBooleanArray(e),t)},n.prototype.decodeBitMatrix=function(e,t){var r=new _ne(e),o=null;try{return this.decodeBitMatrixParser(r,t)}catch(a){o=a}try{r.remask(),r.setMirror(!0),r.readVersion(),r.readFormatInformation(),r.mirror();var i=this.decodeBitMatrixParser(r,t);return i.setOther(new rP(!0)),i}catch(a){throw null!==o?o:a}},n.prototype.decodeBitMatrixParser=function(e,t){var r,o,i,a,s=e.readVersion(),u=e.readFormatInformation().getErrorCorrectionLevel(),c=e.readCodewords(),l=Cne.getDataBlocks(c,s,u),f=0;try{for(var d=oP(l),h=d.next();!h.done;h=d.next())f+=(p=h.value).getNumDataCodewords()}catch(b){r={error:b}}finally{try{h&&!h.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}var g=new Uint8Array(f),v=0;try{for(var m=oP(l),y=m.next();!y.done;y=m.next()){var p,x=(p=y.value).getCodewords(),w=p.getNumDataCodewords();this.correctErrors(x,w);for(var _=0;_<w;_++)g[v++]=x[_]}}catch(b){i={error:b}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}return Ane.decode(g,s,u,t)},n.prototype.correctErrors=function(e,t){var r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch{throw new Gn}for(var o=0;o<t;o++)e[o]=r[o]},n}();const Tne=Dne;var Rne=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Nne=function(n){function e(t,r,o){var i=n.call(this,t,r)||this;return i.estimatedModuleSize=o,i}return Rne(e,n),e.prototype.aboutEquals=function(t,r,o){if(Math.abs(r-this.getY())<=t&&Math.abs(o-this.getX())<=t){var i=Math.abs(t-this.estimatedModuleSize);return i<=1||i<=this.estimatedModuleSize}return!1},e.prototype.combineEstimate=function(t,r,o){return new e((this.getX()+r)/2,(this.getY()+t)/2,(this.estimatedModuleSize+o)/2)},e}(Ne);const One=Nne;var Pne=function(){function n(e,t,r,o,i,a,s){this.image=e,this.startX=t,this.startY=r,this.width=o,this.height=i,this.moduleSize=a,this.resultPointCallback=s,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}return n.prototype.find=function(){for(var e=this.startX,t=this.height,o=e+this.width,i=this.startY+t/2,a=new Int32Array(3),s=this.image,u=0;u<t;u++){var c=i+(1&u?-Math.floor((u+1)/2):Math.floor((u+1)/2));a[0]=0,a[1]=0,a[2]=0;for(var l=e;l<o&&!s.get(l,c);)l++;for(var f=0;l<o;){if(s.get(l,c))if(1===f)a[1]++;else if(2===f){var d;if(this.foundPatternCross(a)&&null!==(d=this.handlePossibleCenter(a,c,l)))return d;a[0]=a[2],a[1]=1,a[2]=0,f=1}else a[++f]++;else 1===f&&f++,a[f]++;l++}if(this.foundPatternCross(a)&&null!==(d=this.handlePossibleCenter(a,c,o)))return d}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new Z},n.centerFromEnd=function(e,t){return t-e[2]-e[1]/2},n.prototype.foundPatternCross=function(e){for(var t=this.moduleSize,r=t/2,o=0;o<3;o++)if(Math.abs(t-e[o])>=r)return!1;return!0},n.prototype.crossCheckVertical=function(e,t,r,o){var i=this.image,a=i.getHeight(),s=this.crossCheckStateCount;s[0]=0,s[1]=0,s[2]=0;for(var u=e;u>=0&&i.get(t,u)&&s[1]<=r;)s[1]++,u--;if(u<0||s[1]>r)return NaN;for(;u>=0&&!i.get(t,u)&&s[0]<=r;)s[0]++,u--;if(s[0]>r)return NaN;for(u=e+1;u<a&&i.get(t,u)&&s[1]<=r;)s[1]++,u++;if(u===a||s[1]>r)return NaN;for(;u<a&&!i.get(t,u)&&s[2]<=r;)s[2]++,u++;return s[2]>r||5*Math.abs(s[0]+s[1]+s[2]-o)>=2*o?NaN:this.foundPatternCross(s)?n.centerFromEnd(s,u):NaN},n.prototype.handlePossibleCenter=function(e,t,r){var o,i,a=e[0]+e[1]+e[2],s=n.centerFromEnd(e,r),u=this.crossCheckVertical(t,s,2*e[1],a);if(!isNaN(u)){var c=(e[0]+e[1]+e[2])/3;try{for(var l=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.possibleCenters),f=l.next();!f.done;f=l.next()){var d=f.value;if(d.aboutEquals(c,u,s))return d.combineEstimate(u,s,c)}}catch(p){o={error:p}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}var h=new One(s,u,c);this.possibleCenters.push(h),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(h)}return null},n}();const kne=Pne;var Fne=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Lne=function(n){function e(t,r,o,i){var a=n.call(this,t,r)||this;return a.estimatedModuleSize=o,a.count=i,void 0===i&&(a.count=1),a}return Fne(e,n),e.prototype.getEstimatedModuleSize=function(){return this.estimatedModuleSize},e.prototype.getCount=function(){return this.count},e.prototype.aboutEquals=function(t,r,o){if(Math.abs(r-this.getY())<=t&&Math.abs(o-this.getX())<=t){var i=Math.abs(t-this.estimatedModuleSize);return i<=1||i<=this.estimatedModuleSize}return!1},e.prototype.combineEstimate=function(t,r,o){var i=this.count+1;return new e((this.count*this.getX()+r)/i,(this.count*this.getY()+t)/i,(this.count*this.estimatedModuleSize+o)/i,i)},e}(Ne);const Bne=Lne;var Vne=function(){function n(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}return n.prototype.getBottomLeft=function(){return this.bottomLeft},n.prototype.getTopLeft=function(){return this.topLeft},n.prototype.getTopRight=function(){return this.topRight},n}();const Une=Vne;var Dh=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Hne=function(){function n(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}return n.prototype.getImage=function(){return this.image},n.prototype.getPossibleCenters=function(){return this.possibleCenters},n.prototype.find=function(e){var t=null!=e&&void 0!==e.get(Kt.TRY_HARDER),r=null!=e&&void 0!==e.get(Kt.PURE_BARCODE),o=this.image,i=o.getHeight(),a=o.getWidth(),s=Math.floor(3*i/(4*n.MAX_MODULES));(s<n.MIN_SKIP||t)&&(s=n.MIN_SKIP);for(var u=!1,c=new Int32Array(5),l=s-1;l<i&&!u;l+=s){c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0;for(var f=0,d=0;d<a;d++)if(o.get(d,l))1==(1&f)&&f++,c[f]++;else if(1&f)c[f]++;else if(4===f)if(n.foundPatternCross(c)){if(!0!==this.handlePossibleCenter(c,l,d,r)){c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,f=3;continue}if(s=2,!0===this.hasSkipped)u=this.haveMultiplyConfirmedCenters();else{var p=this.findRowSkip();p>c[2]&&(l+=p-c[2]-s,d=a-1)}f=0,c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0}else c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,f=3;else c[++f]++;n.foundPatternCross(c)&&!0===this.handlePossibleCenter(c,l,a,r)&&(s=c[0],this.hasSkipped&&(u=this.haveMultiplyConfirmedCenters()))}var g=this.selectBestPatterns();return Ne.orderBestPatterns(g),new Une(g)},n.centerFromEnd=function(e,t){return t-e[4]-e[3]-e[2]/2},n.foundPatternCross=function(e){for(var t=0,r=0;r<5;r++){var o=e[r];if(0===o)return!1;t+=o}if(t<7)return!1;var i=t/7,a=i/2;return Math.abs(i-e[0])<a&&Math.abs(i-e[1])<a&&Math.abs(3*i-e[2])<3*a&&Math.abs(i-e[3])<a&&Math.abs(i-e[4])<a},n.prototype.getCrossCheckStateCount=function(){var e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e},n.prototype.crossCheckDiagonal=function(e,t,r,o){for(var i=this.getCrossCheckStateCount(),a=0,s=this.image;e>=a&&t>=a&&s.get(t-a,e-a);)i[2]++,a++;if(e<a||t<a)return!1;for(;e>=a&&t>=a&&!s.get(t-a,e-a)&&i[1]<=r;)i[1]++,a++;if(e<a||t<a||i[1]>r)return!1;for(;e>=a&&t>=a&&s.get(t-a,e-a)&&i[0]<=r;)i[0]++,a++;if(i[0]>r)return!1;var u=s.getHeight(),c=s.getWidth();for(a=1;e+a<u&&t+a<c&&s.get(t+a,e+a);)i[2]++,a++;if(e+a>=u||t+a>=c)return!1;for(;e+a<u&&t+a<c&&!s.get(t+a,e+a)&&i[3]<r;)i[3]++,a++;if(e+a>=u||t+a>=c||i[3]>=r)return!1;for(;e+a<u&&t+a<c&&s.get(t+a,e+a)&&i[4]<r;)i[4]++,a++;return!(i[4]>=r)&&Math.abs(i[0]+i[1]+i[2]+i[3]+i[4]-o)<2*o&&n.foundPatternCross(i)},n.prototype.crossCheckVertical=function(e,t,r,o){for(var i=this.image,a=i.getHeight(),s=this.getCrossCheckStateCount(),u=e;u>=0&&i.get(t,u);)s[2]++,u--;if(u<0)return NaN;for(;u>=0&&!i.get(t,u)&&s[1]<=r;)s[1]++,u--;if(u<0||s[1]>r)return NaN;for(;u>=0&&i.get(t,u)&&s[0]<=r;)s[0]++,u--;if(s[0]>r)return NaN;for(u=e+1;u<a&&i.get(t,u);)s[2]++,u++;if(u===a)return NaN;for(;u<a&&!i.get(t,u)&&s[3]<r;)s[3]++,u++;if(u===a||s[3]>=r)return NaN;for(;u<a&&i.get(t,u)&&s[4]<r;)s[4]++,u++;return s[4]>=r||5*Math.abs(s[0]+s[1]+s[2]+s[3]+s[4]-o)>=2*o?NaN:n.foundPatternCross(s)?n.centerFromEnd(s,u):NaN},n.prototype.crossCheckHorizontal=function(e,t,r,o){for(var i=this.image,a=i.getWidth(),s=this.getCrossCheckStateCount(),u=e;u>=0&&i.get(u,t);)s[2]++,u--;if(u<0)return NaN;for(;u>=0&&!i.get(u,t)&&s[1]<=r;)s[1]++,u--;if(u<0||s[1]>r)return NaN;for(;u>=0&&i.get(u,t)&&s[0]<=r;)s[0]++,u--;if(s[0]>r)return NaN;for(u=e+1;u<a&&i.get(u,t);)s[2]++,u++;if(u===a)return NaN;for(;u<a&&!i.get(u,t)&&s[3]<r;)s[3]++,u++;if(u===a||s[3]>=r)return NaN;for(;u<a&&i.get(u,t)&&s[4]<r;)s[4]++,u++;return s[4]>=r||5*Math.abs(s[0]+s[1]+s[2]+s[3]+s[4]-o)>=o?NaN:n.foundPatternCross(s)?n.centerFromEnd(s,u):NaN},n.prototype.handlePossibleCenter=function(e,t,r,o){var i=e[0]+e[1]+e[2]+e[3]+e[4],a=n.centerFromEnd(e,r),s=this.crossCheckVertical(t,Math.floor(a),e[2],i);if(!isNaN(s)&&(a=this.crossCheckHorizontal(Math.floor(a),Math.floor(s),e[2],i),!isNaN(a)&&(!o||this.crossCheckDiagonal(Math.floor(s),Math.floor(a),e[2],i)))){for(var u=i/7,c=!1,l=this.possibleCenters,f=0,d=l.length;f<d;f++){var h=l[f];if(h.aboutEquals(u,s,a)){l[f]=h.combineEstimate(s,a,u),c=!0;break}}if(!c){var p=new Bne(a,s,u);l.push(p),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(p)}return!0}return!1},n.prototype.findRowSkip=function(){var e,t;if(this.possibleCenters.length<=1)return 0;var o=null;try{for(var i=Dh(this.possibleCenters),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.getCount()>=n.CENTER_QUORUM){if(null!=o)return this.hasSkipped=!0,Math.floor((Math.abs(o.getX()-s.getX())-Math.abs(o.getY()-s.getY()))/2);o=s}}}catch(u){e={error:u}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return 0},n.prototype.haveMultiplyConfirmedCenters=function(){var e,t,r,o,i=0,a=0,s=this.possibleCenters.length;try{for(var u=Dh(this.possibleCenters),c=u.next();!c.done;c=u.next())(l=c.value).getCount()>=n.CENTER_QUORUM&&(i++,a+=l.getEstimatedModuleSize())}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}if(i<3)return!1;var f=a/s,d=0;try{for(var h=Dh(this.possibleCenters),p=h.next();!p.done;p=h.next()){var l=p.value;d+=Math.abs(l.getEstimatedModuleSize()-f)}}catch(g){r={error:g}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}return d<=.05*a},n.prototype.selectBestPatterns=function(){var e,t,r,o,i=this.possibleCenters.length;if(i<3)throw new Z;var s,a=this.possibleCenters;if(i>3){var u=0,c=0;try{for(var l=Dh(this.possibleCenters),f=l.next();!f.done;f=l.next()){var h=f.value.getEstimatedModuleSize();u+=h,c+=h*h}}catch(_){e={error:_}}finally{try{f&&!f.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}s=u/i;var p=Math.sqrt(c/i-s*s);a.sort(function(_,b){var C=Math.abs(b.getEstimatedModuleSize()-s),E=Math.abs(_.getEstimatedModuleSize()-s);return C<E?-1:C>E?1:0});for(var g=Math.max(.2*s,p),v=0;v<a.length&&a.length>3;v++)Math.abs(a[v].getEstimatedModuleSize()-s)>g&&(a.splice(v,1),v--)}if(a.length>3){u=0;try{for(var y=Dh(a),x=y.next();!x.done;x=y.next())u+=x.value.getEstimatedModuleSize()}catch(b){r={error:b}}finally{try{x&&!x.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}s=u/a.length,a.sort(function(b,C){if(C.getCount()===b.getCount()){var E=Math.abs(C.getEstimatedModuleSize()-s),S=Math.abs(b.getEstimatedModuleSize()-s);return E<S?1:E>S?-1:0}return C.getCount()-b.getCount()}),a.splice(3)}return[a[0],a[1],a[2]]},n.CENTER_QUORUM=2,n.MIN_SKIP=3,n.MAX_MODULES=57,n}();const Wne=Hne;var Gne=function(){function n(e){this.image=e}return n.prototype.getImage=function(){return this.image},n.prototype.getResultPointCallback=function(){return this.resultPointCallback},n.prototype.detect=function(e){this.resultPointCallback=null==e?null:e.get(Kt.NEED_RESULT_POINT_CALLBACK);var r=new Wne(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(r)},n.prototype.processFinderPatternInfo=function(e){var t=e.getTopLeft(),r=e.getTopRight(),o=e.getBottomLeft(),i=this.calculateModuleSize(t,r,o);if(i<1)throw new Z("No pattern found in proccess finder.");var a=n.computeDimension(t,r,o,i),s=_c.getProvisionalVersionForDimension(a),u=s.getDimensionForVersion()-7,c=null;if(s.getAlignmentPatternCenters().length>0)for(var l=r.getX()-t.getX()+o.getX(),f=r.getY()-t.getY()+o.getY(),d=1-3/u,h=Math.floor(t.getX()+d*(l-t.getX())),p=Math.floor(t.getY()+d*(f-t.getY())),g=4;g<=16;g<<=1)try{c=this.findAlignmentInRegion(i,h,p,g);break}catch(x){if(!(x instanceof Z))throw x}var v=n.createTransform(t,r,o,c,a),m=n.sampleGrid(this.image,v,a);return new R_(m,null===c?[o,t,r]:[o,t,r,c])},n.createTransform=function(e,t,r,o,i){var s,u,c,l,a=i-3.5;return null!==o?(s=o.getX(),u=o.getY(),l=c=a-3):(s=t.getX()-e.getX()+r.getX(),u=t.getY()-e.getY()+r.getY(),c=a,l=a),kM.quadrilateralToQuadrilateral(3.5,3.5,a,3.5,c,l,3.5,a,e.getX(),e.getY(),t.getX(),t.getY(),s,u,r.getX(),r.getY())},n.sampleGrid=function(e,t,r){return O_.getInstance().sampleGridWithTransform(e,r,r,t)},n.computeDimension=function(e,t,r,o){var i=Pt.round(Ne.distance(e,t)/o),a=Pt.round(Ne.distance(e,r)/o),s=Math.floor((i+a)/2)+7;switch(3&s){case 0:s++;break;case 2:s--;break;case 3:throw new Z("Dimensions could be not found.")}return s},n.prototype.calculateModuleSize=function(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2},n.prototype.calculateModuleSizeOneWay=function(e,t){var r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),o=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(r)?o/7:isNaN(o)?r/7:(r+o)/14},n.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,t,r,o){var i=this.sizeOfBlackWhiteBlackRun(e,t,r,o),a=1,s=e-(r-e);s<0?(a=e/(e-s),s=0):s>=this.image.getWidth()&&(a=(this.image.getWidth()-1-e)/(s-e),s=this.image.getWidth()-1);var u=Math.floor(t-(o-t)*a);return a=1,u<0?(a=t/(t-u),u=0):u>=this.image.getHeight()&&(a=(this.image.getHeight()-1-t)/(u-t),u=this.image.getHeight()-1),s=Math.floor(e+(s-e)*a),(i+=this.sizeOfBlackWhiteBlackRun(e,t,s,u))-1},n.prototype.sizeOfBlackWhiteBlackRun=function(e,t,r,o){var i=Math.abs(o-t)>Math.abs(r-e);if(i){var a=e;e=t,t=a,a=r,r=o,o=a}for(var s=Math.abs(r-e),u=Math.abs(o-t),c=-s/2,l=e<r?1:-1,f=t<o?1:-1,d=0,h=r+l,p=e,g=t;p!==h;p+=l){if(1===d===this.image.get(i?g:p,i?p:g)){if(2===d)return Pt.distance(p,g,e,t);d++}if((c+=u)>0){if(g===o)break;g+=f,c-=s}}return 2===d?Pt.distance(r+l,o,e,t):NaN},n.prototype.findAlignmentInRegion=function(e,t,r,o){var i=Math.floor(o*e),a=Math.max(0,t-i),s=Math.min(this.image.getWidth()-1,t+i);if(s-a<3*e)throw new Z("Alignment top exceeds estimated module size.");var u=Math.max(0,r-i),c=Math.min(this.image.getHeight()-1,r+i);if(c-u<3*e)throw new Z("Alignment bottom exceeds estimated module size.");return new kne(this.image,a,u,s-a,c-u,e,this.resultPointCallback).find()},n}();const zne=Gne;var jne=function(){function n(){this.decoder=new Tne}return n.prototype.getDecoder=function(){return this.decoder},n.prototype.decode=function(e,t){var r,o;if(null!=t&&void 0!==t.get(Kt.PURE_BARCODE)){var i=n.extractPureBits(e.getBlackMatrix());r=this.decoder.decodeBitMatrix(i,t),o=n.NO_POINTS}else{var a=new zne(e.getBlackMatrix()).detect(t);r=this.decoder.decodeBitMatrix(a.getBits(),t),o=a.getPoints()}r.getOther()instanceof rP&&r.getOther().applyMirroredCorrection(o);var s=new qr(r.getText(),r.getRawBytes(),void 0,o,Me.QR_CODE,void 0),u=r.getByteSegments();null!==u&&s.putMetadata(Rr.BYTE_SEGMENTS,u);var c=r.getECLevel();return null!==c&&s.putMetadata(Rr.ERROR_CORRECTION_LEVEL,c),r.hasStructuredAppend()&&(s.putMetadata(Rr.STRUCTURED_APPEND_SEQUENCE,r.getStructuredAppendSequenceNumber()),s.putMetadata(Rr.STRUCTURED_APPEND_PARITY,r.getStructuredAppendParity())),s},n.prototype.reset=function(){},n.extractPureBits=function(e){var t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null===t||null===r)throw new Z;var o=this.moduleSize(t,e),i=t[1],a=r[1],s=t[0],u=r[0];if(s>=u||i>=a)throw new Z;if(a-i!=u-s&&(u=s+(a-i))>=e.getWidth())throw new Z;var c=Math.round((u-s+1)/o),l=Math.round((a-i+1)/o);if(c<=0||l<=0)throw new Z;if(l!==c)throw new Z;var f=Math.floor(o/2);i+=f;var d=(s+=f)+Math.floor((c-1)*o)-u;if(d>0){if(d>f)throw new Z;s-=d}var h=i+Math.floor((l-1)*o)-a;if(h>0){if(h>f)throw new Z;i-=h}for(var p=new Ro(c,l),g=0;g<l;g++)for(var v=i+Math.floor(g*o),m=0;m<c;m++)e.get(s+Math.floor(m*o),v)&&p.set(m,g);return p},n.moduleSize=function(e,t){for(var r=t.getHeight(),o=t.getWidth(),i=e[0],a=e[1],s=!0,u=0;i<o&&a<r;){if(s!==t.get(i,a)){if(5==++u)break;s=!s}i++,a++}if(i===o||a===r)throw new Z;return(i-e[0])/7},n.NO_POINTS=new Array,n}();const w0=jne;var qne=function(){function n(){}return n.prototype.PDF417Common=function(){},n.getBitCountSum=function(e){return Pt.sum(e)},n.toIntArray=function(e){var t,r;if(null==e||!e.length)return n.EMPTY_INT_ARRAY;var o=new Int32Array(e.length),i=0;try{for(var a=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),s=a.next();!s.done;s=a.next())o[i++]=s.value}catch(c){t={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return o},n.getCodeword=function(e){var t=Yn.binarySearch(n.SYMBOL_TABLE,262143&e);return t<0?-1:(n.CODEWORD_TABLE[t]-1)%n.NUMBER_OF_CODEWORDS},n.MAX_CODEWORDS_IN_BARCODE=(n.NUMBER_OF_CODEWORDS=929)-1,n.MIN_ROWS_IN_BARCODE=3,n.MAX_ROWS_IN_BARCODE=90,n.MODULES_IN_CODEWORD=17,n.MODULES_IN_STOP_PATTERN=18,n.BARS_IN_MODULE=8,n.EMPTY_INT_ARRAY=new Int32Array([]),n.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),n.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]),n}();const Rt=qne;var Xne=function(){function n(e,t){this.bits=e,this.points=t}return n.prototype.getBits=function(){return this.bits},n.prototype.getPoints=function(){return this.points},n}();const Kne=Xne;var Yne=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zne=function(){function n(){}return n.detectMultiple=function(e,t,r){var o=e.getBlackMatrix(),i=n.detect(r,o);return i.length||((o=o.clone()).rotate180(),i=n.detect(r,o)),new Kne(o,i)},n.detect=function(e,t){for(var r,o,i=new Array,a=0,s=0,u=!1;a<t.getHeight();){var c=n.findVertices(t,a,s);if(null!=c[0]||null!=c[3]){if(u=!0,i.push(c),!e)break;null!=c[2]?(s=Math.trunc(c[2].getX()),a=Math.trunc(c[2].getY())):(s=Math.trunc(c[4].getX()),a=Math.trunc(c[4].getY()))}else{if(!u)break;u=!1,s=0;try{for(var l=(r=void 0,Yne(i)),f=l.next();!f.done;f=l.next()){var d=f.value;null!=d[1]&&(a=Math.trunc(Math.max(a,d[1].getY()))),null!=d[3]&&(a=Math.max(a,Math.trunc(d[3].getY())))}}catch(h){r={error:h}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}a+=n.ROW_STEP}}return i},n.findVertices=function(e,t,r){var o=e.getHeight(),i=e.getWidth(),a=new Array(8);return n.copyToResult(a,n.findRowsWithPattern(e,o,i,t,r,n.START_PATTERN),n.INDEXES_START_PATTERN),null!=a[4]&&(r=Math.trunc(a[4].getX()),t=Math.trunc(a[4].getY())),n.copyToResult(a,n.findRowsWithPattern(e,o,i,t,r,n.STOP_PATTERN),n.INDEXES_STOP_PATTERN),a},n.copyToResult=function(e,t,r){for(var o=0;o<r.length;o++)e[r[o]]=t[o]},n.findRowsWithPattern=function(e,t,r,o,i,a){for(var s=new Array(4),u=!1,c=new Int32Array(a.length);o<t;o+=n.ROW_STEP)if(null!=(l=n.findGuardPattern(e,i,o,r,!1,a,c))){for(;o>0;){if(null==(f=n.findGuardPattern(e,i,--o,r,!1,a,c))){o++;break}l=f}s[0]=new Ne(l[0],o),s[1]=new Ne(l[1],o),u=!0;break}var d=o+1;if(u){for(var h=0,f=Int32Array.from([Math.trunc(s[0].getX()),Math.trunc(s[1].getX())]);d<t;d++){var l;if(null!=(l=n.findGuardPattern(e,f[0],d,r,!1,a,c))&&Math.abs(f[0]-l[0])<n.MAX_PATTERN_DRIFT&&Math.abs(f[1]-l[1])<n.MAX_PATTERN_DRIFT)f=l,h=0;else{if(h>n.SKIPPED_ROW_COUNT_MAX)break;h++}}s[2]=new Ne(f[0],d-=h+1),s[3]=new Ne(f[1],d)}return d-o<n.BARCODE_MIN_HEIGHT&&Yn.fill(s,null),s},n.findGuardPattern=function(e,t,r,o,i,a,s){Yn.fillWithin(s,0,s.length,0);for(var u=t,c=0;e.get(u,r)&&u>0&&c++<n.MAX_PIXEL_DRIFT;)u--;for(var l=u,f=0,d=a.length,h=i;l<o;l++)if(e.get(l,r)!==h)s[f]++;else{if(f===d-1){if(n.patternMatchVariance(s,a,n.MAX_INDIVIDUAL_VARIANCE)<n.MAX_AVG_VARIANCE)return new Int32Array([u,l]);u+=s[0]+s[1],cn.arraycopy(s,2,s,0,f-1),s[f-1]=0,s[f]=0,f--}else f++;s[f]=1,h=!h}return f===d-1&&n.patternMatchVariance(s,a,n.MAX_INDIVIDUAL_VARIANCE)<n.MAX_AVG_VARIANCE?new Int32Array([u,l-1]):null},n.patternMatchVariance=function(e,t,r){for(var o=e.length,i=0,a=0,s=0;s<o;s++)i+=e[s],a+=t[s];if(i<a)return 1/0;var u=i/a;r*=u;for(var c=0,l=0;l<o;l++){var f=e[l],d=t[l]*u,h=f>d?f-d:d-f;if(h>r)return 1/0;c+=h}return c/i},n.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),n.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),n.MAX_AVG_VARIANCE=.42,n.MAX_INDIVIDUAL_VARIANCE=.8,n.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),n.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),n.MAX_PIXEL_DRIFT=3,n.MAX_PATTERN_DRIFT=5,n.SKIPPED_ROW_COUNT_MAX=25,n.ROW_STEP=5,n.BARCODE_MIN_HEIGHT=10,n}();const Qne=Zne;var ere=function(){function n(e,t){if(0===t.length)throw new Ie;this.field=e;var r=t.length;if(r>1&&0===t[0]){for(var o=1;o<r&&0===t[o];)o++;o===r?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(r-o),cn.arraycopy(t,o,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}return n.prototype.getCoefficients=function(){return this.coefficients},n.prototype.getDegree=function(){return this.coefficients.length-1},n.prototype.isZero=function(){return 0===this.coefficients[0]},n.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},n.prototype.evaluateAt=function(e){var t,r;if(0===e)return this.getCoefficient(0);if(1===e){var o=0;try{for(var i=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.coefficients),a=i.next();!a.done;a=i.next())o=this.field.add(o,a.value)}catch(f){t={error:f}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return o}for(var u=this.coefficients[0],c=this.coefficients.length,l=1;l<c;l++)u=this.field.add(this.field.multiply(e,u),this.coefficients[l]);return u},n.prototype.add=function(e){if(!this.field.equals(e.field))throw new Ie("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;var t=this.coefficients,r=e.coefficients;if(t.length>r.length){var o=t;t=r,r=o}var i=new Int32Array(r.length),a=r.length-t.length;cn.arraycopy(r,0,i,0,a);for(var s=a;s<r.length;s++)i[s]=this.field.add(t[s-a],r[s]);return new n(this.field,i)},n.prototype.subtract=function(e){if(!this.field.equals(e.field))throw new Ie("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())},n.prototype.multiply=function(e){return e instanceof n?this.multiplyOther(e):this.multiplyScalar(e)},n.prototype.multiplyOther=function(e){if(!this.field.equals(e.field))throw new Ie("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new n(this.field,new Int32Array([0]));for(var t=this.coefficients,r=t.length,o=e.coefficients,i=o.length,a=new Int32Array(r+i-1),s=0;s<r;s++)for(var u=t[s],c=0;c<i;c++)a[s+c]=this.field.add(a[s+c],this.field.multiply(u,o[c]));return new n(this.field,a)},n.prototype.negative=function(){for(var e=this.coefficients.length,t=new Int32Array(e),r=0;r<e;r++)t[r]=this.field.subtract(0,this.coefficients[r]);return new n(this.field,t)},n.prototype.multiplyScalar=function(e){if(0===e)return new n(this.field,new Int32Array([0]));if(1===e)return this;for(var t=this.coefficients.length,r=new Int32Array(t),o=0;o<t;o++)r[o]=this.field.multiply(this.coefficients[o],e);return new n(this.field,r)},n.prototype.multiplyByMonomial=function(e,t){if(e<0)throw new Ie;if(0===t)return new n(this.field,new Int32Array([0]));for(var r=this.coefficients.length,o=new Int32Array(r+e),i=0;i<r;i++)o[i]=this.field.multiply(this.coefficients[i],t);return new n(this.field,o)},n.prototype.toString=function(){for(var e=new ct,t=this.getDegree();t>=0;t--){var r=this.getCoefficient(t);0!==r&&(r<0?(e.append(" - "),r=-r):e.length()>0&&e.append(" + "),(0===t||1!==r)&&e.append(r),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()},n}();const bc=ere;var tre=function(){function n(){}return n.prototype.add=function(e,t){return(e+t)%this.modulus},n.prototype.subtract=function(e,t){return(this.modulus+e-t)%this.modulus},n.prototype.exp=function(e){return this.expTable[e]},n.prototype.log=function(e){if(0===e)throw new Ie;return this.logTable[e]},n.prototype.inverse=function(e){if(0===e)throw new OM;return this.expTable[this.modulus-this.logTable[e]-1]},n.prototype.multiply=function(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]},n.prototype.getSize=function(){return this.modulus},n.prototype.equals=function(e){return e===this},n}();const nre=tre;var rre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),ore=function(n){function e(t,r){var o=n.call(this)||this;o.modulus=t,o.expTable=new Int32Array(t),o.logTable=new Int32Array(t);for(var i=1,a=0;a<t;a++)o.expTable[a]=i,i=i*r%t;for(a=0;a<t-1;a++)o.logTable[o.expTable[a]]=a;return o.zero=new bc(o,new Int32Array([0])),o.one=new bc(o,new Int32Array([1])),o}return rre(e,n),e.prototype.getZero=function(){return this.zero},e.prototype.getOne=function(){return this.one},e.prototype.buildMonomial=function(t,r){if(t<0)throw new Ie;if(0===r)return this.zero;var o=new Int32Array(t+1);return o[0]=r,new bc(this,o)},e.PDF417_GF=new e(Rt.NUMBER_OF_CODEWORDS,3),e}(nre);const ire=ore;var sre=function(){function n(){this.field=ire.PDF417_GF}return n.prototype.decode=function(e,t,r){for(var o,i,a=new bc(this.field,e),s=new Int32Array(t),u=!1,c=t;c>0;c--){var l=a.evaluateAt(this.field.exp(c));s[t-c]=l,0!==l&&(u=!0)}if(!u)return 0;var f=this.field.getOne();if(null!=r)try{for(var d=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),h=d.next();!h.done;h=d.next()){var g=this.field.exp(e.length-1-h.value),v=new bc(this.field,new Int32Array([this.field.subtract(0,g),1]));f=f.multiply(v)}}catch(E){o={error:E}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}var m=new bc(this.field,s),y=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),m,t),x=y[0],w=y[1],_=this.findErrorLocations(x),b=this.findErrorMagnitudes(w,x,_);for(c=0;c<_.length;c++){var C=e.length-1-this.field.log(_[c]);if(C<0)throw Gn.getChecksumInstance();e[C]=this.field.subtract(e[C],b[c])}return _.length},n.prototype.runEuclideanAlgorithm=function(e,t,r){if(e.getDegree()<t.getDegree()){var o=e;e=t,t=o}for(var i=e,a=t,s=this.field.getZero(),u=this.field.getOne();a.getDegree()>=Math.round(r/2);){var c=i,l=s;if(s=u,(i=a).isZero())throw Gn.getChecksumInstance();a=c;for(var f=this.field.getZero(),d=i.getCoefficient(i.getDegree()),h=this.field.inverse(d);a.getDegree()>=i.getDegree()&&!a.isZero();){var p=a.getDegree()-i.getDegree(),g=this.field.multiply(a.getCoefficient(a.getDegree()),h);f=f.add(this.field.buildMonomial(p,g)),a=a.subtract(i.multiplyByMonomial(p,g))}u=f.multiply(s).subtract(l).negative()}var v=u.getCoefficient(0);if(0===v)throw Gn.getChecksumInstance();var m=this.field.inverse(v);return[u.multiply(m),a.multiply(m)]},n.prototype.findErrorLocations=function(e){for(var t=e.getDegree(),r=new Int32Array(t),o=0,i=1;i<this.field.getSize()&&o<t;i++)0===e.evaluateAt(i)&&(r[o]=this.field.inverse(i),o++);if(o!==t)throw Gn.getChecksumInstance();return r},n.prototype.findErrorMagnitudes=function(e,t,r){for(var o=t.getDegree(),i=new Int32Array(o),a=1;a<=o;a++)i[o-a]=this.field.multiply(a,t.getCoefficient(a));var s=new bc(this.field,i),u=r.length,c=new Int32Array(u);for(a=0;a<u;a++){var l=this.field.inverse(r[a]),f=this.field.subtract(0,e.evaluateAt(l)),d=this.field.inverse(s.evaluateAt(l));c[a]=this.field.multiply(f,d)}return c},n}();const ure=sre;var cre=function(){function n(e,t,r,o,i){e instanceof n?this.constructor_2(e):this.constructor_1(e,t,r,o,i)}return n.prototype.constructor_1=function(e,t,r,o,i){var a=null==t||null==r,s=null==o||null==i;if(a&&s)throw new Z;a?(t=new Ne(0,o.getY()),r=new Ne(0,i.getY())):s&&(o=new Ne(e.getWidth()-1,t.getY()),i=new Ne(e.getWidth()-1,r.getY())),this.image=e,this.topLeft=t,this.bottomLeft=r,this.topRight=o,this.bottomRight=i,this.minX=Math.trunc(Math.min(t.getX(),r.getX())),this.maxX=Math.trunc(Math.max(o.getX(),i.getX())),this.minY=Math.trunc(Math.min(t.getY(),o.getY())),this.maxY=Math.trunc(Math.max(r.getY(),i.getY()))},n.prototype.constructor_2=function(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()},n.merge=function(e,t){return null==e?t:null==t?e:new n(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)},n.prototype.addMissingRows=function(e,t,r){var o=this.topLeft,i=this.bottomLeft,a=this.topRight,s=this.bottomRight;if(e>0){var u=r?this.topLeft:this.topRight,c=Math.trunc(u.getY()-e);c<0&&(c=0);var l=new Ne(u.getX(),c);r?o=l:a=l}if(t>0){var f=r?this.bottomLeft:this.bottomRight,d=Math.trunc(f.getY()+t);d>=this.image.getHeight()&&(d=this.image.getHeight()-1);var h=new Ne(f.getX(),d);r?i=h:s=h}return new n(this.image,o,i,a,s)},n.prototype.getMinX=function(){return this.minX},n.prototype.getMaxX=function(){return this.maxX},n.prototype.getMinY=function(){return this.minY},n.prototype.getMaxY=function(){return this.maxY},n.prototype.getTopLeft=function(){return this.topLeft},n.prototype.getTopRight=function(){return this.topRight},n.prototype.getBottomLeft=function(){return this.bottomLeft},n.prototype.getBottomRight=function(){return this.bottomRight},n}();const V_=cre;var lre=function(){function n(e,t,r,o){this.columnCount=e,this.errorCorrectionLevel=o,this.rowCountUpperPart=t,this.rowCountLowerPart=r,this.rowCount=t+r}return n.prototype.getColumnCount=function(){return this.columnCount},n.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},n.prototype.getRowCount=function(){return this.rowCount},n.prototype.getRowCountUpperPart=function(){return this.rowCountUpperPart},n.prototype.getRowCountLowerPart=function(){return this.rowCountLowerPart},n}();const fre=lre;var dre=function(){function n(){this.buffer=""}return n.form=function(e,t){var r=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function o(a,s,u,c,l,f){if("%%"===a)return"%";if(void 0!==t[++r]){a=c?parseInt(c.substr(1)):void 0;var h,d=l?parseInt(l.substr(1)):void 0;switch(f){case"s":h=t[r];break;case"c":h=t[r][0];break;case"f":h=parseFloat(t[r]).toFixed(a);break;case"p":h=parseFloat(t[r]).toPrecision(a);break;case"e":h=parseFloat(t[r]).toExponential(a);break;case"x":h=parseInt(t[r]).toString(d||16);break;case"d":h=parseFloat(parseInt(t[r],d||10).toPrecision(a)).toFixed(0)}h="object"==typeof h?JSON.stringify(h):(+h).toString(d);for(var p=parseInt(u),g=u&&u[0]+""=="0"?"0":" ";h.length<p;)h=void 0!==s?h+g:g+h;return h}})},n.prototype.format=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.buffer+=n.form(e,t)},n.prototype.toString=function(){return this.buffer},n}();const U_=dre;var pre=function(){function n(e){this.boundingBox=new V_(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}return n.prototype.getCodewordNearby=function(e){var t=this.getCodeword(e);if(null!=t)return t;for(var r=1;r<n.MAX_NEARBY_DISTANCE;r++){var o=this.imageRowToCodewordIndex(e)-r;if(o>=0&&null!=(t=this.codewords[o])||(o=this.imageRowToCodewordIndex(e)+r)<this.codewords.length&&null!=(t=this.codewords[o]))return t}return null},n.prototype.imageRowToCodewordIndex=function(e){return e-this.boundingBox.getMinY()},n.prototype.setCodeword=function(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t},n.prototype.getCodeword=function(e){return this.codewords[this.imageRowToCodewordIndex(e)]},n.prototype.getBoundingBox=function(){return this.boundingBox},n.prototype.getCodewords=function(){return this.codewords},n.prototype.toString=function(){var e,t,r=new U_,o=0;try{for(var i=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.codewords),a=i.next();!a.done;a=i.next()){var s=a.value;null!=s?r.format("%3d: %3d|%3d%n",o++,s.getRowNumber(),s.getValue()):r.format("%3d:    |   %n",o++)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r.toString()},n.MAX_NEARBY_DISTANCE=5,n}();const iP=pre;var vre=function(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,a,r=t.call(n),i=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},mre=function(){function n(){this.values=new Map}return n.prototype.setValue=function(e){e=Math.trunc(e);var t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)},n.prototype.getValue=function(){var e,t,r=-1,o=new Array,i=function(f,d){var h_getKey=function(){return f},h_getValue=function(){return d};h_getValue()>r?(r=h_getValue(),(o=[]).push(h_getKey())):h_getValue()===r&&o.push(h_getKey())};try{for(var a=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.values.entries()),s=a.next();!s.done;s=a.next()){var u=vre(s.value,2);i(u[0],u[1])}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Rt.toIntArray(o)},n.prototype.getConfidence=function(e){return this.values.get(e)},n}();const Th=mre;var yre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),H_=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},xre=function(n){function e(t,r){var o=n.call(this,t)||this;return o._isLeft=r,o}return yre(e,n),e.prototype.setRowNumbers=function(){var t,r;try{for(var o=H_(this.getCodewords()),i=o.next();!i.done;i=o.next())i.value?.setRowNumberAsRowIndicatorColumn()}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.adjustCompleteIndicatorColumnRowNumbers=function(t){var r=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(r,t);for(var o=this.getBoundingBox(),i=this._isLeft?o.getTopLeft():o.getTopRight(),a=this._isLeft?o.getBottomLeft():o.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(i.getY())),u=this.imageRowToCodewordIndex(Math.trunc(a.getY())),c=-1,l=1,f=0,d=s;d<u;d++)if(null!=r[d]){var h=r[d],p=h.getRowNumber()-c;if(0===p)f++;else if(1===p)l=Math.max(l,f),f=1,c=h.getRowNumber();else if(p<0||h.getRowNumber()>=t.getRowCount()||p>d)r[d]=null;else{for(var g,v=(g=l>2?(l-2)*p:p)>=d,m=1;m<=g&&!v;m++)v=null!=r[d-m];v?r[d]=null:(c=h.getRowNumber(),f=1)}}},e.prototype.getRowHeights=function(){var t,r,o=this.getBarcodeMetadata();if(null==o)return null;this.adjustIncompleteIndicatorColumnRowNumbers(o);var i=new Int32Array(o.getRowCount());try{for(var a=H_(this.getCodewords()),s=a.next();!s.done;s=a.next()){var u=s.value;if(null!=u){var c=u.getRowNumber();if(c>=i.length)continue;i[c]++}}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return i},e.prototype.adjustIncompleteIndicatorColumnRowNumbers=function(t){for(var r=this.getBoundingBox(),o=this._isLeft?r.getTopLeft():r.getTopRight(),i=this._isLeft?r.getBottomLeft():r.getBottomRight(),a=this.imageRowToCodewordIndex(Math.trunc(o.getY())),s=this.imageRowToCodewordIndex(Math.trunc(i.getY())),u=this.getCodewords(),c=-1,l=1,f=0,d=a;d<s;d++)if(null!=u[d]){var h=u[d];h.setRowNumberAsRowIndicatorColumn();var p=h.getRowNumber()-c;0===p?f++:1===p?(l=Math.max(l,f),f=1,c=h.getRowNumber()):h.getRowNumber()>=t.getRowCount()?u[d]=null:(c=h.getRowNumber(),f=1)}},e.prototype.getBarcodeMetadata=function(){var t,r,o=this.getCodewords(),i=new Th,a=new Th,s=new Th,u=new Th;try{for(var c=H_(o),l=c.next();!l.done;l=c.next()){var f=l.value;if(null!=f){f.setRowNumberAsRowIndicatorColumn();var d=f.getValue()%30,h=f.getRowNumber();switch(this._isLeft||(h+=2),h%3){case 0:a.setValue(3*d+1);break;case 1:u.setValue(d/3),s.setValue(d%3);break;case 2:i.setValue(d+1)}}}}catch(g){t={error:g}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}if(0===i.getValue().length||0===a.getValue().length||0===s.getValue().length||0===u.getValue().length||i.getValue()[0]<1||a.getValue()[0]+s.getValue()[0]<Rt.MIN_ROWS_IN_BARCODE||a.getValue()[0]+s.getValue()[0]>Rt.MAX_ROWS_IN_BARCODE)return null;var p=new fre(i.getValue()[0],a.getValue()[0],s.getValue()[0],u.getValue()[0]);return this.removeIncorrectCodewords(o,p),p},e.prototype.removeIncorrectCodewords=function(t,r){for(var o=0;o<t.length;o++){var i=t[o];if(null!=t[o]){var a=i.getValue()%30,s=i.getRowNumber();if(s>r.getRowCount()){t[o]=null;continue}switch(this._isLeft||(s+=2),s%3){case 0:3*a+1!==r.getRowCountUpperPart()&&(t[o]=null);break;case 1:(Math.trunc(a/3)!==r.getErrorCorrectionLevel()||a%3!==r.getRowCountLowerPart())&&(t[o]=null);break;case 2:a+1!==r.getColumnCount()&&(t[o]=null)}}}},e.prototype.isLeft=function(){return this._isLeft},e.prototype.toString=function(){return"IsLeft: "+this._isLeft+"\n"+n.prototype.toString.call(this)},e}(iP);const aP=xre;var _re=function(){function n(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}return n.prototype.getDetectionResultColumns=function(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);var t,e=Rt.MAX_CODEWORDS_IN_BARCODE;do{t=e,e=this.adjustRowNumbersAndGetCount()}while(e>0&&e<t);return this.detectionResultColumns},n.prototype.adjustIndicatorColumnRowNumbers=function(e){e?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)},n.prototype.adjustRowNumbersAndGetCount=function(){var e=this.adjustRowNumbersByRow();if(0===e)return 0;for(var t=1;t<this.barcodeColumnCount+1;t++)for(var r=this.detectionResultColumns[t].getCodewords(),o=0;o<r.length;o++)null!=r[o]&&(r[o].hasValidRowNumber()||this.adjustRowNumbers(t,o,r));return e},n.prototype.adjustRowNumbersByRow=function(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()},n.prototype.adjustRowNumbersFromBothRI=function(){if(null!=this.detectionResultColumns[0]&&null!=this.detectionResultColumns[this.barcodeColumnCount+1])for(var e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),r=0;r<e.length;r++)if(null!=e[r]&&null!=t[r]&&e[r].getRowNumber()===t[r].getRowNumber())for(var o=1;o<=this.barcodeColumnCount;o++){var i=this.detectionResultColumns[o].getCodewords()[r];null!=i&&(i.setRowNumber(e[r].getRowNumber()),i.hasValidRowNumber()||(this.detectionResultColumns[o].getCodewords()[r]=null))}},n.prototype.adjustRowNumbersFromRRI=function(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;for(var e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),r=0;r<t.length;r++)if(null!=t[r])for(var o=t[r].getRowNumber(),i=0,a=this.barcodeColumnCount+1;a>0&&i<this.ADJUST_ROW_NUMBER_SKIP;a--){var s=this.detectionResultColumns[a].getCodewords()[r];null!=s&&(i=n.adjustRowNumberIfValid(o,i,s),s.hasValidRowNumber()||e++)}return e},n.prototype.adjustRowNumbersFromLRI=function(){if(null==this.detectionResultColumns[0])return 0;for(var e=0,t=this.detectionResultColumns[0].getCodewords(),r=0;r<t.length;r++)if(null!=t[r])for(var o=t[r].getRowNumber(),i=0,a=1;a<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;a++){var s=this.detectionResultColumns[a].getCodewords()[r];null!=s&&(i=n.adjustRowNumberIfValid(o,i,s),s.hasValidRowNumber()||e++)}return e},n.adjustRowNumberIfValid=function(e,t,r){return null==r||r.hasValidRowNumber()||(r.isValidRowNumber(e)?(r.setRowNumber(e),t=0):++t),t},n.prototype.adjustRowNumbers=function(e,t,r){var o,i;if(null!=this.detectionResultColumns[e-1]){var a=r[t],s=this.detectionResultColumns[e-1].getCodewords(),u=s;null!=this.detectionResultColumns[e+1]&&(u=this.detectionResultColumns[e+1].getCodewords());var c=new Array(14);c[2]=s[t],c[3]=u[t],t>0&&(c[0]=r[t-1],c[4]=s[t-1],c[5]=u[t-1]),t>1&&(c[8]=r[t-2],c[10]=s[t-2],c[11]=u[t-2]),t<r.length-1&&(c[1]=r[t+1],c[6]=s[t+1],c[7]=u[t+1]),t<r.length-2&&(c[9]=r[t+2],c[12]=s[t+2],c[13]=u[t+2]);try{for(var l=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(c),f=l.next();!f.done;f=l.next())if(n.adjustRowNumber(a,f.value))return}catch(h){o={error:h}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}}},n.adjustRowNumber=function(e,t){return!(null==t||!t.hasValidRowNumber()||t.getBucket()!==e.getBucket()||(e.setRowNumber(t.getRowNumber()),0))},n.prototype.getBarcodeColumnCount=function(){return this.barcodeColumnCount},n.prototype.getBarcodeRowCount=function(){return this.barcodeMetadata.getRowCount()},n.prototype.getBarcodeECLevel=function(){return this.barcodeMetadata.getErrorCorrectionLevel()},n.prototype.setBoundingBox=function(e){this.boundingBox=e},n.prototype.getBoundingBox=function(){return this.boundingBox},n.prototype.setDetectionResultColumn=function(e,t){this.detectionResultColumns[e]=t},n.prototype.getDetectionResultColumn=function(e){return this.detectionResultColumns[e]},n.prototype.toString=function(){var e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);for(var t=new U_,r=0;r<e.getCodewords().length;r++){t.format("CW %3d:",r);for(var o=0;o<this.barcodeColumnCount+2;o++)if(null!=this.detectionResultColumns[o]){var i=this.detectionResultColumns[o].getCodewords()[r];null!=i?t.format(" %3d|%3d",i.getRowNumber(),i.getValue()):t.format("    |   ")}else t.format("    |   ");t.format("%n")}return t.toString()},n}();const bre=_re;var Cre=function(){function n(e,t,r,o){this.rowNumber=n.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(r),this.value=Math.trunc(o)}return n.prototype.hasValidRowNumber=function(){return this.isValidRowNumber(this.rowNumber)},n.prototype.isValidRowNumber=function(e){return e!==n.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3},n.prototype.setRowNumberAsRowIndicatorColumn=function(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))},n.prototype.getWidth=function(){return this.endX-this.startX},n.prototype.getStartX=function(){return this.startX},n.prototype.getEndX=function(){return this.endX},n.prototype.getBucket=function(){return this.bucket},n.prototype.getValue=function(){return this.value},n.prototype.getRowNumber=function(){return this.rowNumber},n.prototype.setRowNumber=function(e){this.rowNumber=e},n.prototype.toString=function(){return this.rowNumber+"|"+this.value},n.BARCODE_ROW_UNKNOWN=-1,n}();const Ere=Cre;var Sre=function(){function n(){}return n.initialize=function(){for(var e=0;e<Rt.SYMBOL_TABLE.length;e++)for(var t=Rt.SYMBOL_TABLE[e],r=1&t,o=0;o<Rt.BARS_IN_MODULE;o++){for(var i=0;(1&t)===r;)i+=1,t>>=1;r=1&t,n.RATIOS_TABLE[e]||(n.RATIOS_TABLE[e]=new Array(Rt.BARS_IN_MODULE)),n.RATIOS_TABLE[e][Rt.BARS_IN_MODULE-o-1]=Math.fround(i/Rt.MODULES_IN_CODEWORD)}this.bSymbolTableReady=!0},n.getDecodedValue=function(e){var t=n.getDecodedCodewordValue(n.sampleBitCounts(e));return-1!==t?t:n.getClosestDecodedValue(e)},n.sampleBitCounts=function(e){for(var t=Pt.sum(e),r=new Int32Array(Rt.BARS_IN_MODULE),o=0,i=0,a=0;a<Rt.MODULES_IN_CODEWORD;a++)i+e[o]<=t/(2*Rt.MODULES_IN_CODEWORD)+a*t/Rt.MODULES_IN_CODEWORD&&(i+=e[o],o++),r[o]++;return r},n.getDecodedCodewordValue=function(e){var t=n.getBitValue(e);return-1===Rt.getCodeword(t)?-1:t},n.getBitValue=function(e){for(var t=0,r=0;r<e.length;r++)for(var o=0;o<e[r];o++)t=t<<1|(r%2==0?1:0);return Math.trunc(t)},n.getClosestDecodedValue=function(e){var t=Pt.sum(e),r=new Array(Rt.BARS_IN_MODULE);if(t>1)for(var o=0;o<r.length;o++)r[o]=Math.fround(e[o]/t);var i=T_.MAX_VALUE,a=-1;this.bSymbolTableReady||n.initialize();for(var s=0;s<n.RATIOS_TABLE.length;s++){for(var u=0,c=n.RATIOS_TABLE[s],l=0;l<Rt.BARS_IN_MODULE;l++){var f=Math.fround(c[l]-r[l]);if((u+=Math.fround(f*f))>=i)break}u<i&&(i=u,a=Rt.SYMBOL_TABLE[s])}return a},n.bSymbolTableReady=!1,n.RATIOS_TABLE=new Array(Rt.SYMBOL_TABLE.length).map(function(e){return new Array(Rt.BARS_IN_MODULE)}),n}();const Are=Sre;var Ire=function(){function n(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}return n.prototype.getSegmentIndex=function(){return this.segmentIndex},n.prototype.setSegmentIndex=function(e){this.segmentIndex=e},n.prototype.getFileId=function(){return this.fileId},n.prototype.setFileId=function(e){this.fileId=e},n.prototype.getOptionalData=function(){return this.optionalData},n.prototype.setOptionalData=function(e){this.optionalData=e},n.prototype.isLastSegment=function(){return this.lastSegment},n.prototype.setLastSegment=function(e){this.lastSegment=e},n.prototype.getSegmentCount=function(){return this.segmentCount},n.prototype.setSegmentCount=function(e){this.segmentCount=e},n.prototype.getSender=function(){return this.sender||null},n.prototype.setSender=function(e){this.sender=e},n.prototype.getAddressee=function(){return this.addressee||null},n.prototype.setAddressee=function(e){this.addressee=e},n.prototype.getFileName=function(){return this.fileName},n.prototype.setFileName=function(e){this.fileName=e},n.prototype.getFileSize=function(){return this.fileSize},n.prototype.setFileSize=function(e){this.fileSize=e},n.prototype.getChecksum=function(){return this.checksum},n.prototype.setChecksum=function(e){this.checksum=e},n.prototype.getTimestamp=function(){return this.timestamp},n.prototype.setTimestamp=function(e){this.timestamp=e},n}();const Dre=Ire;var Tre=function(){function n(){}return n.parseLong=function(e,t){return void 0===t&&(t=void 0),parseInt(e,t)},n}();const sP=Tre;var Rre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Nre=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Rre(e,n),e.kind="NullPointerException",e}(To);const Ore=Nre;var Mre=function(){function n(){}return n.prototype.writeBytes=function(e){this.writeBytesOffset(e,0,e.length)},n.prototype.writeBytesOffset=function(e,t,r){if(null==e)throw new Ore;if(t<0||t>e.length||r<0||t+r>e.length||t+r<0)throw new D_;if(0!==r)for(var o=0;o<r;o++)this.write(e[t+o])},n.prototype.flush=function(){},n.prototype.close=function(){},n}();const Pre=Mre;var kre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Fre=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return kre(e,n),e}(To);const Lre=Fre;var Bre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vre=function(n){function e(t){void 0===t&&(t=32);var r=n.call(this)||this;if(r.count=0,t<0)throw new Ie("Negative initial size: "+t);return r.buf=new Uint8Array(t),r}return Bre(e,n),e.prototype.ensureCapacity=function(t){t-this.buf.length>0&&this.grow(t)},e.prototype.grow=function(t){var o=this.buf.length<<1;if(o-t<0&&(o=t),o<0){if(t<0)throw new Lre;o=ut.MAX_VALUE}this.buf=Yn.copyOfUint8Array(this.buf,o)},e.prototype.write=function(t){this.ensureCapacity(this.count+1),this.buf[this.count]=t,this.count+=1},e.prototype.writeBytesOffset=function(t,r,o){if(r<0||r>t.length||o<0||r+o-t.length>0)throw new D_;this.ensureCapacity(this.count+o),cn.arraycopy(t,r,this.buf,this.count,o),this.count+=o},e.prototype.writeTo=function(t){t.writeBytesOffset(this.buf,0,this.count)},e.prototype.reset=function(){this.count=0},e.prototype.toByteArray=function(){return Yn.copyOfUint8Array(this.buf,this.count)},e.prototype.size=function(){return this.count},e.prototype.toString=function(t){return t?"string"==typeof t?this.toString_string(t):this.toString_number(t):this.toString_void()},e.prototype.toString_void=function(){return new String(this.buf).toString()},e.prototype.toString_string=function(t){return new String(this.buf).toString()},e.prototype.toString_number=function(t){return new String(this.buf).toString()},e.prototype.close=function(){},e}(Pre);const Ure=Vre;var _0,en=(()=>(function(n){n[n.ALPHA=0]="ALPHA",n[n.LOWER=1]="LOWER",n[n.MIXED=2]="MIXED",n[n.PUNCT=3]="PUNCT",n[n.ALPHA_SHIFT=4]="ALPHA_SHIFT",n[n.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(en||(en={})),en))();function uP(){if(typeof window<"u")return window.BigInt||null;if(typeof global<"u")return global.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}function vu(n){if(typeof _0>"u"&&(_0=uP()),null===_0)throw new Error("BigInt is not supported!");return _0(n)}var Wre=function(){function n(){}return n.decode=function(e,t){var r=new ct(""),o=ur.ISO8859_1;r.enableDecoding(o);for(var i=1,a=e[i++],s=new Dre;i<e[0];){switch(a){case n.TEXT_COMPACTION_MODE_LATCH:i=n.textCompaction(e,i,r);break;case n.BYTE_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH_6:i=n.byteCompaction(a,e,o,i,r);break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[i++]);break;case n.NUMERIC_COMPACTION_MODE_LATCH:i=n.numericCompaction(e,i,r);break;case n.ECI_CHARSET:ur.getCharacterSetECIByValue(e[i++]);break;case n.ECI_GENERAL_PURPOSE:i+=2;break;case n.ECI_USER_DEFINED:i++;break;case n.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=n.decodeMacroBlock(e,i,s);break;case n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case n.MACRO_PDF417_TERMINATOR:throw new le;default:i--,i=n.textCompaction(e,i,r)}if(!(i<e.length))throw le.getFormatInstance();a=e[i++]}if(0===r.length())throw le.getFormatInstance();var c=new f0(null,r.toString(),null,t);return c.setOther(s),c},n.decodeMacroBlock=function(e,t,r){if(t+n.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw le.getFormatInstance();for(var o=new Int32Array(n.NUMBER_OF_SEQUENCE_CODEWORDS),i=0;i<n.NUMBER_OF_SEQUENCE_CODEWORDS;i++,t++)o[i]=e[t];r.setSegmentIndex(ut.parseInt(n.decodeBase900toBase10(o,n.NUMBER_OF_SEQUENCE_CODEWORDS)));var a=new ct;t=n.textCompaction(e,t,a),r.setFileId(a.toString());var s=-1;for(e[t]===n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(s=t+1);t<e[0];)switch(e[t]){case n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++t]){case n.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:var u=new ct;t=n.textCompaction(e,t+1,u),r.setFileName(u.toString());break;case n.MACRO_PDF417_OPTIONAL_FIELD_SENDER:var c=new ct;t=n.textCompaction(e,t+1,c),r.setSender(c.toString());break;case n.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:var l=new ct;t=n.textCompaction(e,t+1,l),r.setAddressee(l.toString());break;case n.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:var f=new ct;t=n.numericCompaction(e,t+1,f),r.setSegmentCount(ut.parseInt(f.toString()));break;case n.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:var d=new ct;t=n.numericCompaction(e,t+1,d),r.setTimestamp(sP.parseLong(d.toString()));break;case n.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:var h=new ct;t=n.numericCompaction(e,t+1,h),r.setChecksum(ut.parseInt(h.toString()));break;case n.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:var p=new ct;t=n.numericCompaction(e,t+1,p),r.setFileSize(sP.parseLong(p.toString()));break;default:throw le.getFormatInstance()}break;case n.MACRO_PDF417_TERMINATOR:t++,r.setLastSegment(!0);break;default:throw le.getFormatInstance()}if(-1!==s){var g=t-s;r.isLastSegment()&&g--,r.setOptionalData(Yn.copyOfRange(e,s,s+g))}return t},n.textCompaction=function(e,t,r){for(var o=new Int32Array(2*(e[0]-t)),i=new Int32Array(2*(e[0]-t)),a=0,s=!1;t<e[0]&&!s;){var u=e[t++];if(u<n.TEXT_COMPACTION_MODE_LATCH)o[a]=u/30,o[a+1]=u%30,a+=2;else switch(u){case n.TEXT_COMPACTION_MODE_LATCH:o[a++]=n.TEXT_COMPACTION_MODE_LATCH;break;case n.BYTE_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH_6:case n.NUMERIC_COMPACTION_MODE_LATCH:case n.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case n.MACRO_PDF417_TERMINATOR:t--,s=!0;break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o[a]=n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,u=e[t++],i[a]=u,a++}}return n.decodeTextCompaction(o,i,a,r),t},n.decodeTextCompaction=function(e,t,r,o){for(var i=en.ALPHA,a=en.ALPHA,s=0;s<r;){var u=e[s],c="";switch(i){case en.ALPHA:if(u<26)c=String.fromCharCode(65+u);else switch(u){case 26:c=" ";break;case n.LL:i=en.LOWER;break;case n.ML:i=en.MIXED;break;case n.PS:a=i,i=en.PUNCT_SHIFT;break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(t[s]);break;case n.TEXT_COMPACTION_MODE_LATCH:i=en.ALPHA}break;case en.LOWER:if(u<26)c=String.fromCharCode(97+u);else switch(u){case 26:c=" ";break;case n.AS:a=i,i=en.ALPHA_SHIFT;break;case n.ML:i=en.MIXED;break;case n.PS:a=i,i=en.PUNCT_SHIFT;break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(t[s]);break;case n.TEXT_COMPACTION_MODE_LATCH:i=en.ALPHA}break;case en.MIXED:if(u<n.PL)c=n.MIXED_CHARS[u];else switch(u){case n.PL:i=en.PUNCT;break;case 26:c=" ";break;case n.LL:i=en.LOWER;break;case n.AL:i=en.ALPHA;break;case n.PS:a=i,i=en.PUNCT_SHIFT;break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(t[s]);break;case n.TEXT_COMPACTION_MODE_LATCH:i=en.ALPHA}break;case en.PUNCT:if(u<n.PAL)c=n.PUNCT_CHARS[u];else switch(u){case n.PAL:i=en.ALPHA;break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(t[s]);break;case n.TEXT_COMPACTION_MODE_LATCH:i=en.ALPHA}break;case en.ALPHA_SHIFT:if(i=a,u<26)c=String.fromCharCode(65+u);else switch(u){case 26:c=" ";break;case n.TEXT_COMPACTION_MODE_LATCH:i=en.ALPHA}break;case en.PUNCT_SHIFT:if(i=a,u<n.PAL)c=n.PUNCT_CHARS[u];else switch(u){case n.PAL:i=en.ALPHA;break;case n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:o.append(t[s]);break;case n.TEXT_COMPACTION_MODE_LATCH:i=en.ALPHA}}""!==c&&o.append(c),s++}},n.byteCompaction=function(e,t,r,o,i){var a=new Ure,s=0,u=0,c=!1;switch(e){case n.BYTE_COMPACTION_MODE_LATCH:for(var l=new Int32Array(6),f=t[o++];o<t[0]&&!c;)switch(l[s++]=f,u=900*u+f,f=t[o++],f){case n.TEXT_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH:case n.NUMERIC_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH_6:case n.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case n.MACRO_PDF417_TERMINATOR:o--,c=!0;break;default:if(s%5==0&&s>0){for(var d=0;d<6;++d)a.write(Number(vu(u)>>vu(8*(5-d))));u=0,s=0}}o===t[0]&&f<n.TEXT_COMPACTION_MODE_LATCH&&(l[s++]=f);for(var h=0;h<s;h++)a.write(l[h]);break;case n.BYTE_COMPACTION_MODE_LATCH_6:for(;o<t[0]&&!c;){var p=t[o++];if(p<n.TEXT_COMPACTION_MODE_LATCH)s++,u=900*u+p;else switch(p){case n.TEXT_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH:case n.NUMERIC_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH_6:case n.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case n.MACRO_PDF417_TERMINATOR:o--,c=!0}if(s%5==0&&s>0){for(d=0;d<6;++d)a.write(Number(vu(u)>>vu(8*(5-d))));u=0,s=0}}}return i.append(Ei.decode(a.toByteArray(),r)),o},n.numericCompaction=function(e,t,r){for(var o=0,i=!1,a=new Int32Array(n.MAX_NUMERIC_CODEWORDS);t<e[0]&&!i;){var s=e[t++];if(t===e[0]&&(i=!0),s<n.TEXT_COMPACTION_MODE_LATCH)a[o]=s,o++;else switch(s){case n.TEXT_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH:case n.BYTE_COMPACTION_MODE_LATCH_6:case n.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case n.MACRO_PDF417_TERMINATOR:t--,i=!0}(o%n.MAX_NUMERIC_CODEWORDS==0||s===n.NUMERIC_COMPACTION_MODE_LATCH||i)&&o>0&&(r.append(n.decodeBase900toBase10(a,o)),o=0)}return t},n.decodeBase900toBase10=function(e,t){for(var r=vu(0),o=0;o<t;o++)r+=n.EXP900[t-o-1]*vu(e[o]);var i=r.toString();if("1"!==i.charAt(0))throw new le;return i.substring(1)},n.TEXT_COMPACTION_MODE_LATCH=900,n.BYTE_COMPACTION_MODE_LATCH=901,n.NUMERIC_COMPACTION_MODE_LATCH=902,n.BYTE_COMPACTION_MODE_LATCH_6=924,n.ECI_USER_DEFINED=925,n.ECI_GENERAL_PURPOSE=926,n.ECI_CHARSET=927,n.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,n.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,n.MACRO_PDF417_TERMINATOR=922,n.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,n.MAX_NUMERIC_CODEWORDS=15,n.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,n.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,n.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,n.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,n.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,n.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,n.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,n.PL=25,n.LL=27,n.AS=27,n.ML=28,n.AL=28,n.PS=29,n.PAL=29,n.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",n.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",n.EXP900=uP()?function Hre(){var n=[];n[0]=vu(1);var e=vu(900);n[1]=e;for(var t=2;t<16;t++)n[t]=n[t-1]*e;return n}():[],n.NUMBER_OF_SEQUENCE_CODEWORDS=2,n}();const Gre=Wre;var Rh=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},zre=function(){function n(){}return n.decode=function(e,t,r,o,i,a,s){for(var f,u=new V_(e,t,r,o,i),c=null,l=null,d=!0;;d=!1){if(null!=t&&(c=n.getRowIndicatorColumn(e,u,t,!0,a,s)),null!=o&&(l=n.getRowIndicatorColumn(e,u,o,!1,a,s)),null==(f=n.merge(c,l)))throw Z.getNotFoundInstance();var h=f.getBoundingBox();if(!d||null==h||!(h.getMinY()<u.getMinY()||h.getMaxY()>u.getMaxY()))break;u=h}f.setBoundingBox(u);var p=f.getBarcodeColumnCount()+1;f.setDetectionResultColumn(0,c),f.setDetectionResultColumn(p,l);for(var g=null!=c,v=1;v<=p;v++){var m=g?v:p-v;if(void 0===f.getDetectionResultColumn(m)){var y=void 0;y=0===m||m===p?new aP(u,0===m):new iP(u),f.setDetectionResultColumn(m,y);for(var x=-1,w=x,_=u.getMinY();_<=u.getMaxY();_++){if((x=n.getStartColumn(f,m,_,g))<0||x>u.getMaxX()){if(-1===w)continue;x=w}var b=n.detectCodeword(e,u.getMinX(),u.getMaxX(),g,x,_,a,s);null!=b&&(y.setCodeword(_,b),w=x,a=Math.min(a,b.getWidth()),s=Math.max(s,b.getWidth()))}}}return n.createDecoderResult(f)},n.merge=function(e,t){if(null==e&&null==t)return null;var r=n.getBarcodeMetadata(e,t);if(null==r)return null;var o=V_.merge(n.adjustBoundingBox(e),n.adjustBoundingBox(t));return new bre(r,o)},n.adjustBoundingBox=function(e){var t,r;if(null==e)return null;var o=e.getRowHeights();if(null==o)return null;var i=n.getMax(o),a=0;try{for(var s=Rh(o),u=s.next();!u.done;u=s.next()){var c=u.value;if(a+=i-c,c>0)break}}catch(h){t={error:h}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}for(var l=e.getCodewords(),f=0;a>0&&null==l[f];f++)a--;var d=0;for(f=o.length-1;f>=0&&(d+=i-o[f],!(o[f]>0));f--);for(f=l.length-1;d>0&&null==l[f];f--)d--;return e.getBoundingBox().addMissingRows(a,d,e.isLeft())},n.getMax=function(e){var t,r,o=-1;try{for(var i=Rh(e),a=i.next();!a.done;a=i.next())o=Math.max(o,a.value)}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return o},n.getBarcodeMetadata=function(e,t){var r,o;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(o=t.getBarcodeMetadata())?r:r.getColumnCount()!==o.getColumnCount()&&r.getErrorCorrectionLevel()!==o.getErrorCorrectionLevel()&&r.getRowCount()!==o.getRowCount()?null:r},n.getRowIndicatorColumn=function(e,t,r,o,i,a){for(var s=new aP(t,o),u=0;u<2;u++)for(var c=0===u?1:-1,l=Math.trunc(Math.trunc(r.getX())),f=Math.trunc(Math.trunc(r.getY()));f<=t.getMaxY()&&f>=t.getMinY();f+=c){var d=n.detectCodeword(e,0,e.getWidth(),o,l,f,i,a);null!=d&&(s.setCodeword(f,d),l=o?d.getStartX():d.getEndX())}return s},n.adjustCodewordCount=function(e,t){var r=t[0][1],o=r.getValue(),i=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-n.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===o.length){if(i<1||i>Rt.MAX_CODEWORDS_IN_BARCODE)throw Z.getNotFoundInstance();r.setValue(i)}else o[0]!==i&&r.setValue(i)},n.createDecoderResult=function(e){var t=n.createBarcodeMatrix(e);n.adjustCodewordCount(e,t);for(var r=new Array,o=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),i=[],a=new Array,s=0;s<e.getBarcodeRowCount();s++)for(var u=0;u<e.getBarcodeColumnCount();u++){var c=t[s][u+1].getValue(),l=s*e.getBarcodeColumnCount()+u;0===c.length?r.push(l):1===c.length?o[l]=c[0]:(a.push(l),i.push(c))}for(var f=new Array(i.length),d=0;d<f.length;d++)f[d]=i[d];return n.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),o,Rt.toIntArray(r),Rt.toIntArray(a),f)},n.createDecoderResultFromAmbiguousValues=function(e,t,r,o,i){for(var a=new Int32Array(o.length),s=100;s-- >0;){for(var u=0;u<a.length;u++)t[o[u]]=i[u][a[u]];try{return n.decodeCodewords(t,e,r)}catch(l){if(!(l instanceof Gn))throw l}if(0===a.length)throw Gn.getChecksumInstance();for(u=0;u<a.length;u++){if(a[u]<i[u].length-1){a[u]++;break}if(a[u]=0,u===a.length-1)throw Gn.getChecksumInstance()}}throw Gn.getChecksumInstance()},n.createBarcodeMatrix=function(e){for(var t,r,o,i,a=Array.from({length:e.getBarcodeRowCount()},function(){return new Array(e.getBarcodeColumnCount()+2)}),s=0;s<a.length;s++)for(var u=0;u<a[s].length;u++)a[s][u]=new Th;var c=0;try{for(var l=Rh(e.getDetectionResultColumns()),f=l.next();!f.done;f=l.next()){var d=f.value;if(null!=d)try{for(var h=(o=void 0,Rh(d.getCodewords())),p=h.next();!p.done;p=h.next()){var g=p.value;if(null!=g){var v=g.getRowNumber();if(v>=0){if(v>=a.length)continue;a[v][c].setValue(g.getValue())}}}}catch(m){o={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}c++}}catch(m){t={error:m}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return a},n.isValidBarcodeColumn=function(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1},n.getStartColumn=function(e,t,r,o){var i,a,s=o?1:-1,u=null;if(n.isValidBarcodeColumn(e,t-s)&&(u=e.getDetectionResultColumn(t-s).getCodeword(r)),null!=u)return o?u.getEndX():u.getStartX();if(null!=(u=e.getDetectionResultColumn(t).getCodewordNearby(r)))return o?u.getStartX():u.getEndX();if(n.isValidBarcodeColumn(e,t-s)&&(u=e.getDetectionResultColumn(t-s).getCodewordNearby(r)),null!=u)return o?u.getEndX():u.getStartX();for(var c=0;n.isValidBarcodeColumn(e,t-s);){t-=s;try{for(var l=(i=void 0,Rh(e.getDetectionResultColumn(t).getCodewords())),f=l.next();!f.done;f=l.next()){var d=f.value;if(null!=d)return(o?d.getEndX():d.getStartX())+s*c*(d.getEndX()-d.getStartX())}}catch(h){i={error:h}}finally{try{f&&!f.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}c++}return o?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()},n.detectCodeword=function(e,t,r,o,i,a,s,u){i=n.adjustCodewordStartColumn(e,t,r,o,i,a);var c=n.getModuleBitCount(e,t,r,o,i,a);if(null==c)return null;var l,f=Pt.sum(c);if(o)l=i+f;else{for(var d=0;d<c.length/2;d++){var h=c[d];c[d]=c[c.length-1-d],c[c.length-1-d]=h}i=(l=i)-f}if(!n.checkCodewordSkew(f,s,u))return null;var p=Are.getDecodedValue(c),g=Rt.getCodeword(p);return-1===g?null:new Ere(i,l,n.getCodewordBucketNumber(p),g)},n.getModuleBitCount=function(e,t,r,o,i,a){for(var s=i,u=new Int32Array(8),c=0,l=o?1:-1,f=o;(o?s<r:s>=t)&&c<u.length;)e.get(s,a)===f?(u[c]++,s+=l):(c++,f=!f);return c===u.length||s===(o?r:t)&&c===u.length-1?u:null},n.getNumberOfECCodeWords=function(e){return 2<<e},n.adjustCodewordStartColumn=function(e,t,r,o,i,a){for(var s=i,u=o?-1:1,c=0;c<2;c++){for(;(o?s>=t:s<r)&&o===e.get(s,a);){if(Math.abs(i-s)>n.CODEWORD_SKEW_SIZE)return i;s+=u}u=-u,o=!o}return s},n.checkCodewordSkew=function(e,t,r){return t-n.CODEWORD_SKEW_SIZE<=e&&e<=r+n.CODEWORD_SKEW_SIZE},n.decodeCodewords=function(e,t,r){if(0===e.length)throw le.getFormatInstance();var o=1<<t+1,i=n.correctErrors(e,r,o);n.verifyCodewordCount(e,o);var a=Gre.decode(e,""+t);return a.setErrorsCorrected(i),a.setErasures(r.length),a},n.correctErrors=function(e,t,r){if(null!=t&&t.length>r/2+n.MAX_ERRORS||r<0||r>n.MAX_EC_CODEWORDS)throw Gn.getChecksumInstance();return n.errorCorrection.decode(e,r,t)},n.verifyCodewordCount=function(e,t){if(e.length<4)throw le.getFormatInstance();var r=e[0];if(r>e.length)throw le.getFormatInstance();if(0===r){if(!(t<e.length))throw le.getFormatInstance();e[0]=e.length-t}},n.getBitCountForCodeword=function(e){for(var t=new Int32Array(8),r=0,o=t.length-1;!((1&e)!==r&&(r=1&e,o--,o<0));)t[o]++,e>>=1;return t},n.getCodewordBucketNumber=function(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)},n.getCodewordBucketNumber_number=function(e){return n.getCodewordBucketNumber(n.getBitCountForCodeword(e))},n.getCodewordBucketNumber_Int32Array=function(e){return(e[0]-e[2]+e[4]-e[6]+9)%9},n.toString=function(e){for(var t=new U_,r=0;r<e.length;r++){t.format("Row %2d: ",r);for(var o=0;o<e[r].length;o++){var i=e[r][o];0===i.getValue().length?t.format("        ",null):t.format("%4d(%2d)",i.getValue()[0],i.getConfidence(i.getValue()[0]))}t.format("%n")}return t.toString()},n.CODEWORD_SKEW_SIZE=2,n.MAX_ERRORS=3,n.MAX_EC_CODEWORDS=512,n.errorCorrection=new ure,n}();const jre=zre;var qre=function(){function n(){}return n.prototype.decode=function(e,t){void 0===t&&(t=null);var r=n.decode(e,t,!1);if(null==r||0===r.length||null==r[0])throw Z.getNotFoundInstance();return r[0]},n.prototype.decodeMultiple=function(e,t){void 0===t&&(t=null);try{return n.decode(e,t,!0)}catch(r){throw r instanceof le||r instanceof Gn?Z.getNotFoundInstance():r}},n.decode=function(e,t,r){var o,i,a=new Array,s=Qne.detectMultiple(e,t,r);try{for(var u=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s.getPoints()),c=u.next();!c.done;c=u.next()){var l=c.value,f=jre.decode(s.getBits(),l[4],l[5],l[6],l[7],n.getMinCodewordWidth(l),n.getMaxCodewordWidth(l)),d=new qr(f.getText(),f.getRawBytes(),void 0,l,Me.PDF_417);d.putMetadata(Rr.ERROR_CORRECTION_LEVEL,f.getECLevel());var h=f.getOther();null!=h&&d.putMetadata(Rr.PDF417_EXTRA_METADATA,h),a.push(d)}}catch(p){o={error:p}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return a.map(function(p){return p})},n.getMaxWidth=function(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))},n.getMinWidth=function(e,t){return null==e||null==t?ut.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))},n.getMaxCodewordWidth=function(e){return Math.floor(Math.max(Math.max(n.getMaxWidth(e[0],e[4]),n.getMaxWidth(e[6],e[2])*Rt.MODULES_IN_CODEWORD/Rt.MODULES_IN_STOP_PATTERN),Math.max(n.getMaxWidth(e[1],e[5]),n.getMaxWidth(e[7],e[3])*Rt.MODULES_IN_CODEWORD/Rt.MODULES_IN_STOP_PATTERN)))},n.getMinCodewordWidth=function(e){return Math.floor(Math.min(Math.min(n.getMinWidth(e[0],e[4]),n.getMinWidth(e[6],e[2])*Rt.MODULES_IN_CODEWORD/Rt.MODULES_IN_STOP_PATTERN),Math.min(n.getMinWidth(e[1],e[5]),n.getMinWidth(e[7],e[3])*Rt.MODULES_IN_CODEWORD/Rt.MODULES_IN_STOP_PATTERN)))},n.prototype.reset=function(){},n}();const b0=qre;var Xre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Kre=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Xre(e,n),e.kind="ReaderException",e}(To);const cP=Kre;var lP=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Yre=function(){function n(){}return n.prototype.decode=function(e,t){return this.setHints(t),this.decodeInternal(e)},n.prototype.decodeWithState=function(e){return null==this.readers&&this.setHints(null),this.decodeInternal(e)},n.prototype.setHints=function(e){this.hints=e;var t=null!=e&&void 0!==e.get(Kt.TRY_HARDER),r=null==e?null:e.get(Kt.POSSIBLE_FORMATS),o=new Array;if(null!=r){var i=r.some(function(a){return a===Me.UPC_A||a===Me.UPC_E||a===Me.EAN_13||a===Me.EAN_8||a===Me.CODABAR||a===Me.CODE_39||a===Me.CODE_93||a===Me.CODE_128||a===Me.ITF||a===Me.RSS_14||a===Me.RSS_EXPANDED});i&&!t&&o.push(new vf(e)),r.includes(Me.QR_CODE)&&o.push(new w0),r.includes(Me.DATA_MATRIX)&&o.push(new x0),r.includes(Me.AZTEC)&&o.push(new p0),r.includes(Me.PDF_417)&&o.push(new b0),i&&t&&o.push(new vf(e))}0===o.length&&(t||o.push(new vf(e)),o.push(new w0),o.push(new x0),o.push(new p0),o.push(new b0),t&&o.push(new vf(e))),this.readers=o},n.prototype.reset=function(){var e,t;if(null!==this.readers)try{for(var r=lP(this.readers),o=r.next();!o.done;o=r.next())o.value.reset()}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},n.prototype.decodeInternal=function(e){var t,r;if(null===this.readers)throw new cP("No readers where selected, nothing can be read.");try{for(var o=lP(this.readers),i=o.next();!i.done;i=o.next()){var a=i.value;try{return a.decode(e,this.hints)}catch(s){if(s instanceof cP)continue}}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}throw new Z("No MultiFormat Readers were able to detect the code.")},n}();const fP=Yre;var Zre=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Qre=(function(n){function e(t,r){void 0===t&&(t=null),void 0===r&&(r=500);var i=new fP;return i.setHints(t),n.call(this,i,r)||this}Zre(e,n),e.prototype.decodeBitmap=function(t){return this.reader.decodeWithState(t)}}(df),function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}()),Jre=(function(n){Qre(function e(t){return void 0===t&&(t=500),n.call(this,new b0,t)||this},n)}(df),function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}()),C0=(function(n){Jre(function e(t){return void 0===t&&(t=500),n.call(this,new w0,t)||this},n)}(df),(()=>(function(n){n[n.ERROR_CORRECTION=0]="ERROR_CORRECTION",n[n.CHARACTER_SET=1]="CHARACTER_SET",n[n.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",n[n.DATA_MATRIX_COMPACT=3]="DATA_MATRIX_COMPACT",n[n.MIN_SIZE=4]="MIN_SIZE",n[n.MAX_SIZE=5]="MAX_SIZE",n[n.MARGIN=6]="MARGIN",n[n.PDF417_COMPACT=7]="PDF417_COMPACT",n[n.PDF417_COMPACTION=8]="PDF417_COMPACTION",n[n.PDF417_DIMENSIONS=9]="PDF417_DIMENSIONS",n[n.AZTEC_LAYERS=10]="AZTEC_LAYERS",n[n.QR_VERSION=11]="QR_VERSION",n[n.GS1_FORMAT=12]="GS1_FORMAT",n[n.FORCE_C40=13]="FORCE_C40"}(C0||(C0={})),C0))());const wt=C0;var eoe=function(){function n(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new hu(e,Int32Array.from([1])))}return n.prototype.buildGenerator=function(e){var t=this.cachedGenerators;if(e>=t.length)for(var r=t[t.length-1],o=this.field,i=t.length;i<=e;i++){var a=r.multiply(new hu(o,Int32Array.from([1,o.exp(i-1+o.getGeneratorBase())])));t.push(a),r=a}return t[e]},n.prototype.encode=function(e,t){if(0===t)throw new Ie("No error correction bytes");var r=e.length-t;if(r<=0)throw new Ie("No data bytes provided");var o=this.buildGenerator(t),i=new Int32Array(r);cn.arraycopy(e,0,i,0,r);for(var a=new hu(this.field,i),u=(a=a.multiplyByMonomial(t,1)).divide(o)[1].getCoefficients(),c=t-u.length,l=0;l<c;l++)e[r+l]=0;cn.arraycopy(u,0,e,r+c,u.length)},n}();const dP=eoe;var toe=function(){function n(){}return n.applyMaskPenaltyRule1=function(e){return n.applyMaskPenaltyRule1Internal(e,!0)+n.applyMaskPenaltyRule1Internal(e,!1)},n.applyMaskPenaltyRule2=function(e){for(var t=0,r=e.getArray(),o=e.getWidth(),i=e.getHeight(),a=0;a<i-1;a++)for(var s=r[a],u=0;u<o-1;u++){var c=s[u];c===s[u+1]&&c===r[a+1][u]&&c===r[a+1][u+1]&&t++}return n.N2*t},n.applyMaskPenaltyRule3=function(e){for(var t=0,r=e.getArray(),o=e.getWidth(),i=e.getHeight(),a=0;a<i;a++)for(var s=0;s<o;s++){var u=r[a];s+6<o&&1===u[s]&&0===u[s+1]&&1===u[s+2]&&1===u[s+3]&&1===u[s+4]&&0===u[s+5]&&1===u[s+6]&&(n.isWhiteHorizontal(u,s-4,s)||n.isWhiteHorizontal(u,s+7,s+11))&&t++,a+6<i&&1===r[a][s]&&0===r[a+1][s]&&1===r[a+2][s]&&1===r[a+3][s]&&1===r[a+4][s]&&0===r[a+5][s]&&1===r[a+6][s]&&(n.isWhiteVertical(r,s,a-4,a)||n.isWhiteVertical(r,s,a+7,a+11))&&t++}return t*n.N3},n.isWhiteHorizontal=function(e,t,r){t=Math.max(t,0),r=Math.min(r,e.length);for(var o=t;o<r;o++)if(1===e[o])return!1;return!0},n.isWhiteVertical=function(e,t,r,o){r=Math.max(r,0),o=Math.min(o,e.length);for(var i=r;i<o;i++)if(1===e[i][t])return!1;return!0},n.applyMaskPenaltyRule4=function(e){for(var t=0,r=e.getArray(),o=e.getWidth(),i=e.getHeight(),a=0;a<i;a++)for(var s=r[a],u=0;u<o;u++)1===s[u]&&t++;var c=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*t-c)/c)*n.N4},n.getDataMaskBit=function(e,t,r){var o,i;switch(e){case 0:o=r+t&1;break;case 1:o=1&r;break;case 2:o=t%3;break;case 3:o=(r+t)%3;break;case 4:o=Math.floor(r/2)+Math.floor(t/3)&1;break;case 5:o=(1&(i=r*t))+i%3;break;case 6:o=(1&(i=r*t))+i%3&1;break;case 7:o=(i=r*t)%3+(r+t&1)&1;break;default:throw new Ie("Invalid mask pattern: "+e)}return 0===o},n.applyMaskPenaltyRule1Internal=function(e,t){for(var r=0,o=t?e.getHeight():e.getWidth(),i=t?e.getWidth():e.getHeight(),a=e.getArray(),s=0;s<o;s++){for(var u=0,c=-1,l=0;l<i;l++){var f=t?a[s][l]:a[l][s];f===c?u++:(u>=5&&(r+=n.N1+(u-5)),u=1,c=f)}u>=5&&(r+=n.N1+(u-5))}return r},n.N1=3,n.N2=3,n.N3=40,n.N4=10,n}();const Nh=toe;var roe=function(){function n(e,t){this.width=e,this.height=t;for(var r=new Array(t),o=0;o!==t;o++)r[o]=new Uint8Array(e);this.bytes=r}return n.prototype.getHeight=function(){return this.height},n.prototype.getWidth=function(){return this.width},n.prototype.get=function(e,t){return this.bytes[t][e]},n.prototype.getArray=function(){return this.bytes},n.prototype.setNumber=function(e,t,r){this.bytes[t][e]=r},n.prototype.setBoolean=function(e,t,r){this.bytes[t][e]=r?1:0},n.prototype.clear=function(e){var t,r;try{for(var o=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.bytes),i=o.next();!i.done;i=o.next())Yn.fill(i.value,e)}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},n.prototype.equals=function(e){if(!(e instanceof n))return!1;var t=e;if(this.width!==t.width||this.height!==t.height)return!1;for(var r=0,o=this.height;r<o;++r)for(var i=this.bytes[r],a=t.bytes[r],s=0,u=this.width;s<u;++s)if(i[s]!==a[s])return!1;return!0},n.prototype.toString=function(){for(var e=new ct,t=0,r=this.height;t<r;++t){for(var o=this.bytes[t],i=0,a=this.width;i<a;++i)switch(o[i]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()},n}();const hP=roe;var ooe=function(){function n(){this.maskPattern=-1}return n.prototype.getMode=function(){return this.mode},n.prototype.getECLevel=function(){return this.ecLevel},n.prototype.getVersion=function(){return this.version},n.prototype.getMaskPattern=function(){return this.maskPattern},n.prototype.getMatrix=function(){return this.matrix},n.prototype.toString=function(){var e=new ct;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()},n.prototype.setMode=function(e){this.mode=e},n.prototype.setECLevel=function(e){this.ecLevel=e},n.prototype.setVersion=function(e){this.version=e},n.prototype.setMaskPattern=function(e){this.maskPattern=e},n.prototype.setMatrix=function(e){this.matrix=e},n.isValidMaskPattern=function(e){return e>=0&&e<n.NUM_MASK_PATTERNS},n.NUM_MASK_PATTERNS=8,n}();const W_=ooe;var ioe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),aoe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ioe(e,n),e.kind="WriterException",e}(To);const vn=aoe;var soe=function(){function n(){}return n.clearMatrix=function(e){e.clear(255)},n.buildMatrix=function(e,t,r,o,i){n.clearMatrix(i),n.embedBasicPatterns(r,i),n.embedTypeInfo(t,o,i),n.maybeEmbedVersionInfo(r,i),n.embedDataBits(e,o,i)},n.embedBasicPatterns=function(e,t){n.embedPositionDetectionPatternsAndSeparators(t),n.embedDarkDotAtLeftBottomCorner(t),n.maybeEmbedPositionAdjustmentPatterns(e,t),n.embedTimingPatterns(t)},n.embedTypeInfo=function(e,t,r){var o=new vr;n.makeTypeInfoBits(e,t,o);for(var i=0,a=o.getSize();i<a;++i){var s=o.get(o.getSize()-1-i),u=n.TYPE_INFO_COORDINATES[i];if(r.setBoolean(u[0],u[1],s),i<8){var f=r.getWidth()-i-1;r.setBoolean(f,d=8,s)}else{f=8;var d=r.getHeight()-7+(i-8);r.setBoolean(f,d,s)}}},n.maybeEmbedVersionInfo=function(e,t){if(!(e.getVersionNumber()<7)){var r=new vr;n.makeVersionInfoBits(e,r);for(var o=17,i=0;i<6;++i)for(var a=0;a<3;++a){var s=r.get(o);o--,t.setBoolean(i,t.getHeight()-11+a,s),t.setBoolean(t.getHeight()-11+a,i,s)}}},n.embedDataBits=function(e,t,r){for(var o=0,i=-1,a=r.getWidth()-1,s=r.getHeight()-1;a>0;){for(6===a&&(a-=1);s>=0&&s<r.getHeight();){for(var u=0;u<2;++u){var c=a-u;if(n.isEmpty(r.get(c,s))){var l=void 0;o<e.getSize()?(l=e.get(o),++o):l=!1,255!==t&&Nh.getDataMaskBit(t,c,s)&&(l=!l),r.setBoolean(c,s,l)}}s+=i}s+=i=-i,a-=2}if(o!==e.getSize())throw new vn("Not all bits consumed: "+o+"/"+e.getSize())},n.findMSBSet=function(e){return 32-ut.numberOfLeadingZeros(e)},n.calculateBCHCode=function(e,t){if(0===t)throw new Ie("0 polynomial");var r=n.findMSBSet(t);for(e<<=r-1;n.findMSBSet(e)>=r;)e^=t<<n.findMSBSet(e)-r;return e},n.makeTypeInfoBits=function(e,t,r){if(!W_.isValidMaskPattern(t))throw new vn("Invalid mask pattern");var o=e.getBits()<<3|t;r.appendBits(o,5);var i=n.calculateBCHCode(o,n.TYPE_INFO_POLY);r.appendBits(i,10);var a=new vr;if(a.appendBits(n.TYPE_INFO_MASK_PATTERN,15),r.xor(a),15!==r.getSize())throw new vn("should not happen but we got: "+r.getSize())},n.makeVersionInfoBits=function(e,t){t.appendBits(e.getVersionNumber(),6);var r=n.calculateBCHCode(e.getVersionNumber(),n.VERSION_INFO_POLY);if(t.appendBits(r,12),18!==t.getSize())throw new vn("should not happen but we got: "+t.getSize())},n.isEmpty=function(e){return 255===e},n.embedTimingPatterns=function(e){for(var t=8;t<e.getWidth()-8;++t){var r=(t+1)%2;n.isEmpty(e.get(t,6))&&e.setNumber(t,6,r),n.isEmpty(e.get(6,t))&&e.setNumber(6,t,r)}},n.embedDarkDotAtLeftBottomCorner=function(e){if(0===e.get(8,e.getHeight()-8))throw new vn;e.setNumber(8,e.getHeight()-8,1)},n.embedHorizontalSeparationPattern=function(e,t,r){for(var o=0;o<8;++o){if(!n.isEmpty(r.get(e+o,t)))throw new vn;r.setNumber(e+o,t,0)}},n.embedVerticalSeparationPattern=function(e,t,r){for(var o=0;o<7;++o){if(!n.isEmpty(r.get(e,t+o)))throw new vn;r.setNumber(e,t+o,0)}},n.embedPositionAdjustmentPattern=function(e,t,r){for(var o=0;o<5;++o)for(var i=n.POSITION_ADJUSTMENT_PATTERN[o],a=0;a<5;++a)r.setNumber(e+a,t+o,i[a])},n.embedPositionDetectionPattern=function(e,t,r){for(var o=0;o<7;++o)for(var i=n.POSITION_DETECTION_PATTERN[o],a=0;a<7;++a)r.setNumber(e+a,t+o,i[a])},n.embedPositionDetectionPatternsAndSeparators=function(e){var t=n.POSITION_DETECTION_PATTERN[0].length;n.embedPositionDetectionPattern(0,0,e),n.embedPositionDetectionPattern(e.getWidth()-t,0,e),n.embedPositionDetectionPattern(0,e.getWidth()-t,e),n.embedHorizontalSeparationPattern(0,7,e),n.embedHorizontalSeparationPattern(e.getWidth()-8,7,e),n.embedHorizontalSeparationPattern(0,e.getWidth()-8,e),n.embedVerticalSeparationPattern(7,0,e),n.embedVerticalSeparationPattern(e.getHeight()-7-1,0,e),n.embedVerticalSeparationPattern(7,e.getHeight()-7,e)},n.maybeEmbedPositionAdjustmentPatterns=function(e,t){if(!(e.getVersionNumber()<2))for(var r=e.getVersionNumber()-1,o=n.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[r],i=0,a=o.length;i!==a;i++){var s=o[i];if(s>=0)for(var u=0;u!==a;u++){var c=o[u];c>=0&&n.isEmpty(t.get(c,s))&&n.embedPositionAdjustmentPattern(c-2,s-2,t)}}},n.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),n.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),n.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),n.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),n.VERSION_INFO_POLY=7973,n.TYPE_INFO_POLY=1335,n.TYPE_INFO_MASK_PATTERN=21522,n}();const pP=soe;var uoe=function(){function n(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}return n.prototype.getDataBytes=function(){return this.dataBytes},n.prototype.getErrorCorrectionBytes=function(){return this.errorCorrectionBytes},n}();const coe=uoe;var gP=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},loe=function(){function n(){}return n.calculateMaskPenalty=function(e){return Nh.applyMaskPenaltyRule1(e)+Nh.applyMaskPenaltyRule2(e)+Nh.applyMaskPenaltyRule3(e)+Nh.applyMaskPenaltyRule4(e)},n.encode=function(e,t,r){void 0===r&&(r=null);var o=n.DEFAULT_BYTE_MODE_ENCODING,i=null!==r&&void 0!==r.get(wt.CHARACTER_SET);i&&(o=r.get(wt.CHARACTER_SET).toString());var a=this.chooseMode(e,o),s=new vr;if(a===gn.BYTE&&(i||n.DEFAULT_BYTE_MODE_ENCODING!==o)){var u=ur.getCharacterSetECIByName(o);void 0!==u&&this.appendECI(u,s)}this.appendModeInfo(a,s);var l,c=new vr;if(this.appendBytes(e,a,c,o),null!==r&&void 0!==r.get(wt.QR_VERSION)){var f=Number.parseInt(r.get(wt.QR_VERSION).toString(),10);l=_c.getVersionForNumber(f);var d=this.calculateBitsNeeded(a,s,c,l);if(!this.willFit(d,l,t))throw new vn("Data too big for requested version")}else l=this.recommendVersion(t,a,s,c);var h=new vr;h.appendBitArray(s);var p=a===gn.BYTE?c.getSizeInBytes():e.length;this.appendLengthInfo(p,l,a,h),h.appendBitArray(c);var g=l.getECBlocksForLevel(t),v=l.getTotalCodewords()-g.getTotalECCodewords();this.terminateBits(v,h);var m=this.interleaveWithECBytes(h,l.getTotalCodewords(),v,g.getNumBlocks()),y=new W_;y.setECLevel(t),y.setMode(a),y.setVersion(l);var x=l.getDimensionForVersion(),w=new hP(x,x),_=this.chooseMaskPattern(m,t,l,w);return y.setMaskPattern(_),pP.buildMatrix(m,t,l,_,w),y.setMatrix(w),y},n.recommendVersion=function(e,t,r,o){var i=this.calculateBitsNeeded(t,r,o,_c.getVersionForNumber(1)),a=this.chooseVersion(i,e),s=this.calculateBitsNeeded(t,r,o,a);return this.chooseVersion(s,e)},n.calculateBitsNeeded=function(e,t,r,o){return t.getSize()+e.getCharacterCountBits(o)+r.getSize()},n.getAlphanumericCode=function(e){return e<n.ALPHANUMERIC_TABLE.length?n.ALPHANUMERIC_TABLE[e]:-1},n.chooseMode=function(e,t){if(void 0===t&&(t=null),ur.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return gn.KANJI;for(var r=!1,o=!1,i=0,a=e.length;i<a;++i){var s=e.charAt(i);if(n.isDigit(s))r=!0;else{if(-1===this.getAlphanumericCode(s.charCodeAt(0)))return gn.BYTE;o=!0}}return o?gn.ALPHANUMERIC:r?gn.NUMERIC:gn.BYTE},n.isOnlyDoubleByteKanji=function(e){var t;try{t=Ei.encode(e,ur.SJIS)}catch{return!1}var r=t.length;if(r%2!=0)return!1;for(var o=0;o<r;o+=2){var i=255&t[o];if((i<129||i>159)&&(i<224||i>235))return!1}return!0},n.chooseMaskPattern=function(e,t,r,o){for(var i=Number.MAX_SAFE_INTEGER,a=-1,s=0;s<W_.NUM_MASK_PATTERNS;s++){pP.buildMatrix(e,t,r,s,o);var u=this.calculateMaskPenalty(o);u<i&&(i=u,a=s)}return a},n.chooseVersion=function(e,t){for(var r=1;r<=40;r++){var o=_c.getVersionForNumber(r);if(n.willFit(e,o,t))return o}throw new vn("Data too big")},n.willFit=function(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8},n.terminateBits=function(e,t){var r=8*e;if(t.getSize()>r)throw new vn("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(var o=0;o<4&&t.getSize()<r;++o)t.appendBit(!1);var i=7&t.getSize();if(i>0)for(o=i;o<8;o++)t.appendBit(!1);var a=e-t.getSizeInBytes();for(o=0;o<a;++o)t.appendBits(1&o?17:236,8);if(t.getSize()!==r)throw new vn("Bits size does not equal capacity")},n.getNumDataBytesAndNumECBytesForBlockID=function(e,t,r,o,i,a){if(o>=r)throw new vn("Block ID too large");var s=e%r,u=r-s,c=Math.floor(e/r),l=c+1,f=Math.floor(t/r),d=f+1,h=c-f,p=l-d;if(h!==p)throw new vn("EC bytes mismatch");if(r!==u+s)throw new vn("RS blocks mismatch");if(e!==(f+h)*u+(d+p)*s)throw new vn("Total bytes mismatch");o<u?(i[0]=f,a[0]=h):(i[0]=d,a[0]=p)},n.interleaveWithECBytes=function(e,t,r,o){var i,a,s,u;if(e.getSizeInBytes()!==r)throw new vn("Number of bits and data bytes does not match");for(var c=0,l=0,f=0,d=new Array,h=0;h<o;++h){var p=new Int32Array(1),g=new Int32Array(1);n.getNumDataBytesAndNumECBytesForBlockID(t,r,o,h,p,g);var v=p[0],m=new Uint8Array(v);e.toBytes(8*c,m,0,v);var y=n.generateECBytes(m,g[0]);d.push(new coe(m,y)),l=Math.max(l,v),f=Math.max(f,y.length),c+=p[0]}if(r!==c)throw new vn("Data bytes does not match offset");var x=new vr;for(h=0;h<l;++h)try{for(var w=(i=void 0,gP(d)),_=w.next();!_.done;_=w.next())h<(m=_.value.getDataBytes()).length&&x.appendBits(m[h],8)}catch(A){i={error:A}}finally{try{_&&!_.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}for(h=0;h<f;++h)try{for(var C=(s=void 0,gP(d)),E=C.next();!E.done;E=C.next())h<(y=E.value.getErrorCorrectionBytes()).length&&x.appendBits(y[h],8)}catch(A){s={error:A}}finally{try{E&&!E.done&&(u=C.return)&&u.call(C)}finally{if(s)throw s.error}}if(t!==x.getSizeInBytes())throw new vn("Interleaving error: "+t+" and "+x.getSizeInBytes()+" differ.");return x},n.generateECBytes=function(e,t){for(var r=e.length,o=new Int32Array(r+t),i=0;i<r;i++)o[i]=255&e[i];new dP(No.QR_CODE_FIELD_256).encode(o,t);var a=new Uint8Array(t);for(i=0;i<t;i++)a[i]=o[r+i];return a},n.appendModeInfo=function(e,t){t.appendBits(e.getBits(),4)},n.appendLengthInfo=function(e,t,r,o){var i=r.getCharacterCountBits(t);if(e>=1<<i)throw new vn(e+" is bigger than "+((1<<i)-1));o.appendBits(e,i)},n.appendBytes=function(e,t,r,o){switch(t){case gn.NUMERIC:n.appendNumericBytes(e,r);break;case gn.ALPHANUMERIC:n.appendAlphanumericBytes(e,r);break;case gn.BYTE:n.append8BitBytes(e,r,o);break;case gn.KANJI:n.appendKanjiBytes(e,r);break;default:throw new vn("Invalid mode: "+t)}},n.getDigit=function(e){return e.charCodeAt(0)-48},n.isDigit=function(e){var t=n.getDigit(e);return t>=0&&t<=9},n.appendNumericBytes=function(e,t){for(var r=e.length,o=0;o<r;){var i=n.getDigit(e.charAt(o));if(o+2<r){var a=n.getDigit(e.charAt(o+1)),s=n.getDigit(e.charAt(o+2));t.appendBits(100*i+10*a+s,10),o+=3}else o+1<r?(a=n.getDigit(e.charAt(o+1)),t.appendBits(10*i+a,7),o+=2):(t.appendBits(i,4),o++)}},n.appendAlphanumericBytes=function(e,t){for(var r=e.length,o=0;o<r;){var i=n.getAlphanumericCode(e.charCodeAt(o));if(-1===i)throw new vn;if(o+1<r){var a=n.getAlphanumericCode(e.charCodeAt(o+1));if(-1===a)throw new vn;t.appendBits(45*i+a,11),o+=2}else t.appendBits(i,6),o++}},n.append8BitBytes=function(e,t,r){var o;try{o=Ei.encode(e,r)}catch(u){throw new vn(u)}for(var i=0,a=o.length;i!==a;i++)t.appendBits(o[i],8)},n.appendKanjiBytes=function(e,t){var r;try{r=Ei.encode(e,ur.SJIS)}catch(f){throw new vn(f)}for(var o=r.length,i=0;i<o;i+=2){var u=(255&r[i])<<8&4294967295|255&r[i+1],c=-1;if(u>=33088&&u<=40956?c=u-33088:u>=57408&&u<=60351&&(c=u-49472),-1===c)throw new vn("Invalid byte sequence");t.appendBits(192*(c>>8)+(255&c),13)}},n.appendECI=function(e,t){t.appendBits(gn.ECI.getBits(),4),t.appendBits(e.getValue(),8)},n.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),n.DEFAULT_BYTE_MODE_ENCODING=ur.UTF8.getName(),n}();const E0=loe;!function(){function n(){}n.prototype.write=function(e,t,r,o){if(void 0===o&&(o=null),0===e.length)throw new Ie("Found empty contents");if(t<0||r<0)throw new Ie("Requested dimensions are too small: "+t+"x"+r);var i=Es.L,a=n.QUIET_ZONE_SIZE;null!==o&&(void 0!==o.get(wt.ERROR_CORRECTION)&&(i=Es.fromString(o.get(wt.ERROR_CORRECTION).toString())),void 0!==o.get(wt.MARGIN)&&(a=Number.parseInt(o.get(wt.MARGIN).toString(),10)));var s=E0.encode(e,i,o);return this.renderResult(s,t,r,a)},n.prototype.writeToDom=function(e,t,r,o,i){void 0===i&&(i=null),"string"==typeof e&&(e=document.querySelector(e));var a=this.write(t,r,o,i);e&&e.appendChild(a)},n.prototype.renderResult=function(e,t,r,o){var i=e.getMatrix();if(null===i)throw new La;for(var a=i.getWidth(),s=i.getHeight(),u=a+2*o,c=s+2*o,l=Math.max(t,u),f=Math.max(r,c),d=Math.min(Math.floor(l/u),Math.floor(f/c)),h=Math.floor((l-a*d)/2),p=Math.floor((f-s*d)/2),g=this.createSVGElement(l,f),v=0,m=p;v<s;v++,m+=d)for(var y=0,x=h;y<a;y++,x+=d)if(1===i.get(y,v)){var w=this.createSvgRectElement(x,m,d,d);g.appendChild(w)}return g},n.prototype.createSVGElement=function(e,t){var r=document.createElementNS(n.SVG_NS,"svg");return r.setAttributeNS(null,"height",e.toString()),r.setAttributeNS(null,"width",t.toString()),r},n.prototype.createSvgRectElement=function(e,t,r,o){var i=document.createElementNS(n.SVG_NS,"rect");return i.setAttributeNS(null,"x",e.toString()),i.setAttributeNS(null,"y",t.toString()),i.setAttributeNS(null,"height",r.toString()),i.setAttributeNS(null,"width",o.toString()),i.setAttributeNS(null,"fill","#000000"),i},n.QUIET_ZONE_SIZE=4,n.SVG_NS="http://www.w3.org/2000/svg"}();!function(){function n(){}n.prototype.encode=function(e,t,r,o,i){if(0===e.length)throw new Ie("Found empty contents");if(t!==Me.QR_CODE)throw new Ie("Can only encode QR_CODE, but got "+t);if(r<0||o<0)throw new Ie("Requested dimensions are too small: "+r+"x"+o);var a=Es.L,s=n.QUIET_ZONE_SIZE;null!==i&&(void 0!==i.get(wt.ERROR_CORRECTION)&&(a=Es.fromString(i.get(wt.ERROR_CORRECTION).toString())),void 0!==i.get(wt.MARGIN)&&(s=Number.parseInt(i.get(wt.MARGIN).toString(),10)));var u=E0.encode(e,a,i);return n.renderResult(u,r,o,s)},n.renderResult=function(e,t,r,o){var i=e.getMatrix();if(null===i)throw new La;for(var a=i.getWidth(),s=i.getHeight(),u=a+2*o,c=s+2*o,l=Math.max(t,u),f=Math.max(r,c),d=Math.min(Math.floor(l/u),Math.floor(f/c)),h=Math.floor((l-a*d)/2),p=Math.floor((f-s*d)/2),g=new Ro(l,f),v=0,m=p;v<s;v++,m+=d)for(var y=0,x=h;y<a;y++,x+=d)1===i.get(y,v)&&g.setRegion(x,m,d,d);return g},n.QUIET_ZONE_SIZE=4}();var hoe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();!function(n){function e(t,r,o,i,a,s,u,c){var l=n.call(this,s,u)||this;if(l.yuvData=t,l.dataWidth=r,l.dataHeight=o,l.left=i,l.top=a,i+s>r||a+u>o)throw new Ie("Crop rectangle does not fit within image data.");return c&&l.reverseHorizontal(s,u),l}hoe(e,n),e.prototype.getRow=function(t,r){if(t<0||t>=this.getHeight())throw new Ie("Requested row is outside the image: "+t);var o=this.getWidth();return(null==r||r.length<o)&&(r=new Uint8ClampedArray(o)),cn.arraycopy(this.yuvData,(t+this.top)*this.dataWidth+this.left,r,0,o),r},e.prototype.getMatrix=function(){var t=this.getWidth(),r=this.getHeight();if(t===this.dataWidth&&r===this.dataHeight)return this.yuvData;var o=t*r,i=new Uint8ClampedArray(o),a=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return cn.arraycopy(this.yuvData,a,i,0,o),i;for(var s=0;s<r;s++)cn.arraycopy(this.yuvData,a,i,s*t,t),a+=this.dataWidth;return i},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(t,r,o,i){return new e(this.yuvData,this.dataWidth,this.dataHeight,this.left+t,this.top+r,o,i,!1)},e.prototype.renderThumbnail=function(){for(var t=this.getWidth()/e.THUMBNAIL_SCALE_FACTOR,r=this.getHeight()/e.THUMBNAIL_SCALE_FACTOR,o=new Int32Array(t*r),i=this.yuvData,a=this.top*this.dataWidth+this.left,s=0;s<r;s++){for(var u=s*t,c=0;c<t;c++)o[u+c]=4278190080|65793*(255&i[a+c*e.THUMBNAIL_SCALE_FACTOR]);a+=this.dataWidth*e.THUMBNAIL_SCALE_FACTOR}return o},e.prototype.getThumbnailWidth=function(){return this.getWidth()/e.THUMBNAIL_SCALE_FACTOR},e.prototype.getThumbnailHeight=function(){return this.getHeight()/e.THUMBNAIL_SCALE_FACTOR},e.prototype.reverseHorizontal=function(t,r){for(var o=this.yuvData,i=0,a=this.top*this.dataWidth+this.left;i<r;i++,a+=this.dataWidth)for(var s=a+t/2,u=a,c=a+t-1;u<s;u++,c--){var l=o[u];o[u]=o[c],o[c]=l}},e.prototype.invert=function(){return new u0(this)},e.THUMBNAIL_SCALE_FACTOR=2}(Ah);var poe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();!function(n){function e(t,r,o,i,a,s,u){var c=n.call(this,r,o)||this;if(c.dataWidth=i,c.dataHeight=a,c.left=s,c.top=u,4===t.BYTES_PER_ELEMENT){for(var l=r*o,f=new Uint8ClampedArray(l),d=0;d<l;d++){var h=t[d];f[d]=((h>>16&255)+(h>>7&510)+(255&h))/4&255}c.luminances=f}else c.luminances=t;if(void 0===i&&(c.dataWidth=r),void 0===a&&(c.dataHeight=o),void 0===s&&(c.left=0),void 0===u&&(c.top=0),c.left+r>c.dataWidth||c.top+o>c.dataHeight)throw new Ie("Crop rectangle does not fit within image data.");return c}poe(e,n),e.prototype.getRow=function(t,r){if(t<0||t>=this.getHeight())throw new Ie("Requested row is outside the image: "+t);var o=this.getWidth();return(null==r||r.length<o)&&(r=new Uint8ClampedArray(o)),cn.arraycopy(this.luminances,(t+this.top)*this.dataWidth+this.left,r,0,o),r},e.prototype.getMatrix=function(){var t=this.getWidth(),r=this.getHeight();if(t===this.dataWidth&&r===this.dataHeight)return this.luminances;var o=t*r,i=new Uint8ClampedArray(o),a=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return cn.arraycopy(this.luminances,a,i,0,o),i;for(var s=0;s<r;s++)cn.arraycopy(this.luminances,a,i,s*t,t),a+=this.dataWidth;return i},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(t,r,o,i){return new e(this.luminances,o,i,this.dataWidth,this.dataHeight,this.left+t,this.top+r)},e.prototype.invert=function(){return new u0(this)}}(Ah);var goe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),voe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return goe(e,n),e.forName=function(t){return this.getCharacterSetECIByName(t)},e}(ur);const G_=voe;var moe=function(){function n(){}return n.ISO_8859_1=ur.ISO8859_1,n}();const vP=moe;var yoe=function(){function n(e,t,r){this.codewords=e,this.numcols=t,this.numrows=r,this.bits=new Uint8Array(t*r),Yn.fill(this.bits,2)}return n.prototype.getNumrows=function(){return this.numrows},n.prototype.getNumcols=function(){return this.numcols},n.prototype.getBits=function(){return this.bits},n.prototype.getBit=function(e,t){return 1===this.bits[t*this.numcols+e]},n.prototype.setBit=function(e,t,r){this.bits[t*this.numcols+e]=r?1:0},n.prototype.noBit=function(e,t){return 2===this.bits[t*this.numcols+e]},n.prototype.place=function(){var e=0,t=4,r=0;do{t===this.numrows&&0===r&&this.corner1(e++),t===this.numrows-2&&0===r&&this.numcols%4!=0&&this.corner2(e++),t===this.numrows-2&&0===r&&this.numcols%8==4&&this.corner3(e++),t===this.numrows+4&&2===r&&this.numcols%8==0&&this.corner4(e++);do{t<this.numrows&&r>=0&&this.noBit(r,t)&&this.utah(t,r,e++),t-=2,r+=2}while(t>=0&&r<this.numcols);t++,r+=3;do{t>=0&&r<this.numcols&&this.noBit(r,t)&&this.utah(t,r,e++),t+=2,r-=2}while(t<this.numrows&&r>=0);t+=3,r++}while(t<this.numrows||r<this.numcols);this.noBit(this.numcols-1,this.numrows-1)&&(this.setBit(this.numcols-1,this.numrows-1,!0),this.setBit(this.numcols-2,this.numrows-2,!0))},n.prototype.module=function(e,t,r,o){e<0&&(e+=this.numrows,t+=4-(this.numrows+4)%8),t<0&&(t+=this.numcols,e+=4-(this.numcols+4)%8);var i=this.codewords.charCodeAt(r);this.setBit(t,e,0!=(i&=1<<8-o))},n.prototype.utah=function(e,t,r){this.module(e-2,t-2,r,1),this.module(e-2,t-1,r,2),this.module(e-1,t-2,r,3),this.module(e-1,t-1,r,4),this.module(e-1,t,r,5),this.module(e,t-2,r,6),this.module(e,t-1,r,7),this.module(e,t,r,8)},n.prototype.corner1=function(e){this.module(this.numrows-1,0,e,1),this.module(this.numrows-1,1,e,2),this.module(this.numrows-1,2,e,3),this.module(0,this.numcols-2,e,4),this.module(0,this.numcols-1,e,5),this.module(1,this.numcols-1,e,6),this.module(2,this.numcols-1,e,7),this.module(3,this.numcols-1,e,8)},n.prototype.corner2=function(e){this.module(this.numrows-3,0,e,1),this.module(this.numrows-2,0,e,2),this.module(this.numrows-1,0,e,3),this.module(0,this.numcols-4,e,4),this.module(0,this.numcols-3,e,5),this.module(0,this.numcols-2,e,6),this.module(0,this.numcols-1,e,7),this.module(1,this.numcols-1,e,8)},n.prototype.corner3=function(e){this.module(this.numrows-3,0,e,1),this.module(this.numrows-2,0,e,2),this.module(this.numrows-1,0,e,3),this.module(0,this.numcols-2,e,4),this.module(0,this.numcols-1,e,5),this.module(1,this.numcols-1,e,6),this.module(2,this.numcols-1,e,7),this.module(3,this.numcols-1,e,8)},n.prototype.corner4=function(e){this.module(this.numrows-1,0,e,1),this.module(this.numrows-1,this.numcols-1,e,2),this.module(0,this.numcols-3,e,3),this.module(0,this.numcols-2,e,4),this.module(0,this.numcols-1,e,5),this.module(1,this.numcols-3,e,6),this.module(1,this.numcols-2,e,7),this.module(1,this.numcols-1,e,8)},n}();const xoe=yoe;var z_,mP=[5,7,10,11,12,14,18,20,24,28,36,42,48,56,62,68],woe=[[228,48,15,111,62],[23,68,144,134,240,92,254],[28,24,185,166,223,248,116,255,110,61],[175,138,205,12,194,168,39,245,60,97,120],[41,153,158,91,61,42,142,213,97,178,100,242],[156,97,192,252,95,9,157,119,138,45,18,186,83,185],[83,195,100,39,188,75,66,61,241,213,109,129,94,254,225,48,90,188],[15,195,244,9,233,71,168,2,188,160,153,145,253,79,108,82,27,174,186,172],[52,190,88,205,109,39,176,21,155,197,251,223,155,21,5,172,254,124,12,181,184,96,50,193],[211,231,43,97,71,96,103,174,37,151,170,53,75,34,249,121,17,138,110,213,141,136,120,151,233,168,93,255],[245,127,242,218,130,250,162,181,102,120,84,179,220,251,80,182,229,18,2,4,68,33,101,137,95,119,115,44,175,184,59,25,225,98,81,112],[77,193,137,31,19,38,22,153,247,105,122,2,245,133,242,8,175,95,100,9,167,105,214,111,57,121,21,1,253,57,54,101,248,202,69,50,150,177,226,5,9,5],[245,132,172,223,96,32,117,22,238,133,238,231,205,188,237,87,191,106,16,147,118,23,37,90,170,205,131,88,120,100,66,138,186,240,82,44,176,87,187,147,160,175,69,213,92,253,225,19],[175,9,223,238,12,17,220,208,100,29,175,170,230,192,215,235,150,159,36,223,38,200,132,54,228,146,218,234,117,203,29,232,144,238,22,150,201,117,62,207,164,13,137,245,127,67,247,28,155,43,203,107,233,53,143,46],[242,93,169,50,144,210,39,118,202,188,201,189,143,108,196,37,185,112,134,230,245,63,197,190,250,106,185,221,175,64,114,71,161,44,147,6,27,218,51,63,87,10,40,130,188,17,163,31,176,170,4,107,232,7,94,166,224,124,86,47,11,204],[220,228,173,89,251,149,159,56,89,33,147,244,154,36,73,127,213,136,248,180,234,197,158,177,68,122,93,213,15,160,227,236,66,139,153,185,202,167,179,25,220,232,96,210,231,136,223,239,181,241,59,52,172,25,49,232,211,189,64,54,108,153,132,63,96,103,82,186]],S0=(z_=function(n,e){for(var t=1,r=0;r<255;r++)e[r]=t,n[t]=r,(t*=2)>=256&&(t^=301);return{LOG:n,ALOG:e}}([],[]),z_.LOG),yP=z_.ALOG,A0="[)>\x1e05\x1d",I0="[)>\x1e06\x1d",Noe=function(){function n(){}return n.encodeECC200=function(e,t){if(e.length!==t.getDataCapacity())throw new Error("The number of codewords does not match the selected symbol");var r=new ct;r.append(e);var o=t.getInterleavedBlockCount();if(1===o){var i=this.createECCBlock(e,t.getErrorCodewords());r.append(i)}else{for(var a=[],s=[],u=0;u<o;u++)a[u]=t.getDataLengthForInterleavedBlock(u+1),s[u]=t.getErrorLengthForInterleavedBlock(u+1);for(var c=0;c<o;c++){for(var l=new ct,f=c;f<t.getDataCapacity();f+=o)l.append(e.charAt(f));i=this.createECCBlock(l.toString(),s[c]);for(var d=0,h=c;h<s[c]*o;h+=o)r.setCharAt(t.getDataCapacity()+h,i.charAt(d++))}}return r.toString()},n.createECCBlock=function(e,t){for(var r=-1,o=0;o<mP.length;o++)if(mP[o]===t){r=o;break}if(r<0)throw new Error("Illegal number of error correction codewords specified: "+t);var i=woe[r],a=[];for(o=0;o<t;o++)a[o]=0;for(o=0;o<e.length;o++){for(var s=a[t-1]^e.charAt(o).charCodeAt(0),u=t-1;u>0;u--)a[u]=0!==s&&0!==i[u]?a[u-1]^yP[(S0[s]+S0[i[u]])%255]:a[u-1];a[0]=0!==s&&0!==i[0]?yP[(S0[s]+S0[i[0]])%255]:0}var c=[];for(o=0;o<t;o++)c[o]=a[t-o-1];return c.map(function(l){return String.fromCharCode(l)}).join("")},n}();const Ooe=Noe;var Moe=function(){function n(){}return n.prototype.getEncodingMode=function(){return 0},n.prototype.encode=function(e){if(_t.determineConsecutiveDigitCount(e.getMessage(),e.pos)>=2)e.writeCodeword(this.encodeASCIIDigits(e.getMessage().charCodeAt(e.pos),e.getMessage().charCodeAt(e.pos+1))),e.pos+=2;else{var r=e.getCurrentChar(),o=_t.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(o!==this.getEncodingMode())switch(o){case 5:return e.writeCodeword(231),void e.signalEncoderChange(5);case 1:return e.writeCodeword(230),void e.signalEncoderChange(1);case 3:e.writeCodeword(238),e.signalEncoderChange(3);break;case 2:e.writeCodeword(239),e.signalEncoderChange(2);break;case 4:e.writeCodeword(240),e.signalEncoderChange(4);break;default:throw new Error("Illegal mode: "+o)}else _t.isExtendedASCII(r)?(e.writeCodeword(235),e.writeCodeword(r-128+1),e.pos++):(e.writeCodeword(r+1),e.pos++)}},n.prototype.encodeASCIIDigits=function(e,t){if(_t.isDigit(e)&&_t.isDigit(t))return 10*(e-48)+(t-48)+130;throw new Error("not digits: "+e+t)},n}(),Poe=function(){function n(){}return n.prototype.getEncodingMode=function(){return 5},n.prototype.encode=function(e){var t=new ct;for(t.append(0);e.hasMoreCharacters();){var r=e.getCurrentChar();if(t.append(r),e.pos++,_t.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}var i=t.length()-1,s=e.getCodewordCount()+i+1;e.updateSymbolInfo(s);var u=e.getSymbolInfo().getDataCapacity()-s>0;if(e.hasMoreCharacters()||u)if(i<=249)t.setCharAt(0,Et.getCharAt(i));else{if(!(i<=1555))throw new Error("Message length not in valid ranges: "+i);t.setCharAt(0,Et.getCharAt(Math.floor(i/250)+249)),t.insert(1,Et.getCharAt(i%250))}var c=0;for(r=t.length();c<r;c++)e.writeCodeword(this.randomize255State(t.charAt(c).charCodeAt(0),e.getCodewordCount()+1))},n.prototype.randomize255State=function(e,t){var o=e+(149*t%255+1);return o<=255?o:o-256},n}(),$_=function(){function n(){}return n.prototype.getEncodingMode=function(){return 1},n.prototype.encodeMaximal=function(e){for(var t=new ct,r=0,o=e.pos,i=0;e.hasMoreCharacters();){var a=e.getCurrentChar();e.pos++,r=this.encodeChar(a,t),t.length()%3==0&&(o=e.pos,i=t.length())}if(i!==t.length()){var s=Math.floor(t.length()/3*2),u=Math.floor(e.getCodewordCount()+s+1);e.updateSymbolInfo(u);var c=e.getSymbolInfo().getDataCapacity()-u,l=Math.floor(t.length()%3);(2===l&&2!==c||1===l&&(r>3||1!==c))&&(e.pos=o)}t.length()>0&&e.writeCodeword(230),this.handleEOD(e,t)},n.prototype.encode=function(e){for(var t=new ct;e.hasMoreCharacters();){var r=e.getCurrentChar();e.pos++;var o=this.encodeChar(r,t),i=2*Math.floor(t.length()/3),a=e.getCodewordCount()+i;e.updateSymbolInfo(a);var s=e.getSymbolInfo().getDataCapacity()-a;if(!e.hasMoreCharacters()){var u=new ct;for(t.length()%3==2&&2!==s&&(o=this.backtrackOneCharacter(e,t,u,o));t.length()%3==1&&(o>3||1!==s);)o=this.backtrackOneCharacter(e,t,u,o);break}if(t.length()%3==0&&_t.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}this.handleEOD(e,t)},n.prototype.backtrackOneCharacter=function(e,t,r,o){var i=t.length(),a=t.toString().substring(0,i-o);t.setLengthToZero(),t.append(a),e.pos--;var s=e.getCurrentChar();return o=this.encodeChar(s,r),e.resetSymbolInfo(),o},n.prototype.writeNextTriplet=function(e,t){e.writeCodewords(this.encodeToCodewords(t.toString()));var r=t.toString().substring(3);t.setLengthToZero(),t.append(r)},n.prototype.handleEOD=function(e,t){var r=Math.floor(t.length()/3*2),o=t.length()%3,i=e.getCodewordCount()+r;e.updateSymbolInfo(i);var a=e.getSymbolInfo().getDataCapacity()-i;if(2===o){for(t.append("\0");t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(254)}else if(1===a&&1===o){for(;t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(254),e.pos--}else{if(0!==o)throw new Error("Unexpected case. Please report!");for(;t.length()>=3;)this.writeNextTriplet(e,t);(a>0||e.hasMoreCharacters())&&e.writeCodeword(254)}e.signalEncoderChange(0)},n.prototype.encodeChar=function(e,t){return e===" ".charCodeAt(0)?(t.append(3),1):e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)?(t.append(e-48+4),1):e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)?(t.append(e-65+14),1):e<" ".charCodeAt(0)?(t.append(0),t.append(e),2):e<="/".charCodeAt(0)?(t.append(1),t.append(e-33),2):e<="@".charCodeAt(0)?(t.append(1),t.append(e-58+15),2):e<="_".charCodeAt(0)?(t.append(1),t.append(e-91+22),2):e<=127?(t.append(2),t.append(e-96),2):(t.append("1\x1e"),2+this.encodeChar(e-128,t))},n.prototype.encodeToCodewords=function(e){var t=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,r=t/256,o=t%256,i=new ct;return i.append(r),i.append(o),i.toString()},n}(),koe=function(){function n(){}return n.prototype.getEncodingMode=function(){return 4},n.prototype.encode=function(e){for(var t=new ct;e.hasMoreCharacters();){var r=e.getCurrentChar();if(this.encodeChar(r,t),e.pos++,t.length()>=4){e.writeCodewords(this.encodeToCodewords(t.toString()));var i=t.toString().substring(4);if(t.setLengthToZero(),t.append(i),_t.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}}t.append(Et.getCharAt(31)),this.handleEOD(e,t)},n.prototype.handleEOD=function(e,t){try{var r=t.length();if(0===r)return;if(1===r){e.updateSymbolInfo();var o=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount(),i=e.getRemainingCharacters();if(i>o&&(e.updateSymbolInfo(e.getCodewordCount()+1),o=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount()),i<=o&&o<=2)return}if(r>4)throw new Error("Count must not exceed 4");var a=r-1,s=this.encodeToCodewords(t.toString()),c=!e.hasMoreCharacters()&&a<=2;a<=2&&(e.updateSymbolInfo(e.getCodewordCount()+a),(o=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount())>=3&&(c=!1,e.updateSymbolInfo(e.getCodewordCount()+s.length))),c?(e.resetSymbolInfo(),e.pos-=a):e.writeCodewords(s)}finally{e.signalEncoderChange(0)}},n.prototype.encodeChar=function(e,t){e>=" ".charCodeAt(0)&&e<="?".charCodeAt(0)?t.append(e):e>="@".charCodeAt(0)&&e<="^".charCodeAt(0)?t.append(Et.getCharAt(e-64)):_t.illegalCharacter(Et.getCharAt(e))},n.prototype.encodeToCodewords=function(e){var t=e.length;if(0===t)throw new Error("StringBuilder must not be empty");var s=(e.charAt(0).charCodeAt(0)<<18)+((t>=2?e.charAt(1).charCodeAt(0):0)<<12)+((t>=3?e.charAt(2).charCodeAt(0):0)<<6)+(t>=4?e.charAt(3).charCodeAt(0):0),u=s>>16&255,c=s>>8&255,l=255&s,f=new ct;return f.append(u),t>=2&&f.append(c),t>=3&&f.append(l),f.toString()},n}(),Foe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ut=function(){function n(e,t,r,o,i,a,s,u){void 0===s&&(s=0),void 0===u&&(u=0),this.rectangular=e,this.dataCapacity=t,this.errorCodewords=r,this.matrixWidth=o,this.matrixHeight=i,this.dataRegions=a,this.rsBlockData=s,this.rsBlockError=u}return n.lookup=function(e,t,r,o,i){var a,s;void 0===t&&(t=0),void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=!0);try{for(var u=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Voe),c=u.next();!c.done;c=u.next()){var l=c.value;if((1!==t||!l.rectangular)&&(2!==t||l.rectangular)&&(null==r||!(l.getSymbolWidth()<r.getWidth()||l.getSymbolHeight()<r.getHeight()))&&(null==o||!(l.getSymbolWidth()>o.getWidth()||l.getSymbolHeight()>o.getHeight()))&&e<=l.dataCapacity)return l}}catch(f){a={error:f}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(a)throw a.error}}if(i)throw new Error("Can't find a symbol arrangement that matches the message. Data codewords: "+e);return null},n.prototype.getHorizontalDataRegions=function(){switch(this.dataRegions){case 1:return 1;case 2:case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},n.prototype.getVerticalDataRegions=function(){switch(this.dataRegions){case 1:case 2:return 1;case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},n.prototype.getSymbolDataWidth=function(){return this.getHorizontalDataRegions()*this.matrixWidth},n.prototype.getSymbolDataHeight=function(){return this.getVerticalDataRegions()*this.matrixHeight},n.prototype.getSymbolWidth=function(){return this.getSymbolDataWidth()+2*this.getHorizontalDataRegions()},n.prototype.getSymbolHeight=function(){return this.getSymbolDataHeight()+2*this.getVerticalDataRegions()},n.prototype.getCodewordCount=function(){return this.dataCapacity+this.errorCodewords},n.prototype.getInterleavedBlockCount=function(){return this.rsBlockData?this.dataCapacity/this.rsBlockData:1},n.prototype.getDataCapacity=function(){return this.dataCapacity},n.prototype.getErrorCodewords=function(){return this.errorCodewords},n.prototype.getDataLengthForInterleavedBlock=function(e){return this.rsBlockData},n.prototype.getErrorLengthForInterleavedBlock=function(e){return this.rsBlockError},n}();const _P=Ut;var Boe=function(n){function e(){return n.call(this,!1,1558,620,22,22,36,-1,62)||this}return Foe(e,n),e.prototype.getInterleavedBlockCount=function(){return 10},e.prototype.getDataLengthForInterleavedBlock=function(t){return t<=8?156:155},e}(Ut),Voe=[new Ut(!1,3,5,8,8,1),new Ut(!1,5,7,10,10,1),new Ut(!0,5,7,16,6,1),new Ut(!1,8,10,12,12,1),new Ut(!0,10,11,14,6,2),new Ut(!1,12,12,14,14,1),new Ut(!0,16,14,24,10,1),new Ut(!1,18,14,16,16,1),new Ut(!1,22,18,18,18,1),new Ut(!0,22,18,16,10,2),new Ut(!1,30,20,20,20,1),new Ut(!0,32,24,16,14,2),new Ut(!1,36,24,22,22,1),new Ut(!1,44,28,24,24,1),new Ut(!0,49,28,22,14,2),new Ut(!1,62,36,14,14,4),new Ut(!1,86,42,16,16,4),new Ut(!1,114,48,18,18,4),new Ut(!1,144,56,20,20,4),new Ut(!1,174,68,22,22,4),new Ut(!1,204,84,24,24,4,102,42),new Ut(!1,280,112,14,14,16,140,56),new Ut(!1,368,144,16,16,16,92,36),new Ut(!1,456,192,18,18,16,114,48),new Ut(!1,576,224,20,20,16,144,56),new Ut(!1,696,272,22,22,16,174,68),new Ut(!1,816,336,24,24,16,136,56),new Ut(!1,1050,408,18,18,36,175,68),new Ut(!1,1304,496,20,20,36,163,62),new Boe],Uoe=function(){function n(e){this.msg=e,this.pos=0,this.skipAtEnd=0;for(var t=e.split("").map(function(s){return s.charCodeAt(0)}),r=new ct,o=0,i=t.length;o<i;o++){var a=String.fromCharCode(255&t[o]);if("?"===a&&"?"!==e.charAt(o))throw new Error("Message contains characters outside ISO-8859-1 encoding.");r.append(a)}this.msg=r.toString(),this.shape=0,this.codewords=new ct,this.newEncoding=-1}return n.prototype.setSymbolShape=function(e){this.shape=e},n.prototype.setSizeConstraints=function(e,t){this.minSize=e,this.maxSize=t},n.prototype.getMessage=function(){return this.msg},n.prototype.setSkipAtEnd=function(e){this.skipAtEnd=e},n.prototype.getCurrentChar=function(){return this.msg.charCodeAt(this.pos)},n.prototype.getCurrent=function(){return this.msg.charCodeAt(this.pos)},n.prototype.getCodewords=function(){return this.codewords},n.prototype.writeCodewords=function(e){this.codewords.append(e)},n.prototype.writeCodeword=function(e){this.codewords.append(e)},n.prototype.getCodewordCount=function(){return this.codewords.length()},n.prototype.getNewEncoding=function(){return this.newEncoding},n.prototype.signalEncoderChange=function(e){this.newEncoding=e},n.prototype.resetEncoderSignal=function(){this.newEncoding=-1},n.prototype.hasMoreCharacters=function(){return this.pos<this.getTotalMessageCharCount()},n.prototype.getTotalMessageCharCount=function(){return this.msg.length-this.skipAtEnd},n.prototype.getRemainingCharacters=function(){return this.getTotalMessageCharCount()-this.pos},n.prototype.getSymbolInfo=function(){return this.symbolInfo},n.prototype.updateSymbolInfo=function(e){void 0===e&&(e=this.getCodewordCount()),(null==this.symbolInfo||e>this.symbolInfo.getDataCapacity())&&(this.symbolInfo=_P.lookup(e,this.shape,this.minSize,this.maxSize,!0))},n.prototype.resetSymbolInfo=function(){this.symbolInfo=null},n}(),Hoe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Woe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Hoe(e,n),e.prototype.getEncodingMode=function(){return 3},e.prototype.encode=function(t){for(var r=new ct;t.hasMoreCharacters();){var o=t.getCurrentChar();if(t.pos++,this.encodeChar(o,r),r.length()%3==0&&(this.writeNextTriplet(t,r),_t.lookAheadTest(t.getMessage(),t.pos,this.getEncodingMode())!==this.getEncodingMode())){t.signalEncoderChange(0);break}}this.handleEOD(t,r)},e.prototype.encodeChar=function(t,r){switch(t){case 13:r.append(0);break;case"*".charCodeAt(0):r.append(1);break;case">".charCodeAt(0):r.append(2);break;case" ".charCodeAt(0):r.append(3);break;default:t>="0".charCodeAt(0)&&t<="9".charCodeAt(0)?r.append(t-48+4):t>="A".charCodeAt(0)&&t<="Z".charCodeAt(0)?r.append(t-65+14):_t.illegalCharacter(Et.getCharAt(t))}return 1},e.prototype.handleEOD=function(t,r){t.updateSymbolInfo();var o=t.getSymbolInfo().getDataCapacity()-t.getCodewordCount(),i=r.length();t.pos-=i,(t.getRemainingCharacters()>1||o>1||t.getRemainingCharacters()!==o)&&t.writeCodeword(254),t.getNewEncoding()<0&&t.signalEncoderChange(0)},e}($_),Goe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),zoe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Goe(e,n),e.prototype.getEncodingMode=function(){return 2},e.prototype.encodeChar=function(t,r){return t===" ".charCodeAt(0)?(r.append(3),1):t>="0".charCodeAt(0)&&t<="9".charCodeAt(0)?(r.append(t-48+4),1):t>="a".charCodeAt(0)&&t<="z".charCodeAt(0)?(r.append(t-97+14),1):t<" ".charCodeAt(0)?(r.append(0),r.append(t),2):t<="/".charCodeAt(0)?(r.append(1),r.append(t-33),2):t<="@".charCodeAt(0)?(r.append(1),r.append(t-58+15),2):t>="[".charCodeAt(0)&&t<="_".charCodeAt(0)?(r.append(1),r.append(t-91+22),2):t==="`".charCodeAt(0)?(r.append(2),r.append(0),2):t<="Z".charCodeAt(0)?(r.append(2),r.append(t-65+1),2):t<=127?(r.append(2),r.append(t-123+27),2):(r.append("1\x1e"),2+this.encodeChar(t-128,r))},e}($_),joe=function(){function n(){}return n.randomize253State=function(e){var r=149*e%253+1+129;return r<=254?r:r-254},n.encodeHighLevel=function(e,t,r,o,i){void 0===t&&(t=0),void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=!1);var a=new $_,s=[new Moe,a,new zoe,new Woe,new koe,new Poe],u=new Uoe(e);u.setSymbolShape(t),u.setSizeConstraints(r,o),e.startsWith(A0)&&e.endsWith("\x1e\x04")?(u.writeCodeword(236),u.setSkipAtEnd(2),u.pos+=A0.length):e.startsWith(I0)&&e.endsWith("\x1e\x04")&&(u.writeCodeword(237),u.setSkipAtEnd(2),u.pos+=I0.length);var c=0;for(i&&(a.encodeMaximal(u),c=u.getNewEncoding(),u.resetEncoderSignal());u.hasMoreCharacters();)s[c].encode(u),u.getNewEncoding()>=0&&(c=u.getNewEncoding(),u.resetEncoderSignal());var l=u.getCodewordCount();u.updateSymbolInfo();var f=u.getSymbolInfo().getDataCapacity();l<f&&0!==c&&5!==c&&4!==c&&u.writeCodeword("\xfe");var d=u.getCodewords();for(d.length()<f&&d.append(129);d.length()<f;)d.append(this.randomize253State(d.length()+1));return u.getCodewords().toString()},n.lookAheadTest=function(e,t,r){var o=this.lookAheadTestIntern(e,t,r);if(3===r&&3===o){for(var i=Math.min(t+3,e.length),a=t;a<i;a++)if(!this.isNativeX12(e.charCodeAt(a)))return 0}else if(4===r&&4===o)for(i=Math.min(t+4,e.length),a=t;a<i;a++)if(!this.isNativeEDIFACT(e.charCodeAt(a)))return 0;return o},n.lookAheadTestIntern=function(e,t,r){if(t>=e.length)return r;var o;0===r?o=[0,1,1,1,1,1.25]:(o=[1,2,2,2,2,2.25])[r]=0;for(var i=0,a=new Uint8Array(6),s=[];;){if(t+i===e.length){Yn.fill(a,0),Yn.fill(s,0);var u=this.findMinimums(o,s,ut.MAX_VALUE,a),c=this.getMinimumCount(a);if(s[0]===u)return 0;if(1===c){if(a[5]>0)return 5;if(a[4]>0)return 4;if(a[2]>0)return 2;if(a[3]>0)return 3}return 1}var l=e.charCodeAt(t+i);if(i++,this.isDigit(l)?o[0]+=.5:this.isExtendedASCII(l)?(o[0]=Math.ceil(o[0]),o[0]+=2):(o[0]=Math.ceil(o[0]),o[0]++),this.isNativeC40(l)?o[1]+=2/3:this.isExtendedASCII(l)?o[1]+=8/3:o[1]+=4/3,this.isNativeText(l)?o[2]+=2/3:this.isExtendedASCII(l)?o[2]+=8/3:o[2]+=4/3,this.isNativeX12(l)?o[3]+=2/3:this.isExtendedASCII(l)?o[3]+=13/3:o[3]+=10/3,this.isNativeEDIFACT(l)?o[4]+=3/4:this.isExtendedASCII(l)?o[4]+=4.25:o[4]+=3.25,this.isSpecialB256(l)?o[5]+=4:o[5]++,i>=4){if(Yn.fill(a,0),Yn.fill(s,0),this.findMinimums(o,s,ut.MAX_VALUE,a),s[0]<this.min(s[5],s[1],s[2],s[3],s[4]))return 0;if(s[5]<s[0]||s[5]+1<this.min(s[1],s[2],s[3],s[4]))return 5;if(s[4]+1<this.min(s[5],s[1],s[2],s[3],s[0]))return 4;if(s[2]+1<this.min(s[5],s[1],s[4],s[3],s[0]))return 2;if(s[3]+1<this.min(s[5],s[1],s[4],s[2],s[0]))return 3;if(s[1]+1<this.min(s[0],s[5],s[4],s[2])){if(s[1]<s[3])return 1;if(s[1]===s[3]){for(var f=t+i+1;f<e.length;){var d=e.charCodeAt(f);if(this.isX12TermSep(d))return 3;if(!this.isNativeX12(d))break;f++}return 1}}}}},n.min=function(e,t,r,o,i){var a=Math.min(e,Math.min(t,Math.min(r,o)));return void 0===i?a:Math.min(a,i)},n.findMinimums=function(e,t,r,o){for(var i=0;i<6;i++){var a=t[i]=Math.ceil(e[i]);r>a&&(r=a,Yn.fill(o,0)),r===a&&(o[i]=o[i]+1)}return r},n.getMinimumCount=function(e){for(var t=0,r=0;r<6;r++)t+=e[r];return t||0},n.isDigit=function(e){return e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)},n.isExtendedASCII=function(e){return e>=128&&e<=255},n.isNativeC40=function(e){return e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)},n.isNativeText=function(e){return e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="a".charCodeAt(0)&&e<="z".charCodeAt(0)},n.isNativeX12=function(e){return this.isX12TermSep(e)||e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)},n.isX12TermSep=function(e){return 13===e||e==="*".charCodeAt(0)||e===">".charCodeAt(0)},n.isNativeEDIFACT=function(e){return e>=" ".charCodeAt(0)&&e<="^".charCodeAt(0)},n.isSpecialB256=function(e){return!1},n.determineConsecutiveDigitCount=function(e,t){void 0===t&&(t=0);for(var r=e.length,o=t;o<r&&this.isDigit(e.charCodeAt(o));)o++;return o-t},n.illegalCharacter=function(e){var t=ut.toHexString(e.charCodeAt(0));throw t="0000".substring(0,4-t.length)+t,new Error("Illegal character: "+e+" (0x"+t+")")},n}();const _t=joe;var q_=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},bP=function(){function n(e){this.charset=e,this.name=e.name}return n.prototype.canEncode=function(e){try{return null!=Ei.encode(e,this.charset)}catch{return!1}},n}(),$oe=function(){function n(e,t,r){var o,i,a,s,u,c;this.ENCODERS=["IBM437","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-10","ISO-8859-11","ISO-8859-13","ISO-8859-14","ISO-8859-15","ISO-8859-16","windows-1250","windows-1251","windows-1252","windows-1256","Shift_JIS"].map(function(S){return new bP(G_.forName(S))}),this.encoders=[];var l=[];l.push(new bP(vP.ISO_8859_1));for(var f=null!=t&&t.name.startsWith("UTF"),d=0;d<e.length;d++){var h=!1;try{for(var p=(o=void 0,q_(l)),g=p.next();!g.done;g=p.next()){var v=g.value,m=e.charAt(d);if(m.charCodeAt(0)===r||v.canEncode(m)){h=!0;break}}}catch(S){o={error:S}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(o)throw o.error}}if(!h)try{for(var x=(a=void 0,q_(this.ENCODERS)),w=x.next();!w.done;w=x.next())if((v=w.value).canEncode(e.charAt(d))){l.push(v),h=!0;break}}catch(S){a={error:S}}finally{try{w&&!w.done&&(s=x.return)&&s.call(x)}finally{if(a)throw a.error}}h||(f=!0)}if(1!==l.length||f){this.encoders=[];var _=0;try{for(var b=q_(l),C=b.next();!C.done;C=b.next())this.encoders[_++]=v=C.value}catch(S){u={error:S}}finally{try{C&&!C.done&&(c=b.return)&&c.call(b)}finally{if(u)throw u.error}}}else this.encoders=[l[0]];var E=-1;if(null!=t)for(d=0;d<this.encoders.length;d++)if(null!=this.encoders[d]&&t.name===this.encoders[d].name){E=d;break}this.priorityEncoderIndex=E}return n.prototype.length=function(){return this.encoders.length},n.prototype.getCharsetName=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].name},n.prototype.getCharset=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].charset},n.prototype.getECIValue=function(e){return this.encoders[e].charset.getValueIdentifier()},n.prototype.getPriorityEncoderIndex=function(){return this.priorityEncoderIndex},n.prototype.canEncode=function(e,t){if(!(t<this.length()))throw new Error("index must be less than length");return!0},n.prototype.encode=function(e,t){if(!(t<this.length()))throw new Error("index must be less than length");return Ei.encode(Et.getCharAt(e),this.encoders[t].name)},n}(),qoe=3,Xoe=function(){function n(e,t,r){this.fnc1=r;var o=new $oe(e,t,r);if(1===o.length())for(var i=0;i<this.bytes.length;i++){var a=e.charAt(i).charCodeAt(0);this.bytes[i]=a===r?1e3:a}else this.bytes=this.encodeMinimally(e,o,r)}return n.prototype.getFNC1Character=function(){return this.fnc1},n.prototype.length=function(){return this.bytes.length},n.prototype.haveNCharacters=function(e,t){if(e+t-1>=this.bytes.length)return!1;for(var r=0;r<t;r++)if(this.isECI(e+r))return!1;return!0},n.prototype.charAt=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(this.isECI(e))throw new Error("value at "+e+" is not a character but an ECI");return this.isFNC1(e)?this.fnc1:this.bytes[e]},n.prototype.subSequence=function(e,t){if(e<0||e>t||t>this.length())throw new Error(""+e);for(var r=new ct,o=e;o<t;o++){if(this.isECI(o))throw new Error("value at "+o+" is not a character but an ECI");r.append(this.charAt(o))}return r.toString()},n.prototype.isECI=function(e){if(e<0||e>=this.length())throw new Error(""+e);return this.bytes[e]>255&&this.bytes[e]<=999},n.prototype.isFNC1=function(e){if(e<0||e>=this.length())throw new Error(""+e);return 1e3===this.bytes[e]},n.prototype.getECIValue=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(!this.isECI(e))throw new Error("value at "+e+" is not an ECI but a character");return this.bytes[e]-256},n.prototype.addEdge=function(e,t,r){(null==e[t][r.encoderIndex]||e[t][r.encoderIndex].cachedTotalSize>r.cachedTotalSize)&&(e[t][r.encoderIndex]=r)},n.prototype.addEdges=function(e,t,r,o,i,a){var s=e.charAt(o).charCodeAt(0),u=0,c=t.length();t.getPriorityEncoderIndex()>=0&&(s===a||t.canEncode(s,t.getPriorityEncoderIndex()))&&(c=(u=t.getPriorityEncoderIndex())+1);for(var l=u;l<c;l++)(s===a||t.canEncode(s,l))&&this.addEdge(r,o+1,new CP(s,t,l,i,a))},n.prototype.encodeMinimally=function(e,t,r){var o=e.length,i=new(CP[o+1][t.length()]);this.addEdges(e,t,i,0,null,r);for(var a=1;a<=o;a++){for(var s=0;s<t.length();s++)null!=i[a][s]&&a<o&&this.addEdges(e,t,i,a,i[a][s],r);for(s=0;s<t.length();s++)i[a-1][s]=null}var u=-1,c=ut.MAX_VALUE;for(s=0;s<t.length();s++)if(null!=i[o][s]){var l=i[o][s];l.cachedTotalSize<c&&(c=l.cachedTotalSize,u=s)}if(u<0)throw new Error('Failed to encode "'+e+'"');for(var f=[],d=i[o][u];null!=d;){if(d.isFNC1())f.unshift(1e3);else{var h=t.encode(d.c,d.encoderIndex);for(a=h.length-1;a>=0;a--)f.unshift(255&h[a])}(null===d.previous?0:d.previous.encoderIndex)!==d.encoderIndex&&f.unshift(256+t.getECIValue(d.encoderIndex)),d=d.previous}var g=[];for(a=0;a<g.length;a++)g[a]=f[a];return g},n}(),CP=function(){function n(e,t,r,o,i){this.c=e,this.encoderSet=t,this.encoderIndex=r,this.previous=o,this.fnc1=i,this.c=e===i?1e3:e;var a=this.isFNC1()?1:t.encode(e,r).length;(null===o?0:o.encoderIndex)!==r&&(a+=qoe),null!=o&&(a+=o.cachedTotalSize),this.cachedTotalSize=a}return n.prototype.isFNC1=function(){return 1e3===this.c},n}(),Koe=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Oh=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Yoe=function(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,a,r=t.call(n),i=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i},fe=(()=>(function(n){n[n.ASCII=0]="ASCII",n[n.C40=1]="C40",n[n.TEXT=2]="TEXT",n[n.X12=3]="X12",n[n.EDF=4]="EDF",n[n.B256=5]="B256"}(fe||(fe={})),fe))(),Qoe=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Mo=function(){function n(){}return n.isExtendedASCII=function(e,t){return e!==t&&e>=128&&e<=255},n.isInC40Shift1Set=function(e){return e<=31},n.isInC40Shift2Set=function(e,t){var r,o;try{for(var i=Oh(Qoe),a=i.next();!a.done;a=i.next())if(a.value.charCodeAt(0)===e)return!0}catch(u){r={error:u}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return e===t},n.isInTextShift1Set=function(e){return this.isInC40Shift1Set(e)},n.isInTextShift2Set=function(e,t){return this.isInC40Shift2Set(e,t)},n.encodeHighLevel=function(e,t,r,o){void 0===t&&(t=null),void 0===r&&(r=-1),void 0===o&&(o=0);var i=0;return e.startsWith(A0)&&e.endsWith("\x1e\x04")?(i=5,e=e.substring(A0.length,e.length-2)):e.startsWith(I0)&&e.endsWith("\x1e\x04")&&(i=6,e=e.substring(I0.length,e.length-2)),decodeURIComponent(escape(String.fromCharCode.apply(String,function(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Yoe(arguments[e]));return n}(this.encode(e,t,r,o,i)))))},n.encode=function(e,t,r,o,i){return this.encodeMinimally(new eie(e,t,r,o,i)).getBytes()},n.addEdge=function(e,t){var r=t.fromPosition+t.characterLength;(null===e[r][t.getEndMode()]||e[r][t.getEndMode()].cachedTotalSize>t.cachedTotalSize)&&(e[r][t.getEndMode()]=t)},n.getNumberOfC40Words=function(e,t,r,o){for(var i=0,a=t;a<e.length();a++){if(e.isECI(a))return o[0]=0,0;var s=e.charAt(a);if(r&&_t.isNativeC40(s)||!r&&_t.isNativeText(s))i++;else if(n.isExtendedASCII(s,e.getFNC1Character())){var u=255&s;u>=128&&(r&&_t.isNativeC40(u-128)||!r&&_t.isNativeText(u-128))?i+=3:i+=4}else i+=2;if(i%3==0||(i-2)%3==0&&a+1===e.length())return o[0]=a-t+1,Math.ceil(i/3)}return o[0]=0,0},n.addEdges=function(e,t,r,o){var i,a;if(e.isECI(r))this.addEdge(t,new Si(e,fe.ASCII,r,1,o));else{var h,s=e.charAt(r);if(null===o||o.getEndMode()!==fe.EDF){_t.isDigit(s)&&e.haveNCharacters(r,2)&&_t.isDigit(e.charAt(r+1))?this.addEdge(t,new Si(e,fe.ASCII,r,2,o)):this.addEdge(t,new Si(e,fe.ASCII,r,1,o));var u=[fe.C40,fe.TEXT];try{for(var c=Oh(u),l=c.next();!l.done;l=c.next()){var f=l.value,d=[];n.getNumberOfC40Words(e,r,f===fe.C40,d)>0&&this.addEdge(t,new Si(e,f,r,d[0],o))}}catch(g){i={error:g}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}e.haveNCharacters(r,3)&&_t.isNativeX12(e.charAt(r))&&_t.isNativeX12(e.charAt(r+1))&&_t.isNativeX12(e.charAt(r+2))&&this.addEdge(t,new Si(e,fe.X12,r,3,o)),this.addEdge(t,new Si(e,fe.B256,r,1,o))}for(h=0;h<3;h++){var p=r+h;if(!e.haveNCharacters(p,1)||!_t.isNativeEDIFACT(e.charAt(p)))break;this.addEdge(t,new Si(e,fe.EDF,r,h+1,o))}3===h&&e.haveNCharacters(r,4)&&_t.isNativeEDIFACT(e.charAt(r+3))&&this.addEdge(t,new Si(e,fe.EDF,r,4,o))}},n.encodeMinimally=function(e){var t=e.length(),r=Array(t+1).fill(null).map(function(){return Array(6).fill(0)});this.addEdges(e,r,0,null);for(var o=1;o<=t;o++){for(var i=0;i<6;i++)null!==r[o][i]&&o<t&&this.addEdges(e,r,o,r[o][i]);for(i=0;i<6;i++)r[o-1][i]=null}var a=-1,s=ut.MAX_VALUE;for(i=0;i<6;i++)if(null!==r[t][i]){var u=r[t][i],c=i>=1&&i<=3?u.cachedTotalSize+1:u.cachedTotalSize;c<s&&(s=c,a=i)}if(a<0)throw new Error('Failed to encode "'+e+'"');return new Joe(r[t][a])},n}(),Joe=function(){function n(e){var t=e.input,r=0,o=[],i=[],a=[];(e.mode===fe.C40||e.mode===fe.TEXT||e.mode===fe.X12)&&e.getEndMode()!==fe.ASCII&&(r+=this.prepend(Si.getBytes(254),o));for(var s=e;null!==s;)r+=this.prepend(s.getDataBytes(),o),(null===s.previous||s.getPreviousStartMode()!==s.getMode())&&(s.getMode()===fe.B256&&(r<=249?(o.unshift(r),r++):(o.unshift(r%250),o.unshift(r/250+249),r+=2),i.push(o.length),a.push(r)),this.prepend(s.getLatchBytes(),o),r=0),s=s.previous;5===t.getMacroId()?r+=this.prepend(Si.getBytes(236),o):6===t.getMacroId()&&(r+=this.prepend(Si.getBytes(237),o)),t.getFNC1Character()>0&&(r+=this.prepend(Si.getBytes(232),o));for(var u=0;u<i.length;u++)this.applyRandomPattern(o,o.length-i[u],a[u]);var c=e.getMinSymbolSize(o.length);for(o.length<c&&o.push(129);o.length<c;)o.push(this.randomize253State(o.length+1));for(this.bytes=new Uint8Array(o.length),u=0;u<this.bytes.length;u++)this.bytes[u]=o[u]}return n.prototype.prepend=function(e,t){for(var r=e.length-1;r>=0;r--)t.unshift(e[r]);return e.length},n.prototype.randomize253State=function(e){var r=149*e%253+1+129;return r<=254?r:r-254},n.prototype.applyRandomPattern=function(e,t,r){for(var o=0;o<r;o++){var i=t+o,u=149*(i+1)%255+1+(255&e[i]);e[i]=u<=255?u:u-256}},n.prototype.getBytes=function(){return this.bytes},n}(),Si=function(){function n(e,t,r,o,i){if(this.input=e,this.mode=t,this.fromPosition=r,this.characterLength=o,this.previous=i,this.allCodewordCapacities=[3,5,8,10,12,16,18,22,30,32,36,44,49,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.squareCodewordCapacities=[3,5,8,12,18,22,30,36,44,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.rectangularCodewordCapacities=[5,10,16,33,32,49],!(r+o<=e.length()))throw new Error("Invalid edge");var a=null!==i?i.cachedTotalSize:0,s=this.getPreviousMode();switch(t){case fe.ASCII:a++,(e.isECI(r)||Mo.isExtendedASCII(e.charAt(r),e.getFNC1Character()))&&a++,(s===fe.C40||s===fe.TEXT||s===fe.X12)&&a++;break;case fe.B256:a++,(s!==fe.B256||250===this.getB256Size())&&a++,s===fe.ASCII?a++:(s===fe.C40||s===fe.TEXT||s===fe.X12)&&(a+=2);break;case fe.C40:case fe.TEXT:case fe.X12:a+=t===fe.X12?2:2*Mo.getNumberOfC40Words(e,r,t===fe.C40,[]),s===fe.ASCII||s===fe.B256?a++:s!==t&&(s===fe.C40||s===fe.TEXT||s===fe.X12)&&(a+=2);break;case fe.EDF:a+=3,s===fe.ASCII||s===fe.B256?a++:(s===fe.C40||s===fe.TEXT||s===fe.X12)&&(a+=2)}this.cachedTotalSize=a}return n.prototype.getB256Size=function(){for(var e=0,t=this;null!==t&&t.mode===fe.B256&&e<=250;)e++,t=t.previous;return e},n.prototype.getPreviousStartMode=function(){return null===this.previous?fe.ASCII:this.previous.mode},n.prototype.getPreviousMode=function(){return null===this.previous?fe.ASCII:this.previous.getEndMode()},n.prototype.getEndMode=function(){if(this.mode===fe.EDF){if(this.characterLength<4)return fe.ASCII;if((e=this.getLastASCII())>0&&this.getCodewordsRemaining(this.cachedTotalSize+e)<=2-e)return fe.ASCII}if(this.mode===fe.C40||this.mode===fe.TEXT||this.mode===fe.X12){if(this.fromPosition+this.characterLength>=this.input.length()&&0===this.getCodewordsRemaining(this.cachedTotalSize))return fe.ASCII;var e;if(1===(e=this.getLastASCII())&&0===this.getCodewordsRemaining(this.cachedTotalSize+1))return fe.ASCII}return this.mode},n.prototype.getMode=function(){return this.mode},n.prototype.getLastASCII=function(){var e=this.input.length(),t=this.fromPosition+this.characterLength;return e-t>4||t>=e?0:e-t==1?Mo.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())?0:1:e-t==2?Mo.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())||Mo.isExtendedASCII(this.input.charAt(t+1),this.input.getFNC1Character())?0:_t.isDigit(this.input.charAt(t))&&_t.isDigit(this.input.charAt(t+1))?1:2:e-t==3?_t.isDigit(this.input.charAt(t))&&_t.isDigit(this.input.charAt(t+1))&&!Mo.isExtendedASCII(this.input.charAt(t+2),this.input.getFNC1Character())||_t.isDigit(this.input.charAt(t+1))&&_t.isDigit(this.input.charAt(t+2))&&!Mo.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())?2:0:_t.isDigit(this.input.charAt(t))&&_t.isDigit(this.input.charAt(t+1))&&_t.isDigit(this.input.charAt(t+2))&&_t.isDigit(this.input.charAt(t+3))?2:0},n.prototype.getMinSymbolSize=function(e){var t,r,o,i,a,s;switch(this.input.getShapeHint()){case 1:try{for(var u=Oh(this.squareCodewordCapacities),c=u.next();!c.done;c=u.next())if((l=c.value)>=e)return l}catch(g){t={error:g}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}break;case 2:try{for(var f=Oh(this.rectangularCodewordCapacities),d=f.next();!d.done;d=f.next())if((l=d.value)>=e)return l}catch(g){o={error:g}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}}try{for(var h=Oh(this.allCodewordCapacities),p=h.next();!p.done;p=h.next()){var l;if((l=p.value)>=e)return l}}catch(g){a={error:g}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}return this.allCodewordCapacities[this.allCodewordCapacities.length-1]},n.prototype.getCodewordsRemaining=function(e){return this.getMinSymbolSize(e)-e},n.getBytes=function(e,t){var r=new Uint8Array(t?2:1);return r[0]=e,t&&(r[1]=t),r},n.prototype.setC40Word=function(e,t,r,o,i){var a=1600*(255&r)+40*(255&o)+(255&i)+1;e[t]=a/256,e[t+1]=a%256},n.prototype.getX12Value=function(e){return 13===e?0:42===e?1:62===e?2:32===e?3:e>=48&&e<=57?e-44:e>=65&&e<=90?e-51:e},n.prototype.getX12Words=function(){if(this.characterLength%3!=0)throw new Error("X12 words must be a multiple of 3");for(var e=new Uint8Array(this.characterLength/3*2),t=0;t<e.length;t+=2)this.setC40Word(e,t,this.getX12Value(this.input.charAt(this.fromPosition+t/2*3)),this.getX12Value(this.input.charAt(this.fromPosition+t/2*3+1)),this.getX12Value(this.input.charAt(this.fromPosition+t/2*3+2)));return e},n.prototype.getShiftValue=function(e,t,r){return t&&Mo.isInC40Shift1Set(e)||!t&&Mo.isInTextShift1Set(e)?0:t&&Mo.isInC40Shift2Set(e,r)||!t&&Mo.isInTextShift2Set(e,r)?1:2},n.prototype.getC40Value=function(e,t,r,o){if(r===o){if(2!==t)throw new Error("FNC1 cannot be used in C40 shift 2");return 27}return e?r<=31?r:32===r?3:r<=47?r-33:r<=57?r-44:r<=64?r-43:r<=90?r-51:r<=95?r-69:r<=127?r-96:r:0===r?0:0===t&&r<=3?r-1:1===t&&r<=31?r:32===r?3:r>=33&&r<=47?r-33:r>=48&&r<=57?r-44:r>=58&&r<=64?r-43:r>=65&&r<=90?r-64:r>=91&&r<=95?r-69:96===r?0:r>=97&&r<=122?r-83:r>=123&&r<=127?r-96:r},n.prototype.getC40Words=function(e,t){for(var r=[],o=0;o<this.characterLength;o++){var i=this.input.charAt(this.fromPosition+o);if(e&&_t.isNativeC40(i)||!e&&_t.isNativeText(i))r.push(this.getC40Value(e,0,i,t));else if(Mo.isExtendedASCII(i,t)){var s=(255&i)-128;if(e&&_t.isNativeC40(s)||!e&&_t.isNativeText(s))r.push(1),r.push(30),r.push(this.getC40Value(e,0,s,t));else{r.push(1),r.push(30);var a=this.getShiftValue(s,e,t);r.push(a),r.push(this.getC40Value(e,a,s,t))}}else a=this.getShiftValue(i,e,t),r.push(a),r.push(this.getC40Value(e,a,i,t))}if(r.length%3!=0){if((r.length-2)%3!=0||this.fromPosition+this.characterLength!==this.input.length())throw new Error("C40 words must be a multiple of 3");r.push(0)}var u=new Uint8Array(r.length/3*2),c=0;for(o=0;o<r.length;o+=3)this.setC40Word(u,c,255&r[o],255&r[o+1],255&r[o+2]),c+=2;return u},n.prototype.getEDFBytes=function(){for(var e=Math.ceil(this.characterLength/4),t=new Uint8Array(3*e),r=this.fromPosition,o=Math.min(this.fromPosition+this.characterLength-1,this.input.length()-1),i=0;i<e;i+=3){for(var a=[],s=0;s<4;s++)a[s]=r<=o?63&this.input.charAt(r++):r===o+1?31:0;var u=a[0]<<18;u|=a[1]<<12,u|=a[2]<<6,t[i]=(u|=a[3])>>16&255,t[i+1]=u>>8&255,t[i+2]=255&u}return t},n.prototype.getLatchBytes=function(){switch(this.getPreviousMode()){case fe.ASCII:case fe.B256:switch(this.mode){case fe.B256:return n.getBytes(231);case fe.C40:return n.getBytes(230);case fe.TEXT:return n.getBytes(239);case fe.X12:return n.getBytes(238);case fe.EDF:return n.getBytes(240)}break;case fe.C40:case fe.TEXT:case fe.X12:if(this.mode!==this.getPreviousMode())switch(this.mode){case fe.ASCII:return n.getBytes(254);case fe.B256:return n.getBytes(254,231);case fe.C40:return n.getBytes(254,230);case fe.TEXT:return n.getBytes(254,239);case fe.X12:return n.getBytes(254,238);case fe.EDF:return n.getBytes(254,240)}break;case fe.EDF:if(this.mode!==fe.EDF)throw new Error("Cannot switch from EDF to "+this.mode)}return new Uint8Array(0)},n.prototype.getDataBytes=function(){switch(this.mode){case fe.ASCII:return this.input.isECI(this.fromPosition)?n.getBytes(241,this.input.getECIValue(this.fromPosition)+1):Mo.isExtendedASCII(this.input.charAt(this.fromPosition),this.input.getFNC1Character())?n.getBytes(235,this.input.charAt(this.fromPosition)-127):2===this.characterLength?n.getBytes(10*this.input.charAt(this.fromPosition)+this.input.charAt(this.fromPosition+1)+130):this.input.isFNC1(this.fromPosition)?n.getBytes(232):n.getBytes(this.input.charAt(this.fromPosition)+1);case fe.B256:return n.getBytes(this.input.charAt(this.fromPosition));case fe.C40:return this.getC40Words(!0,this.input.getFNC1Character());case fe.TEXT:return this.getC40Words(!1,this.input.getFNC1Character());case fe.X12:return this.getX12Words();case fe.EDF:return this.getEDFBytes()}},n}(),eie=function(n){function e(t,r,o,i,a){var s=n.call(this,t,r,o)||this;return s.shape=i,s.macroId=a,s}return Koe(e,n),e.prototype.getMacroId=function(){return this.macroId},e.prototype.getShapeHint=function(){return this.shape},e}(Xoe);!function(){function n(){}n.prototype.encode=function(e,t,r,o,i){if(void 0===i&&(i=null),""===e.trim())throw new Error("Found empty contents");if(t!==Me.DATA_MATRIX)throw new Error("Can only encode DATA_MATRIX, but got "+t);if(r<0||o<0)throw new Error("Requested dimensions can't be negative: "+r+"x"+o);var d,a=0,s=null,u=null;if(null!=i){var c=i.get(wt.DATA_MATRIX_SHAPE);null!=c&&(a=c);var l=i.get(wt.MIN_SIZE);null!=l&&(s=l);var f=i.get(wt.MAX_SIZE);null!=f&&(u=f)}if(null!=i&&i.has(wt.DATA_MATRIX_COMPACT)&&Boolean(i.get(wt.DATA_MATRIX_COMPACT).toString())){var p=i.has(wt.GS1_FORMAT)&&Boolean(i.get(wt.GS1_FORMAT).toString()),g=null;i.has(wt.CHARACTER_SET)&&(g=G_.forName(i.get(wt.CHARACTER_SET).toString())),d=Mo.encodeHighLevel(e,g,p?29:-1,a)}else{var m=null!=i&&i.has(wt.FORCE_C40)&&Boolean(i.get(wt.FORCE_C40).toString());d=_t.encodeHighLevel(e,a,s,u,m)}var y=_P.lookup(d.length,a,s,u,!0),x=Ooe.encodeECC200(d,y),w=new xoe(x,y.getSymbolDataWidth(),y.getSymbolDataHeight());return w.place(),this.encodeLowLevel(w,y,r,o)},n.prototype.encodeLowLevel=function(e,t,r,o){for(var i=t.getSymbolDataWidth(),a=t.getSymbolDataHeight(),s=new hP(t.getSymbolWidth(),t.getSymbolHeight()),u=0,c=0;c<a;c++){var l=void 0;if(c%t.matrixHeight==0){l=0;for(var f=0;f<t.getSymbolWidth();f++)s.setBoolean(l,u,f%2==0),l++;u++}for(l=0,f=0;f<i;f++)f%t.matrixWidth==0&&(s.setBoolean(l,u,!0),l++),s.setBoolean(l,u,e.getBit(f,c)),l++,f%t.matrixWidth==t.matrixWidth-1&&(s.setBoolean(l,u,c%2==0),l++);if(u++,c%t.matrixHeight==t.matrixHeight-1){for(l=0,f=0;f<t.getSymbolWidth();f++)s.setBoolean(l,u,!0),l++;u++}}return this.convertByteMatrixToBitMatrix(s,r,o)},n.prototype.convertByteMatrixToBitMatrix=function(e,t,r){var f,o=e.getWidth(),i=e.getHeight(),a=Math.max(t,o),s=Math.max(r,i),u=Math.min(a/o,s/i),c=(a-o*u)/2,l=(s-i*u)/2;r<i||t<o?(c=0,l=0,f=new Ro(o,i)):f=new Ro(t,r),f.clear();for(var d=0,h=l;d<i;d++,h+=u)for(var p=0,g=c;p<o;p++,g+=u)1===e.get(p,d)&&f.setRegion(g,h,u,u);return f}}();var tie=function(){function n(){}return n.prototype.isCompact=function(){return this.compact},n.prototype.setCompact=function(e){this.compact=e},n.prototype.getSize=function(){return this.size},n.prototype.setSize=function(e){this.size=e},n.prototype.getLayers=function(){return this.layers},n.prototype.setLayers=function(e){this.layers=e},n.prototype.getCodeWords=function(){return this.codeWords},n.prototype.setCodeWords=function(e){this.codeWords=e},n.prototype.getMatrix=function(){return this.matrix},n.prototype.setMatrix=function(e){this.matrix=e},n}();const nie=tie;var rie=function(){function n(){}return n.singletonList=function(e){return[e]},n.min=function(e,t){return e.sort(t)[0]},n}();const EP=rie;var oie=function(){function n(e){this.previous=e}return n.prototype.getPrevious=function(){return this.previous},n}();const iie=oie;var aie=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),sie=function(n){function e(t,r,o){var i=n.call(this,t)||this;return i.value=r,i.bitCount=o,i}return aie(e,n),e.prototype.appendTo=function(t,r){t.appendBits(this.value,this.bitCount)},e.prototype.add=function(t,r){return new e(this,t,r)},e.prototype.addBinaryShift=function(t,r){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new e(this,t,r)},e.prototype.toString=function(){var t=this.value&(1<<this.bitCount)-1;return"<"+ut.toBinaryString((t|=1<<this.bitCount)|1<<this.bitCount).substring(1)+">"},e}(iie);const X_=sie;var uie=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),cie=function(n){function e(t,r,o){var i=n.call(this,t,0,0)||this;return i.binaryShiftStart=r,i.binaryShiftByteCount=o,i}return uie(e,n),e.prototype.appendTo=function(t,r){for(var o=0;o<this.binaryShiftByteCount;o++)(0===o||31===o&&this.binaryShiftByteCount<=62)&&(t.appendBits(31,5),this.binaryShiftByteCount>62?t.appendBits(this.binaryShiftByteCount-31,16):t.appendBits(0===o?Math.min(this.binaryShiftByteCount,31):this.binaryShiftByteCount-31,5)),t.appendBits(r[this.binaryShiftStart+o],8)},e.prototype.addBinaryShift=function(t,r){return new e(this,t,r)},e.prototype.toString=function(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"},e}(X_);const lie=cie;function Mh(n,e,t){return new X_(n,e,t)}var die=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],hie=new X_(null,0,0),K_=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])],AP=function gie(n){var e,t;try{for(var r=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),o=r.next();!o.done;o=r.next())Yn.fill(o.value,-1)}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n[0][4]=0,n[1][4]=0,n[1][0]=28,n[3][4]=0,n[2][4]=0,n[2][0]=15,n}(Yn.createInt32Array(6,6)),mie=function(){function n(e,t,r,o){this.token=e,this.mode=t,this.binaryShiftByteCount=r,this.bitCount=o}return n.prototype.getMode=function(){return this.mode},n.prototype.getToken=function(){return this.token},n.prototype.getBinaryShiftByteCount=function(){return this.binaryShiftByteCount},n.prototype.getBitCount=function(){return this.bitCount},n.prototype.latchAndAppend=function(e,t){var r=this.bitCount,o=this.token;if(e!==this.mode){var i=K_[this.mode][e];o=Mh(o,65535&i,i>>16),r+=i>>16}var a=2===e?4:5;return new n(o=Mh(o,t,a),e,0,r+a)},n.prototype.shiftAndAppend=function(e,t){var r=this.token,o=2===this.mode?4:5;return r=Mh(r,AP[this.mode][e],o),new n(r=Mh(r,t,5),this.mode,0,this.bitCount+o+5)},n.prototype.addBinaryShiftChar=function(e){var t=this.token,r=this.mode,o=this.bitCount;if(4===this.mode||2===this.mode){var i=K_[r][0];t=Mh(t,65535&i,i>>16),o+=i>>16,r=0}var s=new n(t,r,this.binaryShiftByteCount+1,o+(0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8));return 2078===s.binaryShiftByteCount&&(s=s.endBinaryShift(e+1)),s},n.prototype.endBinaryShift=function(e){if(0===this.binaryShiftByteCount)return this;var t=this.token;return t=function fie(n,e,t){return new lie(n,e,t)}(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new n(t,this.mode,0,this.bitCount)},n.prototype.isBetterThanOrEqualTo=function(e){var t=this.bitCount+(K_[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=n.calculateBinaryShiftCost(e)-n.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount},n.prototype.toBitArray=function(e){for(var t,r,o=[],i=this.endBinaryShift(e.length).token;null!==i;i=i.getPrevious())o.unshift(i);var a=new vr;try{for(var s=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),u=s.next();!u.done;u=s.next())u.value.appendTo(a,e)}catch(l){t={error:l}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return a},n.prototype.toString=function(){return Et.format("%s bits=%d bytes=%d",die[this.mode],this.bitCount,this.binaryShiftByteCount)},n.calculateBinaryShiftCost=function(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0},n.INITIAL_STATE=new n(hie,0,0,0),n}();const yie=mie;var Y_=function xie(n){var e=Et.getCharCode(" "),t=Et.getCharCode("."),r=Et.getCharCode(",");n[0][e]=1;for(var o=Et.getCharCode("Z"),i=Et.getCharCode("A"),a=i;a<=o;a++)n[0][a]=a-i+2;n[1][e]=1;var s=Et.getCharCode("z"),u=Et.getCharCode("a");for(a=u;a<=s;a++)n[1][a]=a-u+2;n[2][e]=1;var c=Et.getCharCode("9"),l=Et.getCharCode("0");for(a=l;a<=c;a++)n[2][a]=a-l+2;n[2][r]=12,n[2][t]=13;for(var f=["\0"," ","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x1b","\x1c","\x1d","\x1e","\x1f","@","\\","^","_","`","|","~","\x7f"],d=0;d<f.length;d++)n[3][Et.getCharCode(f[d])]=d;var h=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(d=0;d<h.length;d++)Et.getCharCode(h[d])>0&&(n[4][Et.getCharCode(h[d])]=d);return n}(Yn.createInt32Array(5,256)),R0=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wie=function(){function n(e){this.text=e}return n.prototype.encode=function(){for(var e=Et.getCharCode(" "),t=Et.getCharCode("\n"),r=EP.singletonList(yie.INITIAL_STATE),o=0;o<this.text.length;o++){var i=void 0,a=o+1<this.text.length?this.text[o+1]:0;switch(this.text[o]){case Et.getCharCode("\r"):i=a===t?2:0;break;case Et.getCharCode("."):i=a===e?3:0;break;case Et.getCharCode(","):i=a===e?4:0;break;case Et.getCharCode(":"):i=a===e?5:0;break;default:i=0}i>0?(r=n.updateStateListForPair(r,o,i),o++):r=this.updateStateListForChar(r,o)}return EP.min(r,function(u,c){return u.getBitCount()-c.getBitCount()}).toBitArray(this.text)},n.prototype.updateStateListForChar=function(e,t){var r,o,i=[];try{for(var a=R0(e),s=a.next();!s.done;s=a.next())this.updateStateForChar(s.value,t,i)}catch(c){r={error:c}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return n.simplifyStates(i)},n.prototype.updateStateForChar=function(e,t,r){for(var o=255&this.text[t],i=Y_[e.getMode()][o]>0,a=null,s=0;s<=4;s++){var u=Y_[s][o];if(u>0){if(null==a&&(a=e.endBinaryShift(t)),!i||s===e.getMode()||2===s){var c=a.latchAndAppend(s,u);r.push(c)}if(!i&&AP[e.getMode()][s]>=0){var l=a.shiftAndAppend(s,u);r.push(l)}}}if(e.getBinaryShiftByteCount()>0||0===Y_[e.getMode()][o]){var f=e.addBinaryShiftChar(t);r.push(f)}},n.updateStateListForPair=function(e,t,r){var o,i,a=[];try{for(var s=R0(e),u=s.next();!u.done;u=s.next())this.updateStateForPair(u.value,t,r,a)}catch(l){o={error:l}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return this.simplifyStates(a)},n.updateStateForPair=function(e,t,r,o){var i=e.endBinaryShift(t);if(o.push(i.latchAndAppend(4,r)),4!==e.getMode()&&o.push(i.shiftAndAppend(4,r)),3===r||4===r){var a=i.latchAndAppend(2,16-r).latchAndAppend(2,1);o.push(a)}if(e.getBinaryShiftByteCount()>0){var s=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);o.push(s)}},n.simplifyStates=function(e){var t,r,o,i,a=[];try{for(var s=R0(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=!0,f=function(v){if(v.isBetterThanOrEqualTo(c))return l=!1,"break";c.isBetterThanOrEqualTo(v)&&(a=a.filter(function(m){return m!==v}))};try{for(var d=(o=void 0,R0(a)),h=d.next();!h.done&&"break"!==f(h.value);h=d.next());}catch(v){o={error:v}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}l&&a.push(c)}}catch(v){t={error:v}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return a},n}();const _ie=wie;var Cie=function(){function n(){}return n.encodeBytes=function(e){return n.encode(e,n.DEFAULT_EC_PERCENT,n.DEFAULT_AZTEC_LAYERS)},n.encode=function(e,t,r){var s,u,c,l,f,o=new _ie(e).encode(),i=ut.truncDivision(o.getSize()*t,100)+11,a=o.getSize()+i;if(r!==n.DEFAULT_AZTEC_LAYERS){if(s=r<0,(u=Math.abs(r))>(s?n.MAX_NB_BITS_COMPACT:n.MAX_NB_BITS))throw new Ie(Et.format("Illegal value %s for layers",r));var d=(c=n.totalBitsInLayer(u,s))-c%(l=n.WORD_SIZE[u]);if((f=n.stuffBits(o,l)).getSize()+i>d)throw new Ie("Data to large for user specified layer");if(s&&f.getSize()>64*l)throw new Ie("Data to large for user specified layer")}else{l=0,f=null;for(var h=0;;h++){if(h>n.MAX_NB_BITS)throw new Ie("Data too large for an Aztec code");if(!(a>(c=n.totalBitsInLayer(u=(s=h<=3)?h+1:h,s)))&&((null==f||l!==n.WORD_SIZE[u])&&(f=n.stuffBits(o,l=n.WORD_SIZE[u])),d=c-c%l,!(s&&f.getSize()>64*l)&&f.getSize()+i<=d))break}}var x,p=n.generateCheckWords(f,c,l),g=f.getSize()/l,v=n.generateModeMessage(s,u,g),m=(s?11:14)+4*u,y=new Int32Array(m);if(s)for(x=m,h=0;h<y.length;h++)y[h]=h;else{x=m+1+2*ut.truncDivision(ut.truncDivision(m,2)-1,15);var w=ut.truncDivision(m,2),_=ut.truncDivision(x,2);for(h=0;h<w;h++){var b=h+ut.truncDivision(h,15);y[w-h-1]=_-b-1,y[w+h]=_+b+1}}for(var C=new Ro(x),E=(h=0,0);h<u;h++){for(var S=4*(u-h)+(s?9:12),A=0;A<S;A++)for(var D=2*A,M=0;M<2;M++)p.get(E+D+M)&&C.set(y[2*h+M],y[2*h+A]),p.get(E+2*S+D+M)&&C.set(y[2*h+A],y[m-1-2*h-M]),p.get(E+4*S+D+M)&&C.set(y[m-1-2*h-M],y[m-1-2*h-A]),p.get(E+6*S+D+M)&&C.set(y[m-1-2*h-A],y[2*h+M]);E+=8*S}if(n.drawModeMessage(C,s,x,v),s)n.drawBullsEye(C,ut.truncDivision(x,2),5);else for(n.drawBullsEye(C,ut.truncDivision(x,2),7),h=0,A=0;h<ut.truncDivision(m,2)-1;h+=15,A+=16)for(M=1&ut.truncDivision(x,2);M<x;M+=2)C.set(ut.truncDivision(x,2)-A,M),C.set(ut.truncDivision(x,2)+A,M),C.set(M,ut.truncDivision(x,2)-A),C.set(M,ut.truncDivision(x,2)+A);var L=new nie;return L.setCompact(s),L.setSize(x),L.setLayers(u),L.setCodeWords(g),L.setMatrix(C),L},n.drawBullsEye=function(e,t,r){for(var o=0;o<r;o+=2)for(var i=t-o;i<=t+o;i++)e.set(i,t-o),e.set(i,t+o),e.set(t-o,i),e.set(t+o,i);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)},n.generateModeMessage=function(e,t,r){var o=new vr;return e?(o.appendBits(t-1,2),o.appendBits(r-1,6),o=n.generateCheckWords(o,28,4)):(o.appendBits(t-1,5),o.appendBits(r-1,11),o=n.generateCheckWords(o,40,4)),o},n.drawModeMessage=function(e,t,r,o){var i=ut.truncDivision(r,2);if(t)for(var a=0;a<7;a++){var s=i-3+a;o.get(a)&&e.set(s,i-5),o.get(a+7)&&e.set(i+5,s),o.get(20-a)&&e.set(s,i+5),o.get(27-a)&&e.set(i-5,s)}else for(a=0;a<10;a++)s=i-5+a+ut.truncDivision(a,5),o.get(a)&&e.set(s,i-7),o.get(a+10)&&e.set(i+7,s),o.get(29-a)&&e.set(s,i+7),o.get(39-a)&&e.set(i-7,s)},n.generateCheckWords=function(e,t,r){var o,i,a=e.getSize()/r,s=new dP(n.getGF(r)),u=ut.truncDivision(t,r),c=n.bitsToWords(e,r,u);s.encode(c,u-a);var l=t%r,f=new vr;f.appendBits(0,l);try{for(var d=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Array.from(c)),h=d.next();!h.done;h=d.next())f.appendBits(h.value,r)}catch(g){o={error:g}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}return f},n.bitsToWords=function(e,t,r){var i,a,o=new Int32Array(r);for(i=0,a=e.getSize()/t;i<a;i++){for(var s=0,u=0;u<t;u++)s|=e.get(i*t+u)?1<<t-u-1:0;o[i]=s}return o},n.getGF=function(e){switch(e){case 4:return No.AZTEC_PARAM;case 6:return No.AZTEC_DATA_6;case 8:return No.AZTEC_DATA_8;case 10:return No.AZTEC_DATA_10;case 12:return No.AZTEC_DATA_12;default:throw new Ie("Unsupported word size "+e)}},n.stuffBits=function(e,t){for(var r=new vr,o=e.getSize(),i=(1<<t)-2,a=0;a<o;a+=t){for(var s=0,u=0;u<t;u++)(a+u>=o||e.get(a+u))&&(s|=1<<t-1-u);(s&i)===i?(r.appendBits(s&i,t),a--):s&i?r.appendBits(s,t):(r.appendBits(1|s,t),a--)}return r},n.totalBitsInLayer=function(e,t){return((t?88:112)+16*e)*e},n.DEFAULT_EC_PERCENT=33,n.DEFAULT_AZTEC_LAYERS=0,n.MAX_NB_BITS=32,n.MAX_NB_BITS_COMPACT=4,n.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]),n}();const Z_=Cie;!function(){function n(){}n.prototype.encode=function(e,t,r,o){return this.encodeWithHints(e,t,r,o,null)},n.prototype.encodeWithHints=function(e,t,r,o,i){var a=vP.ISO_8859_1,s=Z_.DEFAULT_EC_PERCENT,u=Z_.DEFAULT_AZTEC_LAYERS;return null!=i&&(i.has(wt.CHARACTER_SET)&&(a=G_.forName(i.get(wt.CHARACTER_SET).toString())),i.has(wt.ERROR_CORRECTION)&&(s=ut.parseInt(i.get(wt.ERROR_CORRECTION).toString())),i.has(wt.AZTEC_LAYERS)&&(u=ut.parseInt(i.get(wt.AZTEC_LAYERS).toString()))),n.encodeLayers(e,t,r,o,a,s,u)},n.encodeLayers=function(e,t,r,o,i,a,s){if(t!==Me.AZTEC)throw new Ie("Can only encode AZTEC, but got "+t);var u=Z_.encode(Et.getBytes(e,i),a,s);return n.renderResult(u,r,o)},n.renderResult=function(e,t,r){var o=e.getMatrix();if(null==o)throw new La;for(var i=o.getWidth(),a=o.getHeight(),s=Math.max(t,i),u=Math.max(r,a),c=Math.min(s/i,u/a),l=(s-i*c)/2,f=(u-a*c)/2,d=new Ro(s,u),h=0,p=f;h<a;h++,p+=c)for(var g=0,v=l;g<i;g++,v+=c)o.get(g,h)&&d.setRegion(v,p,c,c);return d}}();var Eie=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sie=function(n){function e(t){var r=n.call(this,t.width,t.height)||this;return r.canvas=t,r.tempCanvasElement=null,r.buffer=e.makeBufferFromCanvasImageData(t),r}return Eie(e,n),e.makeBufferFromCanvasImageData=function(t){var r=t.getContext("2d");if(!r)throw new Error("Couldn't get canvas context.");var o=r.getImageData(0,0,t.width,t.height);return e.toGrayscaleBuffer(o.data,t.width,t.height)},e.toGrayscaleBuffer=function(t,r,o){for(var i=new Uint8ClampedArray(r*o),a=0,s=0,u=t.length;a<u;a+=4,s++){i[s]=0===t[a+3]?255:306*t[a]+601*t[a+1]+117*t[a+2]+512>>10}return i},e.prototype.getRow=function(t,r){if(t<0||t>=this.getHeight())throw new Ie("Requested row is outside the image: "+t);var o=this.getWidth(),i=t*o;return null===r?r=this.buffer.slice(i,i+o):(r.length<o&&(r=new Uint8ClampedArray(o)),r.set(this.buffer.slice(i,i+o))),r},e.prototype.getMatrix=function(){return this.buffer},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(t,r,o,i){return n.prototype.crop.call(this,t,r,o,i),this},e.prototype.isRotateSupported=function(){return!0},e.prototype.rotateCounterClockwise=function(){return this.rotate(-90),this},e.prototype.rotateCounterClockwise45=function(){return this.rotate(-45),this},e.prototype.invert=function(){return new u0(this)},e.prototype.getTempCanvasElement=function(){if(null===this.tempCanvasElement){var t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement},e.prototype.rotate=function(t){var r=this.getTempCanvasElement();if(!r)throw new Error("Could not create a Canvas element.");var o=t*e.DEGREE_TO_RADIANS,i=this.canvas.width,a=this.canvas.height,s=Math.ceil(Math.abs(Math.cos(o))*i+Math.abs(Math.sin(o))*a),u=Math.ceil(Math.abs(Math.sin(o))*i+Math.abs(Math.cos(o))*a);r.width=s,r.height=u;var c=r.getContext("2d");if(!c)throw new Error("Could not create a Canvas Context element.");return c.translate(s/2,u/2),c.rotate(o),c.drawImage(this.canvas,i/-2,a/-2),this.buffer=e.makeBufferFromCanvasImageData(r),this},e.DEGREE_TO_RADIANS=Math.PI/180,e}(Ah);function IP(){return typeof navigator<"u"}var mf=function(){return mf=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},mf.apply(this,arguments)},Cn=function(n,e,t,r){return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):function o(i){return i instanceof t?i:new t(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})},En=function(n,e){var r,o,i,a,t={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(!(i=(i=t.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){t=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(6===c[0]&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}},Q_=function(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Die={delayBetweenScanAttempts:500,delayBetweenScanSuccess:500,tryPlayVideoTimeout:5e3},yu=function(){function n(e,t,r){void 0===t&&(t=new Map),void 0===r&&(r={}),this.reader=e,this.hints=t,this.options=mf(mf({},Die),r)}return Object.defineProperty(n.prototype,"possibleFormats",{set:function(e){this.hints.set(Kt.POSSIBLE_FORMATS,e)},enumerable:!1,configurable:!0}),n.addVideoSource=function(e,t){try{e.srcObject=t}catch{console.error("got interrupted by new loading request")}},n.mediaStreamSetTorch=function(e,t){return Cn(this,void 0,void 0,function(){return En(this,function(r){switch(r.label){case 0:return[4,e.applyConstraints({advanced:[{fillLightMode:t?"flash":"off",torch:!!t}]})];case 1:return r.sent(),[2]}})})},n.mediaStreamIsTorchCompatible=function(e){var t,r,o=e.getVideoTracks();try{for(var i=Q_(o),a=i.next();!a.done;a=i.next())if(n.mediaStreamIsTorchCompatibleTrack(a.value))return!0}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1},n.mediaStreamIsTorchCompatibleTrack=function(e){try{return"torch"in e.getCapabilities()}catch(r){return console.error(r),console.warn("Your browser may be not fully compatible with WebRTC and/or ImageCapture specs. Torch will not be available."),!1}},n.isVideoPlaying=function(e){return e.currentTime>0&&!e.paused&&e.readyState>2},n.getMediaElement=function(e,t){var r=document.getElementById(e);if(!r)throw new Wn("element with id '".concat(e,"' not found"));if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new Wn("element with id '".concat(e,"' must be an ").concat(t," element"));return r},n.createVideoElement=function(e){if(e instanceof HTMLVideoElement)return e;if("string"==typeof e)return n.getMediaElement(e,"video");if(!e&&typeof document<"u"){var t=document.createElement("video");return t.width=200,t.height=200,t}throw new Error("Couldn't get videoElement from videoSource!")},n.prepareImageElement=function(e){if(e instanceof HTMLImageElement)return e;if("string"==typeof e)return n.getMediaElement(e,"img");if(typeof e>"u"){var t=document.createElement("img");return t.width=200,t.height=200,t}throw new Error("Couldn't get imageElement from imageSource!")},n.prepareVideoElement=function(e){var t=n.createVideoElement(e);return t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t},n.isImageLoaded=function(e){return!(!e.complete||0===e.naturalWidth)},n.createBinaryBitmapFromCanvas=function(e){var t=new Sie(e),r=new NM(t);return new TM(r)},n.drawImageOnCanvas=function(e,t){e.drawImage(t,0,0)},n.getMediaElementDimensions=function(e){if(e instanceof HTMLVideoElement)return{height:e.videoHeight,width:e.videoWidth};if(e instanceof HTMLImageElement)return{height:e.naturalHeight||e.height,width:e.naturalWidth||e.width};throw new Error("Couldn't find the Source's dimensions!")},n.createCaptureCanvas=function(e){if(!e)throw new Wn("Cannot create a capture canvas without a media element.");if(typeof document>"u")throw new Error('The page "Document" is undefined, make sure you\'re running in a browser.');var t=document.createElement("canvas"),r=n.getMediaElementDimensions(e),o=r.width,i=r.height;return t.style.width=o+"px",t.style.height=i+"px",t.width=o,t.height=i,t},n.tryPlayVideo=function(e){return Cn(this,void 0,void 0,function(){var t;return En(this,function(r){switch(r.label){case 0:if(e?.ended)return console.error("Trying to play video that has ended."),[2,!1];if(n.isVideoPlaying(e))return console.warn("Trying to play video that is already playing."),[2,!0];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.play()];case 2:return r.sent(),[2,!0];case 3:return t=r.sent(),console.warn("It was not possible to play the video.",t),[2,!1];case 4:return[2]}})})},n.createCanvasFromMediaElement=function(e){var t=n.createCaptureCanvas(e),r=t.getContext("2d");if(!r)throw new Error("Couldn't find Canvas 2D Context.");return n.drawImageOnCanvas(r,e),t},n.createBinaryBitmapFromMediaElem=function(e){var t=n.createCanvasFromMediaElement(e);return n.createBinaryBitmapFromCanvas(t)},n.destroyImageElement=function(e){e.src="",e.removeAttribute("src"),e=void 0},n.listVideoInputDevices=function(){return Cn(this,void 0,void 0,function(){var e,t,r,o,i,a,s,u,f,d;return En(this,function(h){switch(h.label){case 0:if(!IP())throw new Error("Can't enumerate devices, navigator is not present.");if(!function Iie(){return!(!function Aie(){return IP()&&!!navigator.mediaDevices}()||!navigator.mediaDevices.enumerateDevices)}())throw new Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:e=h.sent(),t=[];try{for(r=Q_(e),o=r.next();!o.done;o=r.next())"videoinput"===(a="video"===(i=o.value).kind?"videoinput":i.kind)&&(s=i.deviceId||i.id,u=i.label||"Video device ".concat(t.length+1),t.push({deviceId:s,label:u,kind:a,groupId:i.groupId}))}catch(p){f={error:p}}finally{try{o&&!o.done&&(d=r.return)&&d.call(r)}finally{if(f)throw f.error}}return[2,t]}})})},n.findDeviceById=function(e){return Cn(this,void 0,void 0,function(){var t;return En(this,function(r){switch(r.label){case 0:return[4,n.listVideoInputDevices()];case 1:return(t=r.sent())?[2,t.find(function(o){return o.deviceId===e})]:[2]}})})},n.cleanVideoSource=function(e){if(e){try{e.srcObject=null}catch{e.src=""}e&&e.removeAttribute("src")}},n.releaseAllStreams=function(){0!==n.streamTracker.length&&n.streamTracker.forEach(function(e){e.getTracks().forEach(function(t){return t.stop()})}),n.streamTracker=[]},n.playVideoOnLoadAsync=function(e,t){return Cn(this,void 0,void 0,function(){return En(this,function(o){switch(o.label){case 0:return[4,n.tryPlayVideo(e)];case 1:return o.sent()?[2,!0]:[2,new Promise(function(i,a){var s=setTimeout(function(){n.isVideoPlaying(e)||(a(!1),e.removeEventListener("canplay",u))},t),u=function(){n.tryPlayVideo(e).then(function(c){clearTimeout(s),e.removeEventListener("canplay",u),i(c)})};e.addEventListener("canplay",u)})]}})})},n.attachStreamToVideo=function(e,t,r){return void 0===r&&(r=5e3),Cn(this,void 0,void 0,function(){var o;return En(this,function(i){switch(i.label){case 0:return o=n.prepareVideoElement(t),n.addVideoSource(o,e),[4,n.playVideoOnLoadAsync(o,r)];case 1:return i.sent(),[2,o]}})})},n._waitImageLoad=function(e){return new Promise(function(t,r){var i=setTimeout(function(){n.isImageLoaded(e)||(e.removeEventListener("load",a),r())},1e4),a=function(){clearTimeout(i),e.removeEventListener("load",a),t()};e.addEventListener("load",a)})},n.checkCallbackFnOrThrow=function(e){if(!e)throw new Wn("`callbackFn` is a required parameter, you cannot capture results without it.")},n.disposeMediaStream=function(e){e.getVideoTracks().forEach(function(t){return t.stop()}),e=void 0},n.prototype.decode=function(e){var t=n.createCanvasFromMediaElement(e);return this.decodeFromCanvas(t)},n.prototype.decodeBitmap=function(e){return this.reader.decode(e,this.hints)},n.prototype.decodeFromCanvas=function(e){var t=n.createBinaryBitmapFromCanvas(e);return this.decodeBitmap(t)},n.prototype.decodeFromImageElement=function(e){return Cn(this,void 0,void 0,function(){var t;return En(this,function(r){switch(r.label){case 0:if(!e)throw new Wn("An image element must be provided.");return t=n.prepareImageElement(e),[4,this._decodeOnLoadImage(t)];case 1:return[2,r.sent()]}})})},n.prototype.decodeFromImageUrl=function(e){return Cn(this,void 0,void 0,function(){var t;return En(this,function(r){switch(r.label){case 0:if(!e)throw new Wn("An URL must be provided.");(t=n.prepareImageElement()).src=e,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.decodeFromImageElement(t)];case 2:return[2,r.sent()];case 3:return n.destroyImageElement(t),[7];case 4:return[2]}})})},n.prototype.decodeFromConstraints=function(e,t,r){return Cn(this,void 0,void 0,function(){var o,i;return En(this,function(a){switch(a.label){case 0:return n.checkCallbackFnOrThrow(r),[4,this.getUserMedia(e)];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.decodeFromStream(o,t,r)];case 3:return[2,a.sent()];case 4:throw i=a.sent(),n.disposeMediaStream(o),i;case 5:return[2]}})})},n.prototype.decodeFromStream=function(e,t,r){return Cn(this,void 0,void 0,function(){var i,s,u,c,f,d,h=this;return En(this,function(p){switch(p.label){case 0:return n.checkCallbackFnOrThrow(r),[4,n.attachStreamToVideo(e,t,this.options.tryPlayVideoTimeout)];case 1:return i=p.sent(),s=this.scan(i,r,function(){n.disposeMediaStream(e),n.cleanVideoSource(i)}),u=e.getVideoTracks(),c=mf(mf({},s),{stop:function(){s.stop()},streamVideoConstraintsApply:function(g,v){return Cn(this,void 0,void 0,function(){var m,y,x,_,b,C;return En(this,function(E){switch(E.label){case 0:m=v?u.filter(v):u,E.label=1;case 1:E.trys.push([1,6,7,8]),y=Q_(m),x=y.next(),E.label=2;case 2:return x.done?[3,5]:[4,x.value.applyConstraints(g)];case 3:E.sent(),E.label=4;case 4:return x=y.next(),[3,2];case 5:return[3,8];case 6:return _=E.sent(),b={error:_},[3,8];case 7:try{x&&!x.done&&(C=y.return)&&C.call(y)}finally{if(b)throw b.error}return[7];case 8:return[2]}})})},streamVideoConstraintsGet:function(g){return u.find(g).getConstraints()},streamVideoSettingsGet:function(g){return u.find(g).getSettings()},streamVideoCapabilitiesGet:function(g){return u.find(g).getCapabilities()}}),n.mediaStreamIsTorchCompatible(e)&&(f=u?.find(function(g){return n.mediaStreamIsTorchCompatibleTrack(g)}),c.switchTorch=d=function(g){return Cn(h,void 0,void 0,function(){return En(this,function(v){switch(v.label){case 0:return[4,n.mediaStreamSetTorch(f,g)];case 1:return v.sent(),[2]}})})},c.stop=function(){return Cn(h,void 0,void 0,function(){return En(this,function(g){switch(g.label){case 0:return s.stop(),[4,d(!1)];case 1:return g.sent(),[2]}})})}),[2,c]}})})},n.prototype.decodeFromVideoDevice=function(e,t,r){return Cn(this,void 0,void 0,function(){return En(this,function(a){switch(a.label){case 0:return n.checkCallbackFnOrThrow(r),[4,this.decodeFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},t,r)];case 1:return[2,a.sent()]}})})},n.prototype.decodeFromVideoElement=function(e,t){return Cn(this,void 0,void 0,function(){var r;return En(this,function(i){switch(i.label){case 0:if(n.checkCallbackFnOrThrow(t),!e)throw new Wn("A video element must be provided.");return r=n.prepareVideoElement(e),[4,n.playVideoOnLoadAsync(r,this.options.tryPlayVideoTimeout)];case 1:return i.sent(),[2,this.scan(r,t)]}})})},n.prototype.decodeFromVideoUrl=function(e,t){return Cn(this,void 0,void 0,function(){var r,o;return En(this,function(s){switch(s.label){case 0:if(n.checkCallbackFnOrThrow(t),!e)throw new Wn("An URL must be provided.");return(r=n.prepareVideoElement()).src=e,o=function(){n.cleanVideoSource(r)},[4,n.playVideoOnLoadAsync(r,this.options.tryPlayVideoTimeout)];case 1:return s.sent(),[2,this.scan(r,t,o)]}})})},n.prototype.decodeOnceFromConstraints=function(e,t){return Cn(this,void 0,void 0,function(){var r;return En(this,function(o){switch(o.label){case 0:return[4,this.getUserMedia(e)];case 1:return r=o.sent(),[4,this.decodeOnceFromStream(r,t)];case 2:return[2,o.sent()]}})})},n.prototype.decodeOnceFromStream=function(e,t){return Cn(this,void 0,void 0,function(){var r,o;return En(this,function(a){switch(a.label){case 0:return r=Boolean(t),[4,n.attachStreamToVideo(e,t)];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,,4,5]),[4,this.scanOneResult(o)];case 3:return[2,a.sent()];case 4:return r||n.cleanVideoSource(o),[7];case 5:return[2]}})})},n.prototype.decodeOnceFromVideoDevice=function(e,t){return Cn(this,void 0,void 0,function(){return En(this,function(i){switch(i.label){case 0:return[4,this.decodeOnceFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},t)];case 1:return[2,i.sent()]}})})},n.prototype.decodeOnceFromVideoElement=function(e){return Cn(this,void 0,void 0,function(){var t;return En(this,function(o){switch(o.label){case 0:if(!e)throw new Wn("A video element must be provided.");return t=n.prepareVideoElement(e),[4,n.playVideoOnLoadAsync(t,this.options.tryPlayVideoTimeout)];case 1:return o.sent(),[4,this.scanOneResult(t)];case 2:return[2,o.sent()]}})})},n.prototype.decodeOnceFromVideoUrl=function(e){return Cn(this,void 0,void 0,function(){var t,r;return En(this,function(o){switch(o.label){case 0:if(!e)throw new Wn("An URL must be provided.");(t=n.prepareVideoElement()).src=e,r=this.decodeOnceFromVideoElement(t),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,r];case 2:return[2,o.sent()];case 3:return n.cleanVideoSource(t),[7];case 4:return[2]}})})},n.prototype.scanOneResult=function(e,t,r,o){var i=this;return void 0===t&&(t=!0),void 0===r&&(r=!0),void 0===o&&(o=!0),new Promise(function(a,s){i.scan(e,function(u,c,l){if(u)return a(u),void l.stop();if(c){if(c instanceof Z&&t||c instanceof Gn&&r||c instanceof le&&o)return;l.stop(),s(c)}})})},n.prototype.scan=function(e,t,r){var o=this;n.checkCallbackFnOrThrow(t);var i=n.createCaptureCanvas(e),a=i.getContext("2d");if(!a)throw new Error("Couldn't create canvas for visual element scan.");var c,s=function(){a=void 0,i=void 0},u=!1,f={stop:function(){u=!0,clearTimeout(c),s(),r&&r()}},d=function(){if(!u)try{n.drawImageOnCanvas(a,e);var h=o.decodeFromCanvas(i);t(h,void 0,f),c=setTimeout(d,o.options.delayBetweenScanSuccess)}catch(m){if(t(void 0,m,f),m instanceof Gn||m instanceof le||m instanceof Z)return void(c=setTimeout(d,o.options.delayBetweenScanAttempts));s(),r&&r(m)}};return d(),f},n.prototype._decodeOnLoadImage=function(e){return Cn(this,void 0,void 0,function(){return En(this,function(r){switch(r.label){case 0:return n.isImageLoaded(e)?[3,2]:[4,n._waitImageLoad(e)];case 1:r.sent(),r.label=2;case 2:return[2,this.decode(e)]}})})},n.prototype.getUserMedia=function(e){return Cn(this,void 0,void 0,function(){var t;return En(this,function(r){switch(r.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return t=r.sent(),n.streamTracker.push(t),[2,t]}})})},n.streamTracker=[],n}(),Tie=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),Rie=(function(n){Tie(function e(t,r){return n.call(this,new p0,t,r)||this},n)}(yu),function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}()),Nie=(function(n){Rie(function e(t,r){return n.call(this,new vf(t),t,r)||this},n)}(yu),function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}()),Oie=(function(n){Nie(function e(t,r){return n.call(this,new x0,t,r)||this},n)}(yu),function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}()),Mie=function(n){function e(t,r){var o=this,i=new fP;return i.setHints(t),(o=n.call(this,i,t,r)||this).reader=i,o}return Oie(e,n),Object.defineProperty(e.prototype,"possibleFormats",{set:function(t){this.hints.set(Kt.POSSIBLE_FORMATS,t),this.reader.setHints(this.hints)},enumerable:!1,configurable:!0}),e.prototype.decodeBitmap=function(t){return this.reader.decodeWithState(t)},e.prototype.setHints=function(t){this.hints=t,this.reader.setHints(this.hints)},e}(yu),Pie=function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),kie=(function(n){Pie(function e(t,r){return n.call(this,new b0,t,r)||this},n)}(yu),function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}()),Ss=(function(n){kie(function e(t,r){return n.call(this,new w0,t,r)||this},n)}(yu),"http://www.w3.org/2000/svg"),DP=(function(){function n(e){if("string"==typeof e){var t=document.getElementById(e);if(!t)throw new Error("Could not find a Container element with '".concat(e,"'."));this.containerElement=t}else this.containerElement=e}n.prototype.write=function(e,t,r,o){if(0===e.length)throw new Ie("Found empty contents");if(t<0||r<0)throw new Ie("Requested dimensions are too small: "+t+"x"+r);var i=o&&void 0!==o.get(wt.MARGIN)?Number.parseInt(o.get(wt.MARGIN).toString(),10):n.QUIET_ZONE_SIZE,a=this.encode(o,e);return this.renderResult(a,t,r,i)},n.prototype.createSVGElement=function(e,t){var r=document.createElementNS(n.SVG_NS,"svg");return r.setAttributeNS(Ss,"width",t.toString()),r.setAttributeNS(Ss,"height",e.toString()),r},n.prototype.createSvgPathPlaceholderElement=function(e,t){var r=document.createElementNS(n.SVG_NS,"path");return r.setAttributeNS(Ss,"d","M0 0h".concat(e,"v").concat(t,"H0z")),r.setAttributeNS(Ss,"fill","none"),r},n.prototype.createSvgRectElement=function(e,t,r,o){var i=document.createElementNS(n.SVG_NS,"rect");return i.setAttributeNS(Ss,"x",e.toString()),i.setAttributeNS(Ss,"y",t.toString()),i.setAttributeNS(Ss,"height",r.toString()),i.setAttributeNS(Ss,"width",o.toString()),i.setAttributeNS(Ss,"fill","#000000"),i},n.prototype.encode=function(e,t){var r=Es.L;if(e&&void 0!==e.get(wt.ERROR_CORRECTION)){var o=e.get(wt.ERROR_CORRECTION).toString();r=Es.fromString(o)}return E0.encode(t,r,e)},n.prototype.renderResult=function(e,t,r,o){var i=e.getMatrix();if(null===i)throw new La;var a=i.getWidth(),s=i.getHeight(),u=a+2*o,c=s+2*o,l=Math.max(t,u),f=Math.max(r,c),d=Math.min(Math.floor(l/u),Math.floor(f/c)),h=Math.floor((l-a*d)/2),p=Math.floor((f-s*d)/2),g=this.createSVGElement(l,f),v=this.createSvgPathPlaceholderElement(t,r);g.appendChild(v),this.containerElement.appendChild(g);for(var m=0,y=p;m<s;m++,y+=d)for(var x=0,w=h;x<a;x++,w+=d)if(1===i.get(x,m)){var _=this.createSvgRectElement(w,y,d,d);g.appendChild(_)}return g},n.QUIET_ZONE_SIZE=4,n.SVG_NS="http://www.w3.org/2000/svg"}(),"http://www.w3.org/2000/svg");!function(){function n(){}n.prototype.write=function(e,t,r,o){if(0===e.length)throw new Ie("Found empty contents");if(t<0||r<0)throw new Ie("Requested dimensions are too small: "+t+"x"+r);var i=Es.L,a=n.QUIET_ZONE_SIZE;if(o){if(void 0!==o.get(wt.ERROR_CORRECTION)){var s=o.get(wt.ERROR_CORRECTION).toString();i=Es.fromString(s)}void 0!==o.get(wt.MARGIN)&&(a=Number.parseInt(o.get(wt.MARGIN).toString(),10))}var u=E0.encode(e,i,o);return this.renderResult(u,t,r,a)},n.prototype.writeToDom=function(e,t,r,o,i){if("string"==typeof e){var a=document.querySelector(e);if(!a)throw new Error("Could no find the target HTML element.");e=a}var s=this.write(t,r,o,i);e instanceof HTMLElement&&e.appendChild(s)},n.prototype.renderResult=function(e,t,r,o){var i=e.getMatrix();if(null===i)throw new La;for(var a=i.getWidth(),s=i.getHeight(),u=a+2*o,c=s+2*o,l=Math.max(t,u),f=Math.max(r,c),d=Math.min(Math.floor(l/u),Math.floor(f/c)),h=Math.floor((l-a*d)/2),p=Math.floor((f-s*d)/2),g=this.createSVGElement(l,f),v=0,m=p;v<s;v++,m+=d)for(var y=0,x=h;y<a;y++,x+=d)if(1===i.get(y,v)){var w=this.createSvgRectElement(x,m,d,d);g.appendChild(w)}return g},n.prototype.createSVGElement=function(e,t){var r=document.createElementNS(DP,"svg"),o=e.toString(),i=t.toString();return r.setAttribute("height",i),r.setAttribute("width",o),r.setAttribute("viewBox","0 0 "+o+" "+i),r},n.prototype.createSvgRectElement=function(e,t,r,o){var i=document.createElementNS(DP,"rect");return i.setAttribute("x",e.toString()),i.setAttribute("y",t.toString()),i.setAttribute("height",r.toString()),i.setAttribute("width",o.toString()),i.setAttribute("fill","#000000"),i},n.QUIET_ZONE_SIZE=4}();const Fie=["preview"];class J_ extends Mie{getScannerControls(){if(!this.scannerControls)throw new Error("No scanning is running at the time.");return this.scannerControls}scanFromDeviceObservable(e,t){var r=this;return lo(function*(){const o=new Qo({});let i;try{i=yield r.decodeFromVideoDevice(e,t,(a,s)=>{if(!s)return void o.next({result:a});const u=s.name;u===Z.name||u===Gn.name||u===le.name||s.message.includes("No MultiFormat Readers were able to detect the code.")?o.next({error:s}):(o.error(s),r.scannerControls.stop(),r.scannerControls=void 0)}),r.scannerControls={...i,stop(){i.stop(),o.complete()}}}catch(a){o.error(a),r.scannerControls?.stop(),r.scannerControls=void 0}return o.asObservable()})()}}let Lie=(()=>{class n{constructor(){this.timeBetweenScans=500,this.delayBetweenScanSuccess=500,this.previewFitMode="cover",this._ready=!1,this.autostarted=new bt,this.autostarting=new bt,this.torchCompatible=new bt(!1),this.scanSuccess=new bt,this.scanFailure=new bt,this.scanError=new bt,this.scanComplete=new bt,this.camerasFound=new bt,this.camerasNotFound=new bt,this.permissionResponse=new bt(!0),this.hasDevices=new bt,this.deviceChange=new bt,this._enabled=!0,this._hints=new Map,this.autofocusEnabled=!0,this.autostart=!0,this.formats=[Me.QR_CODE],this.hasNavigator=typeof navigator<"u",this.isMediaDevicesSupported=this.hasNavigator&&!!navigator.mediaDevices}get codeReader(){return this._codeReader}set device(t){this._ready?this.isAutostarting?console.warn("Avoid setting a device during auto-start."):this.isCurrentDevice(t)?console.warn("Setting the same device is not allowed."):this.hasPermission?this.setDevice(t):console.warn("Permissions not set yet, waiting for them to be set to apply device change."):this._devicePreStart=t}get device(){return this._device}get formats(){return this.hints.get(Kt.POSSIBLE_FORMATS)}set formats(t){if("string"==typeof t)throw new Error("Invalid formats, make sure the [formats] input is a binding.");const r=t.map(i=>this.getBarcodeFormatOrFail(i)),o=this.hints;o.set(Kt.POSSIBLE_FORMATS,r),this.hints=o}get hints(){return this._hints}set hints(t){this._hints=t,this.codeReader?.setHints(this._hints)}set videoConstraints(t){const r=this.codeReader?.getScannerControls();r&&r?.streamVideoConstraintsApply(t)}set isAutostarting(t){this._isAutostarting=t,this.autostarting.next(t)}get isAutostarting(){return this._isAutostarting}set torch(t){try{this.getCodeReader().getScannerControls().switchTorch(t)}catch{}}set enable(t){this._enabled=Boolean(t),this._enabled?this.device?this.scanFromDevice(this.device.deviceId):this.init():(this.reset(),J_.releaseAllStreams())}get enabled(){return this._enabled}get tryHarder(){return this.hints.get(Kt.TRY_HARDER)}set tryHarder(t){const r=this.hints;t?r.set(Kt.TRY_HARDER,!0):r.delete(Kt.TRY_HARDER),this.hints=r}askForPermission(){var t=this;return lo(function*(){if(!t.hasNavigator)return console.error("@zxing/ngx-scanner","Can't ask permission, navigator is not present."),t.setPermission(null),t.hasPermission;if(!t.isMediaDevicesSupported)return console.error("@zxing/ngx-scanner","Can't get user media, this is not supported."),t.setPermission(null),t.hasPermission;let r,o;try{r=yield t.getAnyVideoDevice(),o=!!r}catch(i){return t.handlePermissionException(i)}finally{t.terminateStream(r)}return t.setPermission(o),o})()}getAnyVideoDevice(){return navigator.mediaDevices.getUserMedia({video:!0})}terminateStream(t){t&&t.getTracks().forEach(r=>r.stop()),t=void 0}init(){var t=this;return lo(function*(){if(!t.autostart)return console.warn("Feature 'autostart' disabled. Permissions and devices recovery has to be run manually."),t.initAutostartOff(),void(t._ready=!0);yield t.initAutostartOn(),t._ready=!0})()}initAutostartOff(){this.isAutostarting=!1,this.updateVideoInputDevices(),this._device&&this._devicePreStart&&this.setDevice(this._devicePreStart)}initAutostartOn(){var t=this;return lo(function*(){let r;t.isAutostarting=!0;try{r=yield t.askForPermission()}catch(o){return void console.error("Exception occurred while asking for permission:",o)}if(r){const o=yield t.updateVideoInputDevices();yield t.autostartScanner([...o])}t.isAutostarting=!1,t.autostarted.next()})()}isCurrentDevice(t){return t?.deviceId===this._device?.deviceId}ngOnDestroy(){this.reset(),J_.releaseAllStreams()}ngOnInit(){this.init()}scanStop(){this._scanSubscription&&(this.codeReader?.getScannerControls().stop(),this._scanSubscription?.unsubscribe(),this._scanSubscription=void 0),this.torchCompatible.next(!1)}scanStart(){if(this._scanSubscription)throw new Error("There is already a scan process running.");if(!this._device)throw new Error("No device defined, cannot start scan, please define a device.");this.scanFromDevice(this._device.deviceId)}restart(){this._codeReader=void 0;const t=this._reset();t&&(this.device=t)}updateVideoInputDevices(){var t=this;return lo(function*(){const r=(yield yu.listVideoInputDevices())||[],o=r&&r.length>0;return t.hasDevices.next(o),t.camerasFound.next([...r]),o||t.camerasNotFound.next(null),r})()}autostartScanner(t){var r=this;return lo(function*(){const i=t.find(({label:a})=>/back|tr\xe1s|rear|traseira|environment|ambiente/gi.test(a))||t.pop();if(!i)throw new Error("Impossible to autostart, no input devices available.");yield r.setDevice(i),r.deviceChange.next(i)})()}dispatchScanSuccess(t){this.scanSuccess.next(t.getText())}dispatchScanFailure(t){this.scanFailure.next(t)}dispatchScanError(t){this.scanError.observed||(console.error(`zxing scanner component: ${t.name}`,t),console.warn("Use the `(scanError)` property to handle errors like this!")),this.scanError.next(t)}dispatchScanComplete(t){this.scanComplete.next(t)}handlePermissionException(t){let r;switch(console.error("@zxing/ngx-scanner","Error when asking for permission.",t),t.name){case"NotSupportedError":console.warn("@zxing/ngx-scanner",t.message),r=null,this.hasDevices.next(null);break;case"NotAllowedError":console.warn("@zxing/ngx-scanner",t.message),r=!1,this.hasDevices.next(!0);break;case"NotFoundError":console.warn("@zxing/ngx-scanner",t.message),r=null,this.hasDevices.next(!1),this.camerasNotFound.next(t);break;case"NotReadableError":console.warn("@zxing/ngx-scanner","Couldn't read the device(s)'s stream, it's probably in use by another app."),r=null,this.hasDevices.next(!1),this.camerasNotFound.next(t);break;default:console.warn("@zxing/ngx-scanner","I was not able to define if I have permissions for camera or not.",t),r=null}return this.setPermission(r),this.permissionResponse.error(t),r}getBarcodeFormatOrFail(t){return"string"==typeof t?Me[t.trim().toUpperCase()]:t}getCodeReader(){return this._codeReader||(this._codeReader=new J_(this.hints,{delayBetweenScanAttempts:this.timeBetweenScans,delayBetweenScanSuccess:this.delayBetweenScanSuccess})),this._codeReader}scanFromDevice(t){var r=this;return lo(function*(){const o=r.previewElemRef.nativeElement,i=r.getCodeReader(),a=yield i.scanFromDeviceObservable(t,o);if(!a)throw new Error("Undefined decoding stream, aborting.");if(r._scanSubscription=a.subscribe(d=>r._onDecodeResult(d.result,d.error),d=>r._onDecodeError(d),()=>{}),r._scanSubscription.closed)return;const f=typeof i.getScannerControls().switchTorch<"u";r.torchCompatible.next(f)})()}_onDecodeError(t){this.dispatchScanError(t)}_onDecodeResult(t,r){t?this.dispatchScanSuccess(t):this.dispatchScanFailure(r),this.dispatchScanComplete(t)}_reset(){if(!this._codeReader)return;this._codeReader=void 0;const t=this._device;return this.device=void 0,t}reset(){this._reset(),this.deviceChange.emit(null)}setDevice(t){var r=this;return lo(function*(){r.scanStop(),r._device=t||void 0,r._device||yu.cleanVideoSource(r.previewElemRef.nativeElement),r._enabled&&t&&(yield r.scanFromDevice(t.deviceId))})()}setPermission(t){this.hasPermission=t,this.permissionResponse.next(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Vi({type:n,selectors:[["zxing-scanner"]],viewQuery:function(t,r){if(1&t&&Wd(Fie,7),2&t){let o;$l(o=ql())&&(r.previewElemRef=o.first)}},inputs:{autofocusEnabled:"autofocusEnabled",timeBetweenScans:"timeBetweenScans",delayBetweenScanSuccess:"delayBetweenScanSuccess",autostart:"autostart",previewFitMode:"previewFitMode",device:"device",formats:"formats",videoConstraints:"videoConstraints",torch:"torch",enable:"enable",tryHarder:"tryHarder"},outputs:{autostarted:"autostarted",autostarting:"autostarting",torchCompatible:"torchCompatible",scanSuccess:"scanSuccess",scanFailure:"scanFailure",scanError:"scanError",scanComplete:"scanComplete",camerasFound:"camerasFound",camerasNotFound:"camerasNotFound",permissionResponse:"permissionResponse",hasDevices:"hasDevices",deviceChange:"deviceChange"},decls:6,vars:2,consts:[["preview",""]],template:function(t,r){1&t&&(J(0,"video",null,0)(2,"p"),ae(3," Your browser does not support this feature, please try to upgrade it. "),ee(),J(4,"p"),ae(5," Seu navegador n\xe3o suporta este recurso, por favor tente atualiz\xe1-lo. "),ee()()),2&t&&rx("object-fit",r.previewFitMode)},styles:["[_nghost-%COMP%]{display:block}video[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:contain}"],changeDetection:0}),n})(),Bie=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({imports:[e3,kQ]}),n})();function Vie(n,e){if(1&n&&(J(0,"h2"),ae(1),ee()),2&n){const t=ue().$implicit;ke(1),zr(t("successScreen.titleEnter"))}}function Uie(n,e){if(1&n&&(J(0,"h2"),ae(1),ee()),2&n){const t=ue().$implicit;ke(1),zr(t("successScreen.titleExit"))}}function Hie(n,e){if(1&n){const t=Na();J(0,"div",1),sn(1,"img",2),pn(2,Vie,2,1,"h2",3),pn(3,Uie,2,1,"h2",3),J(4,"p"),ae(5),ee(),J(6,"div",4),de("click",function(){return xe(t),we(ue().redirect())}),ae(7),ee()()}if(2&n){const t=e.$implicit,r=ue();ke(2),At("ngIf","enter"==r.msg),ke(1),At("ngIf","enter"!=r.msg),ke(2),zr(t("successScreen.subtitle")),ke(2),Vg(" ",t("successScreen.buttonBack")," (",r.time,") ")}}let Wie=(()=>{class n{constructor(){this.stopEvent=new bt}ngOnInit(){this.time=15,this.interval=setInterval(()=>{this.time--,this.time<=0&&this.redirect()},1e3)}redirect(){clearInterval(this.interval),window.location.href="/detectlite/save/"+(null==this.deviceId?"":this.deviceId+"")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Vi({type:n,selectors:[["app-success"]],inputs:{msg:"msg",deviceId:"deviceId"},outputs:{stopEvent:"stopEvent"},decls:1,vars:0,consts:[["class","success-screen",4,"transloco"],[1,"success-screen"],["alt","","src","/detectlite/assets/icono_color.webp"],[4,"ngIf"],[1,"button",3,"click"]],template:function(t,r){1&t&&pn(0,Hie,8,5,"div",0)},dependencies:[Kd,$v],styles:[".success-screen[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:9999;display:inline-flex;justify-content:center;align-items:center;align-content:center;flex-direction:column;font-size:20px;color:#662483;background-color:#fff}img[_ngcontent-%COMP%]{max-width:200px;width:30%}h2[_ngcontent-%COMP%]{font-size:45px;font-weight:600;margin-top:15px}p[_ngcontent-%COMP%]{text-transform:uppercase;font-size:20px;font-weight:500}.button[_ngcontent-%COMP%]{cursor:pointer;width:200px;min-width:200px;height:49px;font-size:22px;font-weight:600;margin-top:30px;background-size:cover;align-items:center;justify-content:center;background-repeat:no-repeat;display:inline-flex;text-transform:uppercase;animation:_ngcontent-%COMP%_shake .7s;animation-iteration-count:4;animation-delay:12s;color:#fff;background-image:url(/detectlite/assets/boton_verde.webp)}@keyframes _ngcontent-%COMP%_shake{0%{transform:translate(1px,1px) rotate(0)}10%{transform:translate(-1px,-2px) rotate(-1deg)}20%{transform:translate(-3px) rotate(1deg)}30%{transform:translate(3px,2px) rotate(0)}40%{transform:translate(1px,-1px) rotate(1deg)}50%{transform:translate(-1px,2px) rotate(-1deg)}60%{transform:translate(-3px,1px) rotate(0)}70%{transform:translate(3px,1px) rotate(-1deg)}80%{transform:translate(-1px,-1px) rotate(1deg)}90%{transform:translate(1px,2px) rotate(0)}to{transform:translate(1px,-2px) rotate(-1deg)}}"]}),n})();function Gie(n,e){if(1&n){const t=Na();J(0,"div",1),sn(1,"img",2),J(2,"h2"),ae(3),ee(),sn(4,"p",3),J(5,"div",4),de("click",function(){return xe(t),we(ue().redirect())}),ae(6),ee()()}if(2&n){const t=e.$implicit,r=ue();ke(3),zr(t("errorScreen.title")),ke(1),At("innerHTML",r.msg,wy),ke(2),Vg(" ",t("errorScreen.buttonBack")," (",r.time,") ")}}let zie=(()=>{class n{constructor(){this.stopEvent=new bt}ngOnInit(){this.time=15,this.interval=setInterval(()=>{this.time--,this.time<=0&&this.redirect()},1e3)}redirect(){clearInterval(this.interval),window.location.href="/detectlite/save/"+(null==this.deviceId?"":this.deviceId+"")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Vi({type:n,selectors:[["app-error"]],inputs:{msg:"msg",deviceId:"deviceId"},outputs:{stopEvent:"stopEvent"},decls:1,vars:0,consts:[["class","error-screen",4,"transloco"],[1,"error-screen"],["alt","","src","/detectlite/assets/warning.webp"],[3,"innerHTML"],[1,"button",3,"click"]],template:function(t,r){1&t&&pn(0,Gie,7,4,"div",0)},dependencies:[$v],styles:[".error-screen[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:9999;display:inline-flex;justify-content:center;align-items:center;align-content:center;flex-direction:column;font-size:20px;background:linear-gradient(rgb(102,36,131) .3%,30%,rgb(166,48,137) 100%)!important}img[_ngcontent-%COMP%]{max-width:150px;width:20%}h2[_ngcontent-%COMP%]{font-size:45px;font-weight:600;margin-top:15px}p[_ngcontent-%COMP%]{text-transform:uppercase;font-size:20px;font-weight:500;margin-top:15px;justify-content:center;text-align:center}.button[_ngcontent-%COMP%]{cursor:pointer;width:200px;min-width:200px;height:49px;font-size:22px;font-weight:600;margin-top:30px;background-size:cover;align-items:center;justify-content:center;background-repeat:no-repeat;display:inline-flex;text-transform:uppercase;animation:_ngcontent-%COMP%_shake .8s;animation-iteration-count:4;animation-delay:12s;background-image:url(/detectlite/assets/boton_verde.webp)}@keyframes _ngcontent-%COMP%_shake{0%{transform:translate(1px,1px) rotate(0)}10%{transform:translate(-1px,-2px) rotate(-1deg)}20%{transform:translate(-3px) rotate(1deg)}30%{transform:translate(3px,2px) rotate(0)}40%{transform:translate(1px,-1px) rotate(1deg)}50%{transform:translate(-1px,2px) rotate(-1deg)}60%{transform:translate(-3px,1px) rotate(0)}70%{transform:translate(3px,1px) rotate(-1deg)}80%{transform:translate(-1px,-1px) rotate(1deg)}90%{transform:translate(1px,2px) rotate(0)}to{transform:translate(1px,-2px) rotate(-1deg)}}"]}),n})();const jie=["scanner"];function $ie(n,e){if(1&n&&(J(0,"div",4),sn(1,"img",5),J(2,"p"),ae(3),ee(),J(4,"div",6),sn(5,"div")(6,"div")(7,"div")(8,"div"),ee()()),2&n){const t=ue().$implicit;ke(3),zr(t("loading"))}}function qie(n,e){if(1&n&&(J(0,"div",7)(1,"p"),ae(2),ee(),J(3,"div",6),sn(4,"div")(5,"div")(6,"div")(7,"div"),ee()()),2&n){const t=ue(2);ke(2),zr(t.loadingMsg)}}function Xie(n,e){1&n&&(J(0,"div",29),sn(1,"img",30),ee())}function Kie(n,e){if(1&n&&(Ta(0),ae(1),Ra()),2&n){const t=ue(3);ke(1),zr(t.device.name)}}function Yie(n,e){if(1&n){const t=Na();J(0,"div",45),de("click",function(){return xe(t),we(ue(4).confirmPlate())}),ee()}}function Zie(n,e){if(1&n){const t=Na();Ta(0),J(1,"div",31)(2,"div",12)(3,"p",32),ae(4,"Ingrese la patente"),ee(),J(5,"div",17)(6,"div",33),ae(7),ee(),pn(8,Yie,1,0,"div",34),ee()(),J(9,"div",35)(10,"div",36)(11,"div",20)(12,"div",37),de("click",function(){return xe(t),we(ue(3).setPlate("1"))}),ae(13,"1"),ee(),J(14,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("2"))}),ae(15," 2"),ee(),J(16,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("3"))}),ae(17," 3"),ee(),J(18,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("4"))}),ae(19,"4"),ee(),J(20,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("5"))}),ae(21," 5"),ee(),J(22,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("6"))}),ae(23,"6"),ee(),J(24,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("7"))}),ae(25," 7"),ee(),J(26,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("8"))}),ae(27," 8"),ee(),J(28,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("9"))}),ae(29," 9"),ee(),J(30,"div",38),de("click",function(){return xe(t),we(ue(3).setPlate("0"))}),ae(31,"0"),ee()(),J(32,"div",20)(33,"div",39),de("click",function(){return xe(t),we(ue(3).setPlate("q"))}),ae(34,"q"),ee(),J(35,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("w"))}),ae(36,"w"),ee(),J(37,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("e"))}),ae(38,"e"),ee(),J(39,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("r"))}),ae(40,"r"),ee(),J(41,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("t"))}),ae(42,"t"),ee(),J(43,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("y"))}),ae(44,"y"),ee(),J(45,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("u"))}),ae(46,"u"),ee(),J(47,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("i"))}),ae(48,"i"),ee(),J(49,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("o"))}),ae(50,"o"),ee(),J(51,"div",40),de("click",function(){return xe(t),we(ue(3).setPlate("p"))}),ae(52,"p"),ee()(),J(53,"div",20)(54,"div",41),de("click",function(){return xe(t),we(ue(3).setPlate("a"))}),ae(55,"a"),ee(),J(56,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("s"))}),ae(57,"s"),ee(),J(58,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("d"))}),ae(59,"d"),ee(),J(60,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("f"))}),ae(61,"f"),ee(),J(62,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("g"))}),ae(63,"g"),ee(),J(64,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("h"))}),ae(65,"h"),ee(),J(66,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("j"))}),ae(67,"j"),ee(),J(68,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("k"))}),ae(69,"k"),ee(),J(70,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("l"))}),ae(71,"l"),ee(),sn(72,"div",42),ee(),J(73,"div",20)(74,"div",43),de("click",function(){return xe(t),we(ue(3).setPlate("z"))}),ae(75," z "),ee(),J(76,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("x"))}),ae(77,"x"),ee(),J(78,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("c"))}),ae(79,"c"),ee(),J(80,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("v"))}),ae(81,"v"),ee(),J(82,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("b"))}),ae(83,"b"),ee(),J(84,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("n"))}),ae(85,"n"),ee(),J(86,"div",21),de("click",function(){return xe(t),we(ue(3).setPlate("m"))}),ae(87,"m"),ee(),J(88,"div",23),de("click",function(){return xe(t),we(ue(3).removePlateCharacter())}),J(89,"span",24),ae(90," backspace "),ee()(),sn(91,"div",44)(92,"div",44),ee()()()(),Ra()}if(2&n){const t=ue(3);ke(7),xi(" ",t.plate," "),ke(1),At("ngIf",t.plate.length>5)}}function Qie(n,e){if(1&n){const t=Na();Ta(0),J(1,"div",8)(2,"button",9),de("click",function(){return xe(t),we(ue(2).goToScreenSaver())}),ae(3,"Back"),ee(),pn(4,Xie,2,0,"div",10),J(5,"div",11)(6,"div",12)(7,"p"),ae(8),ee(),J(9,"small"),ae(10),pn(11,Kie,2,1,"ng-container",3),ee()(),J(12,"div",13),sn(13,"div"),J(14,"div")(15,"zxing-scanner",14,15),de("deviceChange",function(o){return xe(t),we(ue(2).deviceCurrent=o)})("camerasFound",function(o){return xe(t),we(ue(2).camerasFoundHandler(o))})("scanSuccess",function(o){return xe(t),we(ue(2).scanSuccessHandler(o))})("scanError",function(o){return xe(t),we(ue(2).scanErrorHandler(o))}),ee()(),J(17,"div",16),de("click",function(){return xe(t),we(ue(2).showPin())}),ae(18," Ingreso Manual "),ee()()(),J(19,"div",11)(20,"div",12)(21,"p"),ae(22),ee(),J(23,"div",17)(24,"div",18),ae(25),ee()()(),J(26,"div",19)(27,"div",20)(28,"div",21),de("click",function(){return xe(t),we(ue(2).addString("1"))}),ae(29," 1 "),ee(),J(30,"div",21),de("click",function(){return xe(t),we(ue(2).addString("2"))}),ae(31," 2 "),ee(),J(32,"div",21),de("click",function(){return xe(t),we(ue(2).addString("3"))}),ae(33," 3 "),ee()(),J(34,"div",20)(35,"div",21),de("click",function(){return xe(t),we(ue(2).addString("4"))}),ae(36," 4 "),ee(),J(37,"div",21),de("click",function(){return xe(t),we(ue(2).addString("5"))}),ae(38," 5 "),ee(),J(39,"div",21),de("click",function(){return xe(t),we(ue(2).addString("6"))}),ae(40," 6 "),ee()(),J(41,"div",20)(42,"div",21),de("click",function(){return xe(t),we(ue(2).addString("7"))}),ae(43," 7 "),ee(),J(44,"div",21),de("click",function(){return xe(t),we(ue(2).addString("8"))}),ae(45," 8 "),ee(),J(46,"div",21),de("click",function(){return xe(t),we(ue(2).addString("9"))}),ae(47," 9 "),ee()(),J(48,"div",20)(49,"div",21),de("click",function(){return xe(t),we(ue(2).addString("0"))}),ae(50," 0 "),ee(),J(51,"div",21),de("click",function(){return xe(t),we(ue(2).addString("-"))}),ae(52," - "),ee(),J(53,"div",21),de("click",function(){return xe(t),we(ue(2).addString("K"))}),ae(54," K "),ee()(),J(55,"div",20),sn(56,"div",22),J(57,"div",23),de("click",function(){return xe(t),we(ue(2).deleteNumber())}),J(58,"span",24),ae(59," backspace "),ee()(),J(60,"div",25),de("click",function(){return xe(t),we(ue(2).continue())}),ee()()()(),J(61,"div",26),sn(62,"img",27),ee(),pn(63,Zie,93,2,"ng-container",3),J(64,"div",28),ae(65," open... "),ee()(),Ra()}if(2&n){const t=ue().$implicit,r=ue();ke(4),At("ngIf",1==r.step&&r.requires_pin),ke(1),At("ngClass",0==r.step&&r.require_QR?"visible":"hidden"),ke(3),xi("",t("titleQR")," "),ke(2),xi("Device Id: ",r.deviceId," "),ke(1),At("ngIf",r.device),ke(4),At("enable",!0)("tryHarder",!0)("autostart",!0)("device",r.deviceCurrent),ke(4),At("ngClass",1==r.step&&r.requires_pin?"visible":"hidden"),ke(3),zr(t("titlePinPad")),ke(3),xi(" ",r.rut," "),ke(35),At("ngClass",r.endRut?"active":"send"),ke(3),At("ngIf",2==r.step),ke(1),At("ngClass",3!=r.step&&r.requires_pin?"hidden":"visible")}}function Jie(n,e){if(1&n){const t=Na();Ta(0),J(1,"app-success",46),de("stopEvent",function(){return xe(t),we(ue(2).restart())}),ee(),Ra()}if(2&n){const t=ue(2);ke(1),At("msg",t.event)("deviceId",t.deviceId)}}function eae(n,e){if(1&n){const t=Na();Ta(0),J(1,"app-error",46),de("stopEvent",function(){return xe(t),we(ue(2).restart())}),ee(),Ra()}if(2&n){const t=ue(2);ke(1),At("msg",t.errorMsg)("deviceId",t.deviceId)}}const tae=function(){return["error","success"]};function nae(n,e){if(1&n&&(Ta(0),pn(1,$ie,9,1,"div",1),pn(2,qie,8,1,"div",2),pn(3,Qie,66,15,"ng-container",3),pn(4,Jie,2,2,"ng-container",3),pn(5,eae,2,2,"ng-container",3),Ra()),2&n){const t=ue();ke(1),At("ngIf","INIT"==t.state),ke(1),At("ngIf","loading"==t.state),ke(1),At("ngIf",!function wT(n,e,t){const r=oo()+n,o=ne();return o[r]===tt?Ia(o,r,t?e.call(t):e()):function Od(n,e){return n[e]}(o,r)}(5,tae).includes(t.state)),ke(1),At("ngIf","success"==t.state),ke(1),At("ngIf","error"==t.state)}}let TP=(()=>{class n{get requires_pin(){return this._requires_pin}set requires_pin(t){this._requires_pin=t,this.requires_pin||(this.step=2)}get step(){return this._step}set step(t){this._step=t,1==this._step&&(this._requires_pin||(this._step=2)),0!=this._step&&this.stopVideo()}constructor(t,r,o,i,a,s,u){this.service=t,this.translocoService=r,this.settings=o,this.activatedRoute=i,this.deviceService=a,this.detectService=s,this.router=u,this.require_QR=!0,this.cameras=[],this.scannerEnabled=!1,this.plate="",this.state="ready",this.loadingMsg="Loading",this.errorMsg="",this.pin=[],this.rut="",this.endRut=!1,this._step=0,this.mode="PIN",this._requires_pin=!0,this.QRCode=eZ,this.activatedRoute.params.subscribe(c=>{if(null!=c.deviceId)this.deviceId=c.deviceId,this.deviceService.getDetail(this.deviceId).subscribe(l=>{this.device=l,this.detectService.device=this.device,this.detectService.hasPlate=this.device.hasPlate||!1});else if(null!=o.getDevice()){let l=o.getDevice();null!=l&&(this.deviceId=l,this.deviceService.getDetail(this.deviceId).subscribe(f=>{this.device=f,this.detectService.device=this.device,this.detectService.hasPlate=this.device.hasPlate||!1}))}}),this.activatedRoute.queryParams.subscribe(c=>{null!=c.event&&("ERROR"==c.event&&this.stateControl({name:c.event,code:c.code,msg:c.msg??""}),"SUCCESS"==c.event&&this.stateControl({name:c.event,detail:c.detail})),c.session&&(this.detectService.sessionUUID=c.session),c.doc_id&&(this.rut=c.doc_id,console.log("doc:"+this.rut),this.continue())})}ngAfterViewInit(){}ngOnInit(){var t=this;return lo(function*(){t.detectService.useTime=!0,t.detectService.timePhoto=3,t.detectService.confirm_identity=!1,t.service.getConfig().subscribe(r=>{t.requires_pin=r.requires_pin||!0,t.translocoService.setActiveLang(r.lang||"es"),t.detectService.useTime=null===r.use_time_photo||r.use_time_photo,t.detectService.timePhoto=null!==r.time_photo_sec?r.time_photo_sec:3,t.detectService.confirm_identity=r.confirm_identity||!1,t.detectService.has_callback=null!==r.has_callback&&r.has_callback,t.detectService.callback_url=null!==r.callback_url?r.callback_url:""})})()}continue(){this.isValidRut(this.rut)?null!=this.device&&this.device.hasPlate?(this.step=2,console.log("Move to plate")):(this.step=3,this.plate="",this.MoveToFace(),console.log("Move to face")):this.errorMsg=this.translocoService.translate("errors.INVALID_RUT")??"Rut inv\xe1lido"}addString(t){this.rut.includes("-")||"K"!=t?this.rut.includes("-")&&"-"==t?this.endRut=!1:(this.rut.includes("-")&&"-"!==this.rut.at(-1)||(this.rut=this.rut+t),this.endRut=this.isValidRut(this.rut)):this.endRut=!1}deleteNumber(){this.rut=this.rut.slice(0,-1),this.endRut=this.isValidRut(this.rut)}stateControl(t){if("READY"==t.name)this.state="ready";else if("SUCCESS"==t.name)this.state="success",this.event=t.detail,this.step=2;else if("ERROR"==t.name){this.state="error";try{if("CUSTOM"===t.code)return void(this.errorMsg=t.msg);let r=t.code;this.errorMsg="CANNOT_IDENTIFY"==r?this.translocoService.translate("errors.CANNOT_IDENTIFY")??"No se pudo reconocer su rostro<br />Intente nuevamente por favor":"EMPTY_IMAGE"==r?this.translocoService.translate("errors.EMPTY_IMAGE")??"La imagen no pudo ser enviada<br />Intente nuevamente por favor":"INVALID_BASE64_IMAGE"==r?this.translocoService.translate("errors.INVALID_BASE64_IMAGE")??"La imagen no pudo ser codificada en su navegador<br />Intente nuevamente por favor":"TOO_MANY_FACES"==r?this.translocoService.translate("errors.TOO_MANY_FACES")??"Se ha detectado m\xe1s de un rostro en la c\xe1mara<br />Intente nuevamente por favor":"NO_FACE_DETECTED"==r?this.translocoService.translate("errors.NO_FACE_DETECTED")??"No se ha detectado un rostro en la c\xe1mara<br />Intente nuevamente por favor":"NO_MATCHING_AREAS"==r?this.translocoService.translate("errors.NO_MATCHING_AREAS")??"Area de marcaci\xf3n no permitida<br />Intente nuevamente por favor":"NO_GPS"==r?this.translocoService.translate("errors.NO_GPS")??"No se pudo obtener la ubicaci\xf3n, valide el permiso de ubicaci\xf3n en el dispositivo":"INVALID_VEHICLE"==r?this.translocoService.translate("errors.INVALID_VEHICLE")??"Veh\xedculo inv\xe1lido":"VEHICLE_DENIED"==r?this.translocoService.translate("errors.VEHICLE_DENIED")??"Veh\xedculo con restricci\xf3n de acceso":"DESCONOCIDO"==r?this.translocoService.translate("errors.OTHER")??"Error desconocido":"DEPENDENCY_FAILED"==r?t.msg:this.translocoService.translate("errors.NO_FACE_DETECTED")??"Error desconocido"}catch{this.errorMsg=this.translocoService.translate("errors.OTHER")??"Error desconocido"}this.step=2}else"LOADING"==t.name&&(this.state="loading",this.loadingMsg=t.detail)}restart(){this.state="ready",this.step=0,this.rut="",this.plate=""}scanSuccessHandler(t){this.qrResultString=t,this.capture()}capture(){this.parseRut(this.qrResultString),this.isValidRut(this.rut)&&(null!=this.device&&this.device.hasPlate?this.step=2:(this.step=3,this.MoveToFace()))}parseRut(t){this.rut=this.isValidURL(t)?this.extractRUTFromURL(t)??"":t.replace("identifica.RUN=","")}showPin(){this.step=1}extractRUTFromURL(t){return new URLSearchParams(t.split("?")[1]).get("RUN")}isValidURL(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)}isValidRut(t){let r=t.replace(/\./g,"").replace(/-/g,""),o=r.slice(0,-1),i=r.slice(-1).toUpperCase();if(o.length<7||isNaN(Number(o)))return!1;let a=0,s=2;for(let c=1;c<=o.length;c++)a+=s*Number(r.charAt(o.length-c)),s<7?s++:s=2;return i="K"==i?"10":i,i="0"==i?"11":i,(11-a%11).toString()===i}goToScreenSaver(){window.location.href="/detectlite/save/"+(null==this.deviceId?"":this.deviceId+"")}ngOnDestroy(){}clearResult(){this.qrResultString=""}camerasFoundHandler(t){if(this.cameras=t,""!=this.settings.getCameraKey())return void this.selectCamera(this.settings.getCameraKey());let r=this.cameras.filter(o=>o.label.toLowerCase().includes("front"));this.selectCamera(r.length>0?r[0].label:this.cameras[0].label)}selectCamera(t){for(let r=0;r<this.cameras.length;r++)this.cameras[r].label.trim().toLowerCase()===t.trim().toLowerCase()&&this.deviceCurrent?.label!==this.cameras[r].label&&(this.deviceCurrent=this.cameras[r])}setPlate(t){this.plate=this.plate+t.toUpperCase()}removePlateCharacter(){this.plate=this.plate.slice(0,-1)}confirmPlate(){this.MoveToFace()}scanErrorHandler(t){alert("Error:"+t.message)}stopVideo(){if(null==this.scanner||null==this.scanner.previewElemRef)return;let t=this.scanner.previewElemRef.nativeElement.srcObject;null!=t&&(t.getTracks().forEach(o=>{o.stop()}),null!=this.scanner.previewElemRef&&(this.scanner.previewElemRef.nativeElement.srcObject=null))}MoveToFace(){this.detectService.pin=this.pin,this.detectService.rut=this.rut,this.detectService.plate=this.plate,this.detectService.step=2,this.router.navigate(["face"])}}return n.\u0275fac=function(t){return new(t||n)(Q(yw),Q(s_),Q(_O),Q(su),Q(LZ),Q(xw),Q(jr))},n.\u0275cmp=Vi({type:n,selectors:[["app-pin-pad"]],viewQuery:function(t,r){if(1&t&&Wd(jie,5),2&t){let o;$l(o=ql())&&(r.scanner=o.first)}},decls:1,vars:0,consts:[[4,"transloco"],["class","init",4,"ngIf"],["class","loading",4,"ngIf"],[4,"ngIf"],[1,"init"],["alt","logo","src","/detectlite/assets/logo_blanco.webp",1,"logo"],[1,"points"],[1,"loading"],[1,"screen-container"],[1,"button-back",3,"click"],["class","watermark-container",4,"ngIf"],[1,"container",3,"ngClass"],[1,"header"],[1,"video"],[2,"width","500px",3,"enable","tryHarder","autostart","device","deviceChange","camerasFound","scanSuccess","scanError"],["scanner",""],[1,"button-manual",3,"click"],[1,"panel-input"],[1,"rut"],[1,"pin-pad"],[1,"row"],[1,"number",3,"click"],[1,"number","send"],[1,"number","delete",3,"click"],[1,"material-symbols-outlined"],[1,"number","send",3,"ngClass","click"],[1,"footer"],["alt","logo footer identifica","src","/detectlite/assets/logo_blanco.webp",1,"logo-footer"],[3,"ngClass"],[1,"watermark-container"],["src","/detectlite/assets/icono.webp","alt","...",1,"watermark"],[1,"container-plate"],[1,"title-plate"],[1,"plate","plate-input"],["class","number send active button_plate",3,"click",4,"ngIf"],[1,"keyboard"],[1,"pin-pad","pin-pad-full"],[1,"number",2,"margin-left","40px",3,"click"],[1,"number",2,"margin-right","160px",3,"click"],[1,"number",2,"margin-left","80px",3,"click"],[1,"number",2,"margin-right","120px",3,"click"],[1,"number",2,"margin-left","120px",3,"click"],[1,"number",2,"margin-right","100px","border","none"],[1,"number",2,"margin-left","160px",3,"click"],[1,"number",2,"border","none"],[1,"number","send","active","button_plate",3,"click"],[3,"msg","deviceId","stopEvent"]],template:function(t,r){1&t&&pn(0,nae,6,6,"ng-container",0)},dependencies:[jR,Kd,$v,Lie,Wie,zie],styles:[".loading[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background-color:#000000b3;z-index:9999;display:inline-flex;justify-content:center;align-items:center;align-content:center;flex-direction:column;font-size:30px;overflow:hidden}.init[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background:linear-gradient(rgb(102,36,131) .3%,30%,rgb(166,48,137) 100%)!important;z-index:9999;display:inline-flex;justify-content:flex-start;align-items:center;align-content:center;flex-direction:column;font-size:30px;overflow:hidden}.init[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{padding-top:20vh;max-width:400px;min-width:300px;width:50%;margin-bottom:10%}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;max-height:100%;width:100%;color:#fff;z-index:100}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;align-content:center;text-align:center}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px;margin:0 0 1px;font-weight:700}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-bottom:15px}.watermark-container[_ngcontent-%COMP%]{position:absolute;overflow:hidden;max-width:100%;max-height:100%;z-index:1;pointer-events:none}.watermark[_ngcontent-%COMP%]{position:relative;max-width:600px;filter:alpha(opacity=10);opacity:.1;left:-50%;margin-top:80%;transform:rotate(-20deg);z-index:1;pointer-events:none;overflow:hidden}.panel-input[_ngcontent-%COMP%]{display:inline-flex;min-width:350px;max-width:90%}.panel-input[_ngcontent-%COMP%]   .rut[_ngcontent-%COMP%]{width:100%;height:80px;border:0;text-align:center;border-bottom:3px solid white;background:transparent;font-size:50px;font-weight:700;padding:0 10px 30px;margin:0 10px}.panel-input[_ngcontent-%COMP%]   .plate[_ngcontent-%COMP%]{width:100%;height:80px;text-align:center;border:3px solid white;border-radius:15px;background:transparent;font-size:50px;font-weight:700;padding:0 10px 30px;margin:0 10px}.panel-input[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{width:100%;height:80px;border:0;text-align:center;border-bottom:3px solid white;background:transparent;font-size:70px;font-weight:700;padding:0 10px 30px;margin:0 10px}.panel-input[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:active{outline:none}.pin-pad[_ngcontent-%COMP%]{margin-top:30px;display:flex;flex-wrap:wrap;max-width:290px}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{width:100%;display:inline-flex;justify-content:space-around}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:15px;border:2px solid white;color:#fff;font-size:50px;font-weight:700;display:flex;justify-content:center;align-items:center;margin:10px;cursor:pointer}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.send[_ngcontent-%COMP%]{border:none}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.active[_ngcontent-%COMP%]{border:none;background-image:url(/detectlite/assets/icono.webp);background-size:120px 120px;background-repeat:no-repeat;background-position-x:-23px;background-position-y:-20px;animation:_ngcontent-%COMP%_shake .4s;animation-iteration-count:1}@keyframes _ngcontent-%COMP%_shake{0%{transform:translate(1px,1px) rotate(0)}10%{transform:translate(-1px,-2px) rotate(-1deg)}20%{transform:translate(-3px) rotate(1deg)}30%{transform:translate(3px,2px) rotate(0)}40%{transform:translate(1px,-1px) rotate(1deg)}50%{transform:translate(-1px,2px) rotate(-1deg)}60%{transform:translate(-3px,1px) rotate(0)}70%{transform:translate(3px,1px) rotate(-1deg)}80%{transform:translate(-1px,-1px) rotate(1deg)}90%{transform:translate(1px,2px) rotate(0)}to{transform:translate(1px,-2px) rotate(-1deg)}}.delete[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:50px!important}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;display:inline-flex;justify-content:center;width:100%}.footer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:260px;min-width:200px;width:40%}.hidden[_ngcontent-%COMP%]{display:none!important}@media only screen and (max-width: 400px){.footer[_ngcontent-%COMP%]{bottom:0}}@media only screen and (max-height: 700px){.footer[_ngcontent-%COMP%]{bottom:0}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;height:100vh;max-height:100%;width:100%;color:#fff;z-index:100}.container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:10px}}@media only screen and (max-height: 690px){.panel-input[_ngcontent-%COMP%]{display:inline-flex;min-width:350px;max-width:90%}.panel-input[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{height:60px;border-bottom:3px solid white;font-size:50px;padding:0 10px 30px;margin:0 10px}.pin-pad[_ngcontent-%COMP%]{margin-top:20px}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:15px;border:2px solid white;color:#fff;font-size:50px;font-weight:700;display:flex;justify-content:center;align-items:center;margin:5px;cursor:pointer}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.send[_ngcontent-%COMP%]{border:none}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.active[_ngcontent-%COMP%]{border:none;background-image:url(/detectlite/assets/icono.webp);background-size:110px 110px;background-repeat:no-repeat;background-position-x:-20px;background-position-y:-20px;animation:_ngcontent-%COMP%_shake .4s;animation-iteration-count:1}}@media only screen and (max-width: 330px){.panel-input[_ngcontent-%COMP%]{display:inline-flex;min-width:320px;max-width:100%}.panel-input[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{padding:0 5px 30px}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.active[_ngcontent-%COMP%]{border:none;background-image:url(/detectlite/assets/icono.webp);background-size:110px 110px;background-repeat:no-repeat;background-position-x:-20px;background-position-y:-20px;animation:_ngcontent-%COMP%_shake .4s;animation-iteration-count:1}}@media only screen and (max-height: 512px){.footer[_ngcontent-%COMP%]{display:none}}@media only screen and (max-height: 680px) and (orientation: landscape){.footer[_ngcontent-%COMP%]{max-width:50%}.container[_ngcontent-%COMP%]{flex-direction:row;padding:10px 20px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .panel-input[_ngcontent-%COMP%]{max-width:50%}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.active[_ngcontent-%COMP%]{border:none;background-image:url(/detectlite/assets/icono.webp);background-size:110px 110px;background-repeat:no-repeat;background-position-x:-20px;background-position-y:-20px;animation:_ngcontent-%COMP%_shake .4s;animation-iteration-count:1}}@media only screen and (max-height: 380px) and (orientation: landscape){.footer[_ngcontent-%COMP%]{max-width:50%}.container[_ngcontent-%COMP%]{flex-direction:row;padding:5px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{max-width:50%}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .panel-input[_ngcontent-%COMP%]{min-width:100%}.pin-pad[_ngcontent-%COMP%]{margin-top:20px}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{justify-content:center;gap:5px}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:15px;border:2px solid white;color:#fff;font-size:50px;font-weight:700;display:flex;align-items:center;margin:5px;cursor:pointer}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.send[_ngcontent-%COMP%]{border:none}.pin-pad[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .number.active[_ngcontent-%COMP%]{border:none;background-image:url(/detectlite/assets/icono.webp);background-size:90px 90px;background-repeat:no-repeat;background-position-x:-16px;background-position-y:-16px;animation:_ngcontent-%COMP%_shake .4s;animation-iteration-count:1}}.points[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.points[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:absolute;top:33px;width:13px;height:13px;border-radius:50%;background:#fff;animation-timing-function:cubic-bezier(0,1,1,0)}.points[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){left:8px;animation:_ngcontent-%COMP%_points1 .6s infinite}.points[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){left:8px;animation:_ngcontent-%COMP%_points2 .6s infinite}.points[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){left:32px;animation:_ngcontent-%COMP%_points2 .6s infinite}.points[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(4){left:56px;animation:_ngcontent-%COMP%_points3 .6s infinite}@keyframes _ngcontent-%COMP%_points1{0%{transform:scale(0)}to{transform:scale(1)}}@keyframes _ngcontent-%COMP%_points3{0%{transform:scale(1)}to{transform:scale(0)}}@keyframes _ngcontent-%COMP%_points2{0%{transform:translate(0)}to{transform:translate(24px)}}.screen-container[_ngcontent-%COMP%]{overflow:hidden;overflow-x:hidden}.button-manual[_ngcontent-%COMP%]{cursor:pointer;width:220px;min-width:200px;height:49px;font-size:22px;font-weight:600;margin-top:30px;background-size:cover;align-items:center;justify-content:center;background-repeat:no-repeat;display:inline-flex;text-transform:uppercase;color:#fff;background-image:url(/detectlite/assets/boton_verde.webp)}.button-back[_ngcontent-%COMP%]{position:absolute;background-color:transparent;border:1px solid white;color:#fff;font-size:22px;font-weight:600;border-radius:12px;margin-top:20px;margin-left:15px;padding:5px 10px}.video[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;flex-direction:column;align-content:center;align-items:center}.buttondevices[_ngcontent-%COMP%]{background-color:#008e96;border:0px;border-radius:15px;color:#fff;padding:10px 15px;margin:5px}.content-video[_ngcontent-%COMP%]{max-height:80vh}.modern_select[_ngcontent-%COMP%]{border-radius:14px;padding:5px 10px;margin-bottom:5px}.button_plate[_ngcontent-%COMP%]{margin-left:10px;margin-top:10px;width:115px;height:80px;border:none;background-image:url(/detectlite/assets/icono.webp);background-size:120px 120px;background-repeat:no-repeat;background-position-x:-23px;background-position-y:-20px}.keyboard[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;max-width:600px;margin-left:70px}.pin-pad-full[_ngcontent-%COMP%]{max-width:none!important}.container-plate[_ngcontent-%COMP%]{flex-direction:column;padding:5px;display:flex;align-content:center;align-items:center}.container-plate[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{max-width:50%}.container-plate[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .panel-input[_ngcontent-%COMP%]{min-width:100%}.plate-input[_ngcontent-%COMP%]{min-width:300px!important}.title-plate[_ngcontent-%COMP%]{font-size:30px;font-weight:700;margin-bottom:10px}"]}),n})();var e2=function(n,e){return(e2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(n,e)};function ht(n,e){function t(){this.constructor=n}e2(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var As=function(){return As=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},As.apply(this,arguments)};function Ke(n,e,t,r){return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):function o(i){return i instanceof t?i:new t(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Ye(n,e){var r,o,i,a,t={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(!(i=(i=t.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){t=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(6===c[0]&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}var NP=function(n,e){return(NP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(n,e)};function Is(n,e){function t(){this.constructor=n}NP(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var O0=function(){return(O0=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)};function gt(n,e,t,r){return new(t||(t=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new t(function(l){l(c.value)}).then(a,s)}u((r=r.apply(n,e||[])).next())})}function vt(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(n,a)}catch(f){l=[6,f],r=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var Cc={},t2={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Va(n){n in Cc||(Cc[n]=function iae(n){if(1!==n&&2!==n)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return e.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Cc[n]},!1),1===n?e.getContext("webgl",t2)||e.getContext("experimental-webgl",t2):e.getContext("webgl2",t2)}(n));var e=Cc[n];return e.isContextLost()?(delete Cc[n],Va(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Cc[n])}function OP(n){for(var e=n.length,t=0,r=0;e>0;)r=Math.random()*e|0,t=n[--e],n[e]=n[r],n[r]=t}function M0(n,e,t){return Math.max(n,Math.min(e,t))}function Ec(n){return n%2==0?n:n+1}function MP(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function PP(n,e){var t=Math.random();return e*t+(1-t)*n}function P(n,e){if(!n)throw new Error("string"==typeof e?e:e())}function kt(n,e,t){void 0===t&&(t=""),P(Or(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function Sc(n){P(null!=n,function(){return"The input to the tensor constructor must be a non-null value."})}function Ac(n,e){if(void 0===e&&(e=[]),null==e&&(e=[]),Array.isArray(n)||Ua(n))for(var t=0;t<n.length;++t)Ac(n[t],e);else e.push(n);return e}function Be(n){if(0===n.length)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Or(n,e){if(n===e)return!0;if(null==n||null==e||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Po(n){return n%1==0}function kP(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function n2(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Ic(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function r2(n,e,t){return void 0===e&&(e=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(n())r();else{var s=e(++i);null!=t&&i>=t?o():setTimeout(a,s)}};a()})}function FP(n,e){for(var t=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(-1===n[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(-1===r){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(0===t)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var i=n.slice();return i[r]=e/t,i}function xr(n,e){var t=e.length;return P((n=null==n?e.map(function(r,o){return o}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),P(n.every(function(r){return Po(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function xu(n,e){for(var t=[],r=[],o=null==e?null:xr(e,n).sort(),i=0,a=0;a<n.length;++a){if(null!=o){if(o[i]===a&&1!==n[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(null==o[i]||o[i]>a)&&1===n[a]&&(t.push(n[a]),r.push(a)),o[i]<=a&&i++}1!==n[a]&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function P0(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else{if("bool"!==n)throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function Ph(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else if("bool"===n)t=new Uint8Array(e);else{if("string"!==n)throw new Error("Unknown data type "+n);t=new Array(e)}return t}function LP(n,e,t){if("float32"===e)for(var r=0;r<n.length;r++){var o=n[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+t+"' is "+o+".")}}function BP(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function VP(n,e){return!("complex64"===e||"float32"===e&&"complex64"!==n||"int32"===e&&"float32"!==n&&"complex64"!==n||"bool"===e&&"bool"===n)}function Ua(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function o2(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function UP(n){if(null==n)return 0;var e=0;return n.forEach(function(t){return e+=2*t.length}),e}function kh(n){return"string"==typeof n||n instanceof String}function HP(n){return"boolean"==typeof n}function WP(n){return"number"==typeof n}function yf(n){return Array.isArray(n)?yf(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":WP(n)?"float32":kh(n)?"string":HP(n)?"bool":"float32"}function wu(n){return!!(n&&n.constructor&&n.call&&n.apply)}function k0(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function _u(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function i2(n,e,t){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ac(n)),t&&BP(n,e),function lae(n,e){return n instanceof Float32Array&&"float32"===e||n instanceof Int32Array&&"int32"===e||n instanceof Uint8Array&&"bool"===e}(n,e))return n;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)0!==Math.round(n[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function GP(n,e,t){var r=new Array;if(1===e.length)for(var o=e[0],i=0;i<o;i++)r[i]=t[n+i];else{o=e[0];var a=e.slice(1),s=a.reduce(function(u,c){return u*c});for(i=0;i<o;i++)r[i]=GP(n+i*s,a,t)}return r}function a2(n,e){if(0===n.length)return e[0];var t=n.reduce(function(r,o){return r*o});if(0===t)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return GP(0,n,e)}function s2(n,e){for(var t=xf(n,e),r=0;r<t.length;r++)t[r]=1;return t}function xf(n,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e)return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Fh(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function u2(n){n.forEach(function(e){P(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}Object.freeze({shuffle:OP,clamp:M0,nearestLargerEven:Ec,sum:MP,randUniform:PP,distSquared:function sae(n,e){for(var t=0,r=0;r<n.length;r++){var o=Number(n[r])-Number(e[r]);t+=o*o}return t},assert:P,assertShapesMatch:kt,assertNonNull:Sc,flatten:Ac,sizeFromShape:Be,isScalarShape:function uae(n){return 0===n.length},arraysEqual:Or,isInt:Po,tanh:kP,sizeToSquarishShape:n2,createShuffledIndices:function cae(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return OP(e),e},rightPad:Ic,repeatedTry:r2,inferFromImplicitShape:FP,parseAxisParam:xr,squeezeShape:xu,getTypedArrayFromDType:P0,getArrayFromDType:Ph,checkComputationForErrors:LP,checkConversionForErrors:BP,hasEncodingLoss:VP,isTypedArray:Ua,bytesPerElement:o2,bytesFromStringArray:UP,isString:kh,isBoolean:HP,isNumber:WP,inferDtype:yf,isFunction:wu,nearestDivisor:k0,computeStrides:_u,toTypedArray:i2,toNestedArray:a2,makeOnesTypedArray:s2,makeZerosTypedArray:xf,now:Fh,assertNonNegativeIntegerDimensions:u2});var fae=function(){function n(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new dae)}return n.prototype.profileKernel=function(e,t){var r,o=this,i=this.backendTimer.time(function(){r=t()});return(Array.isArray(r)?r:[r]).forEach(function(a){var s=a.dataSync();LP(s,a.dtype,e),i.then(function(u){var c="";null!=u.getExtraProfileInfo&&(c=u.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,s,u.kernelMs,c)})}),r},n}(),dae=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,o,i){var a=Ic(o+"ms",9),s=Ic(e,25),u=t.rank,c=t.size,l=Ic(t.shape.toString(),14);console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green")},n}(),zP=20,Lh=3,c2=7;function hae(n,e,t,r){var o=_u(e),i=function pae(n,e,t,r){var o=Be(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===t?Vh(n):n;if(s>1)for(var c=0;c<o/i;c++)for(var l=c*i,f=0;f<i;f++)a[f]=Math.max(a[f],Bh(u[l+f],0,t).length);return a}(n,e,t,o),a=e.length,s=F0(n,e,t,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}function Bh(n,e,t){return Ic(Array.isArray(n)?parseFloat(n[0].toFixed(c2))+" + "+parseFloat(n[1].toFixed(c2))+"j":kh(n)?"'"+n+"'":"bool"===t?jP(n):parseFloat(n.toFixed(c2)).toString(),e)}function jP(n){return 0===n?"false":"true"}function F0(n,e,t,r,o,i){void 0===i&&(i=!0);var a="complex64"===t?2:1,s=e[0],u=e.length;if(0===u)return"complex64"===t?[Bh(Vh(n)[0],0,t)]:"bool"===t?[jP(n[0])]:[n[0].toString()];if(1===u){if(s>zP){var l=Array.from(n.slice(0,Lh*a)),f=Array.from(n.slice(s-Lh*a,s));return"complex64"===t&&(l=Vh(l),f=Vh(f)),["["+l.map(function(_,b){return Bh(_,o[b],t)}).join(", ")+", ..., "+f.map(function(_,b){return Bh(_,o[s-Lh+b],t)}).join(", ")+"]"]}return["["+("complex64"===t?Vh(n):Array.from(n)).map(function(_,b){return Bh(_,o[b],t)}).join(", ")+"]"]}var d=e.slice(1),h=r.slice(1),p=r[0]*a,g=[];if(s>zP){for(var v=0;v<Lh;v++){var m=(y=v*p)+p;g.push.apply(g,F0(n.slice(y,m),d,t,h,o,!1))}for(g.push("..."),v=s-Lh;v<s;v++)m=(y=v*p)+p,g.push.apply(g,F0(n.slice(y,m),d,t,h,o,v===s-1))}else for(v=0;v<s;v++){var y;m=(y=v*p)+p,g.push.apply(g,F0(n.slice(y,m),d,t,h,o,v===s-1))}var x=2===u?",":"";for(g[0]="["+g[0]+x,v=1;v<g.length-1;v++)g[v]=" "+g[v]+x;var w=",\n";for(v=2;v<u;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":w),g}function Vh(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Uh=function(){function n(e,t,r){var o=this;if(this.dtype=t,this.shape=e.slice(),this.size=Be(e),null!=r){var i=r.length;P(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ph(t,this.size),this.strides=_u(e)}return n.prototype.set=function(e){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];0===r.length&&(r=[0]),P(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var r=0,o=0,i=e;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r])throw new Error("Requested out of range element at "+e+".   Buffer shape="+this.shape);r++}for(var u=e[e.length-1],c=0;c<e.length-1;++c)u+=this.strides[c]*e[c];return this.values[u]},n.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return se.make(this.shape,{values:this.values},this.dtype)},n}(),Ii=null,q=null,$P=null,se=function(){function n(e,t,r,o,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Be(e),this.strides=_u(e),this.dataId=o??{},this.id=Ii().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Ii().registerTensor(this,i),null!=r&&Ii().write(this.dataId,r)}return n.make=function(e,t,r,o){return new n(e,r,t.values,t.dataId,o)},n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),P(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,o){return this.throwIfDisposed(),this.reshape([e,t,r,o])},n.prototype.as5D=function(e,t,r,o,i){return this.throwIfDisposed(),this.reshape([e,t,r,o,i])},n.prototype.asType=function(e){return this.throwIfDisposed(),q.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return gt(this,void 0,void 0,function(){var e;return vt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,q.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return q.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return gt(this,void 0,void 0,function(){var e;return vt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,a2(this.shape,e)]}})})},n.prototype.arraySync=function(){return a2(this.shape,this.dataSync())},n.prototype.data=function(){return gt(this,void 0,void 0,function(){return vt(this,function(e){return this.throwIfDisposed(),[2,Ii().read(this.dataId)]})})},n.prototype.dataSync=function(){return this.throwIfDisposed(),Ii().readSync(this.dataId)},n.prototype.dispose=function(){this.isDisposed||(Ii().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return void 0===e&&(e=!1),q.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),q.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return void 0===e&&(e=0),q.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1),q.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),q.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),q.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),q.oneHot(this,e,t,r)},n.prototype.toString=function(e){return void 0===e&&(e=!1),hae(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),q.tile(this,e)},n.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),q.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),this.throwIfDisposed(),q.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),q.dot(this,e)},n.prototype.norm=function(e,t,r){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1),this.throwIfDisposed(),q.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),q.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),q.reverse(this,e)},n.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),q.concat([this].concat(e),t)},n.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),q.split(this,e,t)},n.prototype.stack=function(e,t){return void 0===t&&(t=0),q.stack([this,e],t)},n.prototype.unstack=function(e){return void 0===e&&(e=0),q.unstack(this,e)},n.prototype.pad=function(e,t){return void 0===t&&(t=0),q.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,o,i){return void 0===r&&(r=.001),$P("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,o,r)},n.prototype.batchNorm=function(e,t,r,o,i){return void 0===i&&(i=.001),this.throwIfDisposed(),q.batchNorm(this,e,t,r,o,i)},n.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.all(this,e,t)},n.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.any(this,e,t)},n.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.sum(this,e,t)},n.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.prod(this,e,t)},n.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.mean(this,e,t)},n.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.min(this,e,t)},n.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),q.max(this,e,t)},n.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),q.argMin(this,e)},n.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),q.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),q.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),q.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),q.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),q.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),q.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),q.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),q.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),q.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),q.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),q.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),q.div(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),q.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),q.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),q.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),q.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),q.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),q.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),q.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),q.modStrict(this,e)},n.prototype.squaredDifference=function(e){return this.throwIfDisposed(),q.squaredDifference(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),q.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),q.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),q.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),q.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),q.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),q.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),q.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),q.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),q.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),q.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),q.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),q.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),q.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),q.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),q.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),q.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),q.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),q.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),q.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),q.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),q.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),q.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),q.sign(this)},n.prototype.exp=function(){return this.throwIfDisposed(),q.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),q.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),q.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),q.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),q.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),q.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),q.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),q.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),q.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),q.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),q.relu(this)},n.prototype.elu=function(){return this.throwIfDisposed(),q.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),q.selu(this)},n.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),q.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),q.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),q.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),q.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),q.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),q.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),q.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),q.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),q.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),q.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),q.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),q.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),q.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),q.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),q.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),q.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),q.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),q.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),q.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),q.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),q.round(this)},n.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),q.step(this,e)},n.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),q.softmax(this,e)},n.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),q.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),q.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),q.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,o,i,a){return void 0===o&&(o="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),q.conv1d(this,e,t,r,o,i,a)},n.prototype.conv2d=function(e,t,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),q.conv2d(this,e,t,r,o,i,a)},n.prototype.conv2dTranspose=function(e,t,r,o,i){return this.throwIfDisposed(),q.conv2dTranspose(this,e,t,r,o,i)},n.prototype.depthwiseConv2D=function(e,t,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),q.depthwiseConv2d(this,e,t,r,o,i,a)},n.prototype.separableConv2d=function(e,t,r,o,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),q.separableConv2d(this,e,t,r,o,i,a)},n.prototype.avgPool=function(e,t,r,o){return this.throwIfDisposed(),q.avgPool(this,e,t,r,o)},n.prototype.maxPool=function(e,t,r,o){return this.throwIfDisposed(),q.maxPool(this,e,t,r,o)},n.prototype.localResponseNormalization=function(e,t,r,o){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===o&&(o=.5),q.localResponseNormalization(this,e,t,r,o)},n.prototype.pool=function(e,t,r,o,i){return this.throwIfDisposed(),q.pool(this,e,t,r,o,i)},n.prototype.variable=function(e,t,r){return void 0===e&&(e=!0),this.throwIfDisposed(),Hh.variable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),q.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),q.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),q.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),q.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,o,i,a,s,u){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),q.stridedSlice(this,e,t,r,o,i,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),q.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),q.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),q.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),q.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),q.spectral.irfft(this)},n}();Object.defineProperty(se,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var qP,l2,f2,d2,h2,Hh=function(n){function e(t,r,o){void 0===r&&(r=!0);var i=n.call(this,t.shape,t.dtype,null,t.dataId)||this;i.trainable=r,i.name=o,null==i.name&&(i.name=Ii().nextVariableId().toString());try{Ii().registerVariable(i)}catch(a){throw Ii().disposeTensor(i),a}return i}return Is(e,n),e.variable=function(t,r,o,i){return void 0===r&&(r=!0),null!=i&&i!==t.dtype&&(t=t.asType(i)),new e(t,r,o)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Or(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ii().disposeTensor(this),this.dataId=t.dataId,Ii().registerTensor(this)},e}(se);Object.defineProperty(Hh,Symbol.hasInstance,{value:function(n){return n instanceof se&&null!=n.assign&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(qP||(qP={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(l2||(l2={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(f2||(f2={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(d2||(d2={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(h2||(h2={}));var wae={float32:d2,int32:l2,bool:f2,complex64:h2};function wr(n,e){if("string"===n||"string"===e){if("string"===n&&"string"===e)return"string";throw new Error("Can not upcast "+n+" with "+e)}return wae[n][e]}function p2(n){return wr(n,"int32")}function Qn(n,e){if(n.dtype===e.dtype)return[n,e];var t=wr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function XP(n,e){P(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function g2(n){var e=[];return KP(n,e,new Set),e}function KP(n,e,t){if(null!=n)if(n instanceof se)e.push(n);else if(function bae(n){return Array.isArray(n)||"object"==typeof n}(n)){var r=n;for(var o in r){var i=r[o];t.has(i)||(t.add(i),KP(i,e,t))}}}Object.freeze({makeTypesMatch:Qn,assertTypesMatch:XP,isTensorInList:function _ae(n,e){for(var t=0;t<e.length;t++)if(e[t].id===n.id)return!0;return!1},getTensorsInContainer:g2});var Nt,Cae=function(){function n(e,t,r){this.backend=e,this.safeMode=t,this.debugMode=r,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new fae(e),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.moveData=function(e){this.write(e,this.readSync(e))},n.prototype.tidy=function(e,t){var r,o=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var o=r();return t(),o}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=se.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(r){return[r.toFloat()]}),t},n.prototype.runKernel=function(e,t,r){var o,i=this,a=[],s=this.isTapeOn(),u=null!=this.activeScope?this.activeScope.name:"",c=function(h){s&&(a=h.map(function(p){return i.keep(i.clone(p))}))},l=this.numBytes,f=this.numTensors;if(this.scopedRun(function(){return i.kernelDepth++},function(){return i.kernelDepth--},function(){o=i.debugMode()?i.profiler.profileKernel(u,function(){return e(i.backend,c)}):e(i.backend,c)}),s){var d={id:this.nextTapeNodeId++,name:u,inputs:t,outputs:Array.isArray(o)?o:[o],saved:a};null!=r&&(d.gradient=function(h){return r(h,a)}),this.activeTape.push(d)}return this.profiling&&this.activeProfile.kernels.push({name:u,bytesAdded:this.numBytes-l,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-f,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(t).map(function(h){return t[h].shape}),outputShape:Array.isArray(o)?o.map(function(h){return h.shape}):o.shape}),o},n.prototype.registerTensor=function(e,t){var r=this.tensorInfo.has(e.dataId)?this.tensorInfo.get(e.dataId).refCount:0;if(this.numTensors++,"string"===e.dtype&&this.numStringTensors++,0===r){this.numDataBuffers++;var o=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(o=e.size*o2(e.dtype)),this.tensorInfo.set(e.dataId,{backend:t??this.backend,dtype:e.dtype,shape:e.shape,bytes:o,refCount:0}),this.numBytes+=o,null!=t?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.tensorInfo.get(e.dataId).refCount++,e instanceof Hh||this.track(e)},n.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},n.prototype.disposeTensor=function(e){if(this.tensorInfo.has(e.dataId)){this.numTensors--,"string"===e.dtype&&this.numStringTensors--;var t=this.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.numBytes-=t.bytes),this.numDataBuffers--,t.backend.disposeData(e.dataId),this.tensorInfo.delete(e.dataId)):this.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.registeredVariables)this.disposeTensor(this.registeredVariables[e]),delete this.registeredVariables[e]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,this.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return gt(this,void 0,void 0,function(){var t,r;return vt(this,function(o){return this.profiling=!0,t=this.numBytes,r=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=e(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-t,this.activeProfile.newTensors=this.numTensors-r,[2,this.activeProfile]})})},n.prototype.isTapeOn=function(){return this.gradientDepth>0&&0===this.kernelDepth},n.prototype.addTapeNode=function(e,t,r){var o={};e.forEach(function(a,s){o[s]=a});var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:o,outputs:[t],gradient:function(a){var s={};return r(a).forEach(function(u,c){s[c]=function(){return u}}),s}};this.activeTape.push(i)},n.prototype.keep=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return e.kept=!0,e},n.prototype.startTape=function(){0===this.gradientDepth&&(this.activeTape=[]),this.gradientDepth++},n.prototype.endTape=function(){this.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.nextScopeId++};e&&(t.name=e),this.scopeStack.push(t),this.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=g2(e),o=new Set(r.map(function(u){return u.id})),i=0;i<this.activeScope.track.length;i++){var a=this.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},n.prototype.gradients=function(e,t,r,o){var i=this;if(void 0===o&&(o=!1),P(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});P(a instanceof se,function(){return"The result y returned by f() must be a tensor."});var s=function yae(n,e,t){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<n.length;i++){var a=(p=n[i]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){p.outputs.forEach(function(y){return r[y.id]=!0}),c=!0,o[p.id]=!0;break}if(c)break}}var f={};f[t.id]=!0;var d={};for(i=n.length-1;i>=0;i--)for(a=(p=n[i]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var s in a)f[a[s].id]=!0,d[p.id]=!0;break}var h=[];for(i=0;i<n.length;i++){var p;if(o[(p=n[i]).id]&&d[p.id]){var g={};for(var s in p.inputs){var v=p.inputs[s];r[v.id]&&(g[s]=v)}var m=Object.assign({},p);m.inputs=g,m.outputs=p.outputs,h.push(m)}}return h}(this.activeTape,t,a);if(!o&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[a.id]=r??function Eae(n){var e=s2(Be(n),"float32");return se.make(n,{values:e})}(a.shape),function xae(n,e,t){for(var r=function(i){var a=e[i],s=[];if(a.outputs.forEach(function(f){var d=n[f.id];if(null!=d)s.push(d);else{var h=se.make(f.shape,{values:xf(f.size,f.dtype)},f.dtype);s.push(h)}}),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.name+".");var u=a.gradient(1===a.outputs.length?s[0]:s),c=function(f){if(!(f in u))throw new Error("Cannot backprop through input "+f+". Available gradients found: "+Object.keys(u)+".");var d=t(function(){return u[f]()});if("float32"!==d.dtype)throw new Error("Error in gradient for op "+a.name+". The gradient of input "+f+" must have 'float32' dtype, but has '"+d.dtype+"'");var h=a.inputs[f];if(!Or(d.shape,h.shape))throw new Error("Error in gradient for op "+a.name+". The gradient of input '"+f+"' has shape '"+d.shape+"', which does not match the shape of the input '"+h.shape+"'");if(null==n[h.id])n[h.id]=d;else{var p=n[h.id];n[h.id]=p.add(d),p.dispose()}};for(var l in a.inputs)c(l)},o=e.length-1;o>=0;o--)r(o)}(u,s,function(l){return i.tidy(l)});var c=t.map(function(l){return u[l.id]});return 0===i.gradientDepth&&(i.activeTape.forEach(function(l){for(var f in l.saved)l.saved[f].dispose()}),i.activeTape=null),{value:a,grads:c}})},n.prototype.customGrad=function(e){var t=this;return P(wu(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];P(o.every(function(s){return s instanceof se}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),t.runKernel(function(s,u){return P((r=e.apply(void 0,o.concat([u]))).value instanceof se,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),P(wu(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];P(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),P(l.every(function(d){return d instanceof se}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var f={};return l.forEach(function(d,h){f[h]=function(){return d}}),f})}},n.prototype.write=function(e,t){var r=this.tensorInfo.get(e);if("string"===r.dtype){var o=UP(t);this.numBytes+=o-r.bytes,r.bytes=o}this.backend!==r.backend&&(r.backend.disposeData(e),r.backend=this.backend,this.backend.register(e,r.shape,r.dtype)),this.backend.write(e,t)},n.prototype.readSync=function(e){return this.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.tensorInfo.get(e).backend.read(e)},n.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},n.prototype.time=function(e){return gt(this,void 0,void 0,function(){var t,r;return vt(this,function(o){switch(o.label){case 0:return t=Fh(),[4,this.backend.time(e)];case 1:return(r=o.sent()).wallMs=Fh()-t,[2,r]}})})},n.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&(e.scopeId=this.activeScope.id,this.activeScope.track.push(e)),e},n.nextTensorId=0,n.nextVariableId=0,n}();!function(n){n[n.NUMBER=0]="NUMBER",n[n.BOOLEAN=1]="BOOLEAN",n[n.STRING=2]="STRING"}(Nt||(Nt={}));var v2,m2,Sae=[{name:"DEBUG",type:Nt.BOOLEAN},{name:"IS_BROWSER",type:Nt.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:Nt.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:Nt.BOOLEAN},{name:"WEBGL_PACK",type:Nt.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:Nt.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:Nt.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:Nt.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:Nt.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:Nt.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:Nt.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:Nt.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:Nt.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:Nt.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:Nt.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:Nt.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Nt.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Nt.BOOLEAN},{name:"WEBGL_VERSION",type:Nt.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Nt.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Nt.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Nt.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:Nt.NUMBER},{name:"BACKEND",type:Nt.STRING},{name:"EPSILON",type:Nt.NUMBER},{name:"PROD",type:Nt.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:Nt.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:Nt.BOOLEAN}];function YP(n){try{if(null!=Va(n))return!0}catch{return!1}return!1}var ZP="tfjsflags";function QP(){var n={};if(typeof window>"u"||void 0===window.location||void 0===window.location.search)return n;var e=function Mae(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return function Pae(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}(e,r[0],r[1]),r.join("=")}),e}(window.location.search);if(ZP in e){var t={};e[ZP].split(",").forEach(function(r){var o=r.split(":");t[o[0]]=o[1]}),Sae.forEach(function(r){r.name in t&&(console.log("Setting feature override from URL "+r.name+": "+t[r.name]),r.type===Nt.NUMBER?n[r.name]=+t[r.name]:r.type===Nt.BOOLEAN?n[r.name]="true"===t[r.name]:r.type===Nt.STRING?n[r.name]=t[r.name]:console.warn("Unknown URL param: "+r.name+"."))})}return n}function Dc(n,e){return null!=n.getExtension(e)}function JP(n,e){var t=n.createFramebuffer(),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,2===e?n.RGBA32F:n.RGBA,1,1,0,n.RGBA,n.FLOAT,null),n.bindFramebuffer(n.FRAMEBUFFER,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(t),i}var y2,Ji=function(){function n(e){this.features={},this.registry={},this.registryFactory={},null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return n.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in N.registry))throw new Error("Backend name '"+e+"' not found in registry");N.engine.backend=N.findBackend(e),N.backendName=e},n.getBackend=function(){return N.initEngine(),N.backendName},n.disposeVariables=function(){N.engine.disposeVariables()},n.memory=function(){return N.engine.memory()},n.profile=function(e){return N.engine.profile(e)},n.tidy=function(e,t){return N.engine.tidy(e,t)},n.dispose=function(e){g2(e).forEach(function(t){return t.dispose()})},n.keep=function(e){return N.engine.keep(e)},n.time=function(e){return N.engine.time(e)},n.prototype.get=function(e){return e in this.features||(this.features[e]=this.evaluateFeature(e)),this.features[e]},n.prototype.getFeatures=function(){return this.features},n.prototype.set=function(e,t){this.features[e]=t},n.prototype.getBestBackendName=function(){var e=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(t){return{name:t,entry:e.registry[t]}}).sort(function(t,r){return r.entry.priority-t.entry.priority})[0].name},n.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("IS_BROWSER"===e)return typeof window<"u";if("IS_NODE"===e)return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node;if("IS_CHROME"===e)return function Oae(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}();if("WEBGL_CPU_FORWARD"===e)return!0;if("WEBGL_PACK"===e)return 0!==this.get("WEBGL_VERSION");if("WEBGL_PACK_BATCHNORMALIZATION"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_BINARY_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_ARRAY_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_IMAGE_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_REDUCE"===e)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===e)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===e)return this.get("WEBGL_PACK");if("WEBGL_NUM_MB_BEFORE_PAGING"===e)return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:function Fae(){return window.screen.height*window.screen.width*window.devicePixelRatio*600/1024}();if("WEBGL_MAX_TEXTURE_SIZE"===e)return function Aae(n){if(null==v2){var e=Va(n);v2=e.getParameter(e.MAX_TEXTURE_SIZE)}return v2}(this.get("WEBGL_VERSION"));if("WEBGL_MAX_TEXTURES_IN_SHADER"===e)return function Iae(n){if(null==m2){var e=Va(n);m2=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,m2)}(this.get("WEBGL_VERSION"));if("IS_TEST"===e)return!1;if("BACKEND"===e)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var t=this.get("WEBGL_VERSION");return 0===t?0:function Dae(n){if(0===n)return 0;var e=Va(n);return Dc(e,"EXT_disjoint_timer_query_webgl2")&&2===n?2:Dc(e,"EXT_disjoint_timer_query")?1:0}(t)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!function aae(){var n=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}();if("HAS_WEBGL"===e)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===e)return YP(2)?2:YP(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===e)return function Tae(n){if(0===n)return!1;var e=Va(n);if(1===n){if(!Dc(e,"OES_texture_float"))return!1}else if(!Dc(e,"EXT_color_buffer_float"))return!1;return JP(e,n)}(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===e)return function Rae(n){if(0===n)return!1;var e=Va(n);if(1===n){if(!Dc(e,"OES_texture_float")||!Dc(e,"WEBGL_color_buffer_float"))return!1}else if(!Dc(e,"EXT_color_buffer_float"))return!1;return JP(e,n)}(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===e)return function Nae(n){return 2===n&&null!=Va(n).fenceSync}(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===e)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===e)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===e)return 32===this.backend.floatPrecision()?1e-7:1e-4;if("PROD"===e)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===e)return!this.get("PROD");if("DEPRECATION_WARNINGS_ENABLED"===e)return!0;throw new Error("Unknown feature "+e+".")},n.prototype.setFeatures=function(e){this.features=Object.assign({},e)},n.prototype.reset=function(){this.features=QP(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(n.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),n.prototype.findBackend=function(e){return e in this.registry?this.registry[e].backend:null},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e]:null},n.prototype.registerBackend=function(e,t,r){var o=this;if(void 0===r&&(r=1),e in this.registry)return console.warn(e+" backend was already registered. Reusing existing backend"),!1;try{var i=t();return i.setDataMover({moveData:function(a){return o.engine.moveData(a)}}),this.registry[e]={backend:i,priority:r},this.registryFactory[e]=t,!0}catch(a){return console.warn("Registration of backend "+e+" failed"),console.warn(a.stack||a.message),!1}},n.prototype.removeBackend=function(e){if(!(e in this.registry))throw new Error(e+" backend not found in registry");this.registry[e].backend.dispose(),delete this.registry[e]},Object.defineProperty(n.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),n.prototype.initEngine=function(){var e=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var t=this.findBackend(this.backendName);this.globalEngine=new Cae(t,!1,function(){return e.get("DEBUG")})}},Object.defineProperty(n.prototype,"global",{get:function(){return n4()},enumerable:!0,configurable:!0}),n}();function n4(){if(null==y2){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else{if(typeof process>"u")throw new Error("Could not find a global object");n=process}y2=n}return y2}function x2(n){N.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}!function mae(n){$P=n}(x2);var N=function Vae(){var n=n4();return null==n.ENV&&(n.ENV=new Ji(QP())),function gae(n){Ii=n}(function(){return n.ENV.engine}),n.ENV}();function bu(n){var e=n;if(Ua(n))return[n.length];if(!Array.isArray(n))return[];for(var t=[];Array.isArray(e)||Ua(e);)t.push(e.length),e=e[0];return Array.isArray(n)&&N.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&r4(n,t,[]),t}function r4(n,e,t){if(t=t||[],Array.isArray(n)||Ua(n)){P(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, but is an array of "+n.length+" elements"}),P(n.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" elements, but has "+n.length+" elements"});for(var r=e.slice(1),o=0;o<n.length;++o)r4(n[o],r,t.concat(o))}else P(0===e.length,function(){return"Element arr["+t.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"})}function o4(n,e,t,r){if(null!=n&&("numeric"!==n&&n!==e||"numeric"===n&&"string"===e))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function O(n,e,t,r){if(void 0===r&&(r="numeric"),n instanceof se)return o4(r,n.dtype,e,t),n;var o=yf(n);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),o4(r,o,e,t),null==n||!Ua(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var a=bu(n);Ua(n)||Array.isArray(n)||(n=[n]);var s="string"!==o?i2(n,o,N.get("DEBUG")):Ac(n);return se.make(a,{values:s},o)}function Wh(n,e,t,r){if(void 0===r&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(o,i){return O(o,e+"["+i+"]",t)},r)}function Gh(n){return N.engine.customGrad(n)}Object.freeze({EPSILON_FLOAT16:1e-4,EPSILON_FLOAT32:1e-7,Environment:Ji,enableProdMode:function Uae(){N.set("PROD",!0)},enableDebugMode:function Hae(){N.set("DEBUG",!0)},disableDeprecationWarnings:function Wae(){N.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:x2,ENV:N});var Ve=Ji.tidy,ln=Ji.keep,zae=Ji.dispose;function w2(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];N.get("IS_TEST")||console.warn.apply(console,n)}function B0(n,e,t,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(n[0]/t),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([n[a+1]/e[a],e[a]]);o=o.concat(n.slice(i+1))}return o}function V0(n,e,t){void 0===t&&(t=!0);var r=[];if(t){r.push(e);for(var o=e+1;o<n;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<n;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function U0(n,e,t,r){void 0===r&&(r=!0);var o=[];o.push(r?n[0]/t:n[0]*t);for(var i=1;i<n.length;++i)o.push(i<=e.length?r?e[i-1]*n[i]:n[i]/e[i-1]:n[i]);return o}function i4(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function a4(n,e,t){for(var r=n.slice(0,1),o=0;o<t;++o)r.push(n[o+1]-e[o][0]-e[o][1]);return r}function s4(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Kr(n,e){for(var t=[],r=n.length,o=0;o<r;o++)-1===e.indexOf(o)&&t.push(n[o]);return[t,e.map(function(i){return n[i]})]}function Di(n,e){return function jae(n,e,t){for(var r=n.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===t.indexOf(s)?o.push(n[i++]):o.push(e[a++]);return o}(n,e.map(function(t){return 1}),e)}function ti(n,e,t){P(s4(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function Ha(n,e){if(s4(n,e))return null;for(var t=[],r=0;r<e;++r)-1===n.indexOf(r)&&t.push(r);return n.forEach(function(o){return t.push(o)}),t}function _2(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Wa(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function wf(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function u4(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],o=1,i=0;i<t.length-1;++i)o*=t[i];var a=n.shape,s=t.slice();s.pop();var u=1;for(i=r;i<n.rank;++i)u*=a[i],s.push(a[i]);var c=_u(n.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}var c4=30;function b2(n){return n<=c4?n:k0(n,Math.floor(Math.sqrt(n)))}function H0(n,e,t){for(var r=e.rank>1?e.shape[e.rank-1]:1,o=t.length,i=1,a=r;a<o;++a)i*=t[a];return{sliceRank:r,numUpdates:e.size/(r<1?1:r),sliceSize:i,strides:_u(t.slice(0,r)).concat([1]),outputSize:Be(t)}}function C2(n,e,t,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var c=[],l=[],f=[],d=0;d<n.length;d++)c[d]=Jae(o,e,r,n,d),l[d]=ese(i,t,r,n,d),u&1<<d&&(l[d]=c[d]+1,f.push(d));var h=new Array(n.length).fill(0);return h=h.map(function(p,g){for(var v=0,m=r[g]||1,y=c[g];!(m>0?y>=l[g]:y<=l[g]);y+=m)v+=1;return v}),[c,h,f]}function Jae(n,e,t,r,o){var i=e[o];(n&1<<o||null==i)&&(i=(t[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),M0(0,i,s-1)}function ese(n,e,t,r,o){var i=e[o],a=t[o]||1;(n&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?M0(0,i,s):M0(-1,i,s-1)}function l4(n,e,t){for(var r=t.length,o=0;o<t.length;o++)if(t[o]>1){r=o;break}for(o=r+1;o<t.length;o++)if(e[o]>0||t[o]!==n[o])return!1;return!0}function f4(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function V(n){var e=Object.keys(n);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];N.engine.startScope(t);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),N.engine.endScope(s),s}catch(u){throw N.engine.endScope(null),u}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}var Cu=V({softmax_:function tse(n,e){void 0===e&&(e=-1);var t=O(n,"logits","softmax");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return Gh(function(r,o){var i=r.logSumExp([e],!0),a=r.toFloat().sub(i).exp();return o([a]),{value:a,gradFunc:function(s,u){var c=u[0],l=s.mul(c);return l.sub(l.sum([e],!0).mul(c))}}})(t)}}),rse=V({logSoftmax_:function nse(n,e){void 0===e&&(e=-1);var t=O(n,"logits","logSoftmax");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Gh(function(r,o){var i=r.max(e,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(e,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(e,!0).mul(l))}}})(t)}}),vo=V({complex_:function ose(n,e){var t=O(n,"real","complex"),r=O(e,"imag","complex");return kt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),N.engine.runKernel(function(o){return o.complex(t,r)},{$real:t,$imag:r})}}),Ga=V({real_:function ise(n){var e=O(n,"input","real");return N.engine.runKernel(function(t){return t.real(e)},{$input:e})}}),Eu=V({imag_:function ase(n){var e=O(n,"input","imag");return N.engine.runKernel(function(t){return t.imag(e)},{$input:e})}});function Sn(n,e,t){if(null==t&&(t=yf(n)),"complex64"===t)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ua(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=bu(n);if(null!=e){u2(e);var o=Be(e),i=Be(r);P(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<r.length;++a){var u=a!==r.length-1||r[a]!==Be(e.slice(a));P(r[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "})}}return Ua(n)||Array.isArray(n)||(n=[n]),e=e||r,n="string"!==t?i2(n,t,N.get("DEBUG")):Ac(n),se.make(e,{values:n},t)}function oe(n,e){if((Ua(n)||Array.isArray(n))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Sn(n,[],e)}function ni(n,e){Sc(n);var t=bu(n);if(1!==t.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Sn(n,t,e)}function W0(n,e,t){if(Sc(n),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=bu(n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Sn(n,e=e||r,t)}function E2(n,e,t){if(Sc(n),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=bu(n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Sn(n,e=e||r,t)}function ea(n,e,t){if(Sc(n),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=bu(n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Sn(n,e=e||r,t)}function Tc(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=Tc(n,"float32"),r=Tc(n,"float32");return vo(t,r)}var o=s2(Be(n),e);return se.make(n,{values:o},e)}function zn(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=zn(n,"float32"),r=zn(n,"float32");return vo(t,r)}var o=xf(Be(n),e);return se.make(n,{values:o},e)}function zh(n,e,t){return N.engine.runKernel(function(r){return r.fill(n,e,t)},{})}function d4(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r="float32"),0===t)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return zn([0],r);var o=xf(Math.abs(Math.ceil((e-n)/t)),r);e<n&&1===t&&(t=-1),o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+t;return ni(o,r)}var h4=V({onesLike_:function cse(n){var e=O(n,"x","onesLike");if("complex64"===e.dtype){var t=h4(Ga(e)),r=Ht(Eu(e));return vo(t,r)}return N.engine.runKernel(function(o){return o.onesLike(e)},{$x:e},null)}}),Ht=V({zerosLike_:function lse(n){var e=O(n,"x","zerosLike");return N.engine.runKernel(function(t){return t.zerosLike(e)},{$x:e},null)}}),p4=function(){function n(e){this.dataMover=e,this.data=new WeakMap}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(e),this.data.get(e)},n.prototype.set=function(e,t){this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.data.delete(e)},n}();function g4(n,e,t){if("complex64"===e){if("complex64"===n.dtype)return n.clone();var r=zn(n.shape),o=n.toFloat(),i=t.complex(o,r);return r.dispose(),o.dispose(),i}if(!VP(n.dtype,e))return se.make(n.shape,{dataId:n.dataId},e);if("complex64"===n.dtype){var a=t.real(n);return i=a.cast(e),a.dispose(),i}if("int32"===e)return t.int(n);if("bool"===e){var s=oe(0,n.dtype);return i=t.notEqual(n,s),s.dispose(),i}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function S2(n,e){return se.make(e,{dataId:n.dataId},n.dtype)}function v4(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function m4(n,e){return{real:n[2*e],imag:n[2*e+1]}}function gse(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function mse(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function A2(n,e,t,r,o){for(var i=Array.from(e).map(function(h,p){return{score:h,boxIndex:p}}).filter(function(h){return h.score>o}).sort(function(h,p){return p.score-h.score}),a=[],s=0;s<i.length;s++){var u=i[s],l=u.boxIndex;if(u.score<o)break;for(var f=!1,d=a.length-1;d>=0;--d)if(yse(n,l,a[d])>=r){f=!0;break}if(!f&&(a.push(l),a.length>=t))break}return ni(a,"int32")}function yse(n,e,t){var r=n.subarray(4*e,4*e+4),o=n.subarray(4*t,4*t+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(f-c)*(d-l);if(h<=0||p<=0)return 0;var g=Math.max(i,c),v=Math.max(a,l),m=Math.min(s,f),y=Math.min(u,d),x=Math.max(m-g,0)*Math.max(y-v,0);return x/(h+p-x)}function y4(n,e,t){var r=new Array(n.rank).fill(0),o=n.shape.slice();return e.map(function(i){o[t]=i;var a=n.slice(r,o);return r[t]+=i,a})}function x4(n,e,t,r,o){for(var i=e[e.length-1],a=[n.length/i,i],s=a[0],u=a[1],c=P0(t,s*r),l=P0("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=n.subarray(d,d+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(w,_){return _.value-w.value});var v=f*r,m=c.subarray(v,v+r),y=l.subarray(v,v+r);for(g=0;g<r;g++)m[g]=p[g].value,y[g]=p[g].index}var x=e.slice();return x[x.length-1]=r,[Sn(c,x,t),Sn(l,x,"int32")]}!function(){function n(){}n.prototype.time=function(e){throw new Error("Not yet implemented.")},n.prototype.read=function(e){throw new Error("Not yet implemented.")},n.prototype.readSync=function(e){throw new Error("Not yet implemented.")},n.prototype.disposeData=function(e){throw new Error("Not yet implemented.")},n.prototype.write=function(e,t){throw new Error("Not yet implemented.")},n.prototype.fromPixels=function(e,t){throw new Error("Not yet implemented.")},n.prototype.register=function(e,t,r){throw new Error("Not yet implemented.")},n.prototype.memory=function(){throw new Error("Not yet implemented.")},n.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},n.prototype.batchMatMul=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.fusedBatchMatMul=function(e,t,r,o,i,a){throw new Error("Not yet implemented")},n.prototype.slice=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.stridedSlice=function(e,t,r,o,i,a,s,u,c){throw new Error("Not yet implemented")},n.prototype.unstack=function(e,t){throw new Error("Not yet implemented")},n.prototype.reverse=function(e,t){throw new Error("Not yet implemented")},n.prototype.concat=function(e,t){throw new Error("Not yet implemented")},n.prototype.neg=function(e){throw new Error("Not yet implemented")},n.prototype.add=function(e,t){throw new Error("Not yet implemented")},n.prototype.addN=function(e){throw new Error("Not yet implemented")},n.prototype.subtract=function(e,t){throw new Error("Not yet implemented")},n.prototype.multiply=function(e,t){throw new Error("Not yet implemented")},n.prototype.realDivide=function(e,t){throw new Error("Not yet implemented")},n.prototype.floorDiv=function(e,t){throw new Error("Not yet implemented")},n.prototype.sum=function(e,t){throw new Error("Not yet implemented")},n.prototype.prod=function(e,t){throw new Error("Not yet implemented")},n.prototype.unsortedSegmentSum=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.argMin=function(e,t){throw new Error("Not yet implemented")},n.prototype.argMax=function(e,t){throw new Error("Not yet implemented")},n.prototype.equal=function(e,t){throw new Error("Not yet implemented")},n.prototype.notEqual=function(e,t){throw new Error("Not yet implemented")},n.prototype.less=function(e,t){throw new Error("Not yet implemented")},n.prototype.lessEqual=function(e,t){throw new Error("Not yet implemented")},n.prototype.greater=function(e,t){throw new Error("Not yet implemented")},n.prototype.greaterEqual=function(e,t){throw new Error("Not yet implemented")},n.prototype.logicalNot=function(e){throw new Error("Not yet implemented")},n.prototype.logicalAnd=function(e,t){throw new Error("Not yet implemented")},n.prototype.logicalOr=function(e,t){throw new Error("Not yet implemented")},n.prototype.where=function(e){throw new Error("Not yet implemented")},n.prototype.select=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.topk=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.min=function(e,t){throw new Error("Not yet implemented")},n.prototype.minimum=function(e,t){throw new Error("Not yet implemented")},n.prototype.mod=function(e,t){throw new Error("Not yet implemented")},n.prototype.max=function(e,t){throw new Error("Not yet implemented")},n.prototype.maximum=function(e,t){throw new Error("Not yet implemented")},n.prototype.all=function(e,t){throw new Error("Not yet implemented")},n.prototype.any=function(e,t){throw new Error("Not yet implemented")},n.prototype.squaredDifference=function(e,t){throw new Error("Not yet implemented")},n.prototype.ceil=function(e){throw new Error("Not yet implemented")},n.prototype.floor=function(e){throw new Error("Not yet implemented")},n.prototype.round=function(e){throw new Error("Not yet implemented")},n.prototype.sign=function(e){throw new Error("Not yet implemented")},n.prototype.isNaN=function(e){throw new Error("Not yet implemented")},n.prototype.isInf=function(e){throw new Error("Not yet implemented")},n.prototype.isFinite=function(e){throw new Error("Not yet implemented")},n.prototype.pow=function(e,t){throw new Error("Not yet implemented")},n.prototype.exp=function(e){throw new Error("Not yet implemented")},n.prototype.expm1=function(e){throw new Error("Not yet implemented")},n.prototype.log=function(e){throw new Error("Not yet implemented")},n.prototype.log1p=function(e){throw new Error("Not yet implemented")},n.prototype.sqrt=function(e){throw new Error("Not yet implemented")},n.prototype.rsqrt=function(e){throw new Error("Not yet implemented")},n.prototype.square=function(e){throw new Error("Not yet implemented")},n.prototype.reciprocal=function(e){throw new Error("Not yet implemented")},n.prototype.relu=function(e){throw new Error("Not yet implemented")},n.prototype.prelu=function(e,t){throw new Error("Not yet implemented")},n.prototype.elu=function(e){throw new Error("Not yet implemented")},n.prototype.eluDer=function(e,t){throw new Error("Not yet implemented")},n.prototype.selu=function(e){throw new Error("Not yet implemented")},n.prototype.int=function(e){throw new Error("Not yet implemented")},n.prototype.clip=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.abs=function(e){throw new Error("Not yet implemented")},n.prototype.complexAbs=function(e){throw new Error("Not yet implemented")},n.prototype.sigmoid=function(e){throw new Error("Not yet implemented")},n.prototype.softplus=function(e){throw new Error("Not yet implemented")},n.prototype.sin=function(e){throw new Error("Not yet implemented")},n.prototype.cos=function(e){throw new Error("Not yet implemented")},n.prototype.tan=function(e){throw new Error("Not yet implemented")},n.prototype.asin=function(e){throw new Error("Not yet implemented")},n.prototype.acos=function(e){throw new Error("Not yet implemented")},n.prototype.atan=function(e){throw new Error("Not yet implemented")},n.prototype.atan2=function(e,t){throw new Error("Not yet implemented")},n.prototype.sinh=function(e){throw new Error("Not yet implemented")},n.prototype.cosh=function(e){throw new Error("Not yet implemented")},n.prototype.tanh=function(e){throw new Error("Not yet implemented")},n.prototype.asinh=function(e){throw new Error("Not yet implemented")},n.prototype.acosh=function(e){throw new Error("Not yet implemented")},n.prototype.atanh=function(e){throw new Error("Not yet implemented")},n.prototype.erf=function(e){throw new Error("Not yet implemented")},n.prototype.step=function(e,t){throw new Error("Not yet implemented")},n.prototype.conv2d=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.conv2dDerInput=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.conv2dDerFilter=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.depthwiseConv2D=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.conv3d=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.conv3dDerInput=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.conv3dDerFilter=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.maxPool=function(e,t){throw new Error("Not yet implemented")},n.prototype.maxPoolBackprop=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.avgPool=function(e,t){throw new Error("Not yet implemented")},n.prototype.avgPoolBackprop=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.reshape=function(e,t){throw new Error("Not yet implemented")},n.prototype.cast=function(e,t){throw new Error("Not yet implemented")},n.prototype.tile=function(e,t){throw new Error("Not yet implemented")},n.prototype.pad=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.transpose=function(e,t){throw new Error("Not yet implemented")},n.prototype.gather=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.gatherND=function(e,t){throw new Error("Not yet implemented")},n.prototype.scatterND=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.batchToSpaceND=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.spaceToBatchND=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.resizeBilinear=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.resizeBilinearBackprop=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.resizeNearestNeighbor=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.batchNormalization=function(e,t,r,o,i,a){throw new Error("Not yet implemented")},n.prototype.localResponseNormalization4D=function(e,t,r,o,i){throw new Error("Not yet implemented")},n.prototype.LRNGrad=function(e,t,r,o,i,a,s){throw new Error("Not yet implemented")},n.prototype.multinomial=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.oneHot=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.cumsum=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.nonMaxSuppression=function(e,t,r,o,i){throw new Error("Not yet implemented")},n.prototype.fft=function(e){throw new Error("Not yet implemented")},n.prototype.ifft=function(e){throw new Error("Not yet implemented")},n.prototype.complex=function(e,t){throw new Error("Not yet implemented")},n.prototype.real=function(e){throw new Error("Not yet implemented")},n.prototype.imag=function(e){throw new Error("Not yet implemented")},n.prototype.cropAndResize=function(e,t,r,o,i,a){throw new Error("Not yet implemented")},n.prototype.depthToSpace=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.split=function(e,t,r){throw new Error("Not yet implemented")},n.prototype.sparseToDense=function(e,t,r,o){throw new Error("Not yet implemented")},n.prototype.fill=function(e,t,r){throw new Error("Not yet implemented.")},n.prototype.onesLike=function(e){throw new Error("Not yet implemented")},n.prototype.zerosLike=function(e){throw new Error("Not yet implemented")},n.prototype.setDataMover=function(e){throw new Error("Not yet implemented")},n.prototype.dispose=function(){throw new Error("Not yet implemented")}}();var xse=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,a=Math.ceil(n.inSize/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function w4(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function ri(n,e){return 1===e?[n]:w4(n,e)}function _f(n,e){for(var t=n.length,r=[],o=0;o<t;o++){var i=t-1-o;(e[e.length-1-o]||1)>1&&1===(n[i]||1)&&r.unshift(i)}return r}function hr(n,e){for(var t=[],r=0;r<e.length;r++){var o=n[n.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&t.unshift(i)}return t}function It(n,e){for(var t=[],r=Math.max(n.length,e.length),o=0;o<r;o++){var i=n[n.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)t.unshift(a);else if(1===a)t.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(i)}}return t}function za(){var n,e,t,r,o,i,a,s,u,c;return 2===N.get("WEBGL_VERSION")?(n="#version 300 es",e="in",t="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      const float NAN = uintBitsToFloat(uint(0x7fc00000));\n    ",u="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",e="attribute",t="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      uniform float NAN;\n\n      bool isnan(float val) {\n        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n      }\n      bvec4 isnan(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function jh(n,e,t){void 0===t&&(t="index");var r=_u(e);return r.map(function(o,i){return"int "+n[i]+" = "+t+" / "+o+"; "+(i===r.length-1?"int "+n[i+1]+" = "+t+" - "+n[i]+" * "+o:"index -= "+n[i]+" * "+o)+";"}).join("")}function G0(n){return 1===n.length?""+n[0]:"vec"+n.length+"("+n.join(",")+")"}function bse(n,e,t,r){var o=[];n.forEach(function(h){var p=Be(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,s=o.join("\n"),u=n.map(function(h){return function Cse(n,e,t){void 0===t&&(t=!1);var r="";return r+=t?_4(n):bf(n),n.shapeInfo.logicalShape.length<=e.logicalShape.length&&(r+=t?function nue(n,e){var t,r=n.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",a=n.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=_f(n.shapeInfo.logicalShape,e.logicalShape),c=mn(s),l=s-a,f=["x","y","z","w","u","v"];t=0===a?"":s<2&&u.length>=1?"coords = 0;":u.map(function(v){return"coords."+f[v+l]+" = 0;"}).join("\n");var d;d=s<2&&a>0?"coords":n.shapeInfo.logicalShape.map(function(v,m){return"coords."+f[m+l]}).join(", ");var h="return outputValue;";if(1===a&&s>1)h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";else if(0===a&&s>0)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var p=a-2,g=a-1;u.indexOf(p)>-1&&u.indexOf(g)>-1?h="return vec4(outputValue.x);":u.indexOf(p)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}return"\n    vec4 "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+t+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+h+"\n    }\n  "}(n,e):function rue(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),o="get"+r+"AtOutCoords",s=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&null==n.shapeInfo.flatOffset&&Or(n.shapeInfo.texShape,e.texShape))return"\n      float "+o+"() {\n        return sampleTexture("+t+", resultUV);\n      }\n    ";var c=mn(u),l=_f(n.shapeInfo.logicalShape,e.logicalShape),f=u-s,d=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map(function(h){return"coords."+d[h+f]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":n.shapeInfo.logicalShape.map(function(h,p){return"coords."+d[p+f]}).join(", "))+");\n    }\n  "}(n,e)),r}(h,e,r)}).join("\n"),c=e.texShape,l=za(),f=function Ase(n){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+n.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),d=function Tse(n){return n.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+n.varyingFs+" vec2 resultUV;\n    "+n.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    "+n.defineSpecialNaN+"\n    "+n.defineSpecialInf+"\n    "+n.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Rse+"\n    "+Nse+"\n    "+Ose+"\n  "}(l);return e.isPacked?(i=function Ese(n,e){switch(n.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function Pse(n,e){var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===t[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function Wse(n,e){var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Or(n,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ";var r=Math.ceil(n[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(n,e);case 3:return function Fse(n,e){var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}(n,e);default:return function Bse(n,e){for(var t=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2),i=o,a="",s="b, r, c",u=2;u<n.length-1;u++)a="\n      int b"+u+" = index / "+(i*=n[n.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+n.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+n.length+"("+s+");\n    }\n  "}(n,e)}}(e.logicalShape,c),a=function Dse(n){return"\n    void setOutput(vec4 val) {\n      "+n.output+" = val;\n    }\n  "}(l)):(i=function Sse(n,e){switch(n.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function kse(n,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function Gse(n,e){return Or(n,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===n[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===n[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+n[1]+";\n      int c = index - r * "+n[1]+";\n      return ivec2(r, c);\n    }\n  "}(n,e);case 3:return function Lse(n,e){var t=jh(["r","c","d"],n);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+t+"\n      return ivec3(r, c, d);\n    }\n  "}(n,e);case 4:return function Vse(n,e){var t=jh(["r","c","d","d2"],n);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+t+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(n,e);case 5:return function Use(n,e){var t=jh(["r","c","d","d2","d3"],n);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(n,e);case 6:return function Hse(n,e){var t=jh(["r","c","d","d2","d3","d4"],n);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(n,e);default:throw new Error(n.length+"-D output sampling is not yet supported")}}(e.logicalShape,c),a=function Ise(n){return"\n    void setOutput(float val) {\n      "+n.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=Mse),[d,f,a,s,i,u,t].join("\n")}function bf(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function jse(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return"float "+t+"() {return "+e+";}";var r=n.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+t+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=n.shapeInfo.texShape;return"\n    float "+t+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+Rc(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(n);case 1:return function qse(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return"\n      float "+t+"(int index) {\n        "+Cf(n)+"\n      }\n    ";var r=n.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+t+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=Rc(e);return 1===i?"\n      float "+t+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+t+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+t+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(n);case 2:return function Kse(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n.shapeInfo.texShape;if(null!=o&&Or(e,o))return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+o[0]+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ";var a=xu(e),u=a.keptDims,c=a.newShape;if(c.length<e.length)return"\n      "+bf(Ef(n,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Sf(["row","col"],u)+");\n      }\n    ";if(n.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+e[1]+", 1)));\n        "+Cf(n)+"\n      }\n    ";var l=o[0],f=o[1],d=Rc(t);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+e[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+l+", "+f+", index);\n    return sampleTexture("+t+", uv);\n  }\n"}(n);case 3:return function Zse(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e[1]*e[2],i=e[2],a=xu(e),u=a.keptDims,c=a.newShape;if(c.length<e.length)return"\n        "+bf(Ef(n,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Sf(["row","col","depth"],u)+");\n        }\n      ";if(n.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+i+", 1)));\n        "+Cf(n)+"\n      }\n    ";var l=n.shapeInfo.texShape,f=l[0],d=l[1],h=n.shapeInfo.flatOffset;return d===o&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+t+", uv);\n        }\n      ":d===i&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+e[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+i+" + depth + "+Rc(t)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+t+", uv);\n      }\n  "}(n);case 4:return function Jse(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e[3],i=e[2]*o,a=e[1]*i,s=xu(e),u=s.newShape,c=s.keptDims;if(u.length<e.length)return"\n      "+bf(Ef(n,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Sf(["row","col","depth","depth2"],c)+");\n      }\n    ";if(n.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+i+", "+o+", 1)));\n        "+Cf(n)+"\n      }\n    ";var l=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,d=f[0],h=f[1];return h===a&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+e[1]*e[2]+", "+e[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+i+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+h+", index + "+Rc(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(n);case 5:return function eue(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e[4],i=e[3]*o,a=e[2]*i,s=e[1]*a,u=xu(e),c=u.newShape,l=u.keptDims;if(c.length<e.length)return"\n      "+bf(Ef(n,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Sf(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(n.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+a+", "+i+", "+o+")) +\n          depth3;\n        "+Cf(n)+"\n      }\n    ";var f=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,h=d[0],p=d[1];return p===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":p===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]+",\n               "+e[2]*e[3]+", "+e[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" + depth * "+i+" +\n          depth2 * "+o+" + depth3 + "+Rc(t)+";\n      vec2 uv = uvFromFlat("+h+", "+p+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}(n);case 6:return function tue(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=xu(e),i=o.newShape,a=o.keptDims;if(i.length<e.length)return"\n      "+bf(Ef(n,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Sf(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    ";var s=e[5],u=e[4]*s,c=e[3]*u,l=e[2]*c,f=e[1]*l;if(n.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+Cf(n)+"\n      }\n    ";var d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,p=h[0],g=h[1];return g===f&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+p+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":g===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]*e[4]+",\n               "+e[2]*e[3]*e[4]+",\n               "+e[3]*e[4]+",\n               "+e[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+p+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+Rc(t)+";\n      vec2 uv = uvFromFlat("+p+", "+g+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function _4(n){switch(n.shapeInfo.logicalShape.length){case 0:return function zse(n){var e=n.name;return"\n    vec4 get"+e.charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+za().texture2D+"("+e+", halfCR);\n    }\n  "}(n);case 1:return function $se(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=n.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=za();return"\n    vec4 "+t+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+e+", uv);\n    }\n  "}(n);case 2:return function Xse(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],s=za();if(null!=o&&Or(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+t+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+t+", uv);\n    }\n  "}(n);case 3:return function Yse(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===e[0])return"\n        "+_4(Ef(n,e.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+Sf(["b","row","col"],[1,2])+");\n        }\n      ";var a=i[0],s=i[1],u=Math.ceil(e[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+s+", "+u*Math.ceil(e[1]/2)+", "+u+", b, row, col);\n      return "+za().texture2D+"("+t+", uv);\n    }\n  "}(n);default:return function Qse(n){for(var e=n.shapeInfo.logicalShape,t=e.length,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],c=Math.ceil(e[t-1]/2),l=c*Math.ceil(e[t-2]/2),f="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",h=2;h<t-1;h++)f="int b"+h+", "+f,d="b"+h+" * "+(l*=e[t-h-1])+" + "+d;return"\n    vec4 "+o+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+za().texture2D+"("+r+", uv);\n    }\n  "}(n)}}var Rse="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Nse="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ose="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Mse="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Rc(n){return"offset"+n}function Cf(n){var e=n.name,t=Be(n.shapeInfo.logicalShape);return t<2?"return "+e+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function mn(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Ef(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Sf(n,e){return e.map(function(t){return n[t]}).join(", ")}var oue=function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,P(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=Math.ceil(n[n.length-1]/e);this.outputShape=n.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=mn(c),f=ri("coords",c);if(1===i){var d=mn(s=c+1);a="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],g=h.map(function(E){return"int "+E}),v=ri("sourceLocR",s-1).concat("inIdx.r"),m=ri("sourceLocG",s-1).concat("inIdx.g"),y=ri("sourceLocB",s-1).concat("inIdx.b"),x=ri("sourceLocA",s-1).concat("inIdx.a"),w="max"===t?"greaterThan":"lessThan",_=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",b="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+b+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+_+"\n          vec4 candidate = "+b+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},iue=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var s=n.effectiveFilterHeight,u=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-n.padInfo.top)+", "+(u-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},aue=function(n,e,t,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],It(n,e),It(n,t);var a="0.0";null!=r&&(It(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(It(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},sue=function(n,e,t,r,o,i){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],It(n,e),It(n,t);var a="vec4(0.0)";null!=r&&(It(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(It(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},E4=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=It(e,t),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},I2="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",D2="return a + b;",T2="return a - b;",S4="return a * b;",A4="return (a - b) * (a - b);",xue=I2+"\n  return max(a, b);\n",wue=I2+"\n  return min(a, b);\n",bue=I2+"\n  return atan(a, b);\n",Nn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=It(e,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},$h="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n",Aue="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+$h+"\n  return result;\n",Tue="\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+$h+"\n  return result;\n",Bue="\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+$h+"\n  return result;\n",Vue="\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+$h+"\n  return result;\n",Uue="\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+$h+"\n  return result;\n",Ds=function(n,e,t){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=It(e,t),this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Hue=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"min"),r.maxLoc=o.getUniformLocationNoThrow(i,"max")),o.gl.uniform1f(r.minLoc,e),o.gl.uniform1f(r.maxLoc,t)}},n}(),Wue=function(){function n(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"min"),r.maxLoc=o.getUniformLocationNoThrow(i,"max")),o.gl.uniform1f(r.minLoc,e),o.gl.uniform1f(r.maxLoc,t)}},n}(),Gue=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},zue=function(n){this.outputShape=[],this.outputShape=wf(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++)r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+e[t-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},jue=function(n,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=wf(n,e);var t=this.outputShape,r=t.length,o=mn(r),i=ri("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,v){return"T"+v});var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var c=a[e],l="vec2("+a.slice(-2).join()+")",f=a.join(),d="if ("+c+" < "+s[0]+")\n          return getChannel(getT0("+f+"), "+l+");";for(u=1;u<s.length;u++)d+="\n        else if ("+c+" < "+s[u]+") {\n          "+c+" -= "+s[u-1]+";\n          return getChannel(getT"+u+"("+f+"), "+l+");\n        }";d+="\n        else {\n          "+c+" -= "+s[s.length-1]+";\n          return getChannel(getT"+s.length+"("+f+"), "+l+");\n        }",this.userCode="\n      float getValue("+a.map(function(g){return"int "+g})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n        if (++"+i[r-1]+" < "+t[r-1]+") {\n          result.g = getValue("+i+");\n        }\n        if (++"+i[r-2]+" < "+t[r-2]+") {\n          result.a = getValue("+i+");\n        }\n        if ("+i[r-2]+" < "+t[r-2]+" &&\n            --"+i[r-1]+" < "+t[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "},$ue=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},que=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Xue=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Kue=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-n.padInfo.front)+", "+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+t+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+t+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Yue=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Zue=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,s=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Que=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.top,t=n.padInfo.left,r=n.strideHeight,o=n.strideWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.filterHeight,u=n.filterWidth,c=4*Math.floor(n.inChannels/4),l=n.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+e+", "+t+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+c+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===l)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+c+") *\n                getW(wR, wC, "+c+", d2);\n            } else if ("+(2===l)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+c+"),\n                getX(batch, xR, xC, "+c+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+c+", d2),\n                getW(wR, wC, "+c+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===l)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+c+"),\n                getX(batch, xR, xC, "+c+" + 1),\n                getX(batch, xR, xC, "+c+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+c+", d2),\n                getW(wR, wC, "+c+" + 1, d2),\n                getW(wR, wC, "+c+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Jue=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,i=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,l=n.filterDepth,f=n.filterHeight,d=n.filterWidth,h=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+t+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ece=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var f=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+n.strideHeight+", "+n.strideWidth+");\n      const ivec2 pads = ivec2("+n.padInfo.top+", "+n.padInfo.left+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+n.filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+n.dilationHeight+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+n.filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+n.dilationWidth+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tce=function(n){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=n.outShape;for(var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,o=n.padInfo.left,i=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.filterHeight,l=n.filterWidth,f=l,d="int xR; int xC; int xCOffset;",h=0;h<c;h++)for(var p=0;p<l;p++)d+="\n          vec4 xTexelR"+h+"C"+2*p+" = vec4(0.);\n          vec4 wR"+h+"C"+p+" = vec4(0.);\n          vec4 xR"+h+"C"+p+" = vec4(0.);";for(h=0;h<c;h++)for(var g=0;g<f;g++){if(d+="\n          xR = xRCorner + "+h*s+";\n          xC = xCCorner + "+(p=2*g)*u+";\n        ",1===a){if(p<l&&(d+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+t+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+h+"C"+p+" = vec4(previous.zw, xTexelR"+h+"C"+p+".xy);\n                } else {\n                  xR"+h+"C"+p+" = vec4(0, 0, xTexelR"+h+"C"+p+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+t+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = xTexelR"+h+"C"+p+";\n              ",p+1<l)){var v=o%2==0?Ec(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(d+="\n                  xCOffset = xC + "+o%2+" + "+v+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+t+") {\n                    xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(d+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+t+") {\n                      xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+h+"C"+p+" = vec4(0.);\n                    }\n                  "),d+="\n                  xR"+h+"C"+(p+1)+" = vec4(\n                    xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".xy);\n                "):d+="\n                  xCOffset = xC + "+v+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+t+") {\n                    xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+h+"C"+(p+1)+" = xTexelR"+h+"C"+(p+2)+";\n                "}}else p<l&&(d+="\n              if(xR >= 0 && xR < "+e+") {\n            ",o%2==1?(d+="\n                xCOffset = xC + 1 - "+a+";\n                if(xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+t+") {\n                  xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+h+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = vec4(\n                  xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".zw);\n              ",p+1<l&&(d+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+a+";\n                  if(xCOffset >= 0 && xCOffset < "+t+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+h+"C"+(p+1)+" = vec4(xTexelR"+h+"C"+(p+2)+".xy, final.xy);\n                ")):(d+="\n                if(xC >= 0 && xC < "+t+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+a+";\n                if(xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = vec4(\n                  xTexelR"+h+"C"+p+".xy, xTexelR"+h+"C"+(p+2)+".xy);\n              ",p+1<l&&(d+="\n                  xR"+h+"C"+(p+1)+" = vec4(\n                    xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".zw);\n                ")),d+="}");p<l&&(d+="\n            vec4 wTexelR"+h+"C"+p+" = getW("+h+", "+p+", d1, q);\n            wR"+h+"C"+p+" = vec4(wTexelR"+h+"C"+p+".xz, wTexelR"+h+"C"+p+".xz);\n          ",p+1<l&&(d+="\n              vec4 wTexelR"+h+"C"+(p+1)+" = getW("+h+", "+(p+1)+", d1, q);\n              wR"+h+"C"+(p+1)+" =\n                vec4(wTexelR"+h+"C"+(p+1)+".xz, wTexelR"+h+"C"+(p+1)+".xz);"))}for(h=0;h<c;h++)for(p=0;p<l;p++)d+="result += xR"+h+"C"+p+" * wR"+h+"C"+p+";";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},nce=function(n,e,t,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=n[0],a=n[1],s=n[2],l=t[0],f=t[1];this.outputShape=[e[0],l,f,n[3]];var h=[a-1+".0",s-1+".0"],p=h[0],g=h[1],v=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],w=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g];this.userCode="\n      const float height_ratio = float("+v[0]+");\n      const float width_ratio = float("+w[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+v[1]+";\n        float width_scale = "+w[1]+";\n\n        float in_y = "+v[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+w[2]+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},rce=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],i=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+mn(r)+" coords = getOutputCoords();\n        int end = "+I4(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+I4(r,"coords")+" = idx;\n          val += getX("+function oce(n,e){if(1===n)return""+e;if(2===n)return e+".x, "+e+".y";if(3===n)return e+".x, "+e+".y, "+e+".z";if(4===n)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function I4(n,e){if(1===n)return""+e;if(2===n)return e+".y";if(3===n)return e+".z";if(4===n)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var ja,ko,ice=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),ace=function(n){this.variableNames=["A"];var e=za();this.outputShape=n,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isnan(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},T4=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(t?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},sce=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,o){null==t.valueLoc&&(t.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),uce=function(n){this.variableNames=["A"];var e=za(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+t+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},cce=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var o=mn(this.rank),i=function lce(n,e){var t=n.length;if(t>4)throw Error("Gather for rank "+t+" is not yet supported");if(1===t)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<n.length;i++)o.push(i===e?"int(getIndices("+r[i]+"))":""+r[i]);return o.join()}(n,t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},fce=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=mn(e.length),o=mn(t.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Af(n,e){return[e,n]}function qh(n,e){return n*e}function R4(n,e,t){var r=function dce(n,e){if(n%e!=0)throw new Error("unpackedSize ("+n+") must be a multiple of "+e);return n/e}(n.length,t);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var o=0,i=0;i<n.length;i+=t)e[o++]=n[i]}function Nc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function R2(n,e){var t=Nc(n,e);return t[0]*t[1]*4}function N4(n,e,t,r,o){var i=t*r;if(o.length<i)throw new Error("matrix length ("+o.length+") must be >= "+i);for(var a=r%2==1,s=t%2==1,u=Math.floor(r/2),c=Math.floor(t/2),l=Math.ceil(r/2),f=l*Math.ceil(t/2),d=Ec(t)*Ec(r),h=0;h<e;h++){for(var p=h*t*r,g=h*d,v=a?4:0,m=r+(a?1:0),y=g,x=p,w=p+r,_=0;_<c;++_){for(var b=0;b<u;++b)o[x++]=n[y++],o[x++]=n[y++],o[w++]=n[y++],o[w++]=n[y++];y+=v,x+=m,w+=m}if(a){y=g+4*(l-1);var C=p+r-1;for(v=4*l,m=2*r,_=0;_<c;++_)o[C]=n[y],o[C+r]=n[y+2],y+=v,C+=m}if(s){for(y=g+4*(f-l),C=p+(t-1)*r,b=0;b<u;++b)o[C++]=n[y++],o[C++]=n[y++],y+=2;a&&(o[p+t*r-1]=n[y])}}return o}function _e(n,e,t){var r=t();return e&&function gce(n){var e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+M4(n,e))}(n),r}(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ja||(ja={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ko||(ko={}));var vce=5.96e-8,mce=65504;function O4(n){return!!(N.get("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||vce<Math.abs(n)&&Math.abs(n)<mce)}function M4(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Xh(n,e,t){return Ts(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function P4(n,e,t){var r=Ts(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(_e(n,e,function(){return n.shaderSource(r,t)}),_e(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function k4(n,e,t){var r=Ts(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(_e(n,e,function(){return n.shaderSource(r,t)}),_e(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw function xce(n,e){var t=yce.exec(e);if(null==t)return console.log("Couldn't parse line number in error: "+e),void console.log(n);for(var r=+t[1],o=n.split("\n"),i=o.length.toString().length+2,a=o.map(function(d,h){return Ic((h+1).toString(),i)+d}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var c=a.slice(0,r-1),l=a.slice(r-1,r),f=a.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+Ic(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var yce=/ERROR: [0-9]+:([0-9]+):/g;function F4(n,e){return Ts(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function L4(n,e,t){if(_e(n,e,function(){return n.linkProgram(t)}),!1===n.getProgramParameter(t,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function z0(n,e,t){if(_e(n,e,function(){return n.validateProgram(t)}),!1===n.getProgramParameter(t,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function B4(n,e,t){var r=Ts(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return _e(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),_e(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function V4(n,e,t){var r=Ts(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return _e(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),_e(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function U4(){return 2===N.get("WEBGL_VERSION")?1:4}function H4(n,e){return Ts(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function N2(n,e){var t=N.get("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+t+"x"+t+"].")}function W4(n,e){return Ts(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function O2(n,e,t,r,o,i,a,s){var u=n.getAttribLocation(t,r);return-1!==u&&(_e(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,o)}),_e(n,e,function(){return n.vertexAttribPointer(u,i,n.FLOAT,!1,a,s)}),_e(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function G4(n,e,t,r){X4(n,r),_e(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function z4(n,e,t,r){return Ts(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function j4(n,e,t){return n.getUniformLocation(e,t)}function $4(n,e,t,r,o,i){_e(n,e,function(){return G4(n,e,r,i)}),_e(n,e,function(){return n.uniform1i(o,i)})}function j0(n,e,t,r){_e(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),_e(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function M2(n,e,t){_e(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),_e(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Kh(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+q4(n,e))}function q4(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Ts(n,e,t,r){var o=_e(n,e,function(){return t()});if(null==o)throw new Error(r);return o}function X4(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+t+"].")}function Oc(n,e){return void 0===e&&(e=2),Be(n.slice(0,n.length-e))}function Mc(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function K4(n,e){var t;void 0===e&&(e=!1);var r=N.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(n=n.map(function(c,l){return l>=n.length-2?Ec(n[l]):n[l]})).length&&(n=[2,n[0]])),2!==n.length){var o=xu(n);n=o.newShape}var i=Be(n);if(n.length<=1&&i<=r)return[1,i];if(2===n.length&&n[0]<=r&&n[1]<=r)return n;if(3===n.length&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=Oc(n),s=2,u=2;return n.length&&(s=(t=Mc(n))[0],u=t[1]),n2(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return n2(i)}function $0(n){return n%2==0}function Yh(n,e){if(Or(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||0===n[0]||0===n[1]||0===e[0]||0===e[1])return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||$0(t)&&$0(r)&&(1===n[0]||1===e[0]))return!0}return n[1]===e[1]&&$0(n[0])&&$0(e[0])}var bce=Object.freeze({callAndCheck:_e,canBeRepresented:O4,getWebGLErrorMessage:M4,getExtensionOrThrow:Xh,createVertexShader:P4,createFragmentShader:k4,createProgram:F4,linkProgram:L4,validateProgram:z0,createStaticVertexBuffer:B4,createStaticIndexBuffer:V4,getNumChannels:U4,createTexture:H4,validateTextureSize:N2,createFramebuffer:W4,bindVertexBufferToProgramAttribute:O2,bindTextureUnit:G4,unbindTextureUnit:function wce(n,e,t){X4(n,t),_e(n,e,function(){return n.activeTexture(n.TEXTURE0+t)}),_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:z4,getProgramUniformLocation:j4,bindTextureToProgramUniformSampler:$4,bindCanvasToFramebuffer:function _ce(n,e){_e(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),_e(n,e,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),_e(n,e,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})},bindColorTextureToFramebuffer:j0,unbindColorTextureFromFramebuffer:M2,validateFramebuffer:Kh,getFramebufferErrorMessage:q4,getBatchDim:Oc,getRowsCols:Mc,getTextureShapeFromLogicalShape:K4,isReshapeFree:Yh});function Y4(n,e){var t=za();return P4(n,e,t.version+"\n    precision highp float;\n    "+t.attribute+" vec3 clipSpacePos;\n    "+t.attribute+" vec2 uv;\n    "+t.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Z4(n,e){return B4(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Q4(n,e){return V4(n,e,new Uint16Array([0,1,2,2,1,3]))}function J4(n,e){var t,r,o,i,a,s,u,c,l=n;return 2===N.get("WEBGL_VERSION")?(t=l.R32F,r=l.R16F,o=l.RGBA16F,i=l.RGBA32F,a=l.RED,s=4,u=1,c=l.HALF_FLOAT):(t=n.RGBA,r=n.RGBA,o=n.RGBA,i=l.RGBA,a=n.RGBA,s=4,u=4,c=null!=e?e.HALF_FLOAT_OES:null),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c}}function Zh(n,e,t,r,o,i,a){N2(t,r);var s=H4(n,e),u=n.TEXTURE_2D;return _e(n,e,function(){return n.bindTexture(u,s)}),_e(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),_e(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),_e(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),_e(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),_e(n,e,function(){return n.texImage2D(u,0,o,t,r,0,i,a,null)}),_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function ek(n,e,t,r,o){var i=Af(t,r);return Zh(n,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function tk(n,e,t,r,o){var i=Af(t,r);return Zh(n,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function nk(n,e,t,r,o){var i=Af(t,r);return Zh(n,e,i[0],i[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function rk(n,e,t,r,o){var i=Nc(t,r);return Zh(n,e,i[0],i[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function ok(n,e,t,r,o){var i=Nc(t,r);return Zh(n,e,i[0],i[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function ik(n,e,t,r){return _e(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),O2(n,e,t,"clipSpacePos",r,3,20,0)&&O2(n,e,t,"uv",r,2,20,12)}function ak(n,e,t,r){_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),_e(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function sk(n,e,t,r,o,i,a){N2(r,o),_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),_e(n,e,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,r,o,a,n.FLOAT,i)}),_e(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function uk(n,e,t,r,o,i,a,s){var u,c=Af(r,o),l=c[0],f=c[1],d=r*o;1===s.defaultNumChannels&&d===i.length?u=i:function hce(n,e,t){var r=qh(n.length,t);if(e.length<r)throw new Error("unpackedArray length ("+e.length+") must be >= "+r);for(var o=0,i=0;i<n.length;++i)e[o]=n[i],o+=t}(i,u=new Float32Array(d*a),a),sk(n,e,t,l,f,u,s.textureFormatFloat)}function ck(n,e,t,r,o,i,a,s,u,c){var l=Nc(a,s),f=l[0],d=l[1],h=new Float32Array(R2(a,s));(function pce(n,e,t,r,o){for(var i=r%2==1,a=t%2==1,s=Math.floor(r/2),u=Math.floor(t/2),c=Math.ceil(r/2),l=c*Math.ceil(t/2),f=Ec(t)*Ec(r),d=0;d<e;d++){for(var h=d*t*r,p=d*f,g=i?4:0,v=r,m=p,y=0;y<u;++y){for(var x=2*y*r,w=0;w<s;++w){var _=h+x+2*w;o[m]=n[_],o[m+1]=n[_+1],o[m+2]=n[_+v],o[m+3]=n[_+v+1],m+=4}m+=g}if(i){_=h+r-1,m=p+4*(c-1);var b=2*r;for(g=4*c,y=0;y<u;++y)o[m]=n[_],o[m+2]=n[_+r],_+=b,m+=g}if(a){for(_=h+(t-1)*r,m=p+4*(l-c),w=0;w<s;++w)o[m++]=n[_++],o[m++]=n[_++],m+=2;i&&a&&(o[p+f-4]=n[_])}}})(u,r,o,i,h),sk(n,e,t,f,d,h,n.RGBA)}function lk(n,e,t,r,o,i){var a=t;if(2===N.get("WEBGL_VERSION")){var s=n,u=s.createBuffer();_e(n,e,function(){return n.bindBuffer(s.PIXEL_PACK_BUFFER,u)});var c=4*qh(r*o,i.downloadUnpackNumChannels);_e(n,e,function(){return n.bufferData(s.PIXEL_PACK_BUFFER,c,s.STREAM_READ)}),_e(n,e,function(){return s.readPixels(0,0,o,r,n.RGBA,n.FLOAT,0)}),_e(n,e,function(){return n.bindBuffer(s.PIXEL_PACK_BUFFER,null)}),a=u}return a}function fk(n,e,t,r,o){var i=n,a=new Float32Array(qh(t*r,o.downloadUnpackNumChannels));i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,a),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);var s=new Float32Array(t*r);return R4(a,s,o.downloadUnpackNumChannels),s}function dk(n,e,t,r,o){var i=Af(t,r),a=i[0],s=i[1],u=new Float32Array(qh(t*r,o.downloadUnpackNumChannels));_e(n,e,function(){return n.readPixels(0,0,a,s,o.downloadTextureFormat,n.FLOAT,u)});var c=new Float32Array(t*r);return R4(u,c,o.downloadUnpackNumChannels),c}function hk(n,e,t,r,o){var i=Af(t,r),a=i[0],s=i[1],u=new Uint8Array(qh(t*r,4));return _e(n,e,function(){return n.readPixels(0,0,a,s,o.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function pk(n,e,t,r,o,i,a,s){var u=n,c=new Float32Array(R2(i,a));u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var l=new Float32Array(Be([t,r,o]));return N4(c,t,r,o,l),l}function gk(n,e,t,r,o,i,a,s){var u=Nc(i,a),c=u[0],l=u[1],f=new Float32Array(R2(i,a));_e(n,e,function(){return n.readPixels(0,0,c,l,n.RGBA,n.FLOAT,f)});var d=new Float32Array(Be([t,r,o]));return N4(f,t,r,o,d)}var Cce=Object.freeze({createVertexShader:Y4,createVertexBuffer:Z4,createIndexBuffer:Q4,getTextureConfig:J4,createFloat32MatrixTexture:ek,createFloat16MatrixTexture:tk,createUnsignedBytesMatrixTexture:nk,createPackedMatrixTexture:rk,createFloat16PackedMatrixTexture:ok,bindVertexProgramAttributeStreams:ik,uploadPixelDataToTexture:ak,uploadMatrixToTexture:uk,uploadMatrixToPackedTexture:ck,maybeCreateBufferFromOutputTexture:lk,downloadFloat32MatrixFromBuffer:fk,downloadFloat32MatrixFromOutputTexture:dk,downloadByteEncodedFloatMatrixFromOutputTexture:hk,downloadPackedMatrixFromBuffer:pk,downloadMatrixFromPackedOutputTexture:gk}),vk=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=N.get("WEBGL_VERSION");null!=e?(this.gl=e,function oae(n,e){Cc[n]=e}(t,e)):this.gl=Va(t),1===N.get("WEBGL_VERSION")?(this.textureFloatExtension=Xh(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),N.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Xh(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Xh(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=Z4(this.gl,this.debug),this.indexBuffer=Q4(this.gl,this.debug),this.framebuffer=W4(this.gl,this.debug),this.textureConfig=J4(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return N.get("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;_e(t,this.debug,function(){return t.finish()}),_e(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),_e(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),_e(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),_e(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),_e(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),ek(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),tk(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),nk(this.gl,this.debug,e,t)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),ak(this.gl,this.debug,e,t)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),ok(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),rk(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(M2(this.gl,this.debug,this.framebuffer),this.outputTexture=null),_e(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.uploadMatrixToTexture=function(e,t,r,o){this.throwIfDisposed();var i=U4();return uk(this.gl,this.debug,e,t,r,o,i,this.textureConfig)},n.prototype.uploadMatrixToPackedTexture=function(e,t,r,o,i,a,s){return this.throwIfDisposed(),ck(this.gl,this.debug,e,t,r,o,i,a,s)},n.prototype.downloadFloat32MatrixFromOutputTexture=function(e,t,r){var o=this;return this.downloadMatrixDriver(e,function(){return dk(o.gl,o.debug,t,r,o.textureConfig)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var o=this;return this.downloadMatrixDriver(e,function(){return hk(o.gl,o.debug,t,r,o.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,o,i,a){return pk(this.gl,e,t,r,o,i,a)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t,r){return fk(this.gl,e,t,r,this.textureConfig)},n.prototype.maybeCreateBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var o=lk(this.gl,this.debug,e,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,o=this;if(N.get("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},t=a}else N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(t,N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r,o,i,a){var s=this;return this.downloadMatrixDriver(e,function(){return gk(s.gl,s.debug,t,r,o,i,a)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=k4(t,this.debug,e),o=Y4(t,this.debug),i=F4(t,this.debug);return _e(t,this.debug,function(){return t.attachShader(i,o)}),_e(t,this.debug,function(){return t.attachShader(i,r)}),L4(t,this.debug,i),this.debug&&z0(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=ik(t,this.debug,this.program,this.vertexBuffer)),i},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&_e(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&z0(this.gl,this.debug,this.program),_e(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?z4(this.gl,this.debug,e,t):j4(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),_e(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),$4(this.gl,this.debug,0,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var o=Nc(t,r);this.setOutputMatrixTextureDriver(e,o[0],o[1])},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,o){this.setOutputMatrixWriteRegionDriver(r,e,o,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&z0(this.gl,this.debug,this.program),Kh(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),_e(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),_e(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Xh(this.gl,this.debug,2===N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(2!==N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return gt(this,void 0,void 0,function(){var t=this;return vt(this,function(r){switch(r.label){case 0:return[4,r2(function(){return t.disposed||t.isQueryAvailable(e,N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(e,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function Ece(n){for(var e=0;e<n.length&&n[e]();++e);return e-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||r2(function(){return r.pollItems(),0===r.itemsToPoll.length})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),j0(this.gl,this.debug,e,this.framebuffer),this.debug&&Kh(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(j0(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Kh(this.gl)):M2(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var o=this.gl;j0(o,this.debug,e,this.framebuffer),this.debug&&Kh(o),this.outputTexture=e,_e(o,this.debug,function(){return o.viewport(0,0,t,r)}),_e(o,this.debug,function(){return o.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,o){var i=this;this.throwIfDisposed(),_e(this.gl,this.debug,function(){return i.gl.scissor(e,t,r,o)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function mk(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var o=t.logicalShape,i=e[r],a=i.shape;if(!Or(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!t.isUniform||!i.isUniform){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!Or(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var Dce=function(n,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var o=t.inChannels,i=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,c=t.dilationWidth,l=t.dilationHeight,f=s.left,d=s.top,h=o*t.filterWidth,p=za();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+n[1]+" || pos >= "+n[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+u+")) * "+a+" - "+d+";\n            int d0 = offsetY + "+l+" * (pos / "+h+");\n\n            if(d0 >= "+e[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+f+".);\n            int d1 = offsetX + "+c+" * (int(mod(float(pos), "+h+".) / "+o+".));\n\n            if(d1 >= "+e[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+o+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+p.output+" = result;\n      }\n    "},Tce=function(n,e,t,r,o){this.variableNames=["x"],this.outputShape=[];var a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Rce=function(n,e,t,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+t+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Nce=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var o=n.effectiveFilterHeight,i=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-n.padInfo.top)+", "+(i-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*i-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},P2=function(n,e,t,r,o,i){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var s=Math.ceil((t?n[1]:n[2])/2),u=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",l=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",h="";i&&(d="vec4 activation(vec4 x) {\n        "+i+"\n      }",h="result = activation(result);");var p=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          result += ("+l[0]+" * "+f[0]+") + ("+l[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},Oce=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,o){null==t.seedLoc&&(t.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),Mce=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+t+"),\n                      float(index == coords.y)));\n      }\n    "},Pce=function(n){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=n;var e=n.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var t=ri("rc",e),r=mn(e),o=function Fce(n,e,t){if(1===n)return"rc > "+e[0];for(var r="",o=n-2;o<n;o++)r+=t[o]+" >= "+e[o],o<n-1&&(r+="||");return r}(e,n,t),i=function Lce(n,e,t,r){if(1===n)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+t+";\n  "}(e,n[n.length-1],n[n.length-2],t),a=function Bce(n,e){var t=n.length,r=function kce(n,e){for(var t=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<n;a++)i=e[e.length-1-a]+","+i;t.push(i)}return t}(t,e);return 1===t?"getA(rc),\n            rc + 1 >= "+n[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(n,t);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Vce=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,c){return u[0]+n[c]+u[1]});var r=n.length,o=mn(r),i=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,c){return u[0]+n[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Uce=function(n,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(v,m){return v[0]+n[m]+v[1]});for(var r=n.length,o=mn(r),i=e.map(function(v){return v[0]}).join(","),a=e.map(function(v,m){return v[0]+n[m]}).join(","),s=ri("rc",r),u=ri("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+t+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},k2=function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,l=n.padInfo.top,f=n.padInfo.left;this.outputShape=n.outShape;var d="avg"===e,h="0.0";if(d||(h="-1.0 / 1e-20"),t)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(p="avgValue / count");var g=4*Math.floor(r/4),v=r%4,m="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+m+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+m+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Hce=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,o=n.inSize,i=Math.ceil(o/t);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(t/4),l=t%4,f="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===e?(a="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(a="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";o%t>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Wce=function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),t+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      "+function zce(n){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+jh(["r","c","d"],n)+"\n      return ivec3(r, c, d);\n    }\n  "}(e)+"\n      "+function Gce(n){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+function _se(n,e){if(n.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+n.length+" and "+e.length);for(var t=[],r=Math.floor(n.length/4),o=n.length%4,i=0;i<r;i++){var a=n.slice(4*i,4*i+4),s=e.slice(4*i,4*i+4);t.push(G0(a)+", "+G0(s))}return 0!==o&&(a=n.slice(4*r),s=e.slice(4*r),1===a.length&&(a=a.map(function(u){return"float("+u+")"}),s=s.map(function(u){return"float("+u+")"})),t.push(G0(a)+", "+G0(s))),t.map(function(u,c){return"dot("+u+")"}).join("+")}(["coords.x","coords.y","coords.z"],_u(n).map(function(e){return e.toString()}).concat(["1."]))+");\n    }\n  "}(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+t+"\n\n        setOutput(result);\n      }\n    "},jce=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=n.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,g=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},$ce=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[1],a=n[2];this.outputShape=[n[0],e,t,n[3]];var u=[r&&e>1?i-1:i,r&&t>1?a-1:a],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},qce=function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var i=n[1],a=n[2],s=n[3];this.outputShape=[n[0],e,t,s];var u=[r&&e>1?i-1:i,r&&t>1?a-1:a],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+"; \n        bool hasNextRow = coords.z < "+(t-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Xce=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=n.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,g=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+t+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+t+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Kce=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[1],a=n[2];this.outputShape=[n[0],e,t,n[3]];var u=[r&&e>1?i-1:i,r&&t>1?a-1:a],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Yce=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,1!==t){var r=n.map(function(i,a){return-1!==e.indexOf(s=a)&&1!==n[s]?n[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=mn(t);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},Zce=function(n,e){this.variableNames=["x"],this.usesPackedTextures=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var u,r=ri("rc",t),o=r[t-1]+" + 1 < "+this.outputShape[t-1],i=r[t-2]+" + 1 < "+this.outputShape[t-2],a=mn(t);function s(u){var c=n.map(function(l,f){return h=u,-1!==e.indexOf(d=f)&&1!==n[d]?n[d]+" - "+h[d]+" - 1":""+h[d];var d,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===t?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1), rc);\n          if("+o+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1), rc + 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+((u=r.slice())[t-1]="("+u[t-1]+" + 1)",s(u)+";\n          }\n          if(")+i+") {\n            result.b = "+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},yk=function(n,e,t,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=mn(o.length),u=mn(i.length),c="";1===t?c="i":2===t&&(c="i, j");var f="";1===r?f="i":2===r&&(f="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+f+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Qce=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,o=n.inSize,i=n.numSegments,a=i*Math.ceil(o/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%t>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%t>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+t+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Jce=function(n,e,t){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(1===t)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<n&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=mn(t);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},ele=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=mn(this.rank),o="uniform int start["+this.rank+"];",i=function tle(n){if(1===n)return"sourceLoc";if(n<=6)return F2.slice(0,n).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+n+" is not yet supported")}(this.rank);t="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+e.map(function(a,s){return"sourceLoc."+F2[s]+" = start["+s+"] + coords."+F2[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,o){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),F2=["x","y","z","w","u","v"],nle=function(){function n(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=mn(this.rank),r=ri("coords",this.rank),o=ri("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+a+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(l,f){return"start["+f+"]"}).join()+");":e.map(function(l,f){return o[f]+" = "+r[f]+" + start["+f+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+" \n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,o){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),rle=function(n,e,t,r){this.variableNames=["x"];var o=t.filter(function(l,f){return-1===r.indexOf(f)});this.outputShape=o;var i=t.length,a=mn(t.length),s=mn(o.length),u="";if(1===i)u="coords * strides + begin";else{var c=0;u=t.map(function(l,f){return-1===r.indexOf(f)?(c++,1===o.length?"coords * strides["+f+"] + begin["+f+"]":"coords["+(c-1)+"] * strides["+f+"] + begin["+f+"]"):"begin["+f+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+n+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},ole=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var o,i=xk(t,r),a=wk(e,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===ko.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===ko.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===ko.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===ko.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===ko.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),o},n.prototype.releaseTexture=function(e,t,r,o){if(null!=this.freeTextures){var i=wk(t,xk(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(o){e.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function xk(n,e){if(n===ja.UPLOAD)return e?ko.PACKED_2X2_FLOAT32:ko.UNPACKED_FLOAT32;if(n===ja.RENDER||null==n)return e?N.get("WEBGL_RENDER_FLOAT32_ENABLED")?ko.PACKED_2X2_FLOAT32:ko.PACKED_2X2_FLOAT16:N.get("WEBGL_RENDER_FLOAT32_ENABLED")?ko.UNPACKED_FLOAT32:ko.UNPACKED_FLOAT16;if(n===ja.DOWNLOAD||n===ja.PIXELS)return ko.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function wk(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var ile=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var o=mn(this.rank),i=function ale(n){var e=n.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+n[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<n.length;o++)r.push("imod("+t[o]+", "+n[o]+")");return r.join()}(n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},sle=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var o=mn(this.rank),i=function ule(n){var e=n.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<n.length;o++)r[n[o]]=t[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},cle=function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=mn(this.rank),i=w4("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},L2=1.7580993408473768,B2=1.0507009873554805,pt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Pc="if (isnan(x)) return x;",Ik=Pc+"\n  return (x < 0.0) ? 0.0 : x;\n",hle="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+L2+";\n  float scale = "+B2+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Dk="return exp(x);",Rle=Pc+"\n  return sin(x);\n",Nle=Pc+"\n  return cos(x);\n",kle=Pc+"\n  return atan(x);\n",Ule=Pc+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Hle=Pc+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Tk="return x;",Rk="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",V2=function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Kle=function(n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var e=n.length,t=ri("rc",e),r=mn(e),o=function wse(n,e){if(1===n)return"rc";for(var t="",r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}(e,t),i=t.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},Fo=V({concat_:function efe(n,e){void 0===e&&(e=0),P(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Wh(n,"tensors","concat");e=xr(e,t[0].shape)[0];var r=wf(t.map(function(a){return a.shape}),e);if(0===Be(r))return Sn([],r);if(1===(t=t.filter(function(a){return a.size>0})).length)return t[0];var o=t.map(function(a){return a.shape});return function $ae(n,e){var t=n[0].length;n.forEach(function(o,i){P(o.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+t+")"})}),P(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(o,i){for(var a=0;a<t;a++)P(a===e||o[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}(o,e),N.engine.runKernel(function(a){return a.concat(t,e)},t,function(a){var s=o.map(function(u){return u[e]});return U2(a,s,e).map(function(u){return function(){return u}})})}}),nfe=V({concat1d_:function Yle(n){return Fo(n,0)}}),rfe=V({concat2d_:function Zle(n,e){return Fo(n,e)}}),ofe=V({concat3d_:function Qle(n,e){return Fo(n,e)}}),ife=V({concat4d_:function Jle(n,e){return Fo(n,e)}}),U2=V({split_:function tfe(n,e,t){void 0===t&&(t=0);var r,o=O(n,"x","split");return t=xr(t,o.shape)[0],"number"==typeof e?(P(o.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(o.shape[t]/e)):(P(o.shape[t]===e.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),N.engine.runKernel(function(i){return i.split(o,r,t)},{$x:o},function(i){return{$x:function(){return Fo(i,t)}}})}});function kc(n,e){return n(e={exports:{}},e.exports),e.exports}typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var afe=kc(function(n){!function(e,t,r){function o(a,s){return s.c=a.c,s.s0=a.s0,s.s1=a.s1,s.s2=a.s2,s}function i(a,s){var u=new function(f){var d,h=this,p=(d=4022871197,function(g){g=g.toString();for(var v=0;v<g.length;v++){var m=.02519603282416938*(d+=g.charCodeAt(v));m-=d=m>>>0,d=(m*=d)>>>0,d+=4294967296*(m-=d)}return 2.3283064365386963e-10*(d>>>0)});h.next=function(){var g=2091639*h.s0+2.3283064365386963e-10*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=g-(h.c=0|g)},h.c=1,h.s0=p(" "),h.s1=p(" "),h.s2=p(" "),h.s0-=p(f),h.s0<0&&(h.s0+=1),h.s1-=p(f),h.s1<0&&(h.s1+=1),h.s2-=p(f),h.s2<0&&(h.s2+=1),p=null}(a),c=s&&s.state,l=u.next;return l.int32=function(){return 4294967296*u.next()|0},l.double=function(){return l()+11102230246251565e-32*(2097152*l()|0)},l.quick=l,c&&("object"==typeof c&&o(c,u),l.state=function(){return o(u,{})}),l}t&&t.exports?t.exports=i:this.alea=i}(0,n)}),sfe=kc(function(n){!function(e,t,r){function o(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s}function i(a,s){var u=new function(f){var d=this,h="";d.x=0,d.y=0,d.z=0,d.w=0,d.next=function(){var g=d.x^d.x<<11;return d.x=d.y,d.y=d.z,d.z=d.w,d.w^=d.w>>>19^g^g>>>8},f===(0|f)?d.x=f:h+=f;for(var p=0;p<h.length+64;p++)d.x^=0|h.charCodeAt(p),d.next()}(a),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do{var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152}while(0===f);return f},l.int32=u.next,l.quick=l,c&&("object"==typeof c&&o(c,u),l.state=function(){return o(u,{})}),l}t&&t.exports?t.exports=i:this.xor128=i}(0,n)}),ufe=kc(function(n){!function(e,t,r){function o(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s.v=a.v,s.d=a.d,s}function i(a,s){var u=new function(f){var d=this,h="";d.next=function(){var g=d.x^d.x>>>2;return d.x=d.y,d.y=d.z,d.z=d.w,d.w=d.v,(d.d=d.d+362437|0)+(d.v=d.v^d.v<<4^g^g<<1)|0},d.x=0,d.y=0,d.z=0,d.w=0,d.v=0,f===(0|f)?d.x=f:h+=f;for(var p=0;p<h.length+64;p++)d.x^=0|h.charCodeAt(p),p==h.length&&(d.d=d.x<<10^d.x>>>4),d.next()}(a),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do{var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152}while(0===f);return f},l.int32=u.next,l.quick=l,c&&("object"==typeof c&&o(c,u),l.state=function(){return o(u,{})}),l}t&&t.exports?t.exports=i:this.xorwow=i}(0,n)}),cfe=kc(function(n){!function(e,t,r){function o(a,s){return s.x=a.x.slice(),s.i=a.i,s}function i(a,s){null==a&&(a=+new Date);var u=new function(f){var d=this;d.next=function(){var h,p,g=d.x,v=d.i;return h=g[v],p=(h^=h>>>7)^h<<24,p^=(h=g[v+1&7])^h>>>10,p^=(h=g[v+3&7])^h>>>3,p^=(h=g[v+4&7])^h<<7,h=g[v+7&7],p^=(h^=h<<13)^h<<9,g[v]=p,d.i=v+1&7,p},function(h,p){var g,v=[];if(p===(0|p))v[0]=p;else for(p=""+p,g=0;g<p.length;++g)v[7&g]=v[7&g]<<15^p.charCodeAt(g)+v[g+1&7]<<13;for(;v.length<8;)v.push(0);for(g=0;g<8&&0===v[g];++g);for(8==g&&(v[7]=-1),h.x=v,h.i=0,g=256;g>0;--g)h.next()}(d,f)}(a),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do{var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152}while(0===f);return f},l.int32=u.next,l.quick=l,c&&(c.x&&o(c,u),l.state=function(){return o(u,{})}),l}t&&t.exports?t.exports=i:this.xorshift7=i}(0,n)}),lfe=kc(function(n){!function(e,t,r){function o(a,s){return s.i=a.i,s.w=a.w,s.X=a.X.slice(),s}function i(a,s){null==a&&(a=+new Date);var u=new function(f){var d=this;d.next=function(){var h,p,g=d.w,v=d.X,m=d.i;return d.w=g=g+1640531527|0,p=v[m+34&127],h=v[m=m+1&127],p^=p<<13,h^=h<<17,p=v[m]=(p^=p>>>15)^(h^=h>>>12),d.i=m,p+(g^g>>>16)|0},function(h,p){var g,v,m,y,x,w=[],_=128;for(p===(0|p)?(v=p,p=null):(p+="\0",v=0,_=Math.max(_,p.length)),m=0,y=-32;y<_;++y)p&&(v^=p.charCodeAt((y+32)%p.length)),0===y&&(x=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,y>=0&&(m=0==(g=w[127&y]^=v+(x=x+1640531527|0))?m+1:0);for(m>=128&&(w[127&(p&&p.length||0)]=-1),m=127,y=512;y>0;--y)v=w[m+34&127],g=w[m=m+1&127],v^=v<<13,g^=g<<17,w[m]=(v^=v>>>15)^(g^=g>>>12);h.w=x,h.X=w,h.i=m}(d,f)}(a),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do{var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152}while(0===f);return f},l.int32=u.next,l.quick=l,c&&(c.X&&o(c,u),l.state=function(){return o(u,{})}),l}t&&t.exports?t.exports=i:this.xor4096=i}(0,n)}),ffe=kc(function(n){!function(e,t,r){function o(a,s){return s.a=a.a,s.b=a.b,s.c=a.c,s.d=a.d,s}function i(a,s){var u=new function(f){var d=this,h="";d.next=function(){var g=d.b,v=d.c,m=d.d,y=d.a;return g=g<<25^g>>>7^v,v=v-m|0,m=m<<24^m>>>8^y,y=y-g|0,d.b=g=g<<20^g>>>12^v,d.c=v=v-m|0,d.d=m<<16^v>>>16^y,d.a=y-g|0},d.a=0,d.b=0,d.c=-1640531527,d.d=1367130551,f===Math.floor(f)?(d.a=f/4294967296|0,d.b=0|f):h+=f;for(var p=0;p<h.length+20;p++)d.b^=0|h.charCodeAt(p),d.next()}(a),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do{var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152}while(0===f);return f},l.int32=u.next,l.quick=l,c&&("object"==typeof c&&o(c,u),l.state=function(){return o(u,{})}),l}t&&t.exports?t.exports=i:this.tychei=i}(0,n)}),Fc=kc(function(n){!function(e,t){var r,o=this,i=256,a=6,s="random",u=t.pow(i,a),c=t.pow(2,52),l=2*c,f=i-1;function d(v,m,y){var x=[],w=p(function C(E,S){var A,D=[],M=typeof E;if(S&&"object"==M)for(A in E)try{D.push(C(E[A],S-1))}catch{}return D.length?D:"string"==M?E:E+"\0"}((m=1==m?{entropy:!0}:m||{}).entropy?[v,g(e)]:v??function(){try{var C;return r&&(C=r.randomBytes)?C=C(i):(C=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(C)),g(C)}catch{var E=o.navigator,S=E&&E.plugins;return[+new Date,o,S,o.screen,g(e)]}}(),3),x),_=new function(C){var E,S=C.length,A=this,D=0,M=A.i=A.j=0,L=A.S=[];for(S||(C=[S++]);D<i;)L[D]=D++;for(D=0;D<i;D++)L[D]=L[M=f&M+C[D%S]+(E=L[D])],L[M]=E;(A.g=function(B){for(var U,G=0,H=A.i,W=A.j,$=A.S;B--;)U=$[H=f&H+1],G=G*i+$[f&($[H]=$[W=f&W+U])+($[W]=U)];return A.i=H,A.j=W,G})(i)}(x),b=function(){for(var C=_.g(a),E=u,S=0;C<c;)C=(C+S)*i,E*=i,S=_.g(1);for(;C>=l;)C/=2,E/=2,S>>>=1;return(C+S)/E};return b.int32=function(){return 0|_.g(4)},b.quick=function(){return _.g(4)/4294967296},b.double=b,p(g(_.S),e),(m.pass||y||function(C,E,S,A){return A&&(A.S&&h(A,_),C.state=function(){return h(_,{})}),S?(t[s]=C,E):C})(b,w,"global"in m?m.global:this==t,m.state)}function h(v,m){return m.i=v.i,m.j=v.j,m.S=v.S.slice(),m}function p(v,m){for(var y,x=v+"",w=0;w<x.length;)m[f&w]=f&(y^=19*m[f&w])+x.charCodeAt(w++);return g(m)}function g(v){return String.fromCharCode.apply(0,v)}if(t["seed"+s]=d,p(t.random(),e),n.exports){n.exports=d;try{r=xo(Object(function(){var m=new Error("Cannot find module 'crypto'");throw m.code="MODULE_NOT_FOUND",m}()))}catch{}}}([],Math)});Fc.alea=afe,Fc.xor128=sfe,Fc.xorwow=ufe,Fc.xorshift7=cfe,Fc.xor4096=lfe,Fc.tychei=ffe;var Nk=Fc.alea,Ok=function(){function n(e,t,r,o,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Nk(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}();function Ct(n,e,t){return void 0===e&&(e="float32"),e=e||"float32",u2(n),new Uh(n,e,t)}var Mk=V({batchToSpaceND_:function Nfe(n,e,t){var r=O(n,"x","batchToSpaceND"),o=e.reduce(function(i,a){return i*a});return P(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),P(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),P(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),N.engine.runKernel(function(i){return i.batchToSpaceND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(e,t)}}})}}),Vfe=V({cast_:function Cfe(n,e){var t=O(n,"x","cast");return N.engine.runKernel(function(r){return r.cast(t,e)},{$x:t},function(r){return{$x:function(){return r.clone()}}})}}),Ufe=V({clone_:function hfe(n){var e=O(n,"x","clone",null);return N.engine.runKernel(function(t){return se.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Hfe=V({cumsum_:function Pfe(n,e,t,r){void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1);var o=O(n,"x","cumsum"),i=Ha([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Wa(1,o.rank)[0],u=N.engine.runKernel(function(c){return c.cumsum(a,s,t,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(e,t,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),Wfe=V({depthToSpace_:function Ffe(n,e,t){void 0===t&&(t="NHWC");var r=O(n,"x","depthToSpace"),o="NHWC"===t?r.shape[1]:r.shape[2],i="NHWC"===t?r.shape[2]:r.shape[3],a="NHWC"===t?r.shape[3]:r.shape[1];return P(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),P(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),P(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),N.engine.runKernel(function(s){return s.depthToSpace(r,e,t)},{$x:r})}}),Ti=V({expandDims_:function kfe(n,e){void 0===e&&(e=0);var t=O(n,"x","expandDims");P(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(P(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),ta(t,r)}}),Pk=V({eye_:function pfe(n,e,t,r){void 0===r&&(r="float32"),null==e&&(e=n);for(var o=Ct([n,e],r),i=n<=e?n:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(n,e);if(null==t)return s;if(1===t.length)return If(Ti(s,0),[t[0],1,1]);if(2===t.length)return If(Ti(Ti(s,0),0),[t[0],t[1],1,1]);if(3===t.length)return If(Ti(Ti(Ti(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Gfe=V({multinomial_:function xfe(n,e,t,r){void 0===r&&(r=!1);var o=O(n,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=1===a?o.as2D(1,-1):o,u=N.engine.runKernel(function(c){return c.multinomial(s,r,e,t)},{logits2D:s});return 1===a?u.as1D():u}}),H2=V({oneHot_:function wfe(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=O(n,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),N.engine.runKernel(function(a){return a.oneHot(o,e,t,r)},{$indices:o},function(a){return{$indices:function(){return zn(o.shape,"float32")}}}).reshape(i)}}),Qh=V({pad_:function Tfe(n,e,t){void 0===t&&(t=0);var r=O(n,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=e.map(function(i){return i[0]});return N.engine.runKernel(function(i){return i.pad(r,e,t)},{$x:r},function(i){return{$x:function(){return i.slice(o,r.shape)}}})}}),zfe=V({pad1d_:function Sfe(n,e,t){return void 0===t&&(t=0),P(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),Qh(n,[e],t)}}),jfe=V({pad2d_:function Afe(n,e,t){return void 0===t&&(t=0),P(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qh(n,e,t)}}),$fe=V({pad3d_:function Ife(n,e,t){return void 0===t&&(t=0),P(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qh(n,e,t)}}),qfe=V({pad4d_:function Dfe(n,e,t){return void 0===t&&(t=0),P(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qh(n,e,t)}}),Xfe=V({rand_:function yfe(n,e,t){var r=Be(n),o=null;if(null==t||"float32"===t)o=new Float32Array(r);else if("int32"===t)o=new Int32Array(r);else{if("bool"!==t)throw new Error("Unknown data type "+t);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return se.make(n,{values:o},t)}}),Kfe=V({randomNormal_:function gfe(n,e,t,r,o){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Ok(e,t,r,!1,o),a=Ct(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Yfe=V({randomUniform_:function mfe(n,e,t,r){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r="float32");for(var o=Ct(n,r),i=0;i<o.values.length;i++)o.values[i]=PP(e,t);return o.toTensor()}}),ta=V({reshape_:function _fe(n,e){var t=O(n,"x","reshape",null);return e=FP(e,t.size),P(t.size===Be(e),function(){return"new shape and old shape must have the same number of elements."}),N.engine.runKernel(function(r){return r.reshape(t,e)},{$x:t},function(r){return{$x:function(){return r.reshape(t.shape)}}})}}),kk=V({spaceToBatchND_:function Ofe(n,e,t){var r=O(n,"x","spaceToBatchND");return P(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),P(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),P(r.shape.reduce(function(o,i,a){return a>0&&a<=e.length?o&&(i+t[a-1][0]+t[a-1][1])%e[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),N.engine.runKernel(function(o){return o.spaceToBatchND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(e,t)}}})}}),Fk=V({squeeze_:function bfe(n,e){var t=O(n,"x","squeeze");return ta(t,xu(t.shape,e).newShape)}}),na=V({stack_:function Rfe(n,e){void 0===e&&(e=0);var t=Wh(n,"tensors","stack");if(P(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===t.length)return t[0].expandDims(e);var o=t[0].shape,i=t[0].dtype;P(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){kt(o,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){P(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return Fo(a,e)}}),If=V({tile_:function Efe(n,e){var t=O(n,"x","tile");return P(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),N.engine.runKernel(function(r,o){var i=r.tile(t,e);return o([t]),i},{$x:t},function(r,o){var i=o[0];return{$x:function(){var a=Ht(i);if(1===i.rank)for(var s=0;s<e[0];++s)a=a.add(r.slice([s*i.shape[0]],[i.shape[0]]));else if(2===i.rank)for(s=0;s<e[0];++s)for(var u=0;u<e[1];++u)a=a.add(r.slice([s*i.shape[0],u*i.shape[1]],[i.shape[0],i.shape[1]]));else if(3===i.rank)for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(var c=0;c<e[2];++c)a=a.add(r.slice([s*i.shape[0],u*i.shape[1],c*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(4!==i.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+i.rank+" tensors yet.");for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(c=0;c<e[2];++c)for(var l=0;l<e[3];++l)a=a.add(r.slice([s*i.shape[0],u*i.shape[1],c*i.shape[2],l*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return a}}})}}),Zfe=V({truncatedNormal_:function vfe(n,e,t,r,o){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Ok(e,t,r,!0,o),a=Ct(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Mr=V({unstack_:function Mfe(n,e){void 0===e&&(e=0),e=e||0;var t=O(n,"x","unstack");return P(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),N.engine.runKernel(function(r){return r.unstack(t,e)},{$x:t},function(r){return{$x:function(){return na(r,e)}}})}});function W2(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var o=Ct(n,"int32"),i=Ct([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=o.indexToLoc(t[r]);i.values.set(a,r*n.length)}return i.toTensor()}var q0={},Bk=function(){function n(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,N.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==e){var t=Va(N.get("WEBGL_VERSION"));this.binaryCache=function Jfe(n){return n in q0||(q0[n]={}),q0[n]}(N.get("WEBGL_VERSION")),this.gpgpu=new vk(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new ole(this.gpgpu)}return n.prototype.register=function(e,t,r){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:r})},n.prototype.setDataMover=function(e){this.texData=new p4(e)},n.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=[e.height,e.width],o=[e.height,e.width,t];if(N.get("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var i=this.makeTensorHandle(r,"int32");this.texData.get(i.dataId).usage=ja.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),e);var a=new uce(o),s=this.compileAndRun(a,[i]);return this.disposeData(i.dataId),s},n.prototype.makeTensorHandle=function(e,t){var r={};return this.register(r,e,t),{dataId:r,shape:e,dtype:t}},n.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");if(N.get("DEBUG"))for(var r=0;r<t.length;r++){var o=t[r];if(!O4(o))throw Error("The value "+o+" cannot be represented on this device.")}var i=this.texData.get(e),a=i.texture,s=i.texShape,u=i.usage,c=i.dtype,l=i.isPacked;if("complex64"===c)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=a&&(this.releaseTexture(e,a,s,u,c,l),i.texture=null,i.texShape=null),i.usage=ja.UPLOAD,i.values=t},n.prototype.readSync=function(e){var t=this.texData.get(e),r=t.values,o=t.dtype,i=t.complexTensors,s=t.shape;if(null!=t.slice){var u=new pt(s,Tk),c=this.compileAndRun(u,[{dataId:e,shape:s,dtype:o}]),l=this.readSync(c.dataId);return c.dispose(),l}if(null!=r)return this.convertAndCacheOnCPU(e);if("string"===o)return r;var f,d,h=null!=this.activeTimers;return h&&(f=performance.now()),d="complex64"===o?v4(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=performance.now()-f),this.convertAndCacheOnCPU(e,d)},n.prototype.read=function(e){return gt(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,d,h,p,g,v,m,y,x,w,_,b,C,E,S;return vt(this,function(A){switch(A.label){case 0:if(this.pendingRead.has(e))return o=this.pendingRead.get(e),[2,new Promise(function(D){return o.push(D)})];if(i=this.texData.get(e),a=i.texture,s=i.values,u=i.texShape,c=i.isPacked,l=i.shape,d=i.dtype,null!=i.slice)return h=new pt(l,Tk),p=this.compileAndRun(h,[{dataId:e,shape:l,dtype:d}]),g=this.read(p.dataId),p.dispose(),[2,g];if(null!=s)return[2,this.convertAndCacheOnCPU(e)];if(this.pendingRead.set(e,[]),!N.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===N.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return v=u[1],m=u[0],c&&(t=Nc(u[0],u[1]),v=t[0],m=t[1]),y=this.gpgpu.maybeCreateBufferFromTexture(a,m,v),[4,this.gpgpu.createAndWaitForFence()];case 1:return A.sent(),y instanceof WebGLTexture?x=this.getValuesFromTexture(e):(w=Be(l),c?(_=Oc(l),b=1,C=1,l.length&&(r=Mc(l),b=r[0],C=r[1]),x=this.gpgpu.downloadPackedMatrixFromBuffer(y,_,b,C,u[0],u[1]).subarray(0,w)):x=this.gpgpu.downloadFloat32MatrixFromBuffer(y,u[0],u[1]).subarray(0,w)),E=this.convertAndCacheOnCPU(e,x),S=this.pendingRead.get(e),this.pendingRead.delete(e),S.forEach(function(D){return D(E)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,E]}})})},n.prototype.getValuesFromTexture=function(e){var t,r=this,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.texture,u=o.texShape,c=Be(i);if(N.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(e).isPacked){var l=Oc(i),f=1,d=1;return i.length&&(f=(t=Mc(i))[0],d=t[1]),this.gpgpu.downloadMatrixFromPackedTexture(s,l,f,d,u[0],u[1]).subarray(0,c)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(s,u[0],u[1]).subarray(0,c)}var h=this.makeTensorHandle(i,"float32");h.size=Be(i),this.texData.get(h.dataId).usage=ja.DOWNLOAD;var p=Ve(function(){var m=new ace(i);return r.compileAndRun(m,[{shape:i,dtype:a,dataId:e}],h,null,!1)}),g=this.texData.get(p.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,c);return this.disposeData(h.dataId),v},n.prototype.time=function(e){return gt(this,void 0,void 0,function(){var t,r,o,i,a,s,u;return vt(this,function(c){switch(c.label){case 0:return t=this.activeTimers,r=[],o=!1,null==this.programTimersStack?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,e(),i=Ac(this.activeTimers.map(function(l){return l.query})).filter(function(l){return null!=l}),a=Ac(this.activeTimers.map(function(l){return l.name})).filter(function(l){return null!=l}),this.activeTimers=t,o&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return s=c.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:MP(s),getExtraProfileInfo:function(){return s.map(function(l,f){return{name:a[f],ms:l}}).map(function(l){return l.name+": "+l.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},n.prototype.endTimer=function(e){return N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},n.prototype.getQueryTime=function(e){return gt(this,void 0,void 0,function(){var t;return vt(this,function(r){return N.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){var t=this.texData.get(e),r=t.texture,o=t.dtype,i=t.texShape,a=t.usage,s=t.complexTensors,u=t.isPacked,c=t.slice;if(null!=r){var l=c&&c.origDataId||e,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),this.releaseTexture(e,r,i,a,o,u),this.texData.delete(e))}null!=s&&(s.real.dispose(),s.imag.dispose())}},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getCPUBackend=function(){return N.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=N.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,t){var r=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(o){return null==r.texData.get(o.dataId).texture&&o.size<t})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.getCanvas=function(){return this.canvas},n.prototype.complex=function(e,t){var r=this.makeOutputArray(e.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:N.engine.keep(e.clone()),imag:N.engine.keep(t.clone())},r},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,r);var o=this.texData.get(e.dataId).isPacked,i=l4(e.shape,t,r);if(o||!i){var a=N.get("WEBGL_PACK_ARRAY_OPERATIONS")?new nle(r):new ele(r),s=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,s)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,r)},n.prototype.shallowSlice=function(e,t,r){var o=this.texData.get(e.dataId),i=se.make(r,{},e.dtype,this),a=this.texData.get(i.dataId);Object.assign(a,o),a.shape=r,a.dtype=e.dtype;var s=f4(t,e.strides);o.slice&&(s+=o.slice.flatOffset),a.slice={flatOffset:s,origDataId:o.slice&&o.slice.origDataId||e.dataId};var u=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,u+1),i},n.prototype.stridedSlice=function(e,t,r,o,i,a,s,u,c){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,r,o,i,a,s,u,c);var l=C2(e.shape,t,r,o,i,a,s,u,c),f=l[0],d=l[1],h=l[2],p=d.filter(function(v,m){return-1===h.indexOf(m)});if(p.some(function(v){return 0===v}))return Sn([],p);var g=new rle(f,o,d,h);return this.compileAndRun(g,[e])},n.prototype.reverse=function(e,t){var r=N.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Zce(e.shape,t):new Yce(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>N.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.concat(e.slice(0,r),t),i=this.concat(e.slice(r),t);return this.concat([o,i],t)}if(N.get("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new jue(e.map(function(l){return l.shape}),t);return this.compileAndRun(a,e)}var s=wf(e.map(function(l){return l.shape}),t),u=e.map(function(l){return l.as2D(-1,Be(l.shape.slice(t)))}),c=new zue(u.map(function(l){return l.shape}));return this.compileAndRun(c,u).reshape(s)},n.prototype.neg=function(e){var t=new pt(e.shape,"return -x;");return this.compileAndRun(t,[e])},n.prototype.batchMatMul=function(e,t,r,o){var i=r?e.shape[2]:e.shape[1],a=o?t.shape[1]:t.shape[2],s=r?e.shape[1]:e.shape[2],u=e.shape[0];if((1===i||1===a)&&s>1e3){r&&(e=e.transpose([0,2,1])),o&&(t=t.transpose([0,2,1]));var c=1===a?e:e.as3D(u,s,1),l=1===a?2:1,f=1===a?t.as3D(u,1,s):t;return this.multiply(c,f).sum(l,!0)}var d=wr(e.dtype,t.dtype),h=new P2(e.shape,[u,i,a],r,o),p=this.makePackedTensor(h.outputShape,d);return this.compileAndRun(h,[e,t],p)},n.prototype.fusedBatchMatMul=function(e,t,r,o,i,a){var s=r?e.shape[2]:e.shape[1],u=o?t.shape[1]:t.shape[2],c=e.shape[0],l=wr(e.dtype,t.dtype),f=new P2(e.shape,[c,s,u],r,o,!!i,a?function ede(n,e){if(void 0===e&&(e=!1),"linear"===n)return"return x;";if("relu"===n)return e?Rk:Ik;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}(a,!0):null),d=this.makePackedTensor(f.outputShape,l),h=[e,t];return i&&h.push(i),this.compileAndRun(f,h,d)},n.prototype.multiply=function(e,t){if("complex64"===e.dtype){var r=this.texData.get(e.dataId),o=this.texData.get(t.dataId),i=new E4("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new E4("return areal * bimag + aimag * breal;",e.shape,t.shape),s=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag),this.makeComplexComponentTensorHandle(t,o.complexTensors.real),this.makeComplexComponentTensorHandle(t,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c);return u.dispose(),c.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,S4,e.dtype);var f=new Nn(S4,e.shape,t.shape),d=this.makeOutputArray(f.outputShape,e.dtype);return this.compileAndRun(f,[e,t],d)},n.prototype.batchNormalization=function(e,t,r,o,i,a){var s=[e,t,r],u=null;null!=a&&(u=a.shape,s.push(a));var c=null;if(null!=i&&(c=i.shape,s.push(i)),N.get("WEBGL_PACK_BATCHNORMALIZATION")){var l=new sue(e.shape,t.shape,r.shape,u,c,o);return this.compileAndRun(l,s)}var f=new aue(e.shape,t.shape,r.shape,u,c,o);return this.compileAndRun(f,s)},n.prototype.localResponseNormalization4D=function(e,t,r,o,i){var a=new Tce(e.shape,t,r,o,i);return this.compileAndRun(a,[e])},n.prototype.LRNGrad=function(e,t,r,o,i,a,s){var u=new Rce(t.shape,o,i,a,s);return this.compileAndRun(u,[t,r,e])},n.prototype.tile=function(e,t){var r=new ile(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.pad=function(e,t,r){var o=N.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Uce(e.shape,t,r):new Vce(e.shape,t,r);return this.compileAndRun(o,[e])},n.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var r=N.get("WEBGL_PACK_ARRAY_OPERATIONS")?new cle(e.shape,t):new sle(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.gather=function(e,t,r){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,r);var o=new cce(e.shape,t.size,r);return this.compileAndRun(o,[e,t])},n.prototype.batchToSpaceND=function(e,t,r){P(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=t.reduce(function(l,f){return l*f}),i=B0(e.shape,t,o),a=V0(i.length,t.length),s=U0(e.shape,t,o),u=i4(r,t.length),c=a4(s,r,t.length);return e.reshape(i).transpose(a).reshape(s).slice(u,c)},n.prototype.spaceToBatchND=function(e,t,r){P(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=t.reduce(function(f,d){return f*d}),i=[[0,0]];i.push.apply(i,r);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var s=e.pad(i),u=B0(s.shape,t,o,!1),c=V0(u.length,t.length,!1),l=U0(s.shape,t,o,!1);return s.reshape(u).transpose(c).reshape(l)},n.prototype.reduce=function(e,t,r){var o=e.shape[0],i=e.shape[1],a=b2(i),s=new Hce({windowSize:a,inSize:i,batchSize:o},t),u=s.outputShape,f=this.makeOutputArray([u[0],u[1]],r);return this.compileAndRun(s,[e],f),1===f.shape[1]?f:this.reduce(f,t,r)},n.prototype.argReduce=function(e,t,r){void 0===r&&(r=null);var o=e.shape[0],i=e.shape[1];null!=r&&(o=r.shape[0],i=r.shape[1]);var a=b2(i),s=new xse({windowSize:a,inSize:i,batchSize:o},t,null==r),u=s.outputShape,f=this.makeOutputArray([u[0],u[1]],"int32"),d=[e];return null!=r&&d.push(r),this.compileAndRun(s,d,f),1===f.shape[1]?f:this.argReduce(e,t,f)},n.prototype.argReducePacked=function(e,t,r){void 0===r&&(r=null);var o=null!=r?r.shape:e.shape,i=b2(o[o.length-1]),a=new oue(o,i,t,null==r),s=this.makePackedTensor(a.outputShape,"int32");return this.compileAndRun(a,null==r?[e]:[e,r],s),s.rank===e.rank?this.argReducePacked(e,t,s):s},n.prototype.sum=function(e,t){ti("sum",t,e.rank);var r=Kr(e.shape,t),o=r[0],i=Be(r[1]),a=e.as2D(-1,i),s=p2(e.dtype);return this.reduce(a,"sum",s).reshape(o)},n.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var r=Kr(e.shape,t),o=r[0],i=Be(r[1]),a=e.as2D(-1,i),s=p2(e.dtype);return this.reduce(a,"prod",s).reshape(o)},n.prototype.unsortedSegmentSum=function(e,t,r){var o=0,i=Ha([o],e.rank),a=e;null!=i&&(a=e.transpose(i),o=Wa(1,e.rank)[0]);var s=function Yae(n,e,t){for(var r=[],o=n.length,i=0;i<o;i++)r.push(i!==e?n[i]:t);return r}(a.shape,o,r),u=Be([a.shape[o]]),c=a.as2D(-1,u),l=p2(e.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",t,l,r).reshape(s);return null!=i&&(f=f.transpose(_2(i))),f},n.prototype.segOpCompute=function(e,t,r,o,i){var a=e.shape[0],s=e.shape[1],u=function Kae(n,e){var t,r=!1;for(n<=c4?(t=n,r=!0):t=k0(n,Math.floor(Math.sqrt(n)));!r;)t>e||t===n?r=!0:t=k0(n,t+1);return t}(s,i),c=new Qce({windowSize:u,inSize:s,batchSize:a,numSegments:i},t),l=c.outputShape,h=this.makeOutputArray([l[0],l[1]],o);return this.compileAndRun(c,[e,r],h),h.shape[1]===i?h:(r=d4(0,i).tile([s/u]),this.segOpCompute(h,t,r,o,i))},n.prototype.argMinMaxReduce=function(e,t,r){var o=[t];if(ti("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,e.rank),!N.get("WEBGL_PACK_REDUCE")||e.rank<=2){var i=Kr(e.shape,o),a=i[0],s=Be(i[1]),u=e.as2D(-1,s);return this.argReduce(u,r).reshape(a)}return this.argReducePacked(e,r)},n.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},n.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},n.prototype.cumsum=function(e,t,r,o){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new rce(e.shape,r,o);return this.compileAndRun(i,[e])},n.prototype.equal=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var r=new Nn("return float(a == b);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.notEqual=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var r=new Nn("return float(a != b);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var r=new Nn("return float(a < b);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.lessEqual=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var r=new Nn("return float(a <= b);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var r=new Nn("return float(a > b);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.greaterEqual=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var r=new Nn("return float(a >= b);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.logicalNot=function(e){var t=new pt(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},n.prototype.logicalAnd=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var r=new Nn("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.logicalOr=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var r=new Nn("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],o)},n.prototype.select=function(e,t,r){var o=new Jce(e.rank,t.shape,t.rank),i=this.makeOutputArray(o.outputShape,wr(t.dtype,r.dtype));return this.compileAndRun(o,[e,t,r],i)},n.prototype.where=function(e){w2("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return W2(e.shape,t)},n.prototype.topk=function(e,t,r){return x4(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){ti("min",t,e.rank);var r=Kr(e.shape,t),o=r[0],i=Be(r[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(o)},n.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds(Vue,e.shape,t.shape):new Nn(wue,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.mod=function(e,t){var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds(Uue,e.shape,t.shape):new Nn("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);ti("max",t,e.rank);var r=Kr(e.shape,t),o=r[0],i=Be(r[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(o)},n.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds(Bue,e.shape,t.shape):new Nn(xue,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.all=function(e,t){ti("all",t,e.rank);var r=Kr(e.shape,t),o=r[0],i=Be(r[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(o)},n.prototype.any=function(e,t){ti("any",t,e.rank);var r=Kr(e.shape,t),o=r[0],i=Be(r[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(o)},n.prototype.squaredDifference=function(e,t){var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds(A4,e.shape,t.shape):new Nn(A4,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.realDivide=function(e,t){var r=new Nn("if (a == b) return 1.0;\n  return a / b;",e.shape,t.shape),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],o)},n.prototype.floorDiv=function(e,t){if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  vec4 resultSign = sign(a) * sign(b);\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  ivec4 result = ia / ib;\n  ivec4 amodb = ia - ib * result;\n\n  // Vectorize INT_DIV\n  // if (resultSign < 0.0 && amodb != 0) result -= 1;\n  // return float(result);\n  return vec4(result -\n     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));\n","int32");var o=new Nn("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",e.shape,t.shape),i=this.makeOutputArray(o.outputShape,"int32");return this.compileAndRun(o,[e,t],i)},n.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,D2);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var r=wr(e.dtype,t.dtype);if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,D2,r);var o=new Nn(D2,e.shape,t.shape),i=this.makeOutputArray(o.outputShape,r);return this.compileAndRun(o,[e,t],i)},n.prototype.packedBinaryOp=function(e,t,r,o){var i=new Ds(r,e.shape,t.shape),a=this.makePackedTensor(i.outputShape,o);return this.compileAndRun(i,[e,t],a)},n.prototype.complexSeparableBinaryOp=function(e,t,r){var o=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),s=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map(function(f){var d=f[0],h=f[1],p=o.makeComplexComponentTensorHandle(e,d),g=o.makeComplexComponentTensorHandle(t,h),v=new Nn(r,e.shape,t.shape),m=o.makeOutputArray(v.outputShape,wr(d.dtype,h.dtype));return o.compileAndRun(v,[p,g],m)}),u=s[0],c=s[1],l=this.complex(u,c);return u.dispose(),c.dispose(),l},n.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},n.prototype.addN=function(e){for(var t=e[0],r=1;r<e.length;r++)t=this.add(t,e[r]);return t},n.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,T2);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var r=wr(e.dtype,t.dtype);if(N.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,T2,e.dtype);var o=new Nn(T2,e.shape,t.shape),i=this.makeOutputArray(o.outputShape,r);return this.compileAndRun(o,[e,t],i)},n.prototype.pow=function(e,t){var r=N.get("WEBGL_PACK_BINARY_OPERATIONS"),o=r?new Ds(Aue,e.shape,t.shape):new Nn("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),i=wr(e.dtype,t.dtype),a=r?this.makePackedTensor(o.outputShape,i):this.makeOutputArray(o.outputShape,i);return this.compileAndRun(o,[e,t],a)},n.prototype.ceil=function(e){var t=new pt(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},n.prototype.floor=function(e){var t=new pt(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},n.prototype.sign=function(e){var t=new pt(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},n.prototype.isNaN=function(e){var t=new pt(e.shape,"return float(isnan(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isInf=function(e){var t=new pt(e.shape,"return float(isinf(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isFinite=function(e){var t=new pt(e.shape,"return float(!isnan(x) && !isinf(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.round=function(e){var t=new pt(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},n.prototype.exp=function(e){var t;return t=N.get("WEBGL_PACK")?new V2(e.shape,Dk):new pt(e.shape,Dk),this.compileAndRun(t,[e])},n.prototype.expm1=function(e){var t=new pt(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},n.prototype.log=function(e){var t;return t=N.get("WEBGL_PACK")?new V2(e.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new pt(e.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(t,[e])},n.prototype.log1p=function(e){var t=new pt(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},n.prototype.sqrt=function(e){var t=new pt(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new pt(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},n.prototype.square=function(e){var t=new pt(e.shape,"return x * x;");return this.compileAndRun(t,[e])},n.prototype.reciprocal=function(e){var t=new pt(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},n.prototype.relu=function(e){var t;return t=N.get("WEBGL_PACK")?new V2(e.shape,Rk):new pt(e.shape,Ik),this.compileAndRun(t,[e])},n.prototype.prelu=function(e,t){var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",e.shape,t.shape):new Nn("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.elu=function(e){var t=new pt(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},n.prototype.eluDer=function(e,t){var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Nn("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.selu=function(e){var t=new pt(e.shape,hle);return this.compileAndRun(t,[e])},n.prototype.int=function(e){var t=new pt(e.shape,"return float(int(x));"),r=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],r)},n.prototype.clip=function(e,t,r){var o,i=(o=N.get("WEBGL_PACK_CLIP")?new Wue(e.shape):new Hue(e.shape)).getCustomSetupFunc(t,r);return this.compileAndRun(o,[e],null,i)},n.prototype.abs=function(e){var t=new pt(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},n.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),r=new Gue(e.shape),o=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(r,o)},n.prototype.sigmoid=function(e){var t=new pt(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},n.prototype.softplus=function(e){var t=new pt(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},n.prototype.sin=function(e){var t=new pt(e.shape,Rle);return this.compileAndRun(t,[e])},n.prototype.cos=function(e){var t=new pt(e.shape,Nle);return this.compileAndRun(t,[e])},n.prototype.tan=function(e){var t=new pt(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},n.prototype.asin=function(e){var t=new pt(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},n.prototype.acos=function(e){var t=new pt(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},n.prototype.atan=function(e){var t=new pt(e.shape,kle);return this.compileAndRun(t,[e])},n.prototype.atan2=function(e,t){var r=N.get("WEBGL_PACK_BINARY_OPERATIONS")?new Ds(Tue,e.shape,t.shape):new Nn(bue,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.sinh=function(e){var t=new pt(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},n.prototype.cosh=function(e){var t=new pt(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},n.prototype.tanh=function(e){var t=new pt(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},n.prototype.asinh=function(e){var t=new pt(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},n.prototype.acosh=function(e){var t=new pt(e.shape,Ule);return this.compileAndRun(t,[e])},n.prototype.atanh=function(e){var t=new pt(e.shape,Hle);return this.compileAndRun(t,[e])},n.prototype.erf=function(e){var t=new pt(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(t,[e])},n.prototype.step=function(e,t){var r=new pt(e.shape,function ple(n){return void 0===n&&(n=0),Pc+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "}(t));return this.compileAndRun(r,[e])},n.prototype.conv2dByMatMul=function(e,t,r){var o=e.shape,i=this.texData.get(e.dataId),l=o[2]%2!=0&&!!i.isPacked;if((1==o[0]*o[1]*o[2]||1===r.outChannels)&&r.inChannels>1e3||!N.get("WEBGL_LAZILY_UNPACK")||!N.get("WEBGL_PACK_BINARY_OPERATIONS")||!l){var f=this.reshape(e,[1,o[0]*o[1]*o[2],r.inChannels]),d=this.reshape(t,[1,r.inChannels,r.outChannels]);return this.reshape(this.batchMatMul(f,d,!1,!1),r.outShape)}var h=se.make([1,o[0]*o[1]*(o[2]+1),r.inChannels],{dataId:e.dataId},e.dtype,this),p=i.shape;i.shape=i.shape.slice(),i.shape[i.shape.length-2]++,P(Yh(i.shape,h.shape),function(){return"packed reshape "+i.shape+" to "+h.shape+" isn't free"});var g=this.reshape(t,[1,r.inChannels,r.outChannels]),v=this.batchMatMul(h,g,!1,!1),m=this.texData.get(v.dataId);return P(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),i.shape=p,m.shape=r.outShape,se.make(r.outShape,{dataId:v.dataId},v.dtype,this)},n.prototype.conv2dWithIm2Row=function(e,t,r){var s=r.outWidth,u=r.outHeight,c=r.filterWidth*r.filterHeight*r.inChannels,l=u*s,f=[c,l],d=e.squeeze([0]),h=t.reshape([1,c,-1]),p=new Dce(f,d.shape,r),g=this.compileAndRun(p,[d]).reshape([1,f[0],f[1]]),v=new P2(g.shape,[1,l,r.outChannels],!0,!1);return this.compileAndRun(v,[g,h]).reshape([1,u,s,r.outChannels])},n.prototype.conv2d=function(e,t,r){if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,t,r);if(N.get("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,r);var o=new Que(r);return this.compileAndRun(o,[e,t])},n.prototype.conv2dDerInput=function(e,t,r){var o=new que(r);return this.compileAndRun(o,[e,t])},n.prototype.conv2dDerFilter=function(e,t,r){var o=new $ue(r);return this.compileAndRun(o,[e,t])},n.prototype.depthwiseConv2D=function(e,t,r){var o;return N.get("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(o=new tce(r),this.compileAndRun(o,[e,t],this.makePackedTensor(r.outShape,e.dtype))):(o=new ece(r),this.compileAndRun(o,[e,t]))},n.prototype.depthwiseConv2DDerInput=function(e,t,r){var o=new Zue(r);return this.compileAndRun(o,[e,t])},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){var o=new Yue(r);return this.compileAndRun(o,[e,t])},n.prototype.conv3d=function(e,t,r){var o=new Jue(r);return this.compileAndRun(o,[e,t])},n.prototype.conv3dDerInput=function(e,t,r){var o=new Kue(r);return this.compileAndRun(o,[e,t])},n.prototype.conv3dDerFilter=function(e,t,r){var o=new Xue(r);return this.compileAndRun(o,[e,t])},n.prototype.maxPool=function(e,t){var r=new k2(t,"max",!1),o=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],o)},n.prototype.avgPool=function(e,t){var r=new k2(t,"avg",!1),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e],o)},n.prototype.maxPoolBackprop=function(e,t,r,o){var i=new k2(o,"max",!0),a=this.compileAndRun(i,[t]),s=new Nce(o),u=this.makeOutputArray(s.outputShape,t.dtype),c=this.compileAndRun(s,[e,a],u);return a.dispose(),c},n.prototype.avgPoolBackprop=function(e,t,r){var o=new iue(r),i=this.makeOutputArray(o.outputShape,t.dtype);return this.compileAndRun(o,[e],i)},n.prototype.cast=function(e,t){return g4(e,t,this)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],o=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(o[i++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var c=new Array(r);for(a=0;a<c.length;a++)s[t]=a,c[a]=this.slice(e,s,u).reshape(o);return c},n.prototype.reshape=function(e,t){var r=this.texData.get(e.dataId);return!r.isPacked||Yh(e.shape,t)||null!==r.texture&&Yh(r.shape,t)?S2(e,t):this.packedReshape(e,t)},n.prototype.resizeBilinear=function(e,t,r,o){var i=N.get("WEBGL_PACK_IMAGE_OPERATIONS")?new qce(e.shape,t,r,o):new $ce(e.shape,t,r,o);return this.compileAndRun(i,[e])},n.prototype.resizeBilinearBackprop=function(e,t,r){var o=new jce(e,t,r);return this.compileAndRun(o,[e])},n.prototype.resizeNearestNeighbor=function(e,t,r,o){var i=new Kce(e.shape,t,r,o);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){var o=new Xce(e,t,r);return this.compileAndRun(o,[e])},n.prototype.multinomial=function(e,t,r,o){var i=t?e:Cu(e),u=new Oce(i.shape[0],i.shape[1],r),c=this.makeOutputArray(u.outputShape,"int32"),l=u.getCustomSetupFunc(o);return this.compileAndRun(u,[i],c,l)},n.prototype.oneHot=function(e,t,r,o){var i=new Mce(e.size,t,r,o);return this.compileAndRun(i,[e])},n.prototype.nonMaxSuppression=function(e,t,r,o,i){return w2("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),A2(e.dataSync(),t.dataSync(),r,o,i)},n.prototype.cropAndResize=function(e,t,r,o,i,a){var s=new nce(e.shape,t.shape,o,i,a);return this.compileAndRun(s,[e,t,r])},n.prototype.depthToSpace=function(e,t,r){P(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var o=e.shape[0],u=("NHWC"===r?e.shape[1]:e.shape[2])*t,c=("NHWC"===r?e.shape[2]:e.shape[3])*t,l=("NHWC"===r?e.shape[3]:e.shape[1])/(t*t),f=new ice("NHWC"===r?[o,u,c,l]:[o,l,u,c],t,r);return this.compileAndRun(f,[e])},n.prototype.split=function(e,t,r){return y4(e,t,r)},n.prototype.scatterND=function(e,t,r){var o=H0(0,e,r),i=o.sliceRank,a=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize,l=[c/s,s],f=e.reshape([a,i]),d=t.reshape([a,s]);if(0===c)return S2(Sn([]),r);var h=oe(0),p=new yk(a,i,f.rank,d.rank,u,l);return this.compileAndRun(p,[d,f,h]).reshape(r)},n.prototype.sparseToDense=function(e,t,r,o){var i=H0(0,e,r),l=new yk(i.numUpdates,i.sliceRank,e.rank,t.rank,i.strides,[i.outputSize,1],!1);return this.compileAndRun(l,[t,e,o]).reshape(r)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,t){var r=this.texData.get(e.dataId),o=new T4("return real * expR - imag * expI;",e.shape,t),i=new T4("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),c=this.complex(s,u).as2D(e.shape[0],e.shape[1]);return s.dispose(),u.dispose(),c},n.prototype.gatherND=function(e,t){var r=t.shape,o=r[r.length-1],i=u4(e,t),a=i[0],s=i[1],u=i[2],c=i[3],l=t.reshape([s,o]),f=e.reshape([e.size/u,u]),d=new fce(o,c,[s,u]);return this.compileAndRun(d,[f,l]).reshape(a)},n.prototype.fill=function(e,t,r){if("string"===(r=r||yf(t))){var o=Ph(r,Be(e));return o.fill(t),se.make(e,{values:o},r)}var i=new sce(e,t),a=i.getCustomSetupFunc(t),s=this.makeOutputArray(e,r);return this.compileAndRun(i,[],s,a)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},n.prototype.makeOutputArray=function(e,t){return se.make(e,{},t,this)},n.prototype.makePackedTensor=function(e,t){var r=se.make(e,{},t,this);return this.texData.get(r.dataId).isPacked=!0,r},n.prototype.unpackTensor=function(e){var t=new Kle(e.shape);return this.compileAndRun(t,[e],se.make(t.outputShape,{},e.dtype,this))},n.prototype.packTensor=function(e){var t=new Pce(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype))},n.prototype.packedReshape=function(e,t){var r=e.reshape([Oc(e.shape)].concat(Mc(e.shape))),o=[Oc(t)].concat(Mc(t)),i=new Wce(o,r.shape);return this.compileAndRun(i,[r]).reshape(t)},n.prototype.compileAndRun=function(e,t,r,o,i){var a=this;if(void 0===i&&(i=!0),null==r&&(r=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),0===r.size)return this.texData.get(r.dataId).values=P0(r.dtype,0),r;var s=t.map(function(x){if("complex64"===x.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=a.texData.get(x.dataId);if(null==w.texture){if(!e.usesPackedTextures&&Be(x.shape)<=N.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:a.readSync(x.dataId)};e.usesPackedTextures&&(w.isPacked=!0,w.shape=x.shape)}else if(!!w.isPacked!=!!e.usesPackedTextures)x=w.isPacked?a.unpackTensor(x):a.packTensor(x),w=a.texData.get(x.dataId);else if(w.isPacked&&!Yh(w.shape,x.shape)){var _=x,b=x.shape;x.shape=w.shape,x=a.packedReshape(x,b),w=a.texData.get(x.dataId),_.shape=b}return a.uploadToGPU(x.dataId),{shape:x.shape,texData:w,isUniform:!1}});this.uploadToGPU(r.dataId);var u,c={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},l=function Ice(n,e,t){var r="";return e.concat(t).forEach(function(a){r+=a.shape+"_"+(a.isUniform?"uniform":a.texData.texShape)+"_"+(null!=a.texData&&null!=a.texData.slice&&a.texData.slice.flatOffset>0)}),n.constructor.name+"_"+r+"_"+n.userCode}(e,s,c),f=this.getAndSaveBinary(l,function(){return function Sce(n,e,t,r){var o=e.userCode,i=t.map(function(g,v){var m={logicalShape:g.shape,texShape:g.isUniform?null:g.texData.texShape,isUniform:g.isUniform,isPacked:!g.isUniform&&g.texData.isPacked,flatOffset:null};return null!=g.texData&&null!=g.texData.slice&&g.texData.slice.flatOffset>0&&(m.flatOffset=g.texData.slice.flatOffset),{name:e.variableNames[v],shapeInfo:m}}),a=i.map(function(g){return g.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=bse(i,s,o,e.usesPackedTextures),c=n.createProgram(u),l=null,f=null;1===N.get("WEBGL_VERSION")&&(l=n.getUniformLocation(c,"INFINITY",!1),f=n.getUniformLocation(c,"NAN",!1));for(var d={},h=0;h<e.variableNames.length;h++){var p=e.variableNames[h];d[p]=n.getUniformLocation(c,p,!1),d["offset"+p]=n.getUniformLocation(c,"offset"+p,!1)}return{program:e,source:u,webGLProgram:c,uniformLocations:d,inShapeInfos:a,outShapeInfo:s,infLoc:l,nanLoc:f}}(a.gpgpu,e,s,c)}),d=null!=this.activeTimers;d&&(u=this.startTimer()),function Ace(n,e,t,r,o){mk(e.inShapeInfos,t),mk([e.outShapeInfo],[r]);var i=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i,a[0],a[1]):n.setOutputMatrixTexture(i,a[0],a[1]),n.setProgram(e.webGLProgram),1===N.get("WEBGL_VERSION")&&(null!==e.infLoc&&n.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&n.gl.uniform1f(e.nanLoc,NaN)),t.forEach(function(s,u){var c=e.program.variableNames[u],l=e.uniformLocations[c],f=e.uniformLocations["offset"+c];if(null!=l)if(s.isUniform)if(Be(s.shape)<2)n.gl.uniform1f(l,s.uniformValues[0]);else{var d=s.uniformValues;d instanceof Float32Array||(d=new Float32Array(d)),n.gl.uniform1fv(l,d)}else null!=s.texData.slice&&null!=f&&n.gl.uniform1i(f,s.texData.slice.flatOffset),n.setInputMatrixTexture(s.texData.texture,l,u)}),o?.(n,e.webGLProgram),n.executeProgram()}(this.gpgpu,f,s,c,o);var h=1024*N.get("WEBGL_NUM_MB_BEFORE_PAGING");if(i&&this.numBytesInGPU>h)for(var p=this.numBytesInGPU-h;p>0&&this.lruDataGPU.length>0;){var g=this.lruDataGPU.shift(),v=this.texData.get(g);p-=this.computeBytes(v.texShape,v.dtype),this.read(g)}return d&&(u=this.endTimer(u),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(u)})),N.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(r.dataId).isPacked||e.isPackShader?r:this.unpackTensor(r)},n.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return Ve(function(){var t=N.get("DEBUG");N.set("DEBUG",!1);var r=e.abs(oe(1e-8)).dataSync()[0];return N.set("DEBUG",t),r>0?32:16})},n.prototype.uploadToGPU=function(e){var t,r=this.texData.get(e),o=r.shape,i=r.dtype,a=r.values,u=r.usage,c=r.isPacked;if(null==r.texture){var l,f=null!=this.activeTimers;f&&(l=performance.now());var d=K4(o,c);r.texShape=d;var h=this.acquireTexture(e,d,u,i,c);if(r.texture=h,null!=a){if(c){var p=Oc(o),g=1,v=1;o.length&&(g=(t=Mc(o))[0],v=t[1]),this.gpgpu.uploadMatrixToPackedTexture(h,p,g,v,d[0],d[1],Vk(a))}else this.gpgpu.uploadMatrixToTexture(h,d[0],d[1],Vk(a));r.values=null,f&&(this.uploadWaitMs+=performance.now()-l)}}else N.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(e)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(e),1),this.lruDataGPU.push(e))},n.prototype.convertAndCacheOnCPU=function(e,t){var r=this.texData.get(e),o=r.texture,a=r.dtype;return null!=o&&(this.releaseTexture(e,o,r.texShape,r.usage,a,r.isPacked),r.texture=null,r.texShape=null,r.isPacked=!1),r.usage=ja.UPLOAD,null!=t&&(r.values=function nde(n,e){if("float32"===e||"complex64"===e)return n;if("int32"===e||"bool"===e){for(var t="int32"===e?new Int32Array(n.length):new Uint8Array(n.length),r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}throw new Error("Unknown dtype "+e)}(t,a)),r.values},n.prototype.releaseTexture=function(e,t,r,o,i,a){if(N.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var s=this.lruDataGPU.indexOf(e);s>=0&&this.lruDataGPU.splice(s,1)}this.numBytesInGPU-=this.computeBytes(r,i),this.textureManager.releaseTexture(t,r,o,a)},n.prototype.acquireTexture=function(e,t,r,o,i){return N.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(e),this.numBytesInGPU+=this.computeBytes(t,o),this.textureManager.acquireTexture(t,r,i)},n.prototype.computeBytes=function(e,t){return e[0]*e[1]*o2(t)},n}();function Vk(n){return n instanceof Float32Array?n:new Float32Array(n)}N.get("IS_BROWSER")&&N.registerBackend("webgl",function(){return new Bk},2);var Bde=V({abs_:function xde(n){var e=O(n,"x","abs");return"complex64"===e.dtype?N.engine.runKernel(function(t){return t.complexAbs(e)},{$x:e}):N.engine.runKernel(function(t,r){var o=t.abs(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.toFloat().step(-1))}}})}}),Vde=V({acos_:function Dde(n){var e=O(n,"x","acos");return N.engine.runKernel(function(t,r){var o=t.acos(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(oe(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),Ude=V({acosh_:function Pde(n){var e=O(n,"x","acosh");return N.engine.runKernel(function(t,r){var o=t.acosh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),Hde=V({asin_:function Ide(n){var e=O(n,"x","asin");return N.engine.runKernel(function(t,r){var o=t.asin(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(oe(1).sub(o.toFloat().square()).sqrt())}}})}}),Wde=V({asinh_:function Mde(n){var e=O(n,"x","asinh");return N.engine.runKernel(function(t,r){var o=t.asinh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(oe(1).add(o.toFloat().square()).sqrt())}}})}}),Gde=V({atan_:function Tde(n){var e=O(n,"x","atan");return N.engine.runKernel(function(t,r){var o=t.atan(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().square().add(1))}}})}}),zde=V({atanh_:function kde(n){var e=O(n,"x","atanh");return N.engine.runKernel(function(t,r){var o=t.atanh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(oe(1).sub(o.toFloat().square()))}}})}}),jde=V({ceil_:function ode(n){var e=O(n,"x","ceil");return N.engine.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),G2=V({clipByValue_:function wde(n,e,t){var r=O(n,"x","clipByValue");return P(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),N.engine.runKernel(function(o,i){var a=o.clip(r,e,t);return i([r]),a},{$x:r},function(o,i){var a=i[0];return{$x:function(){return o.where(a.greaterEqual(e).logicalAnd(a.lessEqual(t)),Ht(o))}}})}}),$de=V({cos_:function Sde(n){var e=O(n,"x","cos");return N.engine.runKernel(function(t,r){var o=t.cos(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return o.toFloat().sin().neg().mul(t)}}})}}),qde=V({cosh_:function Nde(n){var e=O(n,"x","cosh");return N.engine.runKernel(function(t,r){var o=t.cosh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(t)}}})}}),Xde=V({erf_:function Fde(n){var e=O(n,"x","erf");return P("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),N.engine.runKernel(function(t,r){var o=t.erf(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),z2=V({exp_:function fde(n){var e=O(n,"x","exp");return N.engine.runKernel(function(t,r){var o=t.exp(e);return r([o]),o},{$x:e},function(t,r){return{$x:function(){return t.mulStrict(r[0])}}})}}),Kde=V({expm1_:function dde(n){var e=O(n,"x","expm1");return N.engine.runKernel(function(t,r){var o=t.expm1(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.exp())}}})}}),Yde=V({floor_:function ide(n){var e=O(n,"x","floor");return N.engine.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),Zde=V({log_:function hde(n){var e=O(n,"x","log");return N.engine.runKernel(function(t,r){var o=t.log(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat())}}})}}),Qde=V({log1p_:function pde(n){var e=O(n,"x","log1p");return N.engine.runKernel(function(t,r){var o=t.log1p(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.add(1))}}})}}),Jde=V({logSigmoid_:function bde(n){var e=O(n,"x","logSigmoid");return N.engine.runKernel(function(t,r){var o=t.softplus(e.neg()).neg();return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.neg().sigmoid())}}})}}),X0=V({neg_:function rde(n){var e=O(n,"x","neg");return N.engine.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),ehe=V({reciprocal_:function yde(n){var e=O(n,"x","reciprocal");return N.engine.runKernel(function(t,r){var o=t.reciprocal(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.square().neg())}}})}}),the=V({round_:function lde(n){var e=O(n,"x","round");return N.engine.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),Uk=V({rsqrt_:function vde(n){var e=O(n,"x","rsqrt");return N.engine.runKernel(function(t,r){var o=t.rsqrt(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.pow(1.5).mul(2)).neg()}}})}}),Hk=V({sigmoid_:function _de(n){var e=O(n,"x","sigmoid");return N.engine.runKernel(function(t,r){var o=t.sigmoid(e);return r([o]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.mul(oe(1).sub(o)))}}})}}),nhe=V({sign_:function ade(n){var e=O(n,"x","sign");return N.engine.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),rhe=V({isNaN_:function sde(n){var e=O(n,"x","isNaN");return N.engine.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),ohe=V({isInf_:function ude(n){var e=O(n,"x","isInf");return N.engine.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),ihe=V({isFinite_:function cde(n){var e=O(n,"x","isFinite");return N.engine.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Ht(t)}}})}}),ahe=V({sin_:function Ede(n){var e=O(n,"x","sin");return N.engine.runKernel(function(t,r){var o=t.sin(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return o.toFloat().cos().mul(t)}}})}}),she=V({sinh_:function Rde(n){var e=O(n,"x","sinh");return N.engine.runKernel(function(t,r){var o=t.sinh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(t)}}})}}),uhe=V({softplus_:function Cde(n){var e=O(n,"x","softplus");return N.engine.runKernel(function(t,r){var o=t.softplus(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.sigmoid())}}})}}),che=V({sqrt_:function gde(n){var e=O(n,"x","sqrt");return N.engine.runKernel(function(t,r){var o=t.sqrt(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().sqrt().mul(2))}}})}}),lhe=V({square_:function mde(n){var e=O(n,"x","square");return N.engine.runKernel(function(t,r){return r([e]),t.square(e)},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.toFloat().mul(2))}}})}}),fhe=V({step_:function Lde(n,e){void 0===e&&(e=0);var t=O(n,"x","step");return N.engine.runKernel(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Ht(r)}}})}}),dhe=V({tan_:function Ade(n){var e=O(n,"x","tan");return N.engine.runKernel(function(t,r){var o=t.tan(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.cos().square())}}})}}),hhe=V({tanh_:function Ode(n){var e=O(n,"x","tanh");return N.engine.runKernel(function(t,r){var o=t.tanh(e);return r([o]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return oe(1).sub(o.square()).mulStrict(t)}}})}});function Wk(n,e,t,r,o,i){var a,s,u=O(n,"x","batchNorm"),c=O(e,"mean","batchNorm"),l=O(t,"variance","batchNorm");return null!=o&&(a=O(o,"scale","batchNorm")),null!=r&&(s=O(r,"offset","batchNorm")),P(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),P(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),P(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&P(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&P(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Jh(u,c,l,s,a,i)}function Gk(n,e,t,r,o,i){var a,s,u=O(n,"x","batchNorm"),c=O(e,"mean","batchNorm"),l=O(t,"variance","batchNorm");return null!=o&&(a=O(o,"scale","batchNorm")),null!=r&&(s=O(r,"offset","batchNorm")),P(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),P(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),P(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&P(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&P(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Jh(u,c,l,s,a,i)}function zk(n,e,t,r,o,i){var a,s,u=O(n,"x","batchNorm"),c=O(e,"mean","batchNorm"),l=O(t,"variance","batchNorm");return null!=o&&(a=O(o,"scale","batchNorm")),null!=r&&(s=O(r,"offset","batchNorm")),P(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),P(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),P(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&P(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&P(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Jh(u,c,l,s,a,i)}function Jh(n,e,t,r,o,i){null==i&&(i=.001);var a,s,u,c=O(n,"x","batchNorm"),l=O(e,"mean","batchNorm"),f=O(t,"variance","batchNorm");return null!=o&&(a=O(o,"scale","batchNorm")),null!=r&&(s=O(r,"offset","batchNorm")),P(l.rank===f.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),P(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),P(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,N.engine.runKernel(function(d,h){var p=d.batchNormalization(u,K0(l),K0(f),i,K0(a),K0(s));return h([c,l,f,a]),p},{$x:c,$mean:l,$variance:f,$scale:a,$offset:s},function(d,h){var p=h[0],g=h[1],v=h[2],y=h[3]??oe(1),x=hr(g.shape,u.shape),w=[];if(1===g.rank){for(var _=0;_<u.shape.length-1;++_)w.push(u.shape[_]);w.push(1)}var b=p.sub(g),C=d.mul(y),E=Uk(v.add(oe(i))),S=E.mul(E).mul(E).mul(oe(-.5));return{$x:function(){return 1===g.rank?d.mul(If(E.as4D(1,1,1,g.shape[0]),w)).mul(y).reshape(p.shape):d.mul(E).mul(y).reshape(p.shape)},$mean:function(){var A=E.mul(oe(-1)).mul(C);return 1===g.rank&&(A=A.sum(x)),A.reshape(g.shape)},$variance:function(){var A=S.mul(b).mul(C);return 1===g.rank&&(A=A.sum(x)),A.reshape(g.shape)},$scale:function(){var A=b.mul(E),D=d.mul(A);return 1===g.rank&&(D=D.sum(x)),D.reshape(g.shape)},$offset:function(){var A=d;return 1===g.rank&&(A=A.sum(x)),A.reshape(g.shape)}}}).reshape(c.shape)}function K0(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Y0(){x2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var yhe=V({batchNormalization2d_:function ghe(n,e,t,r,o,i){return void 0===r&&(r=.001),Y0(),Wk(n,e,t,i,o,r)}}),xhe=V({batchNormalization3d_:function vhe(n,e,t,r,o,i){return void 0===r&&(r=.001),Y0(),Gk(n,e,t,i,o,r)}}),whe=V({batchNormalization4d_:function mhe(n,e,t,r,o,i){return void 0===r&&(r=.001),Y0(),zk(n,e,t,i,o,r)}}),_he=V({batchNormalization_:function phe(n,e,t,r,o,i){return void 0===r&&(r=.001),Y0(),Jh(n,e,t,i,o,r)}}),jk=V({batchNorm_:Jh}),bhe=V({batchNorm2d_:Wk}),Che=V({batchNorm3d_:Gk}),Ehe=V({batchNorm4d_:zk});function ep(n,e,t,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=Z0(e),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,n[3],n[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,n[1],n[1]]}return tp(n,s,t,r,o,i,!1,a)}function tp(n,e,t,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3];if("channelsLast"===s)c=n[0],l=n[1],f=n[2],d=n[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=n[0],d=n[1],l=n[2],f=n[3]}var h,p=e[0],g=e[1],v=e[3],m=Z0(t),y=m[0],x=m[1],w=Z0(r),_=w[0],b=w[1],C=Df(p,_),E=Df(g,b),S=function Ihe(n,e,t,r,o,i,a,s){var u,c,l;if("number"==typeof n){u={top:n,bottom:n,left:n,right:n,type:0===n?"VALID":"NUMBER"};var f=function She(n,e,t,r,o,i){null==o&&(o=function Ahe(n,e,t,r){void 0===r&&(r=1);var o=Df(e,r);return Math.floor((n[0]*(t-1)-t+o)/2)}(n,e,r));var s=n[1],u=qk((n[0]-e+2*o)/r+1,i);P(Po(u),function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var c=qk((s-e+2*o)/r+1,i);return P(Po(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,c,t]}([e,t,1],i,1,r,n,s);c=f[0],l=f[1]}else if("same"===n){c=Math.ceil(e/r),l=Math.ceil(t/o);var d=Math.max(0,(c-1)*r+i-e),h=Math.max(0,(l-1)*o+a-t),p=Math.floor(d/2),g=d-p,v=Math.floor(h/2);u={top:p,bottom:g,left:v,right:h-v,type:"SAME"}}else{if("valid"!==n)throw Error("Unknown padding parameter: "+n);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/r),l=Math.ceil((t-a+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,f,y,x,C,E,i),D=S.outHeight,M=S.outWidth,L=a?v*d:v;return"channelsFirst"===s?h=[c,L,D,M]:"channelsLast"===s&&(h=[c,D,M,L]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:d,outHeight:D,outWidth:M,outChannels:L,padInfo:S.padInfo,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:_,dilationWidth:b,inShape:n,outShape:h,filterShape:e}}function j2(n,e,t,r,o,i,a){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],c=s[1],l=s[2],f=s[3],d=s[4];if("channelsLast"===a)u=n[0],c=n[1],l=n[2],f=n[3],d=n[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=n[0],d=n[1],c=n[2],l=n[3],f=n[4]}var h,p=e[0],g=e[1],v=e[2],m=e[4],y=$k(t),x=y[0],w=y[1],_=y[2],b=$k(r),C=b[0],E=b[1],S=b[2],A=function Dhe(n,e,t,r,o,i,a,s,u,c){var l,f,d,h;if("same"===n){var p=((f=Math.ceil(e/o))-1)*o+s-e,g=((d=Math.ceil(t/i))-1)*i+u-t,v=((h=Math.ceil(r/a))-1)*a+c-r,m=Math.floor(p/2),y=p-m,x=Math.floor(g/2),w=g-x,_=Math.floor(v/2);l={top:x,bottom:w,left:_,right:v-_,front:m,back:y,type:"SAME"}}else{if("valid"!==n)throw Error("Unknown padding parameter: "+n);l={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((e-s+1)/o),d=Math.ceil((t-u+1)/i),h=Math.ceil((r-c+1)/a)}return{padInfo:l,outDepth:f,outHeight:d,outWidth:h}}(o,c,l,f,x,w,_,Df(p,C),Df(g,E),Df(v,S)),M=A.outDepth,L=A.outHeight,B=A.outWidth,U=i?m*d:m;return"channelsFirst"===a?h=[u,U,M,L,B]:"channelsLast"===a&&(h=[u,M,L,B,U]),{batchSize:u,dataFormat:a,inDepth:c,inHeight:l,inWidth:f,inChannels:d,outDepth:M,outHeight:L,outWidth:B,outChannels:U,padInfo:A.padInfo,strideDepth:x,strideHeight:w,strideWidth:_,filterDepth:p,filterHeight:g,filterWidth:v,dilationDepth:C,dilationHeight:E,dilationWidth:S,inShape:n,outShape:h,filterShape:e}}function Z0(n){return"number"==typeof n?[n,n]:n}function $k(n){return"number"==typeof n?[n,n,n]:n}function Df(n,e){return e<=1?n:n+(n-1)*(e-1)}function qk(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function Q0(n){var e=Z0(n);return 1===e[0]&&1===e[1]}function Su(n,e){return Q0(n)||Q0(e)}function Xk(n,e,t,r,o,i){P(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,s=e,u=!1;3===e.rank&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]);var c=a[3],l=s.shape[3];P(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),P(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),P(4===t.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}),P(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),P(l===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[3]+"."}),null!=i&&P(Po(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=tp(a,t.shape,r,1,o,i),d=N.engine.runKernel(function(h,p){var g=h.conv2dDerInput(s,t,f);return p([t,s]),g},{dy4D:s,filter:t},function(h,p){var g=p[0],v=p[1];return{dy4D:function(){return Rs(h,g,r,o,"NHWC",1,i)},filter:function(){return Yk(h,v,g.shape,r,o,i)}}});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Kk(n,e,t,r,o,i){var a=n;3===n.rank&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),P(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),P(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),P(4===t.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),P(a.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+t[2]+"."}),P(s.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+t[3]+")."}),null!=i&&P(Po(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var u=tp(a.shape,t,r,1,o,i);return N.engine.runKernel(function(c){return c.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function $2(n){var e=function Phe(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}(n);return 1===e[0]&&1===e[1]&&1===e[2]}var Hhe=V({conv1d_:function The(n,e,t,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=O(n,"x","conv1d"),u=O(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),P(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),P(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&P(Po(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),P(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),P(Su(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+i+"'"}),P("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Rs(d,f,[1,t],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Rs=V({conv2d_:function Rhe(n,e,t,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=O(n,"x","conv2d"),u=O(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),P(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),P(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&P(Po(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),P(c.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+c.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),P(Su(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),P("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var f=tp(c.shape,u.shape,t,i,r,a),d=N.engine.runKernel(function(h,p){var g=h.conv2d(c,u,f);return p([u,c]),g},{x:c,$filter:u},function(h,p){var v=p[0],m=p[1];return P(Q0(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return Xk(m.shape,h,v,t,r)},$filter:function(){return Kk(m,h,v.shape,t,r)}}});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),Whe=V({conv3d_:function Bhe(n,e,t,r,o,i){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1,1]);var a=O(n,"x","conv3d"),s=O(e,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),P(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),P(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),P(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),P(function khe(n,e){return $2(n)||$2(e)}(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),P("NHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported."});var l=j2(u.shape,s.shape,t,i,r),f=N.engine.runKernel(function(d,h){var p=d.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(d,h){P($2(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],g=h[1];return{x:function(){return function Vhe(n,e,t,r,o){P(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var i=n,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=a.shape[4];P(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),P(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),P(5===t.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),P(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),P(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."});var l=j2(i,t.shape,r,1,o),f=N.engine.runKernel(function(d){return d.conv3dDerInput(a,t,l)},{dy5D:a});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(p.shape,d,g,t,r)},$filter:function(){return function Uhe(n,e,t,r,o){var i=n;4===n.rank&&(i=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),P(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),P(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),P(5===t.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+t+"."}),P(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+t[3]+"."}),P(a.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+t[4]+")."});var s=j2(i.shape,t,r,1,o);return N.engine.runKernel(function(u){return u.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(p,d,g.shape,t,r)}}});return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Yk=V({conv2dDerFilter_:Kk}),q2=V({depthwiseConv2d_:function Ohe(n,e,t,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=O(n,"x","depthwiseConv2d"),u=O(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),P(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),P(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),P(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),P(Su(t,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),null!=a&&P(Po(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f=tp(c.shape,u.shape,t,i,r,a,!0),d=N.engine.runKernel(function(h,p){var g=h.depthwiseConv2D(c,u,f);return p([c,u]),g},{x:c,$filter:u},function(h,p){P(Q0(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var g=p[0],v=p[1];return{x:function(){return function Fhe(n,e,t,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=N.engine.runKernel(function(s){return s.depthwiseConv2DDerInput(o,t,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(0,h,v,f)},$filter:function(){return function Lhe(n,e,t,r){var o=n;3===n.rank&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),N.engine.runKernel(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}(g,h,0,f)}}});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),Zk=V({separableConv2d_:function Mhe(n,e,t,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=O(n,"x","separableConv2d"),u=O(e,"depthwiseFilter","separableConv2d"),c=O(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");P(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),P(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),P(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),P(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),P(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],h=u.shape[3];P(c.shape[2]===d*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+c.shape[2]+"."});var p=q2(l,u,r,o,a,i),g=Rs(p,c,1,"valid",a);return f?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),Ghe=V({conv2dTranspose_:function Nhe(n,e,t,r,o,i){return Xk(t,O(n,"x","conv2dTranspose"),O(e,"filter","conv2dTranspose"),r,o,i)}}),X2=V({matMul_:function zhe(n,e,t,r){var o;void 0===t&&(t=!1),void 0===r&&(r=!1);var i=O(n,"a","matMul"),a=O(e,"b","matMul");o=Qn(i,a),i=o[0],a=o[1];var s=t?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=t?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=i.shape.slice(0,-2),d=a.shape.slice(0,-2),h=Be(f),p=Be(d);P(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),P(Or(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),P(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var g=i.shape.slice(0,-2).concat([c,l]),v=t?i.as3D(h,s,c):i.as3D(h,c,s),m=r?a.as3D(p,l,u):a.as3D(p,u,l);return N.engine.runKernel(function(y,x){var w=y.batchMatMul(v,m,t,r);return x([v,m]),w},{$a:v,$b:m},function(y,x){var _=x[0],b=x[1];return t||r?!t&&r?{$a:function(){return y.matMul(b,!1,!1)},$b:function(){return y.matMul(_,!0,!1)}}:t&&!r?{$a:function(){return b.matMul(y,!1,!0)},$b:function(){return _.matMul(y,!1,!1)}}:{$a:function(){return b.matMul(y,!0,!0)},$b:function(){return y.matMul(_,!0,!0)}}:{$a:function(){return y.matMul(b,!1,!0)},$b:function(){return _.matMul(y,!0,!1)}}}).reshape(g)}}),qhe=V({dot_:function $he(n,e){var t=O(n,"t1","dot"),r=O(e,"t2","dot");P(!(1!==t.rank&&2!==t.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var o=1===t.rank?t.size:t.shape[1],i=1===r.rank?r.size:r.shape[0];return P(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===t.rank&&1===r.rank?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===t.rank&&2===r.rank?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===t.rank&&1===r.rank?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Xhe=V({outerProduct_:function jhe(n,e){var t=O(n,"v1","outerProduct"),r=O(e,"v2","outerProduct");return P(1===t.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),np=V({reverse_:function Jhe(n,e){var t=O(n,"x","reverse");if(0===t.rank)return t.clone();var r=xr(e,t.shape);return N.engine.runKernel(function(o){return o.reverse(t,r)},{$x:t},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(t)}}),epe=V({reverse1d_:function Khe(n){var e=O(n,"x","reverse");return P(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),np(e,0)}}),tpe=V({reverse2d_:function Yhe(n,e){var t=O(n,"x","reverse");return P(2===t.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),np(t,e)}}),npe=V({reverse3d_:function Zhe(n,e){var t=O(n,"x","reverse");return P(3===t.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),np(t,e)}}),rpe=V({reverse4d_:function Qhe(n,e){var t=O(n,"x","reverse");return P(4===t.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),np(t,e)}});function Qk(n,e,t,r,o,i){var a=O(n,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),P(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),P(Su(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),null!=i&&P(Po(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ep(s.shape,e,t,r,o,i),l=N.engine.runKernel(function(f,d){var h=f.maxPool(s,c);return d([s,h]),h},{x:s},function(f,d){var h=d[0],p=d[1];return{x:function(){return function spe(n,e,t,r,o,i,a,s){var u=O(n,"dy","maxPoolBackprop"),c=O(e,"input","maxPoolBackprop"),l=O(t,"output","maxPoolBackprop");P(c.rank===u.rank,function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"}),null==i&&(i=[1,1]),P(Su(o,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),P(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),P(4===c.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}),null!=s&&P(Po(a),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var f=ep(c.shape,r,o,i,a,s);return N.engine.runKernel(function(d){return d.maxPoolBackprop(u,c,l,f)},{$dy:u,$input:c})}(f,h,p,e,t,r,o)}}});return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function Jk(n,e,t,r,o,i){var a=O(n,"x","avgPool","float32");null==r&&(r=[1,1]),P(Su(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),P(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&P(Po(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ep(s.shape,e,t,r,o,i),l=N.engine.runKernel(function(f){return f.avgPool(s,c)},{x:s},function(f){return{x:function(){return function upe(n,e,t,r,o,i){var a=O(n,"dy","avgPoolBackprop"),s=O(e,"input","avgPoolBackprop");P(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),null==o&&(o=[1,1]),P(Su(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),P(4===c.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),P(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=ep(u.shape,t,r,o,i),d=N.engine.runKernel(function(h){return h.avgPoolBackprop(c,u,f)},{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(f,s,e,t,r,o)}}});return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Tf=V({maxPool_:function ope(n,e,t,r,o){return Qk(n,e,t,1,r,o)}}),rp=V({avgPool_:function ipe(n,e,t,r,o){return Jk(n,e,t,1,r,o)}}),fpe=V({pool_:function ape(n,e,t,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=O(n,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),P(Su(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,l=ep(s.shape,e,i,o,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function lpe(n,e){var t=n.map(function(i,a){return i+(i-1)*(e[a]-1)}).map(function(i){return i-1}),r=t.map(function(i){return Math.floor(i/2)}),o=t.map(function(i,a){return i-r[a]});return t.map(function(i,a){return[r[a],o[a]]})}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function cpe(n,e,t){var r=t.map(function(u){return u[0]}),o=t.map(function(u){return u[1]}),i=n.concat(r,o),a=e.map(function(u,c){return(u-i[c]%u)%u}),s=o.map(function(u,c){return u+a[c]});return[e.map(function(u,c){return[r[c],s[c]]}),e.map(function(u,c){return[0,a[c]]})]}([l.inHeight,l.inWidth],f,c),g=h[1],v=d?r:"valid",m=d?s:kk(s,f,h[0]),y=("avg"===t?function(){return Jk(m,e,i,1,v)}:function(){return Qk(m,e,i,1,v)})(),x=d?y:Mk(y,f,g);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Au=V({slice_:function vpe(n,e,t){var r,o,i=O(n,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice(),o=(o=null==t?new Array(i.rank).fill(-1):"number"==typeof t?[t].concat(new Array(i.rank-1).fill(-1)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(-1)):t).map(function(s,u){return s>=0?s:(P(-1===s,function(){return"Bad value in size"}),i.shape[u]-r[u])}),function Qae(n,e,t){P(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),P(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(i){P(e[i]+t[i]<=n.shape[i],function(){return"Error in slice"+n.rank+"D: begin["+i+"] + size["+i+"] ("+(e[i]+t[i])+") would overflow input.shape["+i+"] ("+n.shape[i]+")"})},o=0;o<n.rank;++o)r(o)}(i,r,o);var a=i.shape;return N.engine.runKernel(function(s){return s.slice(i,r,o)},{$x:i},function(s){for(var u=[],c=0;c<s.rank;c++)u.push([r[c],a[c]-r[c]-o[c]]);return{$x:function(){return s.pad(u)}}})}}),mpe=V({slice1d_:function dpe(n,e,t){var r=O(n,"x","slice1d");return P(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Au(r,[e],[t])}}),ype=V({slice2d_:function hpe(n,e,t){var r=O(n,"x","slice2d");return P(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Au(r,e,t)}}),eF=V({slice3d_:function ppe(n,e,t){var r=O(n,"x","slice3d");return P(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Au(r,e,t)}}),xpe=V({slice4d_:function gpe(n,e,t){var r=O(n,"x","slice4d");return P(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Au(r,e,t)}});function tF(n,e,t,r,o){return e.rank<t.rank&&(e=e.reshape(Di(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Di(n.shape,r))),{$x:function(){var i=n.mul(t.equal(e).cast(n.dtype));return null==o?i:i.transpose(o)}}}var Npe=V({all_:function Dpe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","all","bool"),o=xr(e,r.shape),i=o,a=Ha(i,r.rank);null!=a&&(r=r.transpose(a),i=Wa(i.length,r.rank));var s=N.engine.runKernel(function(c){return c.all(r,i)},{$x:r});if(t){var u=Di(s.shape,o);return s.reshape(u)}return s}}),Ope=V({any_:function Tpe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","any","bool"),o=xr(e,r.shape),i=o,a=Ha(i,r.rank);null!=a&&(r=r.transpose(a),i=Wa(i.length,r.rank));var s=N.engine.runKernel(function(c){return c.any(r,i)},{$x:r});if(t){var u=Di(s.shape,o);return s.reshape(u)}return s}}),Mpe=V({argMax_:function Ipe(n,e){void 0===e&&(e=0);var t=O(n,"x","argMax");null==e&&(e=0);var r=xr(e,t.shape),o=Ha(r,t.rank);return null!=o&&(t=t.transpose(o),r=Wa(r.length,t.rank)),N.engine.runKernel(function(i,a){var s=i.argMax(t,r[0]);return a([t]),s},{$x:t},function(i,a){var s=a[0];return{$x:function(){return Ht(s)}}})}}),Ppe=V({argMin_:function Ape(n,e){void 0===e&&(e=0);var t=O(n,"x","argMin");null==e&&(e=0);var r=xr(e,t.shape),o=Ha(r,t.rank);return null!=o&&(t=t.transpose(o),r=Wa(r.length,t.rank)),N.engine.runKernel(function(i,a){var s=i.argMin(t,r[0]);return a([t]),s},{$x:t},function(i,a){var s=a[0];return{$x:function(){return Ht(s)}}})}}),kpe=V({logSumExp_:function wpe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","logSumExp"),o=xr(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(t){var u=Di(s.shape,o);return s.reshape(u)}return s}}),J0=V({max_:function Spe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","max"),o=r,i=xr(e,r.shape),a=i,s=Ha(a,r.rank);null!=s&&(r=r.transpose(s),a=Wa(a.length,r.rank));var u=N.engine.runKernel(function(l,f){var d=l.max(r,a);return f([o,d]),d},{$x:r},function(l,f){return tF(l,f[1],f[0],i,s)});if(t){var c=Di(u.shape,i);u=u.reshape(c)}return u}}),Fpe=V({mean_:function Cpe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","mean"),o=xr(e,r.shape),i=Be(Kr(r.shape,o)[1]);return Gh(function(a){var s=oe(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(Tc(a.shape,"float32")).div(i)}}})(r)}}),Lpe=V({min_:function Epe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","min"),o=r,i=xr(e,r.shape),a=i,s=Ha(a,r.rank);null!=s&&(r=r.transpose(s),a=Wa(a.length,r.rank));var u=N.engine.runKernel(function(l,f){var d=l.min(r,a);return f([o,d]),d},{$x:r},function(l,f){return tF(l,f[1],f[0],i,s)});if(t){var c=Di(u.shape,i);u=u.reshape(c)}return u}}),Bpe=V({moments_:function Rpe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=xr(e,(n=O(n,"x","moments")).shape),o=n.mean(r,t),i=o.shape;return t||(i=Di(o.shape,r)),{mean:o,variance:n.toFloat().sub(o.reshape(i)).square().mean(r,t)}}}),nF=V({sum_:function _pe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=xr(e,r.shape);return Gh(function(i){var a=Ha(o,i.rank),s=o,u=i;null!=a&&(u=i.transpose(a),s=Wa(s.length,i.rank));var c=N.engine.runKernel(function(f){return f.sum(u,s)},{permutedX:u});if(t){var l=Di(c.shape,o);c=c.reshape(l)}return{value:c,gradFunc:function(f){var d=i.shape.slice();return o.forEach(function(h){d[h]=1}),f.reshape(d).mul(Tc(i.shape,"float32"))}}})(r)}}),Vpe=V({prod_:function bpe(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=O(n,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=xr(e,r.shape),i=Ha(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Wa(a.length,r.rank));var u=N.engine.runKernel(function(l){return l.prod(s,a)},{permutedX:s});if(t){var c=Di(u.shape,o);u=u.reshape(c)}return u}}),rF=V({equal_:function zpe(n,e){var t,r=O(n,"a","equal"),o=O(e,"b","equal");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),Qpe=V({equalStrict_:function jpe(n,e){var t=O(n,"a","equalStrict"),r=O(e,"b","equalStrict");return kt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),Jpe=V({greater_:function Xpe(n,e){var t,r=O(n,"a","greater"),o=O(e,"b","greater");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i){return i.greater(r,o)},{$a:r,$b:o})}}),oF=V({greaterEqual_:function Ype(n,e){var t,r=O(n,"a","greaterEqual"),o=O(e,"b","greaterEqual");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{$a:r,$b:o},function(i,a){var s=a[0],u=a[1];return{$a:function(){return Ht(s)},$b:function(){return Ht(u)}}})}}),ege=V({greaterEqualStrict_:function Zpe(n,e){var t=O(n,"a","greaterEqualStrict"),r=O(e,"b","greaterEqualStrict");return kt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),tge=V({greaterStrict_:function Kpe(n,e){var t=O(n,"a","greaterStrict"),r=O(e,"b","greaterStrict");return kt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),nge=V({less_:function Wpe(n,e){var t,r=O(n,"a","less"),o=O(e,"b","less");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i){return i.less(r,o)},{$a:r,$b:o})}}),rge=V({lessEqual_:function $pe(n,e){var t,r=O(n,"a","lessEqual"),o=O(e,"b","lessEqual");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i){return i.lessEqual(r,o)},{$a:r,$b:o})}}),oge=V({lessEqualStrict_:function qpe(n,e){var t=O(n,"a","lessEqualStrict"),r=O(e,"b","lessEqualStrict");return kt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),ige=V({lessStrict_:function Gpe(n,e){var t=O(n,"a","lessStrict"),r=O(e,"b","lessStrict");return kt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),age=V({notEqual_:function Upe(n,e){var t,r=O(n,"a","notEqual"),o=O(e,"b","notEqual");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i){return i.notEqual(r,o)},{$a:r,$b:o})}}),sge=V({notEqualStrict_:function Hpe(n,e){var t=O(n,"a","notEqualStrict"),r=O(e,"b","notEqualStrict");return kt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}}),Wt=V({add_:function uge(n,e){var t,r=O(n,"a","add"),o=O(e,"b","add");t=Qn(r,o);var i=It((r=t[0]).shape,(o=t[1]).shape);return N.engine.runKernel(function(a){return a.add(r,o)},{$a:r,$b:o},function(a){return{$a:function(){var s=a,u=hr(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=a,u=hr(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}})}}),Tge=V({addN_:function cge(n){P(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),P(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(o,i){return O(o,"tensors"+i,"addN")}),t=e[0];return e.forEach(function(o){if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(o){if(!Or(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),N.engine.runKernel(function(o){return o.addN(e)},e,function(o){var i={};return e.forEach(function(a,s){i[s]=function(){return o.clone()}}),i})}}),Rge=V({addStrict_:function lge(n,e){var t=O(n,"a","addStrict"),r=O(e,"b","addStrict");return kt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),Nge=V({atan2_:function Dge(n,e){var t,r=O(n,"a","atan2"),o=O(e,"b","atan2");t=Qn(r,o);var i=It((r=t[0]).shape,(o=t[1]).shape);return N.engine.runKernel(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Wt(u.square(),c.square()),f=a.mul(c.div(l)),d=hr(u.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(u.shape)},$b:function(){var l=Wt(u.square(),c.square()),f=X0(a.mul(u.div(l))),d=hr(c.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(c.shape)}}})}}),Ns=V({div_:function mge(n,e){var t,r=O(n,"a","div"),o=O(e,"b","div");if(t=Qn(r,o),o=t[1],"int32"===(r=t[0]).dtype&&"int32"===o.dtype)return iF(r,o);var i=It(r.shape,o.shape);return N.engine.runKernel(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=a.div(c.toFloat()),f=hr(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},$b:function(){var l=a.mul(u.toFloat()),f=hr(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}})}}),Oge=V({divStrict_:function xge(n,e){var t=O(n,"a","div"),r=O(e,"b","div");return kt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),iF=V({floorDiv_:function yge(n,e){var t,r=O(n,"a","floorDiv"),o=O(e,"b","floorDiv");t=Qn(r,o);var i=It((r=t[0]).shape,(o=t[1]).shape);return N.engine.runKernel(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=a.div(c.toFloat()),f=hr(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},$b:function(){var l=a.mul(u.toFloat()),f=hr(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}})}}),K2=V({maximum_:function Ege(n,e){var t,r=O(n,"a","maximum"),o=O(e,"b","maximum");return t=Qn(r,o),o=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),o=o.toInt()),It(r.shape,o.shape),N.engine.runKernel(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{$a:r,$b:o},function(i,a){var s=a[0],u=a[1];return{$a:function(){return i.mul(s.greaterEqual(u).toFloat())},$b:function(){return i.mul(s.less(u).toFloat())}}})}}),Mge=V({maximumStrict_:function Sge(n,e){var t=O(n,"a","maximumStrict"),r=O(e,"b","maximumStrict");return kt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),aF=V({minimum_:function bge(n,e){var t,r=O(n,"a","minimum"),o=O(e,"b","minimum");return t=Qn(r,o),o=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),o=o.toInt()),It(r.shape,o.shape),N.engine.runKernel(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{$a:r,$b:o},function(i,a){var s=a[0],u=a[1];return{$a:function(){return i.mul(s.lessEqual(u).toFloat())},$b:function(){return i.mul(s.greater(u).toFloat())}}})}}),Pge=V({minimumStrict_:function Cge(n,e){var t=O(n,"a","minimumStrict"),r=O(e,"b","minimumStrict");return kt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),kge=V({mod_:function wge(n,e){var t,r=O(n,"a","mod"),o=O(e,"b","mod");t=Qn(r,o);var i=It((r=t[0]).shape,(o=t[1]).shape);return N.engine.runKernel(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=hr(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),f=hr(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}})}}),Fge=V({modStrict_:function _ge(n,e){var t=O(n,"a","modStrict"),r=O(e,"b","modStrict");return kt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Os=V({mul_:function gge(n,e){var t,r=O(n,"a","mul"),o=O(e,"b","mul");t=Qn(r,o);var i=It((r=t[0]).shape,(o=t[1]).shape);return N.engine.runKernel(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=a.mul(c.toFloat()),f=hr(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},$b:function(){var l=a.mul(u.toFloat()),f=hr(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}})}}),Lge=V({mulStrict_:function vge(n,e){var t=O(n,"a","mul"),r=O(e,"b","mul");return kt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),sF=V({pow_:function hge(n,e){var t=O(n,"base","pow"),r=O(e,"exp","pow"),o=It(t.shape,r.shape);return n=t.cast(wr(t.dtype,r.dtype)),e=r.cast(wr(t.dtype,r.dtype)),N.engine.runKernel(function(i,a){var s=i.pow(t,r);return a([t,r,s]),s},{$base:t,$exp:r},function(i,a){var s=a[0],u=a[1],c=a[2];return{$base:function(){var l=u.toFloat(),f=i.mul(l.mul(s.pow(l.sub(oe(1))))),d=hr(s.shape,o);return d.length>0&&(f=f.sum(d)),f.reshape(s.shape)},$exp:function(){var l=s.greater(0),f=s.log().where(l,Ht(s)),d=i.mul(c.mul(f)),h=hr(u.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(u.shape)}}})}}),Bge=V({powStrict_:function pge(n,e){return kt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),Vge=V({squaredDifference_:function Age(n,e){var t,r=O(n,"a","squaredDifference"),o=O(e,"b","squaredDifference");return t=Qn(r,o),It((r=t[0]).shape,(o=t[1]).shape),N.engine.runKernel(function(i,a){var s=i.squaredDifference(r,o);return a([r,o]),s},{$a:r,$b:o},function(i,a){var s=a[0],u=a[1],c=oe(2);return{$a:function(){return i.mul(s.sub(u).mul(c))},$b:function(){return i.mul(u.sub(s).mul(c))}}})}}),Uge=V({squaredDifferenceStrict_:function Ige(n,e){var t=O(n,"a","squaredDifferenceStrict"),r=O(e,"b","squaredDifferenceStrict");return kt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),$a=V({sub_:function fge(n,e){var t,r=O(n,"a","sub"),o=O(e,"b","sub");t=Qn(r,o);var i=It((r=t[0]).shape,(o=t[1]).shape);return N.engine.runKernel(function(a){return a.subtract(r,o)},{$a:r,$b:o},function(a){return{$a:function(){var s=a,u=hr(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=a,u=hr(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}})}}),Hge=V({subStrict_:function dge(n,e){var t=O(n,"a","subStrict"),r=O(e,"b","subStrict");return kt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Y2=V({logicalAnd_:function Gge(n,e){var t=O(n,"a","logicalAnd","bool"),r=O(e,"b","logicalAnd","bool");return It(t.shape,r.shape),N.engine.runKernel(function(o){return o.logicalAnd(t,r)},{$a:t,$b:r})}}),Xge=V({logicalNot_:function Wge(n){var e=O(n,"x","logicalNot","bool");return N.engine.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),uF=V({logicalOr_:function zge(n,e){var t=O(n,"a","logicalOr","bool"),r=O(e,"b","logicalOr","bool");return It(t.shape,r.shape),N.engine.runKernel(function(o){return o.logicalOr(t,r)},{$a:t,$b:r})}}),Kge=V({logicalXor_:function jge(n,e){var t=O(n,"a","logicalXor","bool"),r=O(e,"b","logicalXor","bool");return It(t.shape,r.shape),uF(n,e).logicalAnd(Y2(n,e).logicalNot())}}),op=V({where_:function $ge(n,e,t){var r=O(e,"a","where"),o=O(t,"b","where"),i=O(n,"condition","where","bool");return kt(r.shape,o.shape,"Error in where: "),1===i.rank?P(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):kt(i.shape,o.shape,"Error in where: "),N.engine.runKernel(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Ht(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),nve=V({elu_:function Qge(n){var e=O(n,"x","elu");return N.engine.runKernel(function(t,r){var o=t.elu(e);return r([o]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return N.engine.runKernel(function(i){return i.eluDer(t,o)},{dy:t,y:o})}}})}}),rve=V({leakyRelu_:function eve(n,e){void 0===e&&(e=.2);var t=O(n,"x","leakyRelu");return K2(oe(e).mul(t),t)}}),ove=V({prelu_:function tve(n,e){var t=O(n,"x","prelu"),r=O(e,"alpha","prelu");return N.engine.runKernel(function(o,i){var a=o.prelu(t,r);return i([t,r]),a},{$x:t,$alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{$x:function(){return op(u,o,o.mul(s))},$alpha:function(){var c=op(u,Ht(o),o.mul(a)),l=hr(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}})}}),Jn=V({relu_:function Zge(n){var e=O(n,"x","relu");return"bool"===e.dtype?e.toInt():N.engine.runKernel(function(t,r){var o=t.relu(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mulStrict(o.step().toFloat())}}})}}),ive=V({selu_:function Jge(n){var e=O(n,"x","selu");return N.engine.runKernel(function(t,r){var o=t.selu(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){var i=o.greater(oe(0)),a=oe(L2),s=oe(B2),u=t.mul(s),c=t.mul(a).mul(o.toFloat().exp());return op(i,u,c)}}})}}),Iu=V({transpose_:function ave(n,e){var t=O(n,"x","transpose");return null==e&&(e=t.shape.map(function(r,o){return o}).reverse()),P(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(r){P(r>=0&&r<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():N.engine.runKernel(function(r){return r.transpose(t,e)},{$x:t},function(r){var o=_2(e);return{$x:function(){return r.transpose(o)}}})}}),uve=V({localResponseNormalization_:function sve(n,e,t,r,o){void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=O(n,"x","localResponseNormalization");P(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),P(Po(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=N.engine.runKernel(function(c,l){var f=c.localResponseNormalization4D(a,e,t,r,o);return l([a,f]),f},{x4D:a},function(c,l){var f=l[0],d=l[1];return{x4D:function(){return N.engine.runKernel(function(h){return h.LRNGrad(c,f,d,e,t,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}});function cF(n,e,t){if(void 0===t&&(t=null),0===n.rank)return n.abs();if(1!==n.rank&&null===t)return cF(n.reshape([-1]),e,t);if(1===n.rank||"number"==typeof t||Array.isArray(t)&&1===t.length){if(1===e)return n.abs().sum(t);if(e===1/0)return n.abs().max(t);if(e===-1/0)return n.abs().min(t);if("euclidean"===e||2===e)return n.abs().pow(oe(2,"int32")).sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&2===t.length){if(1===e)return n.abs().sum(t[0]).max(t[1]-1);if(e===1/0)return n.abs().sum(t[1]).max(t[0]);if(e===-1/0)return n.abs().sum(t[1]).min(t[0]);if("fro"===e||"euclidean"===e)return n.square().sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var lF=V({norm_:function cve(n,e,t,r){void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1);var o=cF(n=O(n,"x","norm"),e,t),i=o.shape;if(r){var a=xr(t,n.shape);i=Di(o.shape,a)}return o.reshape(i)}});function fF(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function dF(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Yr,hF=V({gather_:function fve(n,e,t){void 0===t&&(t=0);var r=O(n,"x","gather"),o=O(e,"indices","gather","int32");t=xr(t,r.shape)[0];var i=function Zae(n,e,t){for(var r=n.shape[t],o=[],i=1,a=1,s=0;s<t;s++)o.push(n.shape[s]),i*=n.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=t+1;s<n.rank;s++)o.push(n.shape[s]),a*=n.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,t);return N.engine.runKernel(function(a,s){var u=a.gather(r,o.flatten(),t);return s([o]),u},{$x:r},function(a,s){var u=s[0];return{$x:function(){var c=r.shape,l=u.size,f=c.slice(0,t),d=f.length,h=c.slice(t,c.length).slice(1),p=h.length,g=fF(0,d),v=fF(d+1,d+1+p),m=dF([f,[l],h]),y=a.reshape(m),x=u.reshape([l]),w=dF([[d],g,v]),_=y.transpose(w),b=pF(_,x,r.shape[t]),C=_2(w);return b.transpose(C)}}}).reshape(i.outputShape)}}),pF=V({unsortedSegmentSum_:function lve(n,e,t){var r=O(n,"x","unsortedSegmentSum"),o=O(e,"segmentIds","unsortedSegmentSum","int32");return P(Po(t),function(){return"numSegments must be of dtype int"}),N.engine.runKernel(function(i,a){var s=i.unsortedSegmentSum(r,o,t);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function dve(n,e){for(var t=K2(e,Ht(e)),r=hF(n,t),o=oF(e,oe(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=Ti(o,a+1);o=Y2(o,Tc(r.shape,"bool"));var s=Ht(r);return op(o,r,s)}(i,s)}}})}}),gve=V({basicLSTMCell_:function pve(n,e,t,r,o,i){var a=O(n,"forgetBias","basicLSTMCell"),s=O(e,"lstmKernel","basicLSTMCell"),u=O(t,"lstmBias","basicLSTMCell"),c=O(r,"data","basicLSTMCell"),l=O(o,"c","basicLSTMCell"),f=O(i,"h","basicLSTMCell"),d=c.concat(f,1).matMul(s).add(u),p=d.shape[1]/4,g=[d.shape[0],p],v=d.slice([0,0],g),m=d.slice([0,p],g),y=d.slice([0,2*p],g),x=d.slice([0,3*p],g),w=v.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(y).sigmoid()));return[w,w.tanh().mulStrict(x.sigmoid())]}}),vve=V({multiRNNCell_:function hve(n,e,t,r){for(var o=O(e,"data","multiRNNCell"),i=Wh(t,"c","multiRNNCell"),a=Wh(r,"h","multiRNNCell"),s=o,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],d=[];for(c=0;c<u.length;c+=2)f.push(u[c]),d.push(u[c+1]);return[f,d]}}),yve=V({movingAverage_:function mve(n,e,t,r,o){void 0===o&&(o=!0);var i=O(n,"v","movingAverage"),a=O(e,"x","movingAverage"),s=O(t,"decay","movingAverage");XP(i,a),P(Or(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=oe(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){P(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=O(r,"step","movingAverage");l=l.div(u.sub(sF(s,f)))}return i.add(l)}}),wve=V({stridedSlice_:function xve(n,e,t,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var c=O(n,"x","stridedSlice");if(r.every(function(g){return 1===g})){var l=C2(c.shape,e,t,r,o,i,a,s,u),f=l[0],d=l[1],h=l[2],p=d.filter(function(g,v){return-1===h.indexOf(v)});return Au(c,f,d).reshape(p)}return N.engine.runKernel(function(g){return g.stridedSlice(c,e,t,r,o,i,a,s,u)},{$x:c})}}),bve=V({topk_:function _ve(n,e,t){void 0===e&&(e=1),void 0===t&&(t=!0);var r=O(n,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=N.engine.runKernel(function(a){return a.topk(r,e,t)},{$x:r});return{values:i[0],indices:i[1]}}}),Eve=V({scatterND_:function Cve(n,e,t){var r=O(n,"indices","scatterND","int32"),o=O(e,"updates","scatterND");return function Xae(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(0===t.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}!function qae(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(t.rank<o)throw new Error(i+" update.rank < "+o+". ");if(n.length<r+(t.rank-o))throw new Error(i+" Output shape length < "+(r+(t.rank-o)));if(t.rank!==o+n.length-r)throw new Error(i+" update.rank != "+(o+n.length-r));for(var a=0;a<o;++a)if(t.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-o;++a)if(t.shape[a+o]!==n[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+t.shape[a+o]+") != shape["+(a+o)+"] ("+n[a+o]+")")}(t,e,n)}(o,r,t),N.engine.runKernel(function(i){return i.scatterND(r,o,t)},{$indices:r,$updates:o})}}),Z2=V({fft_:function Sve(n){P("complex64"===n.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return N.engine.runKernel(function(o){return o.fft(r)},{input:n}).reshape(n.shape)}}),em=V({ifft_:function Ave(n){P("complex64"===n.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return N.engine.runKernel(function(o){return o.ifft(r)},{input:n}).reshape(n.shape)}}),gF=V({rfft_:function Ive(n){P("float32"===n.dtype,function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.zerosLike(),o=vo(n,r).as2D(t,e),i=Z2(o),a=Math.floor(e/2)+1,s=Ga(i),u=Eu(i),c=s.split([a,e-a],s.shape.length-1),l=u.split([a,e-a],u.shape.length-1),f=n.shape.slice();return f[n.shape.length-1]=a,vo(c[0],l[0]).reshape(f)}}),vF=V({irfft_:function Dve(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),o=em(r);return Ga(o)}var i=[t,2*(e-1)],a=Ga(n).as2D(t,e),s=Eu(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),c=s.slice([0,1],[t,e-2]).reverse(1).mul(oe(-1)),l=a.concat(u,1),f=s.concat(c,1);return r=vo(l,f).as2D(i[0],i[1]),o=em(r),Ga(o)}}),Tve=Object.freeze({fft:Z2,ifft:em,rfft:gF,irfft:vF}),Ove=V({sparseToDense_:function Nve(n,e,t,r){void 0===r&&(r=0);var o=O(n,"sparseIndices","sparseToDense","int32"),i=O(e,"sparseValues","sparseToDense"),a=O(r,"defaultValue","sparseToDense",i.dtype);return function Rve(n,e,t,r){if("int32"!==n.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+n.shape+".");var o=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:, "+t.length+", should be: "+i+".");if(0!==e.rank&&(1!==e.rank||e.size!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,t,a),N.engine.runKernel(function(s){return s.sparseToDense(o,i,t,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),Pve=V({gatherND_:function Mve(n,e){var t=O(e,"indices","gatherND","int32"),r=O(n,"x","gatherND");return N.engine.runKernel(function(o){return o.gatherND(r,t)},{$x:r,$indices:t})}});!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Yr||(Yr={}));var $ve=V({absoluteDifference_:function Fve(n,e,t,r){void 0===r&&(r=Yr.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"labels","absoluteDifference"),i=O(e,"predictions","absoluteDifference"),a=null;null!=t&&(a=O(t,"weights","absoluteDifference")),kt(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Ms(s,a,r)}}),Ms=V({computeWeightedLoss_:function kve(n,e,t){void 0===t&&(t=Yr.SUM_BY_NONZERO_WEIGHTS);var r=O(n,"losses","computeWeightedLoss"),o=null;null!=e&&(o=O(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(t===Yr.NONE)return i;if(t===Yr.SUM)return i.sum();if(t===Yr.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(oe(a)):s}if(t===Yr.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(oe(r.size));var u=o.mul(Tc(r.shape)).notEqual(oe(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+t)}}),qve=V({cosineDistance_:function Bve(n,e,t,r,o){void 0===o&&(o=Yr.SUM_BY_NONZERO_WEIGHTS);var i=O(n,"labels","cosineDistance"),a=O(e,"predictions","cosineDistance"),s=null;null!=r&&(s=O(r,"weights","cosineDistance")),kt(i.shape,a.shape,"Error in cosineDistance: ");var u=oe(1).sub(i.mul(a).sum(t,!0));return Ms(u,s,o)}}),Xve=V({hingeLoss_:function Vve(n,e,t,r){void 0===r&&(r=Yr.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"labels","hingeLoss"),i=O(e,"predictions","hingeLoss"),a=null;null!=t&&(a=O(t,"weights","hingeLoss")),kt(o.shape,i.shape,"Error in hingeLoss: ");var s=oe(1);o=oe(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Ms(u,a,r)}}),Kve=V({huberLoss_:function Gve(n,e,t,r,o){void 0===r&&(r=1),void 0===o&&(o=Yr.SUM_BY_NONZERO_WEIGHTS);var i=O(n,"labels","huberLoss"),a=O(e,"predictions","huberLoss"),s=null;null!=t&&(s=O(t,"weights","huberLoss")),kt(i.shape,a.shape,"Error in huberLoss: ");var u=oe(r),c=a.sub(i).abs(),l=aF(c,u),f=c.sub(l),d=oe(.5).mul(l.square()).add(u.mul(f));return Ms(d,s,o)}}),Yve=V({logLoss_:function Uve(n,e,t,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Yr.SUM_BY_NONZERO_WEIGHTS);var i=O(n,"labels","logLoss"),a=O(e,"predictions","logLoss"),s=null;null!=t&&(s=O(t,"weights","logLoss")),kt(i.shape,a.shape,"Error in logLoss: ");var u=oe(1),c=oe(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Ms(l,s,o)}}),Zve=V({meanSquaredError_:function Lve(n,e,t,r){void 0===r&&(r=Yr.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"labels","meanSquaredError"),i=O(e,"predictions","meanSquaredError"),a=null;null!=t&&(a=O(t,"weights","meanSquaredError")),kt(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Ms(s,a,r)}}),Qve=V({sigmoidCrossEntropy_:function Wve(n,e,t,r,o){void 0===r&&(r=0),void 0===o&&(o=Yr.SUM_BY_NONZERO_WEIGHTS);var i=O(n,"multiClassLabels","sigmoidCrossEntropy"),a=O(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=t&&(s=O(t,"weights","sigmoidCrossEntropy")),kt(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=oe(r),c=oe(1),l=oe(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var f=function Hve(n,e){var t=O(n,"labels","sigmoidCrossEntropyWithLogits"),r=O(e,"logits","sigmoidCrossEntropyWithLogits");kt(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(t),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return Ms(f,s,o)}}),Jve=V({softmaxCrossEntropy_:function jve(n,e,t,r,o){void 0===r&&(r=0),void 0===o&&(o=Yr.SUM_BY_NONZERO_WEIGHTS);var i=O(n,"onehotLabels","softmaxCrossEntropy"),a=O(e,"logits","softmaxCrossEntropy"),s=null;if(null!=t&&(s=O(t,"weights","softmaxCrossEntropy")),kt(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=oe(r),c=oe(1),l=oe(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var f=function zve(n,e,t){if(void 0===t&&(t=-1),-1===t&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+t);return Gh(function(r,o,i){var a=o.logSumExp([t],!0),s=o.toFloat().sub(a);return i([r,s]),{value:s.mul(r).neg().sum([t]),gradFunc:function(u,c){var l=c[0],f=c[1],d=Di(u.shape,[t]);return[u.reshape(d).mul(l.toFloat().sub(f.exp())),u.reshape(d).mul(f.exp().sub(l.toFloat()))]}}})(n,e)}(i,a);return Ms(f,s,o)}}),e0e=Object.freeze({get Reduction(){return Yr},absoluteDifference:$ve,computeWeightedLoss:Ms,cosineDistance:qve,hingeLoss:Xve,huberLoss:Kve,logLoss:Yve,meanSquaredError:Zve,sigmoidCrossEntropy:Qve,softmaxCrossEntropy:Jve});function mF(n,e){return void 0===e&&(e=!1),N.engine.tidy(function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],o=Pk(t),i=n.clone(),a=W0([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,c=function(f){var d,h=i,p=s,g=o;d=N.engine.tidy(function(){var v=i.slice([f,f],[t-f,1]),m=v.norm(),y=i.slice([f,f],[1,1]),x=y.sign().neg(),w=y.sub(x.mul(m)),_=v.div(w);s=1===_.shape[0]?a.clone():a.concat(_.slice([1,0],[_.shape[0]-1,_.shape[1]]),0);var b=x.matMul(w).div(m).neg(),C=i.slice([f,0],[t-f,r]),E=b.mul(s);i=0===f?C.sub(E.matMul(s.transpose().matMul(C))):i.slice([0,0],[f,r]).concat(C.sub(E.matMul(s.transpose().matMul(C))),0);var S=o.slice([0,f],[t,o.shape[1]-f]);return o=0===f?S.sub(S.matMul(s).matMul(E.transpose())):o.slice([0,0],[t,f]).concat(S.sub(S.matMul(s).matMul(E.transpose())),1),[s,i,o]}),s=d[0],i=d[1],o=d[2],zae([h,p,g])},l=0;l<u;++l)c(l);return!e&&t>r&&(o=o.slice([0,0],[t,r]),i=i.slice([0,0],[r,r])),[o,i]})}var r0e=V({gramSchmidt_:function t0e(n){var e;if(Array.isArray(n)){e=!1,P(null!=n&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){P(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},o=1;o<n.length;++o)r(o)}else e=!0,n=U2(n,n.shape[0],0).map(function(u){return Fk(u,[0])});P(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var i=[],a=n,s=function(u){i.push(N.engine.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var f=nF(i[l].mulStrict(c)).mul(i[l]);c=c.sub(f)}return c.div(lF(c,"euclidean"))}))};for(o=0;o<n.length;++o)s(o);return e?na(i,0):i}}),o0e=V({qr_:function n0e(n,e){if(void 0===e&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return mF(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(i,a){return i*a}),r=[],o=[];return Mr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0).forEach(function(i){var a=mF(i,e),u=a[1];r.push(a[0]),o.push(u)}),[na(r,0).reshape(n.shape),na(o,0).reshape(n.shape)]}}),i0e=Object.freeze({gramSchmidt:r0e,qr:o0e});function yF(n,e,t,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var i=n.shape[0];return t=Math.min(t,i),P(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),P(2===n.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),P(4===n.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),P(1===e.rank,function(){return"scores must be a 1D tensor"}),P(e.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:o}}var f0e=V({resizeBilinear_:function a0e(n,e,t){void 0===t&&(t=!1);var r=O(n,"images","resizeBilinear");P(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),P(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=N.engine.runKernel(function(c,l){return l([o]),c.resizeBilinear(o,a,s,t)},{batchImages:o},function(c,l){return{batchImages:function(){return N.engine.runKernel(function(f){return f.resizeBilinearBackprop(c,l[0],t)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),d0e=V({resizeNearestNeighbor_:function s0e(n,e,t){void 0===t&&(t=!1);var r=O(n,"images","resizeNearestNeighbor");P(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),P(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),P("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=N.engine.runKernel(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,t)},{batchImages:o},function(c,l){return{batchImages:function(){return N.engine.runKernel(function(f){return f.resizeNearestNeighborBackprop(c,l[0],t)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),h0e=V({nonMaxSuppression_:function u0e(n,e,t,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=O(n,"boxes","nonMaxSuppression"),a=O(e,"scores","nonMaxSuppression"),s=yF(i,a,t,r,o);return t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,N.engine.runKernel(function(u){return u.nonMaxSuppression(i,a,t,r,o)},{$boxes:i})}}),g0e=V({cropAndResize_:function l0e(n,e,t,r,o,i){var a=O(n,"image","cropAndResize","float32"),s=O(e,"boxes","cropAndResize","float32"),u=O(t,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return P(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),P(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),P(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),P(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),P(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),P("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),N.engine.runKernel(function(l,f){return l.cropAndResize(a,s,u,r,o,i)},{$image:a,$boxes:s})}}),xF=Object.freeze({resizeBilinear:f0e,resizeNearestNeighbor:d0e,nonMaxSuppression:h0e,nonMaxSuppressionAsync:function c0e(n,e,t,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),gt(this,void 0,void 0,function(){var i,a,s,u,c,l;return vt(this,function(f){switch(f.label){case 0:return i=O(n,"boxes","nonMaxSuppressionAsync"),a=O(e,"scores","nonMaxSuppressionAsync"),s=yF(i,a,t,r,o),t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,i.data()];case 1:return u=f.sent(),[4,a.data()];case 2:return c=f.sent(),l=A2(u,c,t,r,o),i!==n&&i.dispose(),a!==e&&a.dispose(),[2,l]}})})},cropAndResize:g0e}),m0e=V({matMul_:function v0e(n,e,t,r,o,i){var a;void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===i&&(i="linear");var s=O(n,"a","fused matMul"),u=O(e,"b","fused matMul");a=Qn(s,u),s=a[0],u=a[1];var c=t?s.shape[s.rank-2]:s.shape[s.rank-1],l=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=t?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],h=s.shape.slice(0,-2),p=u.shape.slice(0,-2),g=Be(h),v=Be(p);P(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),P(Or(h,p),function(){return"Error in fused matMul: outer dimensions ("+h+") and ("+p+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),P(c===l,function(){return"Error in fused matMul: inner shapes ("+c+") and ("+l+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var m,y=s.shape.slice(0,-2).concat([f,d]),x=t?s.as3D(g,c,f):s.as3D(g,f,c),w=r?u.as3D(v,d,l):u.as3D(v,l,d);null!=o&&It(y,(m=Qn(m=O(o,"bias","fused matMul"),s)[0]).shape);var _={$a:x,$b:w};return null!=o&&(_.$bias=m),N.engine.runKernel(function(b,C){var E=b.fusedBatchMatMul(x,w,t,r,m,i);return C([x,w,E]),E},_,function(b,C){var E,S=C[0],A=C[1],D=C[2];if(null==i||"linear"===i)E=b;else{if("relu"!==i)throw new Error("Gradient for activation "+i+" has not been implemented yet.");E=b.mul(D.step())}var M={};return null!=o&&(M={$bias:function(){var L=E,B=hr(m.shape,E.shape);return B.length>0&&(L=L.sum(B)),L.reshape(m.shape)}}),Object.assign(t||r?!t&&r?{$a:function(){return E.matMul(A,!1,!1)},$b:function(){return E.matMul(S,!0,!1)}}:t&&!r?{$a:function(){return A.matMul(E,!1,!0)},$b:function(){return S.matMul(E,!1,!1)}}:{$a:function(){return A.matMul(E,!0,!0)},$b:function(){return E.matMul(S,!0,!0)}}:{$a:function(){return E.matMul(A,!1,!0)},$b:function(){return S.matMul(E,!0,!1)}},M)}).reshape(y)}}),y0e=Object.freeze({matMul:m0e}),x0e=Object.freeze({image:xF,linalg:i0e,losses:e0e,spectral:Tve,fused:y0e,op:V,batchNormalization2d:yhe,batchNormalization3d:xhe,batchNormalization4d:whe,batchNormalization:_he,batchNorm:jk,batchNorm2d:bhe,batchNorm3d:Che,batchNorm4d:Ehe,complex:vo,real:Ga,imag:Eu,concat:Fo,concat1d:nfe,concat2d:rfe,concat3d:ofe,concat4d:ife,split:U2,conv1d:Hhe,conv2d:Rs,conv3d:Whe,conv2dDerFilter:Yk,depthwiseConv2d:q2,separableConv2d:Zk,conv2dTranspose:Ghe,matMul:X2,dot:qhe,outerProduct:Xhe,reverse:np,reverse1d:epe,reverse2d:tpe,reverse3d:npe,reverse4d:rpe,maxPool:Tf,avgPool:rp,pool:fpe,slice:Au,slice1d:mpe,slice2d:ype,slice3d:eF,slice4d:xpe,abs:Bde,acos:Vde,acosh:Ude,asin:Hde,asinh:Wde,atan:Gde,atanh:zde,ceil:jde,clipByValue:G2,cos:$de,cosh:qde,erf:Xde,exp:z2,expm1:Kde,floor:Yde,log:Zde,log1p:Qde,logSigmoid:Jde,neg:X0,reciprocal:ehe,round:the,rsqrt:Uk,sigmoid:Hk,sign:nhe,isNaN:rhe,isInf:ohe,isFinite:ihe,sin:ahe,sinh:she,softplus:uhe,sqrt:che,square:lhe,step:fhe,tan:dhe,tanh:hhe,all:Npe,any:Ope,argMax:Mpe,argMin:Ppe,logSumExp:kpe,max:J0,mean:Fpe,min:Lpe,moments:Bpe,sum:nF,prod:Vpe,equal:rF,equalStrict:Qpe,greater:Jpe,greaterEqual:oF,greaterEqualStrict:ege,greaterStrict:tge,less:nge,lessEqual:rge,lessEqualStrict:oge,lessStrict:ige,notEqual:age,notEqualStrict:sge,add:Wt,addN:Tge,addStrict:Rge,atan2:Nge,div:Ns,divStrict:Oge,floorDiv:iF,maximum:K2,maximumStrict:Mge,minimum:aF,minimumStrict:Pge,mod:kge,modStrict:Fge,mul:Os,mulStrict:Lge,pow:sF,powStrict:Bge,squaredDifference:Vge,squaredDifferenceStrict:Uge,sub:$a,subStrict:Hge,elu:nve,leakyRelu:rve,prelu:ove,relu:Jn,selu:ive,logicalAnd:Y2,logicalNot:Xge,logicalOr:uF,logicalXor:Kge,where:op,whereAsync:function qge(n){return gt(this,void 0,void 0,function(){var e,t,r;return vt(this,function(o){switch(o.label){case 0:return[4,(e=O(n,"condition","whereAsync","bool")).data()];case 1:return t=o.sent(),r=W2(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},buffer:Ct,print:function Bfe(n,e){void 0===e&&(e=!1),console.log(n.toString(e))},batchToSpaceND:Mk,cast:Vfe,clone:Ufe,cumsum:Hfe,depthToSpace:Wfe,expandDims:Ti,eye:Pk,multinomial:Gfe,oneHot:H2,pad:Qh,pad1d:zfe,pad2d:jfe,pad3d:$fe,pad4d:qfe,rand:Xfe,randomNormal:Kfe,randomUniform:Yfe,reshape:ta,spaceToBatchND:kk,squeeze:Fk,stack:na,tile:If,truncatedNormal:Zfe,unstack:Mr,setdiff1dAsync:function Lfe(n,e){return gt(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,f;return vt(this,function(d){switch(d.label){case 0:return t=O(n,"x","setdiff1d"),r=O(e,"y","setdiff1d"),P(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),P(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),P(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new Uh([s],t.dtype),c=new Uh([s],"int32"),l=0,f=0;l<o.length;l++)a.has(o[l])||(u.values[f]=o[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:zh,linspace:function fse(n,e,t){if(0===t)throw new Error("Cannot request zero samples");var r=(e-n)/(t-1),o=xf(t,"float32");o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return ni(o,"float32")},ones:Tc,range:d4,scalar:oe,tensor:Sn,tensor1d:ni,tensor2d:W0,tensor3d:E2,tensor4d:ea,tensor5d:function sse(n,e,t){if(Sc(n),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=bu(n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Sn(n,e=e||r,t)},tensor6d:function use(n,e,t){if(Sc(n),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=bu(n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Sn(n,e=e||r,t)},zeros:zn,onesLike:h4,zerosLike:Ht,transpose:Iu,softmax:Cu,logSoftmax:rse,localResponseNormalization:uve,norm:lF,gather:hF,unsortedSegmentSum:pF,basicLSTMCell:gve,multiRNNCell:vve,movingAverage:yve,stridedSlice:wve,topk:bve,scatterND:Eve,fft:Z2,ifft:em,rfft:gF,irfft:vF,sparseToDense:Ove,gatherND:Pve}),_0e=function(){function n(){this.blockSize=48,this.firstUse=!0,N.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return n.prototype.setDataMover=function(e){this.data=new p4(e)},n.prototype.register=function(e,t,r){if(this.firstUse&&(this.firstUse=!1,N.get("IS_NODE")&&w2("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:r})},n.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},n.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r,o;if(N.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)r=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData)r=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),r=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(4===t)o=new Int32Array(r);else{var i=e.width*e.height;o=new Int32Array(i*t);for(var a=0;a<i;a++)for(var s=0;s<t;++s)o[a*t+s]=r[4*a+s]}return E2(o,[e.height,e.width,t],"int32")},n.prototype.read=function(e){return gt(this,void 0,void 0,function(){return vt(this,function(t){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var t=this.data.get(e),o=t.complexTensors;return"complex64"===t.dtype?v4(o.real.dataSync(),o.imag.dataSync()):this.data.get(e).values},n.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return gt(this,void 0,void 0,function(){var t;return vt(this,function(r){return t=Fh(),e(),[2,{kernelMs:Fh()-t}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,t){var r=se.make(e.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:N.engine.keep(e.clone()),imag:N.engine.keep(t.clone())},r},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(r){null!=r&&P("complex64"!==r.dtype,function(){return t+" does not support complex64 tensors."})})},n.prototype.slice=function(e,t,r){if(this.assertNotComplex(e,"slice"),l4(e.shape,t,r)){var o=f4(t,e.strides),i=Be(r);return Sn(e.dataSync().subarray(o,o+i),r,e.dtype)}for(var a=Ct(r,e.dtype),s=e.bufferSync(),u=0;u<a.size;++u){var c=a.indexToLoc(u).map(function(l,f){return l+t[f]});a.values[u]=s.get.apply(s,c)}return a.toTensor()},n.prototype.stridedSlice=function(e,t,r,o,i,a,s,u,c){this.assertNotComplex(e,"stridedSlice");var l=C2(e.shape,t,r,o,i,a,s,u,c),f=l[0],d=l[1],h=l[2],p=d.filter(function(_,b){return-1===h.indexOf(b)});if(p.some(function(_){return 0===_}))return Sn([],p);for(var g=Ct(d,e.dtype),v=e.bufferSync(),m=0;m<g.size;m++){for(var y=g.indexToLoc(m),x=new Array(y.length),w=0;w<x.length;w++)x[w]=y[w]*o[w]+f[w];g.set.apply(g,[v.get.apply(v,x)].concat(y))}return g.toTensor().reshape(p)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],o=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(o[i++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var c=new Array(r);for(a=0;a<c.length;a++)s[t]=a,c[a]=this.slice(e,s,u).reshape(o);return c},n.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var r=Ct(e.shape,e.dtype),o=e.bufferSync(),i=function(s){var u=r.indexToLoc(s),c=u.slice();t.forEach(function(l){return c[l]=e.shape[l]-1-c[l]}),r.set.apply(r,[o.get.apply(o,c)].concat(u))},a=0;a<r.size;a++)i(a);return r.toTensor()},n.prototype.concat=function(e,t){this.assertNotComplex(e,"concat");var r=e.map(function(c){var l=Be(c.shape.slice(t));return c.as2D(-1,l)}),o=wf(r.map(function(c){return c.shape}),1),i=Ct(o,e[0].dtype).values;if(1===r[0].shape[0]){var a=0;r.forEach(function(c){i.set(c.dataSync(),a),a+=c.size})}else{var s=0;r.forEach(function(c){for(var l=c.dataSync(),f=0,d=0;d<c.shape[0];++d)for(var h=d*o[1]+s,p=0;p<c.shape[1];++p)i[h+p]=l[f++];s+=c.shape[1]})}var u=wf(e.map(function(c){return c.shape}),t);return Sn(i,u,e[0].dtype)},n.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(oe(-1),e)},n.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,o,i,a){return{real:r+i,imag:o+a}}):this.broadcastedBinaryOp(e,t,wr(e.dtype,t.dtype),function(r,o){return r+o})},n.prototype.addN=function(e){this.assertNotComplex(e,"addN");for(var t=e.map(function(u){return u.dataSync()}),r=Ct(e[0].shape,e[0].dtype),o=r.values,i=0;i<e.length;i++)for(var a=t[i],s=0;s<o.length;s++)o[s]+=a[s];return r.toTensor()},n.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,o,i,a){return{real:r-i,imag:o-a}}):this.broadcastedBinaryOp(e,t,wr(e.dtype,t.dtype),function(r,o){return r-o})},n.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){return Math.pow(r,o)})},n.prototype.batchMatMul=function(e,t,r,o){this.assertNotComplex([e,t],"matMul");for(var i=r?e.shape[1]:e.shape[2],a=r?e.shape[2]:e.shape[1],s=o?t.shape[1]:t.shape[2],u=e.shape[0],c=e.dataSync(),l=t.dataSync(),f=r?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=f[0],h=f[1],p=f[2],g=o?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=g[0],m=g[1],y=g[2],x=a*s,w=Ct([u,a,s],e.dtype),_=w.values,b=this.blockSize,C=0;C<u;C++)for(var E=0;E<a;E+=b)for(var S=0;S<s;S+=b)for(var A=0;A<i;A+=b)for(var D=Math.min(E+b,a),M=Math.min(S+b,s),L=Math.min(A+b,i),B=E;B<D;B++)for(var U=S;U<M;U++){for(var G=0,H=A;H<L;H++)G+=c[C*d+B*h+H*p]*l[H*v+U*m+C*y];_[C*x+(B*s+U)]+=G}return w.toTensor()},n.prototype.fusedBatchMatMul=function(e,t,r,o,i,a){var s=this.batchMatMul(e,t,r,o);return i&&(s=this.add(s,i)),a&&(s=function w0e(n,e,t){if("linear"===e)return n.linear(t);if("relu"===e)return n.relu(t);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}(this,a,s)),s},n.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,o,i,a){return{real:r*i-o*a,imag:r*a+o*i}}):this.broadcastedBinaryOp(e,t,wr(e.dtype,t.dtype),function(r,o){return r*o})},n.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(r,o){return r/o})},n.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(r,o){return Math.floor(r/o)})},n.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),ti("sum",t,e.rank);for(var r=Kr(e.shape,t),i=r[1],a=zn(r[0],wr(e.dtype,"int32")),s=Be(i),u=a.dataSync(),c=e.dataSync(),l=0;l<u.length;++l){for(var f=l*s,d=0,h=0;h<s;++h)d+=c[f+h];u[l]=d}return a},n.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var r=Kr(e.shape,t),i=r[1],a=zn(r[0],wr(e.dtype,"int32")),s=Be(i),u=a.dataSync(),c=e.dataSync(),l=0;l<u.length;++l){for(var f=l*s,d=1,h=0;h<s;++h)d*=c[f+h];u[l]=d}return a},n.prototype.unsortedSegmentSum=function(e,t,r){this.assertNotComplex(e,"unsortedSegmentSum");for(var o=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<r;++a){var s=oe(a,"int32"),u=rF(s,t).asType("float32").mul(e).sum(0);o.push(u)}return na(o)},n.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var r=[t];ti("argMin",r,e.rank);for(var o=Kr(e.shape,r),a=o[1],s=zn(o[0],"int32"),u=Be(a),c=s.dataSync(),l=e.dataSync(),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0,g=0;g<u;++g){var v=l[d+g];v<h&&(h=v,p=g)}c[f]=p}return s},n.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var r=[t];ti("argMax",r,e.rank);for(var o=Kr(e.shape,r),a=o[1],s=zn(o[0],"int32"),u=Be(a),c=s.dataSync(),l=e.dataSync(),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0,g=0;g<u;++g){var v=l[d+g];v>h&&(h=v,p=g)}c[f]=p}return s},n.prototype.cumsum=function(e,t,r,o){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=wr(e.dtype,"int32"),a=zn(e.shape,i),s=a.dataSync(),u=e.dataSync(),c=e.shape[e.rank-1],l=o?function(g,v){return g+c-v-1}:function(g,v){return g+v},f=0;f<u.length;f+=c)for(var d=0;d<c;d++){var h=l(f,d);if(0===d)s[h]=r?0:u[h];else{var p=l(f,d-1);s[h]=r?u[p]+s[p]:u[h]+s[p]}}return a},n.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r===o?1:0})},n.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r!==o?1:0})},n.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r<o?1:0})},n.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r<=o?1:0})},n.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r>o?1:0})},n.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r>=o?1:0})},n.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=e.dataSync(),r=new Uint8Array(t.length),o=0;o<t.length;++o)r[o]=t[o]?0:1;return se.make(e.shape,{values:r},"bool")},n.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r&&o})},n.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(r,o){return r||o})},n.prototype.select=function(e,t,r){this.assertNotComplex([e,t,r],"select");for(var o=e.dataSync(),i=t.dataSync(),a=r.dataSync(),s=zn(t.shape,wr(t.dtype,r.dtype)),u=s.dataSync(),c=0,l=0===e.rank||e.rank>1||1===t.rank?1:t.shape[1],f=0;f<o.length;f++)for(var d=0;d<l;d++)u[c++]=1===o[f]?i[f]:a[f];return s},n.prototype.where=function(e){this.assertNotComplex([e],"where");var t=e.dataSync();return W2(e.shape,t)},n.prototype.topk=function(e,t,r){return this.assertNotComplex(e,"topk"),x4(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){this.assertNotComplex(e,"min"),ti("min",t,e.rank);for(var r=Kr(e.shape,t),i=r[1],a=zn(r[0],e.dtype),s=Be(i),u=a.dataSync(),c=e.dataSync(),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0;h<s;++h){var p=c[f+h];p<d&&(d=p)}u[l]=d}return a},n.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){return Math.min(r,o)})},n.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){var i=r%o;return r<0&&o<0||r>=0&&o>=0?i:(i+o)%o})},n.prototype.max=function(e,t){this.assertNotComplex(e,"max"),ti("max",t,e.rank);for(var r=Kr(e.shape,t),i=r[1],a=zn(r[0],e.dtype),s=Be(i),u=a.dataSync(),c=e.dataSync(),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0;h<s;++h){var p=c[f+h];p>d&&(d=p)}u[l]=d}return a},n.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){return Math.max(r,o)})},n.prototype.all=function(e,t){this.assertNotComplex(e,"all"),ti("all",t,e.rank);for(var r=Kr(e.shape,t),i=r[1],a=zn(r[0],e.dtype),s=Be(i),u=a.dataSync(),c=e.dataSync(),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0;h<s;++h)d=d&&c[f+h];u[l]=d}return a},n.prototype.any=function(e,t){this.assertNotComplex(e,"any"),ti("any",t,e.rank);for(var r=Kr(e.shape,t),i=r[1],a=zn(r[0],e.dtype),s=Be(i),u=a.dataSync(),c=e.dataSync(),l=0;l<u.length;++l){for(var f=l*s,d=c[f],h=0;h<s;++h)d=d||c[f+h];u[l]=d}return a},n.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){var i=r-o;return i*i})},n.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.ceil(t[o]);return se.make(e.shape,{values:r})},n.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.floor(t[o]);return se.make(e.shape,{values:r})},n.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=t[o]<0?-1:t[o]>0?1:0;return se.make(e.shape,{values:r})},n.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Uint8Array(t.length),o=0;o<t.length;++o)Number.isNaN(t[o])&&(r[o]=1);return se.make(e.shape,{values:r},"bool")},n.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Uint8Array(t.length),o=0;o<t.length;++o)Math.abs(t[o])===1/0&&(r[o]=1);return se.make(e.shape,{values:r},"bool")},n.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),r=new Uint8Array(t.length),o=0;o<t.length;++o)Number.isFinite(t[o])&&(r[o]=1);return se.make(e.shape,{values:r},"bool")},n.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o){var i=Math.floor(t[o]);r[o]=t[o]-i<.5?Math.floor(t[o]):t[o]-i>.5?Math.ceil(t[o]):i%2==0?i:i+1}return se.make(e.shape,{values:r})},n.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.exp(t[o]);return se.make(e.shape,{values:r})},n.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.expm1(t[o]);return se.make(e.shape,{values:r})},n.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.log(t[o]);return se.make(e.shape,{values:r})},n.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.log1p(t[o]);return se.make(e.shape,{values:r})},n.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=Math.sqrt(t[o]);return se.make(e.shape,{values:r})},n.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=1/Math.sqrt(t[o]);return se.make(e.shape,{values:r})},n.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o){var i=t[o];r[o]=i*i}return se.make(e.shape,{values:r})},n.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=e.dataSync(),r=new Float32Array(t.length),o=0;o<t.length;++o)r[o]=1/t[o];return se.make(e.shape,{values:r})},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=zn(e.shape,e.dtype),r=t.dataSync(),o=e.dataSync(),i=0;i<o.length;++i)r[i]=Math.max(0,o[i]);return t},n.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){return r<0?o*r:r})},n.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o){var i=r[o];t[o]=i>=0?i:Math.exp(i)-1}return se.make(e.shape,{values:t})},n.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var r=new Float32Array(t.size),o=t.dataSync(),i=e.dataSync(),a=0;a<o.length;++a){var s=o[a];r[a]=s>=1?i[a]:i[a]*(s+1)}return se.make(t.shape,{values:r})},n.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var o=new Float32Array(e.size),i=e.dataSync(),a=0;a<i.length;++a){var s=i[a];o[a]=s>=0?1.0507009873554805*s:1.7580993408473768*(Math.exp(s)-1)}return se.make(e.shape,{values:o})},n.prototype.clip=function(e,t,r){this.assertNotComplex(e,"clip");for(var o=new Float32Array(e.size),i=e.dataSync(),a=0;a<i.length;++a){var s=i[a];o[a]=s>r?r:s<t?t:s}return se.make(e.shape,{values:o})},n.prototype.abs=function(e){for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.abs(r[o]);return se.make(e.shape,{values:t})},n.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<e.size;++o)t[o]=Math.hypot(r[2*o],r[2*o+1]);return se.make(e.shape,{values:t})},n.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=r[o];return se.make(e.shape,{values:t},"int32")},n.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=1/(1+Math.exp(-r[o]));return se.make(e.shape,{values:t})},n.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,r=new Float32Array(e.size),o=e.dataSync(),i=0;i<o.length;++i){var c,a=o[i]>-t,s=o[i]<t,u=Math.exp(o[i]);c=s?u:a?o[i]:Math.log(1+u),r[i]=c}return se.make(e.shape,{values:r})},n.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.sin(r[o]);return se.make(e.shape,{values:t})},n.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.cos(r[o]);return se.make(e.shape,{values:t})},n.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.tan(r[o]);return se.make(e.shape,{values:t})},n.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.asin(r[o]);return se.make(e.shape,{values:t})},n.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.acos(r[o]);return se.make(e.shape,{values:t})},n.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.atan(r[o]);return se.make(e.shape,{values:t})},n.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,o){return Math.atan2(r,o)})},n.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.sinh(r[o]);return se.make(e.shape,{values:t})},n.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.cosh(r[o]);return se.make(e.shape,{values:t})},n.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=kP(r[o]);return se.make(e.shape,{values:t})},n.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.asinh(r[o]);return se.make(e.shape,{values:t})},n.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.acosh(r[o]);return se.make(e.shape,{values:t})},n.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o)t[o]=Math.atanh(r[o]);return se.make(e.shape,{values:t})},n.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),r=e.dataSync(),l=0;l<r.length;++l){var f=r[l],d=1/(1+.3275911*f);t[l]=1-((((1.061405429*d-1.453152027)*d+1.421413741)*d-.284496736)*d+.254829592)*d*Math.exp(-f*f)}return se.make(e.shape,{values:t})},n.prototype.step=function(e,t){void 0===t&&(t=0),this.assertNotComplex(e,"step");for(var r=new Float32Array(e.size),o=e.dataSync(),i=0;i<o.length;++i){var a=o[i];r[i]=isNaN(a)?NaN:a>0?1:t}return se.make(e.shape,{values:r})},n.prototype.conv2d=function(e,t,r){this.assertNotComplex([e,t],"conv2d");for(var o=r.filterHeight,i=r.filterWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,c=r.padInfo.top,l=Ct(r.outShape,e.dtype),f=e.dataSync(),d=t.dataSync(),h=l.values,p=0;p<r.batchSize;++p)for(var g=p*e.strides[0],v=p*l.strides[0],m=0;m<r.outHeight;++m)for(var y=v+m*l.strides[1],x=m*r.strideHeight-u,w=0;w<o;w++){var _=x+w*a;if(!(_<0||_>=r.inHeight))for(var b=w*t.strides[0],C=g+_*e.strides[1],E=0;E<r.outWidth;++E)for(var S=y+E*r.outChannels,A=E*r.strideWidth-c,D=0;D<i;D++){var M=A+D*s;if(!(M<0||M>=r.inWidth))for(var B=C+M*r.inChannels,U=b+D*t.strides[1],G=0;G<r.inChannels;++G){for(var H=f[B+G],W=0;W<r.outChannels;++W)h[S+W]+=H*d[U+W];U+=r.outChannels}}}return l.toTensor()},n.prototype.conv3d=function(e,t,r){for(var o=r.filterDepth,i=r.filterHeight,a=r.filterWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.padInfo.front,f=r.padInfo.left,d=r.padInfo.top,h=Ct(r.outShape,e.dtype),p=e.dataSync(),g=t.dataSync(),v=h.values,m=0;m<r.batchSize;++m)for(var y=m*e.strides[0],x=m*h.strides[0],w=0;w<r.outDepth;++w)for(var _=x+w*h.strides[1],b=w*r.strideDepth-l,C=0;C<o;C++){var E=b+C*s;if(!(E<0||E>=r.inDepth))for(var S=C*t.strides[0],A=y+E*e.strides[1],D=0;D<r.outHeight;++D)for(var M=_+D*h.strides[2],L=D*r.strideHeight-d,B=0;B<i;B++){var U=L+B*u;if(!(U<0||U>=r.inHeight))for(var G=S+B*t.strides[1],H=A+U*e.strides[2],W=0;W<r.outWidth;++W)for(var $=M+W*r.outChannels,K=W*r.strideWidth-f,re=0;re<a;re++){var ce=K+re*c;if(!(ce<0||ce>=r.inWidth))for(var Ce=H+ce*r.inChannels,Re=G+re*t.strides[2],Fe=0;Fe<r.inChannels;++Fe){for(var Pe=p[Ce+Fe],Se=0;Se<r.outChannels;++Se)v[$+Se]+=Pe*g[Re+Se];Re+=r.outChannels}}}}return h.toTensor()},n.prototype.conv2dDerInput=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerInput");for(var o=Ct(r.inShape,"float32"),i=o.values,a=o.strides,s=a[0],u=a[1],c=a[2],l=e.dataSync(),f=e.strides,d=f[0],h=f[1],p=f[2],g=t.dataSync(),v=t.strides,m=v[0],y=v[1],x=v[2],w=r.batchSize,_=r.filterHeight,b=r.filterWidth,C=r.inChannels,E=r.inHeight,S=r.inWidth,A=r.outChannels,D=r.outHeight,M=r.outWidth,L=r.strideHeight,B=r.strideWidth,U=_-1-r.padInfo.top,G=b-1-r.padInfo.left,H=0;H<w;++H)for(var W=0;W<C;++W)for(var $=0;$<E;++$)for(var K=$-U,re=Math.max(0,Math.ceil(K/L)),ce=Math.min(D,(_+K)/L),he=0;he<S;++he){for(var Ce=he-G,Re=Math.max(0,Math.ceil(Ce/B)),Fe=Math.min(M,(b+Ce)/B),Pe=0,Se=re;Se<ce;++Se)for(var Xe=Se*L-K,nt=Re;nt<Fe;++nt)for(var Ue=d*H+h*Se+p*nt,it=m*(_-1-Xe)+y*(b-1-(nt*B-Ce))+x*W,rt=0;rt<A;++rt)Pe+=l[Ue+rt]*g[it+rt];i[s*H+u*$+c*he+W]=Pe}return o.toTensor()},n.prototype.conv3dDerInput=function(e,t,r){for(var o=Ct(r.inShape,"float32"),i=o.values,a=o.strides,s=a[0],u=a[1],c=a[2],l=a[3],f=e.dataSync(),d=e.strides,h=d[0],p=d[1],g=d[2],v=d[3],m=t.dataSync(),y=t.strides,x=y[0],w=y[1],_=y[2],b=y[3],C=r.batchSize,E=r.filterDepth,S=r.filterHeight,A=r.filterWidth,D=r.inChannels,M=r.inDepth,L=r.inHeight,B=r.inWidth,U=r.outChannels,G=r.outDepth,H=r.outHeight,W=r.outWidth,$=r.strideDepth,K=r.strideHeight,re=r.strideWidth,ce=E-1-r.padInfo.front,he=S-1-r.padInfo.top,Ce=A-1-r.padInfo.left,Re=0;Re<C;++Re)for(var Fe=0;Fe<D;++Fe)for(var Pe=0;Pe<M;++Pe)for(var Se=Pe-ce,Xe=Math.max(0,Math.ceil(Se/$)),nt=Math.min(G,(E+Se)/$),Ue=0;Ue<L;++Ue)for(var it=Ue-he,rt=Math.max(0,Math.ceil(it/K)),Ot=Math.min(H,(S+it)/K),Mt=0;Mt<B;++Mt){for(var nn=Mt-Ce,Ho=Math.max(0,Math.ceil(nn/re)),Br=Math.min(W,(A+nn)/re),Cr=0,di=Xe;di<nt;++di)for(var to=di*$-Se,yo=rt;yo<Ot;++yo)for(var da=yo*K-it,ha=Ho;ha<Br;++ha)for(var pa=h*Re+p*di+g*yo+v*ha,Hp=x*(E-1-to)+w*(S-1-da)+_*(A-1-(ha*re-nn))+b*Fe,ga=0;ga<U;++ga)Cr+=f[pa+ga]*m[Hp+ga];i[s*Re+u*Pe+c*Ue+l*Mt+Fe]=Cr}return o.toTensor()},n.prototype.conv2dDerFilter=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerFilter");for(var o=r.strideHeight,i=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=Ct(r.filterShape,"float32"),c=r.padInfo.left,l=r.padInfo.top,f=e.bufferSync(),d=t.bufferSync(),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((l-h)/o)),g=Math.min(r.outHeight,(r.inHeight+l-h)/o),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((c-v)/i)),y=Math.min(r.outWidth,(r.inWidth+c-v)/i),x=0;x<r.inChannels;++x)for(var w=0;w<r.outChannels;++w){for(var _=0,b=0;b<r.batchSize;++b)for(var C=p;C<g;++C)for(var E=h+C*o-l,S=m;S<y;++S)_+=f.get(b,E,v+S*i-c,x)*d.get(b,C,S,w);u.set(_,h,v,x,w)}return u.toTensor()},n.prototype.conv3dDerFilter=function(e,t,r){for(var o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,s=r.filterDepth,u=r.filterHeight,c=r.filterWidth,l=Ct(r.filterShape,"float32"),f=l.values,d=l.strides,h=d[0],p=d[1],g=d[2],v=d[3],m=t.dataSync(),y=t.strides,x=y[0],w=y[1],_=y[2],b=y[3],C=e.dataSync(),E=e.strides,S=E[0],A=E[1],D=E[2],M=E[3],L=r.padInfo.front,B=r.padInfo.left,U=r.padInfo.top,G=0;G<s;++G)for(var H=Math.max(0,Math.ceil((L-G)/o)),W=Math.min(r.outDepth,(r.inDepth+L-G)/o),$=G*h,K=0;K<u;++K)for(var re=Math.max(0,Math.ceil((U-K)/i)),ce=Math.min(r.outHeight,(r.inHeight+U-K)/i),he=K*p+$,Ce=0;Ce<c;++Ce)for(var Re=Math.max(0,Math.ceil((B-Ce)/a)),Fe=Math.min(r.outWidth,(r.inWidth+B-Ce)/a),Pe=Ce*g+he,Se=0;Se<r.inChannels;++Se)for(var Xe=Se*v+Pe,nt=0;nt<r.outChannels;++nt){for(var Ue=0,it=0;it<r.batchSize;++it)for(var rt=it*S,Ot=it*x,Mt=H;Mt<W;++Mt)for(var nn=(G+Mt*o-L)*A+rt,Ho=Mt*w+Ot,Br=re;Br<ce;++Br)for(var Cr=(K+Br*i-U)*D+nn,di=Br*_+Ho,to=Re;to<Fe;++to)Ue+=C[(Ce+to*a-B)*M+Cr+Se]*m[to*b+di+nt];f[Xe+nt]=Ue}return l.toTensor()},n.prototype.depthwiseConv2D=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2D");for(var o=r.filterHeight,i=r.filterWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,c=r.padInfo.top,l=r.outChannels/r.inChannels,f=Ct(r.outShape,e.dtype),d=e.dataSync(),h=t.dataSync(),p=f.values,g=0;g<r.batchSize;++g)for(var v=g*e.strides[0],m=g*f.strides[0],y=0;y<r.outHeight;++y)for(var x=m+y*f.strides[1],w=y*r.strideHeight-u,_=0;_<o;++_){var b=w+_*a;if(!(b<0||b>=r.inHeight))for(var C=_*t.strides[0],E=v+b*e.strides[1],S=0;S<r.outWidth;++S)for(var A=x+S*f.strides[2],D=S*r.strideWidth-c,M=0;M<i;++M){var L=D+M*s;if(!(L<0||L>=r.inWidth))for(var U=E+L*r.inChannels,G=A,H=C+M*t.strides[1],W=0;W<r.inChannels;++W){for(var $=d[U+W],K=0;K<l;++K)p[G+K]+=$*h[H+K];G+=l,H+=l}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var o=Ct(r.inShape,"float32"),i=o.values,a=o.strides,s=a[0],u=a[1],c=a[2],l=e.dataSync(),f=e.strides,d=f[0],h=f[1],p=f[2],g=t.dataSync(),v=t.strides,m=v[0],y=v[1],x=v[2],w=r.batchSize,_=r.filterHeight,b=r.filterWidth,C=r.inChannels,E=r.inHeight,S=r.inWidth,D=r.outHeight,M=r.outWidth,L=r.strideHeight,B=r.strideWidth,U=_-1-r.padInfo.top,G=b-1-r.padInfo.left,H=r.outChannels/C,W=0;W<w;++W)for(var $=0;$<C;++$)for(var K=0;K<E;++K)for(var re=K-U,ce=Math.max(0,Math.ceil(re/L)),he=Math.min(D,(_+re)/L),Ce=0;Ce<S;++Ce){for(var Re=Ce-G,Fe=Math.max(0,Math.ceil(Re/B)),Pe=Math.min(M,(b+Re)/B),Se=0,Xe=ce;Xe<he;++Xe)for(var nt=Xe*L-re,Ue=Fe;Ue<Pe;++Ue)for(var it=d*W+h*Xe+p*Ue,rt=m*(_-1-nt)+y*(b-1-(Ue*B-Re))+x*$,Ot=0;Ot<H;++Ot)Se+=l[it+($*H+Ot)]*g[rt+Ot];i[s*W+u*K+c*Ce+$]=Se}return o.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var o=r.strideHeight,i=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=Ct(r.filterShape,"float32"),c=r.padInfo.left,l=r.padInfo.top,f=r.outChannels/r.inChannels,d=e.bufferSync(),h=t.bufferSync(),p=0;p<a;++p)for(var g=Math.max(0,Math.ceil((l-p)/o)),v=Math.min(r.outHeight,(r.inHeight+l-p)/o),m=0;m<s;++m)for(var y=Math.max(0,Math.ceil((c-m)/i)),x=Math.min(r.outWidth,(r.inWidth+c-m)/i),w=0;w<r.outChannels;++w){for(var _=Math.trunc(w/f),b=w%f,C=0,E=0;E<r.batchSize;++E)for(var S=g;S<v;++S)for(var A=p+S*o-l,D=y;D<x;++D)C+=d.get(E,A,m+D*i-c,_)*h.get(E,S,D,w);u.set(C,p,m,_,b)}return u.toTensor()},n.prototype.tile=function(e,t){this.assertNotComplex(e,"tile");for(var r=new Array(e.rank),o=0;o<r.length;o++)r[o]=e.shape[o]*t[o];var i=Ct(r,e.dtype),a=e.bufferSync();for(o=0;o<i.values.length;++o){for(var s=i.indexToLoc(o),u=new Array(e.rank),c=0;c<u.length;c++)u[c]=s[c]%e.shape[c];var l=a.locToIndex(u);i.values[o]=a.values[l]}return i.toTensor()},n.prototype.pad=function(e,t,r){this.assertNotComplex(e,"pad");var o=t.map(function(f,d){return f[0]+e.shape[d]+f[1]}),i=t.map(function(f){return f[0]}),a=e.bufferSync(),s=Ct(o,e.dtype);0!==r&&s.values.fill(r);for(var u=0;u<e.size;u++){var c=a.indexToLoc(u),l=c.map(function(f,d){return f+i[d]});s.set.apply(s,[a.get.apply(a,c)].concat(l))}return s.toTensor()},n.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var r=new Array(e.rank),o=0;o<r.length;o++)r[o]=e.shape[t[o]];var i=e.dataSync(),a=Ct(r,e.dtype),s=e.bufferSync();for(o=0;o<e.size;++o){for(var u=s.indexToLoc(o),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[t[l]];var f=a.locToIndex(c);a.values[f]=i[o]}return a.toTensor()},n.prototype.gather=function(e,t,r){this.assertNotComplex([e,t],"gather");var o=e.shape.slice(),i=t.dataSync();o[r]=i.length;for(var a=Ct(o,e.dtype),s=e.bufferSync(),u=0;u<a.size;++u){var c=a.indexToLoc(u),l=c.slice();l[r]=i[c[r]];var f=s.locToIndex(l);a.values[u]=s.values[f]}return a.toTensor()},n.prototype.batchToSpaceND=function(e,t,r){this.assertNotComplex([e],"batchToSpaceND");var o=t.reduce(function(l,f){return l*f}),i=B0(e.shape,t,o),a=V0(i.length,t.length),s=U0(e.shape,t,o),u=i4(r,t.length),c=a4(s,r,t.length);return e.reshape(i).transpose(a).reshape(s).slice(u,c)},n.prototype.spaceToBatchND=function(e,t,r){this.assertNotComplex([e],"spaceToBatchND");var o=t.reduce(function(f,d){return f*d}),i=[[0,0]];i.push.apply(i,r);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var s=e.pad(i),u=B0(s.shape,t,o,!1),c=V0(u.length,t.length,!1),l=U0(s.shape,t,o,!1);return s.reshape(u).transpose(c).reshape(l)},n.prototype.pool=function(e,t,r){this.assertNotComplex(e,"pool");for(var o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,f=t.padInfo.left,d="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=e.dataSync(),p=Ct(t.outShape,e.dtype),g=p.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],y=t.outShape[3],x=0;x<t.batchSize;++x)for(var w=x*v,_=x*e.strides[0],b=0;b<t.inChannels;++b)for(var C=0;C<t.outHeight;++C)for(var E=C*o-l,S=Math.max(0,E),A=Math.min(t.inHeight,u+E),D=w+C*m,M=0;M<t.outWidth;++M){for(var L=M*i-f,B=Math.max(0,L),U=Math.min(t.inWidth,c+L),G=d,H=0,W=0,$=S;$<A;$+=a){for(var K=_+$*e.strides[1],re=B;re<U;re+=s){var ce=h[K+re*e.strides[2]+b];"max"===r&&ce>G?G=ce:"avg"===r&&(H+=ce,W++)}if(isNaN(G))break}g[D+M*y+b]="avg"===r?H/W:G}return p.toTensor()},n.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},n.prototype.maxPoolPositions=function(e,t){for(var r=Ct(t.outShape,"int32"),o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,f=t.padInfo.left,d=e.bufferSync(),h=0;h<t.batchSize;++h)for(var p=0;p<t.inChannels;++p)for(var g=0;g<t.outHeight;++g){for(var v=g*o-l,m=v;m<0;)m+=a;for(var y=Math.min(t.inHeight,u+v),x=0;x<t.outWidth;++x){for(var w=x*i-f,_=w;_<0;)_+=s;for(var b=Math.min(t.inWidth,c+w),C=Number.NEGATIVE_INFINITY,E=-1,S=m;S<y;S+=a)for(var A=S-v,D=_;D<b;D+=s){var M=D-w,L=d.get(h,S,D,p);L>C&&(C=L,E=A*c+M)}r.set(E,h,g,x,p)}}return r.toTensor()},n.prototype.maxPoolBackprop=function(e,t,r,o){this.assertNotComplex([t,r],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,o),a=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,c=o.dilationWidth,l=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=f-1-o.padInfo.left,h=l-1-o.padInfo.top,p=Ct(t.shape,"float32"),g=i.bufferSync(),v=e.bufferSync(),m=0;m<o.batchSize;++m)for(var y=0;y<o.inChannels;++y)for(var x=0;x<o.inHeight;++x)for(var w=0;w<o.inWidth;++w){for(var _=x-h,b=w-d,C=0,E=0;E<l;E+=u){var S=(_+E)/a;if(!(S<0||S>=o.outHeight||Math.floor(S)!==S))for(var A=0;A<f;A+=c){var D=(b+A)/s;if(!(D<0||D>=o.outWidth||Math.floor(D)!==D)){var M=l*f-1-g.get(m,S,D,y)===E*f+A?1:0;0!==M&&(C+=v.get(m,S,D,y)*M)}}}p.set(C,m,x,w,y)}return p.toTensor()},n.prototype.avgPoolBackprop=function(e,t,r){this.assertNotComplex([e,t],"avgPoolBackprop");for(var o=r.strideHeight,i=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=f-1-r.padInfo.left,h=l-1-r.padInfo.top,p=Ct(t.shape,"float32"),g=1/(a*s),v=e.bufferSync(),m=0;m<r.batchSize;++m)for(var y=0;y<r.inChannels;++y)for(var x=0;x<r.inHeight;++x)for(var w=0;w<r.inWidth;++w){for(var _=x-h,b=w-d,C=0,E=0;E<l;E+=u){var S=(_+E)/o;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var A=0;A<f;A+=c){var D=(b+A)/i;D<0||D>=r.outWidth||Math.floor(D)!==D||(C+=v.get(m,S,D,y))}}p.set(C*g,m,x,w,y)}return p.toTensor()},n.prototype.cast=function(e,t){return g4(e,t,this)},n.prototype.reshape=function(e,t){return S2(e,t)},n.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},n.prototype.resizeBilinear=function(e,t,r,o){this.assertNotComplex(e,"resizeBilinear");for(var i=e.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.dataSync(),f=new Float32Array(Be([a,t,r,c])),d=[o&&t>1?s-1:s,o&&r>1?u-1:u],h=[o&&t>1?t-1:t,o&&r>1?r-1:r],p=0,g=d[0]/h[0],v=d[1]/h[1],m=0;m<a;m++)for(var y=0;y<t;y++)for(var x=g*y,w=Math.floor(x),_=x-w,b=Math.min(s-1,Math.ceil(x)),C=m*e.strides[0]+w*e.strides[1],E=m*e.strides[0]+b*e.strides[1],S=0;S<r;S++)for(var A=v*S,D=Math.floor(A),M=A-D,L=Math.min(u-1,Math.ceil(A)),B=C+D*e.strides[2],U=E+D*e.strides[2],G=C+ +L*e.strides[2],H=E+L*e.strides[2],W=0;W<c;W++){var $=l[B+W],K=l[U+W],re=$+(l[G+W]-$)*M;f[p++]=re+(K+(l[H+W]-K)*M-re)*_}return Sn(f,[a,t,r,c])},n.prototype.resizeBilinearBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=e.shape,l=c[1],f=c[2],d=new Float32Array(i*a*s*u),h=[r&&l>1?a-1:a,r&&f>1?s-1:s],p=[r&&l>1?l-1:l,r&&f>1?f-1:f],g=h[0]/p[0],v=h[1]/p[1],m=e.dataSync(),y=0,x=0;x<i;x++)for(var w=x*t.strides[0],_=0;_<l;_++)for(var b=_*g,C=Math.floor(b),E=Math.min(Math.ceil(b),a-1),S=w+C*t.strides[1],A=w+E*t.strides[1],D=b-C,M=1-D,L=0;L<f;L++)for(var B=L*v,U=Math.floor(B),G=Math.min(Math.ceil(B),s-1),H=B-U,W=1-H,$=S+U*t.strides[2],K=S+G*t.strides[2],re=A+U*t.strides[2],ce=A+G*t.strides[2],he=M*W,Ce=M*H,Re=D*W,Fe=D*H,Pe=0;Pe<u;Pe++){var Se=m[y++];d[$+Pe]+=Se*he,d[K+Pe]+=Se*Ce,d[re+Pe]+=Se*Re,d[ce+Pe]+=Se*Fe}return ea(d,[i,s,a,u],t.dtype)},n.prototype.resizeNearestNeighbor=function(e,t,r,o){this.assertNotComplex(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.dataSync(),f=new Float32Array(a*t*r*c),d=[o&&t>1?s-1:s,o&&r>1?u-1:u],h=[o&&t>1?t-1:t,o&&r>1?r-1:r],p=d[0]/h[0],g=d[1]/h[1],v=0,m=0;m<a;m++)for(var y=m*e.strides[0],x=0;x<t;x++)for(var w=p*x,_=y+Math.min(s-1,o?Math.round(w):Math.floor(w))*e.strides[1],b=0;b<r;b++)for(var C=g*b,E=_+Math.min(u-1,o?Math.round(C):Math.floor(C))*e.strides[2],S=0;S<c;S++)f[v++]=l[E+S];return Sn(f,[a,t,r,c],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=e.shape,l=c[1],f=c[2],d=new Float32Array(i*a*s*u),h=e.dataSync(),p=[r&&l>1?a-1:a,r&&f>1?s-1:s],g=[r&&l>1?l-1:l,r&&f>1?f-1:f],v=p[0]/g[0],m=p[1]/g[1],y=1/v,x=1/m,w=2*Math.ceil(y)+2,_=2*Math.ceil(x)+2,b=0;b<i;b++)for(var C=b*t.strides[0],E=0;E<a;E++)for(var S=C+E*t.strides[1],A=Math.floor(E*y),D=Math.floor(A-w/2),M=0;M<s;M++)for(var L=S+M*t.strides[2],B=Math.floor(M*x),U=Math.floor(B-_/2),G=0;G<u;G++){for(var H=0,W=0;W<w;W++){var $=W+D;if(!($<0||$>=l)){var K=C+$*e.strides[1],re=$*v;if(E===Math.min(a-1,r?Math.round(re):Math.floor(re)))for(var ce=0;ce<_;ce++){var he=ce+U;if(!(he<0||he>=f)){var Ce=K+he*e.strides[2],Re=he*m;M===Math.min(s-1,r?Math.round(Re):Math.floor(Re))&&(H+=h[Ce+G])}}}}d[L+G]=H}return ea(d,t.shape,t.dtype)},n.prototype.batchNormalization=function(e,t,r,o,i,a){this.assertNotComplex([e,t,r,i,a],"batchNorm");for(var s=e.dataSync(),u=t.dataSync(),c=r.dataSync(),l=i?i.dataSync():new Float32Array([1]),f=a?a.dataSync():new Float32Array([0]),d=new Float32Array(s.length),h=f.length,p=l.length,g=c.length,v=u.length,m=0,y=0,x=0,w=0,_=0;_<s.length;++_)d[_]=f[m++]+(s[_]-u[y++])*l[x++]/Math.sqrt(c[w++]+o),m>=h&&(m=0),y>=v&&(y=0),x>=p&&(x=0),w>=g&&(w=0);return ea(d,e.shape)},n.prototype.localResponseNormalization4D=function(e,t,r,o,i){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],s=a-1,u=e.dataSync(),c=e.size,l=new Float32Array(c);function f(g){for(var v=g%a,m=g-v+Math.max(0,v-t),y=g-v+Math.min(v+t,s),x=0;m<=y;m++){var w=u[m];x+=w*w}return x}for(var d=0;d<c;d++){var h=f(d),p=u[d]*Math.pow(r+o*h,-i);l[d]=p}return ea(l,e.shape)},n.prototype.LRNGrad=function(e,t,r,o,i,a,s){this.assertNotComplex(e,"LRNGrad");for(var u=e.shape[3],c=e.dataSync(),l=t.dataSync(),f=r.dataSync(),d=new Float32Array(e.size),h=e.size,p=0;p<h;p++){for(var g=p%u,v=p-g+Math.max(0,g-o),m=p-g+Math.min(u,g+o+1),y=0,x=v;x<m;x++)y+=Math.pow(l[x],2);for(y=a*y+i,x=v;x<m;x++){var w=-2*a*s*l[x]*f[p]/y;p===x&&(w+=Math.pow(y,-s)),d[x]+=w*=c[p]}}return ea(d,e.shape)},n.prototype.multinomial=function(e,t,r,o){this.assertNotComplex(e,"multinomial");for(var i=t?e:Cu(e),a=i.shape[0],s=i.shape[1],u=zn([a,r],"int32"),c=u.dataSync(),l=i.dataSync(),f=0;f<a;++f){var d=f*s,h=new Float32Array(s-1);h[0]=l[d];for(var p=1;p<h.length;++p)h[p]=h[p-1]+l[d+p];for(var g=Nk(o.toString()),v=f*r,m=0;m<r;++m){var y=g();c[v+m]=h.length;for(var x=0;x<h.length;x++)if(y<h[x]){c[v+m]=x;break}}}return u},n.prototype.oneHot=function(e,t,r,o){this.assertNotComplex(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(o);for(var a=e.dataSync(),s=0;s<e.size;++s)a[s]>=0&&a[s]<t&&(i[s*t+a[s]]=r);return W0(i,[e.size,t],"int32")},n.prototype.nonMaxSuppression=function(e,t,r,o,i){return this.assertNotComplex(e,"nonMaxSuppression"),A2(e.dataSync(),t.dataSync(),r,o,i)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,t){for(var r=e.shape[0],o=e.shape[1],i=Ct(e.shape,"float32"),a=Ct(e.shape,"float32"),s=Ga(e).as2D(r,o),u=Eu(e).as2D(r,o),c=0;c<r;c++)for(var l=s.slice([c,0],[1,o]),f=u.slice([c,0],[1,o]),d=vo(l,f),h=this.fftImpl(d,t).dataSync(),p=0;p<o;p++){var g=m4(h,p);i.values[c*o+p]=g.real,a.values[c*o+p]=g.imag}return vo(i.toTensor(),a.toTensor()).as2D(r,o)},n.prototype.fftImpl=function(e,t){var r=e.as1D(),o=r.size;if(this.isExponentOf2(o)){var i=this.fftRadix2(r,o,t).as2D(e.shape[0],e.shape[1]);return t&&(i=vo(Ga(i).div(oe(o)),Eu(i).div(oe(o)))),i}var a=e.dataSync(),s=function dse(n){for(var e=new Float32Array(n.length/2),t=new Float32Array(n.length/2),r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}(this.fourierTransformByMatmul(a,o,t));return vo(s.real,s.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return 0==(e&e-1)},n.prototype.fftRadix2=function(e,t,r){if(1===t)return e;var o=e.dataSync(),i=t/2,a=function hse(n){for(var e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e),o=0;o<n.length;o+=4)t[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:t,imag:r}}(o),s=vo(a.real,a.imag).as1D(),u=function pse(n){for(var e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e),o=2;o<n.length;o+=4)t[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:t,imag:r}}(o),c=vo(u.real,u.imag).as1D();s=this.fftRadix2(s,i,r),c=this.fftRadix2(c,i,r);var l=function vse(n,e){for(var t=new Float32Array(n/2),r=new Float32Array(n/2),o=0;o<Math.ceil(n/2);o++){var i=(e?2:-2)*Math.PI*(o/n);t[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:t,imag:r}}(t,r),f=vo(l.real,l.imag).mul(c),d=s.add(f),h=s.sub(f),p=Ga(d).concat(Ga(h)),g=Eu(d).concat(Eu(h));return vo(p,g).as1D()},n.prototype.fourierTransformByMatmul=function(e,t,r){for(var o=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,s=0,u=0;u<t;u++){var c=mse(i*u,t,r),l=m4(e,u);a+=l.real*c.real-l.imag*c.imag,s+=l.real*c.imag+l.imag*c.real}r&&(a/=t,s/=t),gse(o,a,s,i)}return o},n.prototype.depthToSpace=function(e,t,r){P("NHWC"===r,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),P(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var o=e.shape[0],i=e.shape[1],a=e.shape[2],s=e.shape[3],u=i*t,c=a*t,l=s/(t*t),f=e.dataSync(),d=new Float32Array(o*u*c*l),h=0,p=0;p<o;++p)for(var g=0;g<u;++g)for(var v=Math.floor(g/t),m=g%t,y=0;y<c;++y)for(var x=Math.floor(y/t),w=(m*t+y%t)*l,_=0;_<l;++_)d[h++]=f[_+w+s*(x+a*(v+i*p))];return ea(d,[o,u,c,l])},n.prototype.broadcastedBinaryOp=function(e,t,r,o){var i=It(e.shape,t.shape),a=Ct(i,r),s=e.dataSync(),u=t.dataSync(),c=_f(e.shape,i),l=_f(t.shape,i),f=a.values;if(c.length+l.length===0)for(var d=0;d<f.length;++d)f[d]=o(s[d%s.length],u[d%u.length]);else{var h=e.bufferSync(),p=t.bufferSync(),g=function(v){var m=a.indexToLoc(v),y=m.slice(-e.rank);c.forEach(function(b){return y[b]=0});var x=h.locToIndex(y),w=m.slice(-t.rank);l.forEach(function(b){return w[b]=0});var _=p.locToIndex(w);f[v]=o(s[x],u[_])};for(d=0;d<f.length;++d)g(d)}return a.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,t,r){var o=It(e.shape,t.shape),i=Ct(o,"float32"),a=Ct(o,"float32"),s=e.dataSync(),u=t.dataSync(),c=_f(e.shape,o),l=_f(t.shape,o),f=i.values,d=a.values;if(c.length+l.length===0)for(var h=0;h<f.length;h++){var p=h%s.length,g=h%u.length,v=r(s[2*p],s[2*p+1],u[2*g],u[2*g+1]);f[h]=v.real,d[h]=v.imag}else{var m=this.data.get(e.dataId).complexTensors.real.bufferSync(),y=this.data.get(t.dataId).complexTensors.real.bufferSync(),x=function(w){var _=i.indexToLoc(w),b=_.slice(-e.rank);c.forEach(function(D){return b[D]=0});var C=m.locToIndex(b),E=_.slice(-t.rank);l.forEach(function(D){return E[D]=0});var S=y.locToIndex(E),A=r(s[2*C],s[2*C+1],u[2*S],u[2*S+1]);f[w]=A.real,d[w]=A.imag};for(h=0;h<f.length;h++)x(h)}return this.complex(i.toTensor(),a.toTensor())},n.prototype.split=function(e,t,r){return y4(e,t,r)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.cropAndResize=function(e,t,r,o,i,a){for(var s=e.shape,u=s[0],c=s[1],l=s[2],f=s[3],d=t.shape[0],h=o[0],p=o[1],g=Ct([d,h,p,f],e.dtype),v=t.dataSync(),m=r.dataSync(),y=e.dataSync(),x=e.strides,w=g.strides,_=0;_<d;_++){var b=4*_,C=v[b],E=v[b+1],S=v[b+2],A=v[b+3],D=m[_];if(!(D>=u))for(var M=h>1?(S-C)*(c-1)/(h-1):0,L=p>1?(A-E)*(l-1)/(p-1):0,B=0;B<h;B++){var U=h>1?C*(c-1)+B*M:.5*(C+S)*(c-1);if(U<0||U>c-1)for(var G=0;G<p;G++)for(var H=0;H<f;H++){var W=H+G*w[2]+B*w[1]+_*w[0];g.values[W]=a}else if("bilinear"===i){var $=Math.floor(U),K=Math.ceil(U),re=U-$;for(G=0;G<p;G++)if((nt=p>1?E*(l-1)+G*L:.5*(E+A)*(l-1))<0||nt>l-1)for(H=0;H<f;H++)g.values[W=H+G*w[2]+B*w[1]+_*w[0]]=a;else{var ce=Math.floor(nt),he=Math.ceil(nt),Ce=nt-ce;for(H=0;H<f;H++){var Re=y[W=H+ce*x[2]+$*x[1]+D*x[0]],Fe=y[W=H+he*x[2]+$*x[1]+D*x[0]],Pe=y[W=H+ce*x[2]+K*x[1]+D*x[0]],Se=Re+(Fe-Re)*Ce,Xe=Pe+(y[W=H+he*x[2]+K*x[1]+D*x[0]]-Pe)*Ce;g.values[W=H+G*w[2]+B*w[1]+_*w[0]]=Se+(Xe-Se)*re}}}else for(G=0;G<p;++G){var nt;if((nt=p>1?E*(l-1)+G*L:.5*(E+A)*(l-1))<0||nt>l-1)for(H=0;H<f;H++)g.values[W=H+G*w[2]+B*w[1]+_*w[0]]=a;else{var Ue=Math.round(nt),it=Math.round(U);for(H=0;H<f;H++)g.values[H+G*w[2]+B*w[1]+_*w[0]]=y[H+Ue*x[2]+it*x[1]+D*x[0]]}}}}return g.toTensor()},n.prototype.sparseToDense=function(e,t,r,o){var i=H0(0,e,r);return this.scatter(e,t,r,i.outputSize,i.sliceSize,i.numUpdates,i.sliceRank,i.strides,o,!1)},n.prototype.gatherND=function(e,t){var r=t.shape,o=r[r.length-1],i=u4(e,t),a=i[0],s=i[1],u=i[2],c=i[3];if(0===s)return Sn([],a,e.dtype);for(var l=new Uh([s,u],e.dtype),f=t.dataSync(),d=e.dataSync(),h=0;h<s;h++){for(var p=[],g=0,v=0;v<o;v++){var m=f[h*o+v];g+=m*c[v],p.push(m)}if(g<0||g>=e.size/u)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var y=0;y<u;y++)l.values[h*u+y]=d[g*u+y]}return l.toTensor().reshape(a)},n.prototype.scatterND=function(e,t,r){var o=H0(0,e,r),i=o.sliceRank,a=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize,l=oe(0);return this.scatter(e,t,r,c,s,a,i,u,l,!0)},n.prototype.fill=function(e,t,r){var o=Ph(r=r||yf(t),Be(e));return o.fill(t),se.make(e,{values:o},r)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var t=Ph(e.dtype,Be(e.shape));return se.make(e.shape,{values:t},e.dtype)},n.prototype.scatter=function(e,t,r,o,i,a,s,u,c,l){var f=[o/i,i],d=e.dataSync(),h=t.dataSync();if(0===o)return Sn([],r,t.dtype);var p=new Uh(f,t.dtype);p.values.fill(c.dataSync()[0]);for(var g=0;g<a;g++){for(var v=[],m=0,y=0;y<s;y++){var x=d[g*s+y];v.push(x),m+=x*u[y]}if(m<0||m>=o/i)throw new Error("Invalid indices: "+v+" does not index into "+r);for(var w=0;w<i;w++)l?p.values[m*i+w]+=h[g*i+w]:p.values[m*i+w]=0===t.rank?h[0]:h[g*i+w]}return p.toTensor().reshape(r)},n}();N.registerBackend("cpu",function(){return new _0e},1),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate;var Q2={float32:4,int32:4,uint16:2,uint8:1,bool:1};function wF(n,e){for(var t={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,f=Be(l),d=void 0;if("quantization"in s){var h=s.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Q2[h.dtype],g=n.slice(r,r+f*p),v="uint8"===h.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===c)d=Float32Array.from(v,function(x){return x*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=Int32Array.from(v,function(x){return Math.round(x*h.scale+h.min)})}r+=f*p}else{var m=Q2[c];if(g=n.slice(r,r+f*m),"float32"===c)d=new Float32Array(g);else if("int32"===c)d=new Int32Array(g);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=new Uint8Array(g)}r+=f*m}var y=void 0;if("float32"===c)y=Sn(d,l,"float32");else if("int32"===c)y=Sn(d,l,"int32");else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);y=Sn(d,l,"bool")}t[u]=y},i=0,a=e;i<a.length;i++)o(a[i]);return t}function E0e(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(e),o=0;return t.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var J2=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function _F(n){return J2?Buffer.byteLength(n):new Blob([n]).size}function eb(n){var e=0;n.forEach(function(o){e+=o.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(o){t.set(new Uint8Array(o),r),r+=o.byteLength}),t.buffer}function bF(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function ip(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:_F(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:_F(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var oi=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var o=[];return("load"===t?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(i){var a=i(e,r);null!==a&&o.push(a)}),o},n}(),Rf="://",Du=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(e,t){P(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(Rf)&&(e=e.slice(0,e.indexOf(Rf))),P(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();P(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function tm(n){if(-1===n.indexOf(Rf))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Du.getSchemes().join(","));return{scheme:n.split(Rf)[0],path:n.split(Rf)[1]}}function CF(n,e,t){return void 0===t&&(t=!1),gt(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,f;return vt(this,function(d){switch(d.label){case 0:return P(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),P((r=oi.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),P(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),o=r[0],P((i=oi.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),P(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=i[0],s=tm(n).scheme,u=tm(n).path,c=s===tm(n).scheme,[4,o.load()];case 1:return l=d.sent(),t&&c?[4,Du.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return f=d.sent(),!t||c?[3,6]:[4,Du.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var tb="tensorflowjs",Lc="models_store",Tu="model_info_store";function EF(){if(!N.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function rb(n){var e=n.result;e.createObjectStore(Lc,{keyPath:"modelPath"}),e.createObjectStore(Tu,{keyPath:"modelPath"})}var Nf=function(){function n(e){if(this.indexedDB=EF(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return gt(this,void 0,void 0,function(){return vt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return gt(this,void 0,void 0,function(){return vt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open(tb,1);a.onupgradeneeded=function(){return rb(a)},a.onsuccess=function(){var s=a.result;if(null==t){var u=s.transaction(Lc,"readonly"),c=u.objectStore(Lc).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(g){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,f=ip(t),d=s.transaction(Tu,"readwrite"),h=d.objectStore(Tu),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:f});p.onsuccess=function(){var g=(l=s.transaction(Lc,"readwrite")).objectStore(Lc).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return o({modelArtifactsInfo:f})},g.onerror=function(v){var m=(h=d.objectStore(Tu)).delete(r.modelPath);m.onsuccess=function(){return s.close(),i(g.error)},m.onerror=function(y){return s.close(),i(g.error)}}},p.onerror=function(g){return s.close(),i(p.error)},d.oncomplete=function(){null==l?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},n.URL_SCHEME="indexeddb://",n}(),SF=function(n){return N.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Nf.URL_SCHEME)?function k0e(n){return new Nf(n)}(n.slice(Nf.URL_SCHEME.length)):null};oi.registerSaveRouter(SF),oi.registerLoadRouter(SF);var L0e=function(){function n(){this.indexedDB=EF()}return n.prototype.listModels=function(){return gt(this,void 0,void 0,function(){var e=this;return vt(this,function(t){return[2,new Promise(function(r,o){var i=e.indexedDB.open(tb,1);i.onupgradeneeded=function(){return rb(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Tu,"readonly"),u=s.objectStore(Tu).getAll();u.onsuccess=function(){for(var c={},l=0,f=u.result;l<f.length;l++){var d=f[l];c[d.modelPath]=d.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},n.prototype.removeModel=function(e){return gt(this,void 0,void 0,function(){var t=this;return vt(this,function(r){return e=function F0e(n){return n.startsWith(Nf.URL_SCHEME)?n.slice(Nf.URL_SCHEME.length):n}(e),[2,new Promise(function(o,i){var a=t.indexedDB.open(tb,1);a.onupgradeneeded=function(){return rb(a)},a.onsuccess=function(){var s,u=a.result,c=u.transaction(Tu,"readwrite"),l=c.objectStore(Tu),f=l.get(e);f.onsuccess=function(){if(null==f.result)return u.close(),i(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var d=l.delete(e),h=function(){var p=(s=u.transaction(Lc,"readwrite")).objectStore(Lc).delete(e);p.onsuccess=function(){return o(f.result.modelArtifactsInfo)},p.onerror=function(g){return i(f.error)}};d.onsuccess=h,d.onerror=function(p){return h(),u.close(),i(f.error)}},f.onerror=function(d){return u.close(),i(f.error)},c.oncomplete=function(){null==s?u.close():s.oncomplete=function(){return u.close()}}},a.onerror=function(s){return i(a.error)}})]})})},n}();if(N.get("IS_BROWSER"))try{Du.registerManager(Nf.URL_SCHEME,new L0e)}catch{}var Ps="/",Of="tensorflowjs_models",AF="info",B0e="model_topology",V0e="weight_specs",U0e="weight_data",H0e="model_metadata";function IF(n){return{info:[Of,n,AF].join(Ps),topology:[Of,n,B0e].join(Ps),weightSpecs:[Of,n,V0e].join(Ps),weightData:[Of,n,U0e].join(Ps),modelMetadata:[Of,n,H0e].join(Ps)}}function W0e(n){var e=n.split(Ps);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Ps)}var Mf=function(){function n(e){if(!N.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=IF(this.modelPath)}return n.prototype.save=function(e){return gt(this,void 0,void 0,function(){var t,r,o;return vt(this,function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),o=ip(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function S0e(n){return J2?Buffer.from(n).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(n)))}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return gt(this,void 0,void 0,function(){var e,t,r,o,i,a,s;return vt(this,function(u){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=o,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function A0e(n){if(J2){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),o=0;o<t.length;++o)r.set([t.charCodeAt(o)],o);return r.buffer}(s),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),DF=function(n){return N.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Mf.URL_SCHEME)?function z0e(n){return new Mf(n)}(n.slice(Mf.URL_SCHEME.length)):null};oi.registerSaveRouter(DF),oi.registerLoadRouter(DF);var j0e=function(){function n(){P(N.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),P(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return gt(this,void 0,void 0,function(){var e,t,r,o,i,a;return vt(this,function(s){for(e={},t=Of+Ps,r=Ps+AF,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(t)&&i.endsWith(r)&&(a=W0e(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},n.prototype.removeModel=function(e){return gt(this,void 0,void 0,function(){var t,r;return vt(this,function(o){if(e=function G0e(n){return n.startsWith(Mf.URL_SCHEME)?n.slice(Mf.URL_SCHEME.length):n}(e),t=IF(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(N.get("IS_BROWSER"))try{Du.registerManager(Mf.URL_SCHEME,new j0e)}catch{}var $0e="model",q0e=".json",X0e=".weights.bin",ob=function(){function n(e){if(!N.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),null!=e&&0!==e.length||(e=$0e),this.modelTopologyFileName=e+q0e,this.weightDataFileName=e+X0e}return n.prototype.save=function(e){return gt(this,void 0,void 0,function(){var t,i,a,s;return vt(this,function(u){if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return i=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,a.click(),null!=e.weightData&&((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,s.click()),[2,{modelArtifactsInfo:ip(e)}]})})},n.URL_SCHEME="downloads://",n}(),K0e=function(){function n(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return gt(this,void 0,void 0,function(){var e,t,r=this;return vt(this,function(o){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===t.length&&i({modelTopology:l});var f=c.weightsManifest;if(null!=f){var d;try{d=r.checkManifestAndWeightFiles(f,t)}catch(v){return void a(v)}var h=[],p=[],g=[];f.forEach(function(v){v.paths.forEach(function(m){p.push(m),g.push(null)}),h.push.apply(h,v.weights)}),f.forEach(function(v){v.paths.forEach(function(m){var y=new FileReader;y.onload=function(x){var w=x.target.result,_=p.indexOf(m);g[_]=w,-1===g.indexOf(null)&&i({modelTopology:l,weightSpecs:h,weightData:eb(g)})},y.onerror=function(x){return a("Failed to weights data from file of path '"+m+"'.")},y.readAsArrayBuffer(d[m])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],o=t.map(function(u){return bF(u.name)}),i={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var c=bF(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=t[o.indexOf(c)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return i},n}();function TF(n,e,t,r){var i;P(null!=(i=n)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(i,a){P(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),P(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),P(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(t=t??0,r=r??1);var o=0;return Promise.all(n.map(function(i){return i.then(function(a){var s=t+ ++o/n.length*(r-t);return e(s),a}),i}))}function RF(n,e){return gt(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l;return vt(this,function(f){switch(f.label){case 0:return null==e&&(e={}),t=null==e.fetchFunc?fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit)}),o=0,i=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=f.sent(),[3,4];case 2:return[4,TF(r,e.onProgress,o,i)];case 3:a=f.sent(),f.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,c=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=f.sent(),[3,8];case 6:return[4,TF(s,e.onProgress,u,c)];case 7:l=f.sent(),f.label=8;case 8:return[2,l]}})})}function NF(n){var e=this;return function(t,r,o){return void 0===r&&(r=""),gt(e,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p;return vt(this,function(g){switch(g.label){case 0:if(i=t.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],u=[],t.forEach(function(v,m){var y=0;v.weights.forEach(function(x){var _=Q2["quantization"in x?x.quantization.dtype:x.dtype]*Be(x.shape),b=function(){i[m]=!0,null==a[m]&&(a[m]=[]),a[m].push({manifestEntry:x,groupOffset:y,sizeBytes:_})};null!=o?o.forEach(function(C,E){C===x.name&&(b(),s[E]=!0)}):b(),u.push(x.name),y+=_})}),!s.every(function(v){return v}))throw c=o.filter(function(v,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=i.reduce(function(v,m,y){return m&&v.push(y),v},[]),f=[],l.forEach(function(v){t[v].paths.forEach(function(m){var y=r+(r.endsWith("/")?"":"/")+m;f.push(y)})}),[4,n(f)];case 1:return d=g.sent(),h={},p=0,l.forEach(function(v){for(var m=t[v].paths.length,y=0,x=0;x<m;x++)y+=d[p+x].byteLength;for(var w=new ArrayBuffer(y),_=new Uint8Array(w),b=0,C=0;C<m;C++){var E=new Uint8Array(d[p+C]);_.set(E,b),b+=E.byteLength}a[v].forEach(function(S){var A=wF(w.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var D in A)h[D]=A[D]}),p+=m}),[2,h]}})})}}oi.registerSaveRouter(function(n){return N.get("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ob.URL_SCHEME)?function Z0e(n){return void 0===n&&(n="model"),new ob(n)}(n.slice(ob.URL_SCHEME.length)):null});var OF=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null==t.fetchFunc){var r=N.global.fetch;if(void 0===r)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");t.fetchFunc=r.bind(N.global)}else P("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(o,i){return t.fetchFunc(o,i).catch(function(a){throw new Error("Request for "+o+" failed due to error: "+a)})},P(null!=e&&e.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(e)&&P(2===e.length,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return gt(this,void 0,void 0,function(){var t,i;return vt(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:ip(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},n.prototype.load=function(){return gt(this,void 0,void 0,function(){var e,t,r,o,i,a,s,u;return vt(this,function(c){switch(c.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(e=c.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,e.json()];case 3:return t=c.sent(),[3,5];case 4:throw c.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.weightsManifest,null==(o=t.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:u=c.sent(),a=u[0],s=u[1],c.label=7;case 7:return[2,{modelTopology:o,weightSpecs:a,weightData:s}]}})})},n.prototype.loadWeights=function(e){return gt(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,f,d;return vt(this,function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function nme(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?");return[n.substring(0,e)+"/",t>e?n.substring(t):""]}(t),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=e;u<c.length;u++)s.push.apply(s,c[u].weights);return f=[],e.forEach(function(p){p.paths.forEach(function(g){f.push(a+g+i)})}),[4,RF(f,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return d=h.sent(),[2,[s,eb(d)]]}})})},n.prototype.getFetchFunc=function(){return this.fetchFunc},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function ib(n){return null!=n.match(OF.URL_SCHEME_REGEX)}var MF=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return ib(t)}):ib(n))?PF(n,{onProgress:e}):null};function PF(n,e){return new OF(n,e)}oi.registerSaveRouter(MF),oi.registerLoadRouter(MF);var rme=function(){function n(e,t,r){this.modelTopology=e,this.weightSpecs=t,this.weightData=r}return n.prototype.load=function(){return gt(this,void 0,void 0,function(){var e;return vt(this,function(t){return e={},null!=this.modelTopology&&(e=O0({modelTopology:this.modelTopology},e)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(e=O0({weightSpecs:this.weightSpecs},e)),null!=this.weightData&&this.weightData.byteLength>0&&(e=O0({weightData:this.weightData},e)),[2,e]})})},n}(),ome=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return gt(this,void 0,void 0,function(){return vt(this,function(t){return[2,this.saveHandler(e)]})})},n}();Object.freeze({browserFiles:function Q0e(n){return new K0e(n)},browserHTTPRequest:PF,concatenateArrayBuffers:eb,decodeWeights:wF,encodeWeights:function C0e(n){return gt(this,void 0,void 0,function(){var e,t,r,o;return vt(this,function(i){switch(i.label){case 0:for(r in e=[],t=[],n){if("float32"!==(o=n[r]).dtype&&"int32"!==o.dtype&&"bool"!==o.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);e.push({name:r,shape:o.shape,dtype:o.dtype}),t.push(o.data())}return[4,Promise.all(t)];case 1:return[2,{data:E0e(i.sent()),specs:e}]}})})},fromMemory:function ime(n,e,t){return new rme(n,e,t)},getLoadHandlers:function(n,e){return oi.getLoadHandlers(n)},getModelArtifactsInfoForJSON:ip,getSaveHandlers:function(n){return oi.getSaveHandlers(n)},isHTTPScheme:ib,loadWeights:function J0e(n,e,t,r){return void 0===e&&(e=""),gt(this,void 0,void 0,function(){return vt(this,function(o){return[2,NF(function(i){return RF(i,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return oi.registerLoadRouter(n)},registerSaveRouter:function(n){return oi.registerSaveRouter(n)},weightsLoaderFactory:NF,withSaveHandler:function ame(n){return new ome(n)},copyModel:function M0e(n,e){return gt(this,void 0,void 0,function(){return vt(this,function(t){switch(t.label){case 0:return[4,CF(n,e,!1)];case 1:return[2,t.sent()]}})})},listModels:function N0e(){return gt(this,void 0,void 0,function(){var n,e,t,r,o,i,a;return vt(this,function(s){switch(s.label){case 0:n=Du.getSchemes(),e={},t=0,r=n,s.label=1;case 1:return t<r.length?[4,Du.getManager(o=r[t]).listModels()]:[3,4];case 2:for(a in i=s.sent())e[o+Rf+a]=i[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function P0e(n,e){return gt(this,void 0,void 0,function(){return vt(this,function(t){switch(t.label){case 0:return[4,CF(n,e,!0)];case 1:return[2,t.sent()]}})})},removeModel:function O0e(n){return gt(this,void 0,void 0,function(){var e;return vt(this,function(t){switch(t.label){case 0:return e=tm(n),[4,Du.getManager(e.scheme).removeModel(e.path)];case 1:return[2,t.sent()]}})})}});var ume=V({confusionMatrix_:function sme(n,e,t){var r=O(n,"labels","confusionMatrix"),o=O(e,"predictions","confusionMatrix");P(null==t||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),P(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),P(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),P(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),P(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var i=H2(r.asType("int32"),t),a=H2(o.asType("int32"),t);return i.transpose().matMul(a).asType("int32")}});Object.freeze({confusionMatrix:ume});var fme=V({fromPixels_:function cme(n,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return N.engine.fromPixels(n,e)}}),dme=Object.freeze({toPixels:function lme(n,e){return gt(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,f,d,h,p,g,v,m,y,x,w,_;return vt(this,function(b){switch(b.label){case 0:if(t=O(n,"img","toPixels"),n instanceof se||(t=t.toInt()),2!==t.rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),o=r[0],i=r[1],(a=2===t.rank?1:t.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return s=t.min(),u=t.max(),[4,s.data()];case 1:return c=b.sent()[0],[4,u.data()];case 2:if(l=b.sent()[0],s.dispose(),u.dispose(),"float32"===t.dtype){if(c<0||l>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+c+" - "+l+"].")}else{if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(c<0||l>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+c+" - "+l+"].")}return[4,t.data()];case 3:for(f=b.sent(),d="float32"===t.dtype?255:1,h=new Uint8ClampedArray(i*o*4),p=0;p<o*i;++p)g=void 0,v=void 0,m=void 0,y=void 0,1===a?(g=f[p]*d,v=f[p]*d,m=f[p]*d,y=255):3===a?(g=f[3*p]*d,v=f[3*p+1]*d,m=f[3*p+2]*d,y=255):4===a&&(g=f[4*p]*d,v=f[4*p+1]*d,m=f[4*p+2]*d,y=f[4*p+3]*d),h[0+(x=4*p)]=Math.round(g),h[x+1]=Math.round(v),h[x+2]=Math.round(m),h[x+3]=Math.round(y);return null!=e&&(e.width=i,e.height=o,w=e.getContext("2d"),_=new ImageData(h,i,o),w.putImageData(_,0,0)),t!==n&&t.dispose(),[2,h]}})})},fromPixels:fme}),kF=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),FF=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function Ru(n){P(null!=n.className,function(){return"Class being registered does not have the static className property defined."}),P("string"==typeof n.className,function(){return"className is required to be a string, but got type "+typeof n.className}),P(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),FF.register(n)}function LF(n,e,t){return null==t&&(t=N.get("TEST_EPSILON")),BF(n,"number"==typeof e||"boolean"==typeof e?[e]:e,function(r,o){return VF(r,Number(o),t)})}function BF(n,e,t){if(n instanceof se||e instanceof se){if(n instanceof se&&e instanceof se){if(n.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+n.dtype+" vs expected: "+e.dtype+".");if(!Or(n.shape,e.shape))throw new Error("Arrays are of different shape actual: "+n.shape+" vs expected: "+e.shape+".")}}else{var r=n.constructor.name,o=e.constructor.name;if(r!==o)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+o)}var i,a;if(i=n instanceof se?n.dataSync():n,a=e instanceof se?e.dataSync():e,i.length!==a.length)throw new Error("Arrays have different lengths actual: "+i.length+" vs expected: "+a.length+".\nActual:   "+i+".\nExpected: "+a+".");for(var s=0;s<a.length;++s){var u=i[s],c=a[s];if(!t(u,c))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+c+".\nActual:   "+i+".\nExpected: "+a+".")}}function VF(n,e,t){return!(!isNaN(n)||!isNaN(e))||!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}Object.freeze({Serializable:kF,SerializationMap:FF,registerClass:Ru}),Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},PACKED_ENVS:{WEBGL_PACK:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:LF,expectPromiseToFail:function wme(n,e){n().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function _me(n,e){var t="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return n instanceof se&&"string"===n.dtype||e instanceof se&&"string"===e.dtype||Array.isArray(n)&&kh(n[0])||Array.isArray(e)&&kh(e[0])?BF(n,t,function(r,o){return r==o}):LF(n,e,0)},expectNumbersClose:function bme(n,e,t){if(null==t&&(t=N.get("TEST_EPSILON")),!VF(n,e,t))throw new Error("Numbers differ: actual === "+n+", expected === "+e)},expectValuesInRange:function Cme(n,e,t){var r;r=n instanceof se?n.dataSync():n;for(var o=0;o<r.length;o++)if(r[o]<e||r[o]>t)throw new Error("Value out of range:"+r[o]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function Eme(n,e){expect(new Float32Array(n)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:Cce,webgl_util:bce,MathBackendWebGL:Bk,GPGPUContext:vk});var Bc=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return Is(e,n),e.prototype.minimize=function(t,r,o){void 0===r&&(r=!1);var i=this.computeGradients(t,o),a=i.value,s=i.grads;return this.applyGradients(s),Object.keys(s).forEach(function(u){return s[u].dispose()}),r?a:(a.dispose(),null)},e.prototype.computeGradients=function(t,r){return function Gae(n,e){if(P(wu(n),function(){return"The f passed in variableGrads(f) must be a function"}),P(null==e||Array.isArray(e)&&e.every(function(u){return u instanceof Hh}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),null==e)for(var t in e=[],N.engine.registeredVariables)e.push(N.engine.registeredVariables[t]);var r=e.length;P((e=e.filter(function(u){return u.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable."});var o=N.engine.gradients(n,e,null,!0),i=o.value,a=o.grads;P(a.some(function(u){return null!=u}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),P(0===i.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor"});var s={};return e.forEach(function(u,c){null!=a[c]&&(s[u.name]=a[c])}),{value:i,grads:s}}(t,r)},e.prototype.dispose=function(){},e}(kF);Object.defineProperty(Bc,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var UF=function(n){function e(t,r,o){void 0===o&&(o=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=o,i.accumulatedGrads={},i.accumulatedUpdates={},i.c=ln(oe(-t)),i.rhoScalar=ln(oe(r)),i.oneMinusRho=ln(oe(1-r)),null===o&&(o=N.get("EPSILON")),i.epsilonScalar=ln(oe(o)),i}return Is(e,n),e.prototype.applyGradients=function(t){var r=this,o=function(s){var u=N.engine.registeredVariables[s];null==i.accumulatedGrads[s]&&Ve(function(){r.accumulatedGrads[s]=Ht(u).variable(!1)}),null==i.accumulatedUpdates[s]&&Ve(function(){r.accumulatedUpdates[s]=Ht(u).variable(!1)});var c=t[s],l=i.accumulatedGrads[s],f=i.accumulatedUpdates[s];Ve(function(){var d=r.rhoScalar.mul(l).add(r.oneMinusRho.mul(c.square())),h=f.add(r.epsilonScalar).sqrt().div(l.add(r.epsilonScalar).sqrt()).mul(c),p=r.rhoScalar.mul(f).add(r.oneMinusRho.mul(h.square()));r.accumulatedGrads[s].assign(d),r.accumulatedUpdates[s].assign(p);var g=r.c.mul(h).add(u);u.assign(g)})},i=this;for(var a in t)o(a)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(r){return t.accumulatedUpdates[r].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(r){return t.accumulatedGrads[r].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="AdadeltaOptimizer",e}(Bc);Ru(UF);var HF=function(n){function e(t,r){void 0===r&&(r=.1);var o=n.call(this)||this;return o.learningRate=t,o.initialAccumulatorValue=r,o.accumulatedGrads={},o.c=ln(oe(-t)),o.epsilon=ln(oe(N.get("EPSILON"))),o}return Is(e,n),e.prototype.applyGradients=function(t){var r=this,o=function(s){var u=N.engine.registeredVariables[s];null==i.accumulatedGrads[s]&&Ve(function(){r.accumulatedGrads[s]=zh(u.shape,r.initialAccumulatorValue).variable(!1)});var c=t[s],l=i.accumulatedGrads[s];Ve(function(){var f=l.add(c.square());r.accumulatedGrads[s].assign(f);var d=r.c.mul(c.div(f.add(r.epsilon).sqrt())).add(u);u.assign(d)})},i=this;for(var a in t)o(a)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(r){return t.accumulatedGrads[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(Bc);Ru(HF);var WF=function(n){function e(t,r,o,i){void 0===i&&(i=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment={},a.accumulatedSecondMoment={},a.c=ln(oe(-t)),a.beta1Scalar=ln(oe(r)),a.beta2Scalar=ln(oe(o)),Ve(function(){a.accBeta1=oe(r).variable(),a.accBeta2=oe(o).variable()}),a.oneMinusBeta1=ln(oe(1-r)),a.oneMinusBeta2=ln(oe(1-o)),a.one=ln(oe(1)),null===i&&(i=N.get("EPSILON")),a.epsScalar=ln(oe(i)),a}return Is(e,n),e.prototype.applyGradients=function(t){var r=this;Ve(function(){var o=r.one.sub(r.accBeta1),i=r.one.sub(r.accBeta2);for(var a in t){var s=N.engine.registeredVariables[a];if(null==r.accumulatedFirstMoment[a]){var u=!1;r.accumulatedFirstMoment[a]=Ht(s).variable(u)}null==r.accumulatedSecondMoment[a]&&(u=!1,r.accumulatedSecondMoment[a]=Ht(s).variable(u));var c=t[a],f=r.accumulatedSecondMoment[a],d=r.beta1Scalar.mul(r.accumulatedFirstMoment[a]).add(r.oneMinusBeta1.mul(c)),h=r.beta2Scalar.mul(f).add(r.oneMinusBeta2.mul(c.square())),p=d.div(o),g=h.div(i);r.accumulatedFirstMoment[a].assign(d),r.accumulatedSecondMoment[a].assign(h);var v=r.c.mul(p.div(r.epsScalar.add(g.sqrt()))).add(s);s.assign(v)}r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar)),r.accBeta2.assign(r.accBeta2.mul(r.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return t.accumulatedFirstMoment[r].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(r){return t.accumulatedSecondMoment[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="AdamOptimizer",e}(Bc);Ru(WF);var GF=function(n){function e(t,r,o,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment={},s.accumulatedWeightedInfNorm={},s.c=ln(oe(-t)),s.beta1Scalar=ln(oe(r)),s.beta2Scalar=ln(oe(o)),s.decayScalar=ln(oe(a)),Ve(function(){s.iteration=oe(0).variable(),s.accBeta1=oe(r).variable()}),s.oneMinusBeta1=ln(oe(1-r)),s.one=ln(oe(1)),null===i&&(i=N.get("EPSILON")),s.epsScalar=ln(oe(i)),s}return Is(e,n),e.prototype.applyGradients=function(t){var r=this;Ve(function(){var o=r.one.sub(r.accBeta1),i=r.c.div(r.one.add(r.decayScalar.mul(r.iteration)));for(var a in t){var s=N.engine.registeredVariables[a];if(null==r.accumulatedFirstMoment[a]){var u=!1;r.accumulatedFirstMoment[a]=Ht(s).variable(u)}null==r.accumulatedWeightedInfNorm[a]&&(u=!1,r.accumulatedWeightedInfNorm[a]=Ht(s).variable(u));var c=t[a],f=r.accumulatedWeightedInfNorm[a],d=r.beta1Scalar.mul(r.accumulatedFirstMoment[a]).add(r.oneMinusBeta1.mul(c)),h=r.beta2Scalar.mul(f),p=c.abs(),g=h.maximum(p);r.accumulatedFirstMoment[a].assign(d),r.accumulatedWeightedInfNorm[a].assign(g);var v=i.div(o).mul(d.div(r.epsScalar.add(g))).add(s);s.assign(v)}r.iteration.assign(r.iteration.add(r.one)),r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return t.accumulatedFirstMoment[r].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(r){return t.accumulatedWeightedInfNorm[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="AdamaxOptimizer",e}(Bc);Ru(GF);var ab=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Is(e,n),e.prototype.applyGradients=function(t){var r=this;Object.keys(t).forEach(function(o){var i=t[o],a=N.engine.registeredVariables[o];Ve(function(){var s=r.c.mul(i).add(a);a.assign(s)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=ln(oe(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGDOptimizer",e}(Bc);Ru(ab);var zF=function(n){function e(t,r,o){void 0===o&&(o=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=o,i.m=oe(i.momentum),i.accumulations={},i}return Is(e,n),e.prototype.applyGradients=function(t){var r=this,o=function(s){var u=N.engine.registeredVariables[s];null==i.accumulations[s]&&Ve(function(){r.accumulations[s]=Ht(u).variable(!1)});var c=i.accumulations[s],l=t[s];Ve(function(){var f,d=r.m.mul(c).add(l);f=r.useNesterov?r.c.mul(l.add(d.mul(r.m))).add(u):r.c.mul(d).add(u),r.accumulations[s].assign(d),u.assign(f)})},i=this;for(var a in t)o(a)},e.prototype.dispose=function(){if(n.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var t in this.accumulations)this.accumulations[t].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="MomentumOptimizer",e}(ab);Ru(zF);var jF=function(n){function e(t,r,o,i,a){void 0===r&&(r=.9),void 0===o&&(o=0),void 0===i&&(i=null),void 0===a&&(a=!1);var s=n.call(this)||this;return s.learningRate=t,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares={},s.accumulatedMeanGrads={},s.accumulatedMoments={},s.c=ln(oe(t)),s.decayScalar=ln(oe(r)),s.momentumScalar=ln(oe(o)),s.oneMinusDecay=ln(oe(1-r)),s.centered=a,null===i&&(i=N.get("EPSILON")),s.epsilonScalar=ln(oe(i)),s}return Is(e,n),e.prototype.applyGradients=function(t){var r=this,o=function(s){var u=N.engine.registeredVariables[s];null==i.accumulatedMeanSquares[s]&&Ve(function(){r.accumulatedMeanSquares[s]=Ht(u).variable(!1)}),null==i.accumulatedMeanGrads[s]&&i.centered&&Ve(function(){r.accumulatedMeanGrads[s]=Ht(u).variable(!1)}),null==i.accumulatedMoments[s]&&Ve(function(){r.accumulatedMoments[s]=Ht(u).variable(!1)});var c=i.accumulatedMeanSquares[s],l=i.accumulatedMeanGrads[s],f=i.accumulatedMoments[s],d=t[s];Ve(function(){var h=r.decayScalar.mul(c).add(r.oneMinusDecay.mul(d.square()));if(r.centered){var p=r.decayScalar.mul(l).add(r.oneMinusDecay.mul(d)),g=r.momentumScalar.mul(f).add(r.c.mul(d).div(h.sub(p.square().add(r.epsilonScalar)).sqrt()));r.accumulatedMeanSquares[s].assign(h),r.accumulatedMeanGrads[s].assign(p),r.accumulatedMoments[s].assign(g);var v=u.sub(g);u.assign(v)}else{var m=r.decayScalar.mul(c).add(r.oneMinusDecay.mul(d.square()));g=r.momentumScalar.mul(f).add(r.c.mul(d).div(m.add(r.epsilonScalar).sqrt())),r.accumulatedMeanSquares[s].assign(m),r.accumulatedMoments[s].assign(g),v=u.sub(g),u.assign(v)}})},i=this;for(var a in t)o(a)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(r){return t.accumulatedMeanSquares[r].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(r){return t.accumulatedMeanGrads[r].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(r){return t.accumulatedMoments[r].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSPropOptimizer",e}(Bc);Ru(jF),function(){function n(){}n.sgd=function(e){return new ab(e)},n.momentum=function(e,t,r){return void 0===r&&(r=!1),new zF(e,t,r)},n.rmsprop=function(e,t,r,o,i){return void 0===t&&(t=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1),new jF(e,t,r,o,i)},n.adam=function(e,t,r,o){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===o&&(o=null),new WF(e,t,r,o)},n.adadelta=function(e,t,r){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===r&&(r=null),new UF(e,t,r)},n.adamax=function(e,t,r,o,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===o&&(o=null),void 0===i&&(i=0),new GF(e,t,r,o,i)},n.adagrad=function(e,t){return void 0===t&&(t=.1),new HF(e,t)}}(),function vae(n){q=n}(x0e);var sb=function(n,e){return(sb=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(n,e)};function ap(n,e){function t(){this.constructor=n}sb(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var nm=function(){return nm=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},nm.apply(this,arguments)};function Ri(n,e,t,r){return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):function o(i){return i instanceof t?i:new t(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Ni(n,e){var r,o,i,a,t={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(!(i=(i=t.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){t=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(6===c[0]&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function ub(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),o=0;for(e=0;e<t;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var qF=function(n,e){return(qF=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(n,e)};function ra(n,e){function t(){this.constructor=n}qF(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function De(n,e,t,r){return new(t||(t=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new t(function(l){l(c.value)}).then(a,s)}u((r=r.apply(n,e||[])).next())})}function Te(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(n,a)}catch(f){l=[6,f],r=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var Ame=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},null!=this.urlFlags[e]){var o=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+o+"."),this.set(e,o)}},n.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,o=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return function Ime(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0];e.urlFlags[s]=function(c,l){if("true"===(l=l.toLowerCase())||"false"===l)return"true"===l;if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,a[1])})}},n}();function X(){return XF}var XF=null,Pf=new Map,sp=new Map;function KF(n,e){var t=cb(n,e);return Pf.get(t)}function YF(n){return sp.get(n)}function ZF(n){for(var e=Pf.entries(),t=[];;){var r=e.next(),i=r.value;if(r.done)break;var s=i[1];i[0].split("_")[0]===n&&t.push(s)}return t}function QF(n){var e=n.kernelName,t=n.backendName,r=cb(e,t);if(Pf.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Pf.set(r,n)}function Dme(n){var e=n.kernelName;sp.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),sp.set(e,n)}function cb(n,e){return e+"_"+n}function JF(n){for(var e=n.length,t=0,r=0;e>0;)r=Math.random()*e|0,t=n[--e],n[e]=n[r],n[r]=t}function om(n,e,t){return Math.max(n,Math.min(e,t))}function lb(n){return n%2==0?n:n+1}function eL(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function T(n,e){if(!n)throw new Error("string"==typeof e?e:e())}function Dt(n,e,t){void 0===t&&(t=""),T(er(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function Uc(n){T(null!=n,function(){return"The input to the tensor constructor must be a non-null value."})}function ks(n,e,t){if(void 0===e&&(e=[]),void 0===t&&(t=!1),null==e&&(e=[]),Array.isArray(n)||Pr(n)&&!t)for(var r=0;r<n.length;++r)ks(n[r],e,t);else e.push(n);return e}function Ee(n){if(0===n.length)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function er(n,e){if(n===e)return!0;if(null==n||null==e||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function An(n){return n%1==0}function tL(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function im(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Hc(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function fb(n,e,t){return void 0===e&&(e=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(n())r();else{i++;var s=e(i);null!=t&&i>=t?o():setTimeout(a,s)}};a()})}function nL(n,e){for(var t=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(-1===n[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(-1===r){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(0===t)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var i=n.slice();return i[r]=e/t,i}function tr(n,e){var t=e.length;return T((n=null==n?e.map(function(r,o){return o}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),T(n.every(function(r){return An(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function Nu(n,e){for(var t=[],r=[],o=null!=e&&Array.isArray(e)&&0===e.length,i=null==e||o?null:tr(e,n).sort(),a=0,s=0;s<n.length;++s){if(null!=i){if(i[a]===s&&1!==n[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===n[s]&&(t.push(n[s]),r.push(s)),i[a]<=s&&a++}1!==n[s]&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function Wc(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else{if("bool"!==n)throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function up(n,e){var t=null;if(null==n||"float32"===n)t=new Float32Array(e);else if("int32"===n)t=new Int32Array(e);else if("bool"===n)t=new Uint8Array(e);else{if("string"!==n)throw new Error("Unknown data type "+n);t=new Array(e)}return t}function rL(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function oL(n){return"bool"===n||"complex64"===n||"float32"===n||"int32"===n||"string"===n}function iL(n,e){return!("complex64"===e||"float32"===e&&"complex64"!==n||"int32"===e&&"float32"!==n&&"complex64"!==n||"bool"===e&&"bool"===n)}function Pr(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function db(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function aL(n){if(null==n)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function Ou(n){return"string"==typeof n||n instanceof String}function sL(n){return"boolean"==typeof n}function uL(n){return"number"==typeof n}function kf(n){return Array.isArray(n)?kf(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":uL(n)?"float32":Ou(n)?"string":sL(n)?"bool":"float32"}function Mu(n){return!!(n&&n.constructor&&n.call&&n.apply)}function am(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Lo(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function hb(n,e,t){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ks(n)),t&&rL(n,e),a=e,(i=n)instanceof Float32Array&&"float32"===a||i instanceof Int32Array&&"int32"===a||i instanceof Uint8Array&&"bool"===a)return n;var i,a;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)0!==Math.round(n[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function pb(n,e){if(0===n.length)return e[0];var t=n.reduce(function(r,o){return r*o});if(0===t)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(1===i.length)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),f=l.reduce(function(d,h){return d*h});for(c=0;c<u;c++)s[c]=r(o+c*f,l,a)}return s}(0,n,e)}function gb(n,e){for(var t=Ff(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Ff(n,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(n);if("int32"===e)return new Int32Array(n);if("bool"===e)return new Uint8Array(n);throw new Error("Unknown data type "+e)}function oa(){return X().platform.now()}function vb(n){n.forEach(function(e){T(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function cL(n,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",X().platform.encode(n,e)}function cp(n,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",X().platform.decode(n,e)}function sm(n,e,t){if(0===e)return 0;if(1===e)return n[0];for(var r=n[n.length-1],o=0;o<n.length-1;++o)r+=t[o]*n[o];return r}function mb(n,e,t){if(0===e)return[];if(1===e)return[n];for(var r=new Array(e),o=0;o<r.length-1;++o)r[o]=Math.floor(n/t[o]),n-=r[o]*t[o];return r[r.length-1]=n,r}Object.freeze({shuffle:JF,clamp:om,nearestLargerEven:lb,sum:eL,randUniform:function(n,e){var t=Math.random();return e*t+(1-t)*n},distSquared:function(n,e){for(var t=0,r=0;r<n.length;r++){var o=Number(n[r])-Number(e[r]);t+=o*o}return t},assert:T,assertShapesMatch:Dt,assertNonNull:Uc,flatten:ks,sizeFromShape:Ee,isScalarShape:function(n){return 0===n.length},arraysEqual:er,isInt:An,tanh:tL,sizeToSquarishShape:im,createShuffledIndices:function(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return JF(e),e},rightPad:Hc,repeatedTry:fb,inferFromImplicitShape:nL,parseAxisParam:tr,squeezeShape:Nu,getTypedArrayFromDType:Wc,getArrayFromDType:up,checkConversionForErrors:rL,isValidDtype:oL,hasEncodingLoss:iL,isTypedArray:Pr,bytesPerElement:db,bytesFromStringArray:aL,isString:Ou,isBoolean:sL,isNumber:uL,inferDtype:kf,isFunction:Mu,nearestDivisor:am,computeStrides:Lo,toTypedArray:hb,toNestedArray:pb,makeOnesTypedArray:gb,makeZerosTypedArray:Ff,now:oa,assertNonNegativeIntegerDimensions:vb,fetch:function(n,e){return X().platform.fetch(n,e)},encodeString:cL,decodeString:cp,locToIndex:sm,indexToLoc:mb});var Tme=function(){function n(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Rme)}return n.prototype.profileKernel=function(e,t,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,f){if("float32"!==l)return!1;for(var d=0;d<c.length;d++){var h=c[d];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+f+"'"),!0}})(u,s.dtype,e),a.then(function(c){var l="";null!=c.getExtraProfileInfo&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(e,s,u,c.kernelMs,t,l)})})}),o},n}(),Rme=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,o,i,a){var s="number"==typeof o?Hc(o+"ms",9):o.error,u=Hc(e,25),c=t.rank,l=t.size,f=Hc(t.shape.toString(),14),d="";for(var h in i){var p=i[h].shape||t.shape,g=p.length;d+=h+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+f+"\t%c"+l+"\t%c"+d+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),yb=7;function fp(n,e,t){return Hc(Array.isArray(n)?parseFloat(n[0].toFixed(yb))+" + "+parseFloat(n[1].toFixed(yb))+"j":Ou(n)?"'"+n+"'":"bool"===t?fL(n):parseFloat(n.toFixed(yb)).toString(),e)}function fL(n){return 0===n?"false":"true"}function dp(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var hp=function(){function n(e,t,r){var o=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ee(e),null!=r){var i=r.length;T(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||up(t,this.size),this.strides=Lo(e)}return n.prototype.set=function(e){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];0===r.length&&(r=[0]),T(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var r=0,o=0,i=e;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r])throw new Error("Requested out of range element at "+e+".   Buffer shape="+this.shape);r++}for(var u=e[e.length-1],c=0;c<e.length-1;++c)u+=this.strides[c]*e[c];return this.values[u]},n.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return qa().makeTensor(this.values,this.shape,this.dtype)},n}(),qa=null,Y=null,dL=null,Qt=function(){function n(e,t,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ee(e),this.strides=Lo(e),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),T(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,o){return this.throwIfDisposed(),this.reshape([e,t,r,o])},n.prototype.as5D=function(e,t,r,o,i){return this.throwIfDisposed(),this.reshape([e,t,r,o,i])},n.prototype.asType=function(e){return this.throwIfDisposed(),Y.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return De(this,void 0,void 0,function(){var e;return Te(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Y.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return Y.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return De(this,void 0,void 0,function(){var e;return Te(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,pb(this.shape,e)]}})})},n.prototype.arraySync=function(){return pb(this.shape,this.dataSync())},n.prototype.data=function(){return De(this,void 0,void 0,function(){var e,t;return Te(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=qa().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(o){return cp(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=qa().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(t){return cp(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return De(this,void 0,void 0,function(){var e;return Te(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,qa().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(qa().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return void 0===e&&(e=!1),Y.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Y.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return void 0===e&&(e=0),Y.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1),Y.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Y.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Y.clone(this)},n.prototype.toString=function(e){return void 0===e&&(e=!1),function Nme(n,e,t,r){var o=Lo(e),i=function(c,l,f,d){var h=Ee(l),p=d[d.length-1],g=new Array(p).fill(0),v=l.length,m="complex64"===f?dp(c):c;if(v>1)for(var y=0;y<h/p;y++)for(var x=y*p,w=0;w<p;w++)g[w]=Math.max(g[w],fp(m[x+w],0,f).length);return g}(n,e,t,o),a=e.length,s=function c(l,f,d,h,p,g){void 0===g&&(g=!0);var v="complex64"===d?2:1,m=f[0],y=f.length;if(0===y)return"complex64"===d?[fp(dp(l)[0],0,d)]:"bool"===d?[fL(l[0])]:[l[0].toString()];if(1===y){if(m>20){var w=Array.from(l.slice(0,3*v)),_=Array.from(l.slice((m-3)*v,m*v));return"complex64"===d&&(w=dp(w),_=dp(_)),["["+w.map(function(U,G){return fp(U,p[G],d)}).join(", ")+", ..., "+_.map(function(U,G){return fp(U,p[m-3+G],d)}).join(", ")+"]"]}return["["+("complex64"===d?dp(l):Array.from(l)).map(function(U,G){return fp(U,p[G],d)}).join(", ")+"]"]}var b=f.slice(1),C=h.slice(1),E=h[0]*v,S=[];if(m>20){for(var A=0;A<3;A++){var D=(M=A*E)+E;S.push.apply(S,c(l.slice(M,D),b,d,C,p,!1))}for(S.push("..."),A=m-3;A<m;A++)D=(M=A*E)+E,S.push.apply(S,c(l.slice(M,D),b,d,C,p,A===m-1))}else for(A=0;A<m;A++){var M;D=(M=A*E)+E,S.push.apply(S,c(l.slice(M,D),b,d,C,p,A===m-1))}var L=2===y?",":"";for(S[0]="["+S[0]+L,A=1;A<S.length-1;A++)S[A]=" "+S[A]+L;var B=",\n";for(A=2;A<y;A++)B+="\n";return S[S.length-1]=" "+S[S.length-1]+"]"+(g?"":B),S}(n,e,t,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},n.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Y.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),this.throwIfDisposed(),Y.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Y.dot(this,e)},n.prototype.norm=function(e,t,r){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1),this.throwIfDisposed(),Y.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Y.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Y.reverse(this,e)},n.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Y.concat([this].concat(e),t)},n.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Y.split(this,e,t)},n.prototype.stack=function(e,t){return void 0===t&&(t=0),Y.stack([this,e],t)},n.prototype.unstack=function(e){return void 0===e&&(e=0),Y.unstack(this,e)},n.prototype.batchNormalization=function(e,t,r,o,i){return void 0===r&&(r=.001),dL("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,o,r)},n.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.all(this,e,t)},n.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.any(this,e,t)},n.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.sum(this,e,t)},n.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.prod(this,e,t)},n.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.mean(this,e,t)},n.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.min(this,e,t)},n.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Y.max(this,e,t)},n.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Y.argMin(this,e)},n.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Y.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Y.cast(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Y.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Y.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Y.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Y.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Y.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Y.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Y.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Y.mulStrict(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Y.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Y.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Y.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Y.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Y.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Y.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Y.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Y.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Y.squaredDifferenceStrict(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Y.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Y.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Y.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Y.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Y.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Y.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Y.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Y.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Y.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Y.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Y.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Y.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Y.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Y.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Y.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Y.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Y.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Y.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Y.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Y.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Y.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Y.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Y.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Y.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Y.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Y.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Y.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Y.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Y.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Y.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Y.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Y.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Y.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Y.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Y.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Y.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Y.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Y.selu(this)},n.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),Y.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Y.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Y.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Y.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Y.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Y.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Y.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Y.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Y.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Y.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Y.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Y.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Y.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Y.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Y.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Y.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Y.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Y.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Y.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Y.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Y.round(this)},n.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),Y.step(this,e)},n.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Y.softmax(this,e)},n.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Y.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Y.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Y.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,o,i,a){return void 0===o&&(o="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),Y.conv1d(this,e,t,r,o,i,a)},n.prototype.conv2d=function(e,t,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),Y.conv2d(this,e,t,r,o,i,a)},n.prototype.conv2dTranspose=function(e,t,r,o,i){return this.throwIfDisposed(),Y.conv2dTranspose(this,e,t,r,o,i)},n.prototype.depthwiseConv2D=function(e,t,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),Y.depthwiseConv2d(this,e,t,r,o,i,a)},n.prototype.separableConv2d=function(e,t,r,o,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),Y.separableConv2d(this,e,t,r,o,i,a)},n.prototype.avgPool=function(e,t,r,o){return this.throwIfDisposed(),Y.avgPool(this,e,t,r,o)},n.prototype.maxPool=function(e,t,r,o){return this.throwIfDisposed(),Y.maxPool(this,e,t,r,o)},n.prototype.localResponseNormalization=function(e,t,r,o){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===o&&(o=.5),Y.localResponseNormalization(this,e,t,r,o)},n.prototype.pool=function(e,t,r,o,i){return this.throwIfDisposed(),Y.pool(this,e,t,r,o,i)},n.prototype.variable=function(e,t,r){return void 0===e&&(e=!0),this.throwIfDisposed(),qa().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Y.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Y.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Y.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),Y.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,o,i,a,s,u){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),Y.stridedSlice(this,e,t,r,o,i,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Y.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Y.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Y.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Y.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Y.spectral.irfft(this)},n}();Object.defineProperty(Qt,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var hL,xb,wb,_b,bb,Lf=function(n){function e(t,r,o,i){var a=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=r,a.name=o,a}return ra(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!er(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");qa().disposeTensor(this),this.dataId=t.dataId,qa().incRef(this,null)},e.prototype.dispose=function(){qa().disposeVariable(this),this.isDisposedInternal=!0},e}(Qt);Object.defineProperty(Lf,Symbol.hasInstance,{value:function(n){return n instanceof Qt&&null!=n.assign&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(hL||(hL={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(xb||(xb={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(wb||(wb={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(_b||(_b={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(bb||(bb={}));var Ome={float32:_b,int32:xb,bool:wb,complex64:bb};function _r(n,e){if("string"===n||"string"===e){if("string"===n&&"string"===e)return"string";throw new Error("Can not upcast "+n+" with "+e)}return Ome[n][e]}function Cb(n){return _r(n,"int32")}function wn(n,e){if(n.dtype===e.dtype)return[n,e];var t=_r(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function pL(n,e){T(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function Eb(n){var e=[];return function t(r,o,i){if(null!=r){if(r instanceof Qt)return void o.push(r);if(a=r,Array.isArray(a)||"object"==typeof a){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),t(c,o,i))}}}}(n,e,new Set),e}Object.freeze({makeTypesMatch:wn,assertTypesMatch:pL,isTensorInList:function(n,e){return e.some(function(t){return t.id===n.id})},getTensorsInContainer:Eb});var Sb,gL=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Mme=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new gL}return n.prototype.ready=function(){return De(this,void 0,void 0,function(){var e,t,r;return Te(this,function(o){switch(o.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,o.label=1;case 1:return t<e.length?[4,this.initializeBackend(r=e[t]).success]:[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return e in this.registry||e in this.registryFactory&&!this.initializeBackend(e).asyncInit?this.registry[e]:null},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return void 0===r&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return De(this,void 0,void 0,function(){var t,r,o;return Te(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Tme(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;ZF(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;ZF(e).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(null==r)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<t.pendingBackendInitId||(t.registry[e]=s,t.pendingBackendInit=null,0))}).catch(function(s){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),1))});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],o=this.initializeBackend(r),a=o.asyncInit;if(a||o.success)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),o=r.backend,i=this.readSync(t);o.disposeData(t),r.backend=e,e.move(t,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,o=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var o=r();return t(),o}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],function(o){return{x:function(){return o.toFloat()}}},[],{}),t},n.prototype.runKernel=function(e,t,r,o,i){return this.runKernelFunc(null,t,null,e,r,o,i)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+="complex64"===u.dtype?3:1});var s=o-t-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,o,i,a,s){var u,c=this,l=[],f=this.isTapeOn();null==o&&(o=null!=this.state.activeScope?this.state.activeScope.name:"");var d,h=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=KF(o,this.backendName);if(null!=v)d=function(){var y=c.backend.numDataIds();g=v.kernelFunc({inputs:t,attrs:i,backend:c.backend});var x=Array.isArray(g)?g:[g];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,y,x);var w=x.map(function(C){return c.makeTensorFromDataId(C.dataId,C.shape,C.dtype)});if(f){var _=c.getTensorsForGradient(o,t,w);if(null==_){null==s&&(s=[]);var b=w.filter(function(C,E){return s[E]});_=(a||[]).slice().concat(b)}l=c.saveTensorsForBackwardMode(_)}return w};else{var m=function(y){f&&(l=y.map(function(x){return c.keep(c.clone(x))}))};d=function(){var y=c.backend.numDataIds();g=c.tidy(function(){return e(c.backend,m)});var x=Array.isArray(g)?g:[g];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,y,x),x}}return this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,t,function(){return d()}):d()}),f&&this.addTapeNode(o,t,u,r,l,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(y){return t[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(g)?u:u[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(r){return t.keep(t.clone(r))})},n.prototype.getTensorsForGradient=function(e,t,r){var o=YF(e);if(null!=o){var i=o.inputsToSave||[],a=o.outputsToSave||[],s=void 0;o.saveAllInputs?(T(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return a[l]});return s.concat(u)}return null},n.prototype.makeTensor=function(e,t,r,o){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");o=o||this.backend;var i=e;"string"===(r=r||"float32")&&Ou(e[0])&&(i=e.map(function(l){return cL(l)}));var a=o.write(i,t,r),s=new Qt(t,r,a,this.nextTensorId());if(this.incRef(s,o),"string"===r){var u=this.state.tensorInfo.get(a),c=aL(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,o){var i=new Qt(t,r=r||"float32",e,this.nextTensorId());return this.incRef(i,o),i},n.prototype.makeVariable=function(e,t,r,o){void 0===t&&(t=!0),r=r||this.nextVariableId().toString(),null!=o&&o!==e.dtype&&(e=e.asType(o));var i=new Lf(e,t,r,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var o=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(o=e.size*db(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Lf||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])},n.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return De(this,void 0,void 0,function(){var t,r;return Te(this,function(o){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},n.prototype.addTapeNode=function(e,t,r,o,i,a){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=YF(e);null!=c&&(o=c.gradFunc),null!=o&&(u.gradient=function(l){return l=l.map(function(f,d){if(null==f){var h=r[d],p=Ff(h.size,h.dtype);return s.makeTensor(p,h.shape,h.dtype)}return f}),o(l.length>1?l:l[0],i,a)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=Eb(e),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},n.prototype.gradients=function(e,t,r,o){var i=this;if(void 0===o&&(o=!1),T(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});T(a instanceof Qt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var f={},d={},h=0;h<c.length;h++)f[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(b=u[h]).inputs;for(var g in p){for(var v=p[g],m=!1,y=0;y<c.length;y++)if(f[v.id]){b.outputs.forEach(function(A){return f[A.id]=!0}),m=!0,d[b.id]=!0;break}if(m)break}}var x={};x[l.id]=!0;var w={};for(h=u.length-1;h>=0;h--)for(p=(b=u[h]).inputs,y=0;y<b.outputs.length;y++)if(x[b.outputs[y].id]){for(var g in p)x[p[g].id]=!0,w[b.id]=!0;break}var _=[];for(h=0;h<u.length;h++){var b;if(d[(b=u[h]).id]&&w[b.id]){var C={};for(var g in b.inputs){var E=b.inputs[g];f[E.id]&&(C[g]=E)}var S=Object.assign({},b);S.inputs=C,S.outputs=b.outputs,_.push(S)}}return _}(this.state.activeTape,t,a);if(!o&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=r??(c=gb(Ee(u=a.shape),"float32"),k.makeTensor(c,u,"float32")),function(d,h,p){for(var g=function(m){var y=h[m],x=[];if(y.outputs.forEach(function(C){var E=d[C.id];x.push(null!=E?E:null)}),null==y.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var w=y.gradient(x),_=function(C){if(!(C in w))throw new Error("Cannot backprop through input "+C+". Available gradients found: "+Object.keys(w)+".");var E=i.tidy(function(){return w[C]()});if("float32"!==E.dtype)throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+C+" must have 'float32' dtype, but has '"+E.dtype+"'");var S=y.inputs[C];if(!er(E.shape,S.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+C+"' has shape '"+E.shape+"', which does not match the shape of the input '"+S.shape+"'");if(null==d[S.id])d[S.id]=E;else{var A=d[S.id];d[S.id]=A.add(E),A.dispose()}};for(var b in y.inputs)_(b)},v=h.length-1;v>=0;v--)g(v)}(l,s);var f=t.map(function(d){return l[d.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(d){for(var h=0,p=d.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:f}})},n.prototype.customGrad=function(e){var t=this;return T(Mu(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];T(o.every(function(s){return s instanceof Qt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),t.runKernelFunc(function(s,u){return T((r=e.apply(void 0,o.concat([u]))).value instanceof Qt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),T(Mu(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];T(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),T(l.every(function(d){return d instanceof Qt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var f={};return l.forEach(function(d,h){f[h]=function(){return d}}),f})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return De(this,void 0,void 0,function(){var t,r;return Te(this,function(o){switch(o.label){case 0:return t=oa(),[4,this.backend.time(e)];case 1:return(r=o.sent()).wallMs=oa()-t,[2,r]}})})},n.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new gL,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),k=function(){var n=function(){if(null==Sb){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Sb=t}return Sb}();if(null==n._tfengine){var e=new Ame(n);n._tfengine=new Mme(e)}return XF=n._tfengine.ENV,qa=function(){return n._tfengine},n._tfengine}();function vL(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var Fs=X();Fs.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Fs.registerFlag("IS_BROWSER",function(){return vL()}),Fs.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),Fs.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Fs.registerFlag("PROD",function(){return!1}),Fs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Fs.getBool("DEBUG")}),Fs.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Fs.registerFlag("IS_TEST",function(){return!1});var pp,ii,ai,Gc={},Ab={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function mL(n,e){Gc[n]=e}function Xa(n){n in Gc||(Gc[n]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&2===o)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete Gc[t]},!1),1===t?r.getContext("webgl",Ab)||r.getContext("experimental-webgl",Ab):r.getContext("webgl2",Ab)}(n));var e=Gc[n];return e.isContextLost()?(delete Gc[n],Xa(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Gc[n])}function um(n,e){return[e,n]}function gp(n){var e=Ee(n);return im(Math.ceil(e/4))}function vp(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Ib(n,e){var t,r,o,i,a,s,u,c,l,f=n;return 2===X().getNumber("WEBGL_VERSION")?(t=f.R32F,r=f.R16F,o=f.RGBA16F,i=f.RGBA32F,a=f.RED,s=4,u=1,c=f.HALF_FLOAT,l=f.FLOAT):(t=n.RGBA,r=n.RGBA,o=n.RGBA,i=f.RGBA,a=n.RGBA,s=4,u=4,c=null!=e?e.HALF_FLOAT_OES:null,l=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function be(n,e,t){var r=t();return e&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+xL(o,i))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(pp||(pp={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(ii||(ii={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ai||(ai={}));var Pme=5.96e-8,kme=65504;function yL(n){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||Pme<Math.abs(n)&&Math.abs(n)<kme)}function xL(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function mp(n,e,t){return Ls(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function wL(n,e,t){var r=Ls(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(be(n,e,function(){return n.shaderSource(r,t)}),be(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function _L(n,e,t){var r=Ls(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(be(n,e,function(){return n.shaderSource(r,t)}),be(n,e,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw function(o,i){var a=Fme.exec(i);if(null==a)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split("\n"),c=u.length.toString().length+2,l=u.map(function(v,m){return Hc((m+1).toString(),c)+v}),f=0,d=0;d<l.length;d++)f=Math.max(l[d].length,f);var h=l.slice(0,s-1),p=l.slice(s-1,s),g=l.slice(s);console.log(h.join("\n")),console.log(i.split("\n")[0]),console.log("%c "+Hc(p[0],f),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join("\n"))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var cm,lm,Fme=/ERROR: [0-9]+:([0-9]+):/g;function bL(n,e){return Ls(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function CL(n,e,t){if(be(n,e,function(){return n.linkProgram(t)}),!1===n.getProgramParameter(t,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function fm(n,e,t){if(be(n,e,function(){return n.validateProgram(t)}),!1===n.getProgramParameter(t,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function EL(n,e,t){var r=Ls(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return be(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),be(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function SL(n,e,t){var r=Ls(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return be(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),be(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function AL(n,e){return Ls(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function IL(n,e){var t=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+t+"x"+t+"].")}function DL(n,e){return Ls(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Db(n,e,t,r,o,i,a,s){var u=n.getAttribLocation(t,r);return-1!==u&&(be(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,o)}),be(n,e,function(){return n.vertexAttribPointer(u,i,n.FLOAT,!1,a,s)}),be(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function TL(n,e,t,r){PL(n,r),be(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function RL(n,e,t,r){return Ls(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function NL(n,e,t){return n.getUniformLocation(e,t)}function OL(n,e,t,r,o,i){be(n,e,function(){return TL(n,e,r,i)}),be(n,e,function(){return n.uniform1i(o,i)})}function dm(n,e,t,r){be(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),be(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function Tb(n,e,t){be(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),be(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function yp(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ML(n,e))}function ML(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Ls(n,e,t,r){var o=be(n,e,function(){return t()});if(null==o)throw new Error(r);return o}function PL(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+t+"].")}function xp(n,e){return void 0===e&&(e=2),Ee(n.slice(0,n.length-e))}function wp(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function hm(n){var e=[1,1,1];return 0===n.length||1===n.length&&1===n[0]||(e=[xp(n)].concat(wp(n))),e}function kL(n,e){var t;void 0===e&&(e=!1);var r=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(n=n.map(function(c,l){return l>=n.length-2?lb(n[l]):n[l]})).length&&(n=[2,n[0]])),2!==n.length){var o=Nu(n);n=o.newShape}var i=Ee(n);if(n.length<=1&&i<=r)return[1,i];if(2===n.length&&n[0]<=r&&n[1]<=r)return n;if(3===n.length&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=xp(n),s=2,u=2;return n.length&&(s=(t=wp(n))[0],u=t[1]),im(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return im(i)}function pm(n){return n%2==0}function _p(n,e){if(er(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||0===n[0]||0===n[1]||0===e[0]||0===e[1])return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||pm(t)&&pm(r)&&(1===n[0]||1===e[0]))return!0}return n[1]===e[1]&&pm(n[0])&&pm(e[0])}function FL(n){if(null==cm){var e=Xa(n);cm=e.getParameter(e.MAX_TEXTURE_SIZE)}return cm}function LL(n){if(null==lm){var e=Xa(n);lm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,lm)}function BL(n){if(0===n)return 0;var e=Xa(n);return si(e,"EXT_disjoint_timer_query_webgl2")&&2===n?2:si(e,"EXT_disjoint_timer_query")?1:0}function si(n,e){return null!=n.getExtension(e)}function Rb(n){try{if(null!=Xa(n))return!0}catch{return!1}return!1}function VL(n){if(0===n)return!1;var e=Xa(n);if(1===n){if(!si(e,"OES_texture_float"))return!1}else if(!si(e,"EXT_color_buffer_float"))return!1;return Nb(e)}function UL(n){if(0===n)return!1;var e=Xa(n);if(1!==n){if(si(e,"EXT_color_buffer_float"))return Nb(e);if(si(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=Ib(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(e,t)}return!1}return!!si(e,"OES_texture_float")&&!!si(e,"WEBGL_color_buffer_float")&&Nb(e)}function Nb(n){var e=Ib(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),o}function HL(n){return 2===n&&null!=Xa(n).fenceSync}var Lme=Object.freeze({callAndCheck:be,canBeRepresented:yL,getWebGLErrorMessage:xL,getExtensionOrThrow:mp,createVertexShader:wL,createFragmentShader:_L,createProgram:bL,linkProgram:CL,validateProgram:fm,createStaticVertexBuffer:EL,createStaticIndexBuffer:SL,getNumChannels:function(){return 2===X().getNumber("WEBGL_VERSION")?1:4},createTexture:AL,validateTextureSize:IL,createFramebuffer:DL,bindVertexBufferToProgramAttribute:Db,bindTextureUnit:TL,unbindTextureUnit:function(n,e,t){PL(n,t),be(n,e,function(){return n.activeTexture(n.TEXTURE0+t)}),be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:RL,getProgramUniformLocation:NL,bindTextureToProgramUniformSampler:OL,bindCanvasToFramebuffer:function(n,e){be(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),be(n,e,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),be(n,e,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})},bindColorTextureToFramebuffer:dm,unbindColorTextureFromFramebuffer:Tb,validateFramebuffer:yp,getFramebufferErrorMessage:ML,getBatchDim:xp,getRowsCols:wp,getShapeAs3D:hm,getTextureShapeFromLogicalShape:kL,isReshapeFree:_p,getWebGLMaxTextureSize:FL,resetMaxTextureSize:function(){cm=null},resetMaxTexturesInShader:function(){lm=null},getMaxTexturesInShader:LL,getWebGLDisjointQueryTimerVersion:BL,hasExtension:si,isWebGLVersionEnabled:Rb,isCapableOfRenderingToFloatTexture:VL,isDownloadFloatTextureEnabled:UL,isWebGLFenceEnabled:HL}),qe=X();function WL(n){X().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Gt(n,e){return k.tidy(n,e)}function Bo(n){Eb(n).forEach(function(e){return e.dispose()})}function gm(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];X().getBool("IS_TEST")||console.warn.apply(console,n)}function Ka(n,e){var t=n;if(Pr(n))return"string"===e?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Pr(t)&&"string"!==e;)r.push(t.length),t=t[0];return Array.isArray(n)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],Array.isArray(i)||Pr(i)){T(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),T(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}else T(0===a.length,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"})}(n,r,[]),r}function GL(n,e,t,r){if(null!=n&&("numeric"!==n&&n!==e||"numeric"===n&&"string"===e))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function I(n,e,t,r){if(void 0===r&&(r="numeric"),n instanceof Qt)return GL(r,n.dtype,e,t),n;var o=kf(n);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),GL(r,o,e,t),null==n||!Pr(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var a=Ka(n,o);Pr(n)||Array.isArray(n)||(n=[n]);var s="string"!==o?hb(n,o,X().getBool("DEBUG")):ks(n,[],!0);return k.makeTensor(s,a,o)}function bp(n,e,t,r){if(void 0===r&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(o,i){return I(o,e+"["+i+"]",t)},r)}function Ob(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function zL(n,e,t){for(var r=n.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===t.indexOf(s)?o.push(n[i++]):o.push(e[a++]);return o}function kr(n,e){for(var t=[],r=n.length,o=0;o<r;o++)-1===e.indexOf(o)&&t.push(n[o]);return[t,e.map(function(i){return n[i]})]}function mo(n,e){return zL(n,e.map(function(t){return 1}),e)}function Vo(n,e,t){T(Ob(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function ia(n,e){if(Ob(n,e))return null;for(var t=[],r=0;r<e;++r)-1===n.indexOf(r)&&t.push(r);return n.forEach(function(o){return t.push(o)}),t}function vm(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function aa(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function jL(n,e){var t=n[0].length;n.forEach(function(o,i){T(o.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+t+")"})}),T(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(o,i){for(var a=0;a<t;a++)T(a===e||o[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function zc(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function F(n){var e=Object.keys(n);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];k.startScope(t);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),k.endScope(s),s}catch(u){throw k.endScope(null),u}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}qe.registerFlag("HAS_WEBGL",function(){return qe.getNumber("WEBGL_VERSION")>0}),qe.registerFlag("WEBGL_VERSION",function(){return Rb(2)?2:Rb(1)?1:0}),qe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===qe.get("WEBGL_VERSION")}),qe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),qe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),qe.registerFlag("WEBGL_PACK",function(){return qe.getBool("HAS_WEBGL")}),qe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_PACK_CLIP",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),qe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_PACK_REDUCE",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_CONV_IM2COL",function(){return qe.getBool("WEBGL_PACK")}),qe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return FL(qe.getNumber("WEBGL_VERSION"))}),qe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return LL(qe.getNumber("WEBGL_VERSION"))}),qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=qe.getNumber("WEBGL_VERSION");return 0===n?0:BL(n)}),qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return qe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),qe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return VL(qe.getNumber("WEBGL_VERSION"))}),qe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!qe.getBool("WEBGL_FORCE_F16_TEXTURES")&&qe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),qe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return UL(qe.getNumber("WEBGL_VERSION"))}),qe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return HL(qe.getNumber("WEBGL_VERSION"))}),qe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return qe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),dL=WL;var Fr=F({complex_:function(n,e){var t=I(n,"real","complex"),r=I(e,"imag","complex");return Dt(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),k.runKernelFunc(function(o){return o.complex(t,r)},{$real:t,$imag:r})}}),Oi=F({real_:function(n){var e=I(n,"input","real");return k.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Ya=F({imag_:function(n){var e=I(n,"input","imag");return k.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Lr(n,e,t){return Pu(n,e,Ka(n,t),t)}function Pu(n,e,t,r){if(null==r&&(r=kf(n)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Pr(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){vb(e);var o=Ee(e),i=Ee(t);T(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<t.length;++a){var u=a!==t.length-1||t[a]!==Ee(e.slice(a));T(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Pr(n)||Array.isArray(n)||(n=[n]),e=e||t,n="string"!==r?hb(n,r,X().getBool("DEBUG")):ks(n,[],!0),k.makeTensor(n,e,r)}function Oe(n,e){if((Pr(n)&&"string"!==e||Array.isArray(n))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&Pr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Pu(n,[],[],e)}function sa(n,e){Uc(n);var t=Ka(n,e);if(1!==t.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Pu(n,null,t,e)}function jc(n,e,t){if(Uc(n),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ka(n,t);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Pu(n,e,r,t)}function $L(n,e,t){if(Uc(n),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ka(n,t);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Pu(n,e,r,t)}function Za(n,e,t){if(Uc(n),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ka(n,t);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Pu(n,e,r,t)}function Bf(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=Bf(n,"float32"),r=On(n,"float32");return Fr(t,r)}var o=gb(Ee(n),e);return k.makeTensor(o,n,e)}function On(n,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=On(n,"float32"),r=On(n,"float32");return Fr(t,r)}var o=Ff(Ee(n),e);return k.makeTensor(o,n,e)}function $c(n,e,t){return k.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function mm(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r="float32"),0===t)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return On([0],r);var o=Ff(Math.abs(Math.ceil((e-n)/t)),r);e<n&&1===t&&(t=-1),o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+t;return sa(o,r)}var qL=F({onesLike_:function(n){var e=I(n,"x","onesLike");if("complex64"===e.dtype){var t=qL(Oi(e)),r=Tt(Ya(e));return Fr(t,r)}return k.runKernelFunc(function(o){return o.onesLike(e)},{x:e},function(o,i){return{x:function(){return Tt(o)}}},"OnesLike")}}),Tt=F({zerosLike_:function(n){var e=I(n,"x","zerosLike");return k.runKernelFunc(function(t){return t.zerosLike(e)},{x:e},function(t,r){return{x:function(){return Tt(t)}}},"ZerosLike")}}),Mi=F({concat_:function(n,e){void 0===e&&(e=0),T(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=bp(n,"tensors","concat");"complex64"===t[0].dtype&&t.forEach(function(s){if("complex64"!==s.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+s.dtype+". ")}),e=tr(e,t[0].shape)[0];var r=zc(t.map(function(s){return s.shape}),e);if(0===Ee(r))return Lr([],r);if(1===(t=t.filter(function(s){return s.size>0})).length)return t[0];var o=t.map(function(s){return s.shape});return jL(o,e),k.runKernelFunc(function(s){return s.concat(t,e)},t,function(s){var u=o.map(function(c){return c[e]});return Mb(s,u,e).map(function(c){return function(){return c}})},"Concat",{axis:e})}}),Gme=F({concat1d_:function(n){return Mi(n,0)}}),zme=F({concat2d_:function(n,e){return Mi(n,e)}}),jme=F({concat3d_:function(n,e){return Mi(n,e)}}),$me=F({concat4d_:function(n,e){return Mi(n,e)}}),Mb=F({split_:function(n,e,t){void 0===t&&(t=0);var r,o=I(n,"x","split");return t=tr(t,o.shape)[0],"number"==typeof e?(T(o.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(o.shape[t]/e)):(T(o.shape[t]===e.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),k.runKernelFunc(function(i){return i.split(o,r,t)},{$x:o},function(i){return{$x:function(){return Mi(i,t)}}})}});function Qe(n,e,t){return void 0===e&&(e="float32"),e=e||"float32",vb(n),new hp(n,e,t)}var XL=F({batchToSpaceND_:function(n,e,t){var r=I(n,"x","batchToSpaceND"),o=e.reduce(function(i,a){return i*a});return T(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),T(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),T(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),k.runKernelFunc(function(i){return i.batchToSpaceND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(e,t)}}})}}),Xme=F({cast_:function(n,e){var t=I(n,"x","cast");if(!oL(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==t.dtype||"string"!==e&&"string"===t.dtype)throw new Error("Only strings can be casted to strings");return k.runKernelFunc(function(o){return o.cast(t,e)},{x:t},function(o){return{x:function(){return o.clone()}}},"Cast",{dtype:e})}}),Kme=F({cumsum_:function(n,e,t,r){void 0===e&&(e=0),void 0===t&&(t=!1),void 0===r&&(r=!1);var o=I(n,"x","cumsum"),i=ia([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=aa(1,o.rank)[0],u=k.runKernelFunc(function(c){return c.cumsum(a,s,t,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(e,t,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),Yme=F({depthToSpace_:function(n,e,t){void 0===t&&(t="NHWC");var r=I(n,"x","depthToSpace"),o="NHWC"===t?r.shape[1]:r.shape[2],i="NHWC"===t?r.shape[2]:r.shape[3],a="NHWC"===t?r.shape[3]:r.shape[1];return T(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),T(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),T(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),k.runKernelFunc(function(s){return s.depthToSpace(r,e,t)},{$x:r})}}),ku=F({expandDims_:function(n,e){void 0===e&&(e=0);var t=I(n,"x","expandDims",null);T(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(T(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Bs(t,r)}}),Bs=F({reshape_:function(n,e){var t=I(n,"x","reshape",null);return e=nL(e,t.size),T(t.size===Ee(e),function(){return"new shape and old shape must have the same number of elements."}),k.runKernelFunc(function(o){return o.reshape(t,e)},{x:t},function(o){return{x:function(){return o.reshape(t.shape)}}},"Reshape",{shape:e})}}),KL=F({spaceToBatchND_:function(n,e,t){var r=I(n,"x","spaceToBatchND");return T(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),T(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),T(r.shape.reduce(function(o,i,a){return a>0&&a<=e.length?o&&(i+t[a-1][0]+t[a-1][1])%e[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),k.runKernelFunc(function(o){return o.spaceToBatchND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(e,t)}}})}}),YL=F({squeeze_:function(n,e){var t=I(n,"x","squeeze");return Bs(t,Nu(t.shape,e).newShape)}}),Fu=F({stack_:function(n,e){void 0===e&&(e=0);var t=bp(n,"tensors","stack");if(T(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===t.length)return t[0].expandDims(e);var o=t[0].shape,i=t[0].dtype;T(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){Dt(o,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){T(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return Mi(a,e)}}),ym=F({unstack_:function(n,e){void 0===e&&(e=0),e=e||0;var t=I(n,"x","unstack");return T(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),k.runKernelFunc(function(o){return o.unstack(t,e)},{x:t},function(o){return{x:function(){return Fu(o,e)}}},"Unpack",{axis:e})}});function xm(n,e,t,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(n[0]/t),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([n[a+1]/e[a],e[a]]);o=o.concat(n.slice(i+1))}return o}function wm(n,e,t){void 0===t&&(t=!0);var r=[];if(t){r.push(e);for(var o=e+1;o<n;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<n;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function _m(n,e,t,r){void 0===r&&(r=!0);var o=[];o.push(r?n[0]/t:n[0]*t);for(var i=1;i<n.length;++i)o.push(i<=e.length?r?e[i-1]*n[i]:n[i]/e[i-1]:n[i]);return o}function ZL(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function QL(n,e,t){for(var r=n.slice(0,1),o=0;o<t;++o)r.push(n[o+1]-e[o][0]-e[o][1]);return r}var bm="Div",Cm="SquaredDifference",e8="BroadcastTo",n8="Identity",Pi=F({add_:function(n,e){var t,r=I(n,"a","add"),o=I(e,"b","add");return t=wn(r,o),k.runKernelFunc(function(a,s){var u=a.add(r,o);return s([r,o]),u},{a:r=t[0],b:o=t[1]},null,"Add")}});function Vs(n,e){for(var t=n.length,r=[],o=0;o<t;o++){var i=t-1-o;(e[e.length-1-o]||1)>1&&1===(n[i]||1)&&r.unshift(i)}return r}function nr(n,e){for(var t=[],r=0;r<e.length;r++){var o=n[n.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&t.unshift(i)}return t}function yt(n,e){for(var t=[],r=Math.max(n.length,e.length),o=0;o<r;o++){var i=n[n.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)t.unshift(a);else if(1===a)t.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(i)}}return t}var Qme=F({abs_:function(n){var e=I(n,"x","abs");return"complex64"===e.dtype?k.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):k.runKernelFunc(function(t,r){var o=t.abs(e);return r([e]),o},{x:e},function(t,r){var o=r[0];return{x:function(){return t.mul(o.toFloat().step(-1))}}},"Abs")}}),Jme=F({acos_:function(n){var e=I(n,"x","acos");return k.runKernelFunc(function(t,r){var o=t.acos(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(Oe(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),e1e=F({acosh_:function(n){var e=I(n,"x","acosh");return k.runKernelFunc(function(t,r){var o=t.acosh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),t1e=F({asin_:function(n){var e=I(n,"x","asin");return k.runKernelFunc(function(t,r){var o=t.asin(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(Oe(1).sub(o.toFloat().square()).sqrt())}}})}}),n1e=F({asinh_:function(n){var e=I(n,"x","asinh");return k.runKernelFunc(function(t,r){var o=t.asinh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.divStrict(Oe(1).add(o.toFloat().square()).sqrt())}}})}}),r1e=F({atan_:function(n){var e=I(n,"x","atan");return k.runKernelFunc(function(t,r){var o=t.atan(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().square().add(1))}}})}}),o1e=F({atanh_:function(n){var e=I(n,"x","atanh");return k.runKernelFunc(function(t,r){var o=t.atanh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(Oe(1).sub(o.toFloat().square()))}}})}}),i1e=F({ceil_:function(n){var e=I(n,"x","ceil");return k.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),a1e=F({clipByValue_:function(n,e,t){var r=I(n,"x","clipByValue");return T(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),k.runKernelFunc(function(a,s){var u=a.clip(r,e,t);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),Tt(a))}}},"ClipByValue",{min:e,max:t},[r])}}),s1e=F({cos_:function(n){var e=I(n,"x","cos");return k.runKernelFunc(function(r,o){var i=r.cos(e);return o([e]),i},{x:e},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},[e])}}),u1e=F({cosh_:function(n){var e=I(n,"x","cosh");return k.runKernelFunc(function(t,r){var o=t.cosh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(t)}}})}}),c1e=F({erf_:function(n){var e=I(n,"x","erf");return T("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),k.runKernelFunc(function(t,r){var o=t.erf(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),l1e=F({exp_:function(n){var e=I(n,"x","exp");return k.runKernelFunc(function(t,r){var o=t.exp(e);return r([o]),o},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),f1e=F({expm1_:function(n){var e=I(n,"x","expm1");return k.runKernelFunc(function(t,r){var o=t.expm1(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.exp())}}})}}),d1e=F({floor_:function(n){var e=I(n,"x","floor");return k.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),h1e=F({log_:function(n){var e=I(n,"x","log");return k.runKernelFunc(function(r,o){var i=r.log(e);return o([e]),i},{x:e},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},[e])}}),p1e=F({log1p_:function(n){var e=I(n,"x","log1p");return k.runKernelFunc(function(t,r){var o=t.log1p(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.add(1))}}})}}),g1e=F({logSigmoid_:function(n){var e=I(n,"x","logSigmoid");return k.runKernelFunc(function(t,r){var o=t.softplus(e.neg()).neg();return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.neg().sigmoid())}}})}}),Pb=F({neg_:function(n){var e=I(n,"x","neg");return k.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},[e])}}),v1e=F({reciprocal_:function(n){var e=I(n,"x","reciprocal");return k.runKernelFunc(function(t,r){var o=t.reciprocal(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.square().neg())}}})}}),m1e=F({round_:function(n){var e=I(n,"x","round");return k.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),i8=F({rsqrt_:function(n){var e=I(n,"x","rsqrt");return k.runKernelFunc(function(r,o){var i=r.rsqrt(e);return o([e]),i},{x:e},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[e])}}),y1e=F({sigmoid_:function(n){var e=I(n,"x","sigmoid");return k.runKernelFunc(function(t,r){var o=t.sigmoid(e);return r([o]),o},{x:e},function(t,r){var o=r[0];return{x:function(){return t.mul(o.mul(Oe(1).sub(o)))}}},"Sigmoid")}}),x1e=F({sign_:function(n){var e=I(n,"x","sign");return k.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),w1e=F({isNaN_:function(n){var e=I(n,"x","isNaN");return k.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),_1e=F({isInf_:function(n){var e=I(n,"x","isInf");return k.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),b1e=F({isFinite_:function(n){var e=I(n,"x","isFinite");return k.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),C1e=F({sin_:function(n){var e=I(n,"x","sin");return k.runKernelFunc(function(r,o){var i=r.sin(e);return o([e]),i},{x:e},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},[e])}}),E1e=F({sinh_:function(n){var e=I(n,"x","sinh");return k.runKernelFunc(function(t,r){var o=t.sinh(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(t)}}})}}),S1e=F({softplus_:function(n){var e=I(n,"x","softplus");return k.runKernelFunc(function(t,r){var o=t.softplus(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.mul(o.sigmoid())}}})}}),A1e=F({sqrt_:function(n){var e=I(n,"x","sqrt");return k.runKernelFunc(function(t,r){var o=t.sqrt(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().sqrt().mul(2))}}})}}),I1e=F({step_:function(n,e){void 0===e&&(e=0);var t=I(n,"x","step");return k.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Tt(r)}}})}}),D1e=F({tan_:function(n){var e=I(n,"x","tan");return k.runKernelFunc(function(t,r){var o=t.tan(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return t.div(o.cos().square())}}})}}),T1e=F({tanh_:function(n){var e=I(n,"x","tanh");return k.runKernelFunc(function(t,r){var o=t.tanh(e);return r([o]),o},{x:e},function(t,r){var o=r[0];return{x:function(){return Oe(1).sub(o.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}}),R1e=F({addStrict_:function(n,e){var t=I(n,"a","addStrict"),r=I(e,"b","addStrict");return Dt(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),N1e=F({atan2_:function(n,e){var t,r=I(n,"a","atan2"),o=I(e,"b","atan2");t=wn(r,o);var i=yt((r=t[0]).shape,(o=t[1]).shape);return k.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Pi(u.square(),c.square()),f=a.mul(c.div(l)),d=nr(u.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(u.shape)},$b:function(){var l=Pi(u.square(),c.square()),f=Pb(a.mul(u.div(l))),d=nr(c.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(c.shape)}}})}}),O1e=F({divStrict_:function(n,e){var t=I(n,"a","div"),r=I(e,"b","div");return Dt(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),a8=F({floorDiv_:function(n,e){var t,r=I(n,"a","floorDiv"),o=I(e,"b","floorDiv");t=wn(r,o);var i=yt((r=t[0]).shape,(o=t[1]).shape);return k.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),f=nr(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=nr(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}},"FloorDiv")}}),kb=F({maximum_:function(n,e){var t,r=I(n,"a","maximum"),o=I(e,"b","maximum");return t=wn(r,o),o=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),o=o.toInt()),yt(r.shape,o.shape),k.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),M1e=F({maximumStrict_:function(n,e){var t=I(n,"a","maximumStrict"),r=I(e,"b","maximumStrict");return Dt(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),s8=F({minimum_:function(n,e){var t,r=I(n,"a","minimum"),o=I(e,"b","minimum");return t=wn(r,o),o=t[1],"bool"===(r=t[0]).dtype&&(r=r.toInt(),o=o.toInt()),yt(r.shape,o.shape),k.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),P1e=F({minimumStrict_:function(n,e){var t=I(n,"a","minimumStrict"),r=I(e,"b","minimumStrict");return Dt(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),k1e=F({mod_:function(n,e){var t,r=I(n,"a","mod"),o=I(e,"b","mod");t=wn(r,o);var i=yt((r=t[0]).shape,(o=t[1]).shape);return k.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=nr(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),f=nr(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}})}}),F1e=F({modStrict_:function(n,e){var t=I(n,"a","modStrict"),r=I(e,"b","modStrict");return Dt(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Mn=F({mul_:function(n,e){var t,r=I(n,"a","mul"),o=I(e,"b","mul");t=wn(r,o);var i=yt((r=t[0]).shape,(o=t[1]).shape);return k.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),f=nr(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=nr(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}},"Mul")}}),L1e=F({mulStrict_:function(n,e){var t=I(n,"a","mul"),r=I(e,"b","mul");return Dt(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Em=F({pow_:function(n,e){var t,r=I(n,"base","pow"),o=I(e,"exp","pow");t=wn(r,o);var i=yt((r=t[0]).shape,(o=t[1]).shape);return k.runKernelFunc(function(s,u){var c=s.pow(r,o);return u([r,o,c]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],f=u[2];return{a:function(){var d=l.toFloat(),h=s.mul(d.mul(c.pow(d.sub(Oe(1))))),p=nr(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var d=c.greater(0),h=c.log().where(d,Tt(c)),p=s.mul(f.mul(h)),g=nr(l.shape,i);return g.length>0&&(p=p.sum(g)),p.reshape(l.shape)}}},"Pow",{},[r,o],[!0])}}),B1e=F({powStrict_:function(n,e){return Dt(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),V1e=F({squaredDifferenceStrict_:function(n,e){var t=I(n,"a","squaredDifferenceStrict"),r=I(e,"b","squaredDifferenceStrict");return Dt(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),ua=F({sub_:function(n,e){var t,r=I(n,"a","sub"),o=I(e,"b","sub");t=wn(r,o);var i=yt((r=t[0]).shape,(o=t[1]).shape);return k.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=nr(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=nr(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),U1e=F({subStrict_:function(n,e){var t=I(n,"a","subStrict"),r=I(e,"b","subStrict");return Dt(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Lu=F({div_:function(n,e){var t,r=I(n,"a","div"),o=I(e,"b","div");return t=wn(r,o),o=t[1],"int32"===(r=t[0]).dtype&&"int32"===o.dtype?a8(r,o):k.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},null,bm,{})}});function Fb(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],o=1,i=0;i<t.length-1;++i)o*=t[i];var a=n.shape,s=t.slice();s.pop();var u=1;for(i=r;i<n.rank;++i)u*=a[i],s.push(a[i]);var c=Lo(n.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}Object.freeze({prepareAndValidate:Fb});var Lb=30;function Sm(n){return n<=Lb?n:am(n,Math.floor(Math.sqrt(n)))}function u8(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(t.rank<o)throw new Error(i+" update.rank < "+o+". ");if(n.length<r+(t.rank-o))throw new Error(i+" Output shape length < "+(r+(t.rank-o)));if(t.rank!==o+n.length-r)throw new Error(i+" update.rank != "+(o+n.length-r));for(var a=0;a<o;++a)if(t.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-o;++a)if(t.shape[a+o]!==n[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+t.shape[a+o]+") != shape["+(a+o)+"] ("+n[a+o]+")")}function c8(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(0===t.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}u8(t,e,n)}function Cp(n,e,t){for(var r=e.shape.length,o=r>1?e.shape[r-1]:1,i=t.length,a=1,s=o;s<i;++s)a*=t[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:Ee(e.shape)/u,sliceSize:a,strides:Lo(t.slice(0,o)).concat([1]),outputSize:Ee(t)}}function l8(n,e,t){T(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),T(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(i){T(e[i]+t[i]<=n.shape[i],function(){return"Error in slice"+n.rank+"D: begin["+i+"] + size["+i+"] ("+(e[i]+t[i])+") would overflow input.shape["+i+"] ("+n.shape[i]+")"})},o=0;o<n.rank;++o)r(o)}function Bb(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function Am(n,e,t){for(var r=[],o=0;o<n.length;o++)r[o]=Math.ceil((e[o]-n[o])/t[o]);return r}function f8(n,e,t,r,o){var i=e[o];(n&1<<o||null==i)&&(i=(t[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),om(0,i,s-1)}function d8(n,e,t,r,o){var i=e[o],a=t[o]||1;(n&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?om(0,i,s):om(-1,i,s-1)}function Vb(n,e,t){for(var r=t.length,o=0;o<t.length;o++)if(t[o]>1){r=o;break}for(o=r+1;o<t.length;o++)if(e[o]>0||t[o]!==n[o])return!1;return!0}function Ub(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Im(n){return k.customGrad(n)}Object.freeze({validateUpdateShape:u8,validateInput:c8,calculateShapes:Cp}),Object.freeze({assertParamsValid:l8,maskToAxes:Bb,computeOutShape:Am,startForAxis:f8,stopForAxis:d8,isSliceContinous:Vb,computeFlatOffset:Ub});var Tm=F({softmax_:function(n,e){void 0===e&&(e=-1);var t=I(n,"logits","softmax","float32");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return k.runKernelFunc(function(r,o){var i=r.softmax(t,e);return o([i]),i},{logits:t},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([e],!0).mul(i))}}},"Softmax",{dim:e},[],[!0])}}),W1e=F({logSoftmax_:function(n,e){void 0===e&&(e=-1);var t=I(n,"logits","logSoftmax");if(-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Im(function(r,o){var i=r.max(e,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(e,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(e,!0).mul(l))}}})(t)}}),ca=F({transpose_:function(n,e){var t=I(n,"x","transpose");return null==e&&(e=t.shape.map(function(o,i){return i}).reverse()),T(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(o){T(o>=0&&o<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():k.runKernelFunc(function(o){return o.transpose(t,e)},{x:t},null,"Transpose",{perm:e})}}),h8=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),p8=function(){function n(){}return n.prototype.time=function(e){return j("time")},n.prototype.read=function(e){return j("read")},n.prototype.readSync=function(e){return j("readSync")},n.prototype.numDataIds=function(){return j("numDataIds")},n.prototype.disposeData=function(e){return j("disposeData")},n.prototype.write=function(e,t,r){return j("write")},n.prototype.move=function(e,t,r,o){return j("move")},n.prototype.memory=function(){return j("memory")},n.prototype.floatPrecision=function(){return j("floatPrecision")},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,o){return j("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return j("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return j("slice")},n.prototype.stridedSlice=function(e,t,r,o){return j("stridedSlice")},n.prototype.unstack=function(e,t){return j("unstack")},n.prototype.reverse=function(e,t){return j("reverse")},n.prototype.concat=function(e,t){return j("concat")},n.prototype.neg=function(e){return j("neg")},n.prototype.add=function(e,t){return j("add")},n.prototype.addN=function(e){return j("addN")},n.prototype.subtract=function(e,t){return j("subtract")},n.prototype.multiply=function(e,t){return j("multiply")},n.prototype.realDivide=function(e,t){return j("realDivide")},n.prototype.floorDiv=function(e,t){return j("floorDiv")},n.prototype.sum=function(e,t){return j("sum")},n.prototype.prod=function(e,t){return j("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return j("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return j("argMin")},n.prototype.argMax=function(e,t){return j("argMax")},n.prototype.equal=function(e,t){return j("equal")},n.prototype.notEqual=function(e,t){return j("notEqual")},n.prototype.less=function(e,t){return j("less")},n.prototype.lessEqual=function(e,t){return j("lessEqual")},n.prototype.greater=function(e,t){return j("greater")},n.prototype.greaterEqual=function(e,t){return j("greaterEqual")},n.prototype.logicalNot=function(e){return j("logicalNot")},n.prototype.logicalAnd=function(e,t){return j("logicalAnd")},n.prototype.logicalOr=function(e,t){return j("logicalOr")},n.prototype.where=function(e){return j("where")},n.prototype.select=function(e,t,r){return j("select")},n.prototype.topk=function(e,t,r){return j("topk")},n.prototype.min=function(e,t){return j("min")},n.prototype.minimum=function(e,t){return j("minimum")},n.prototype.mod=function(e,t){return j("mod")},n.prototype.max=function(e,t){return j("max")},n.prototype.maximum=function(e,t){return j("maximum")},n.prototype.all=function(e,t){return j("all")},n.prototype.any=function(e,t){return j("any")},n.prototype.squaredDifference=function(e,t){return j("squaredDifference")},n.prototype.ceil=function(e){return j("ceil")},n.prototype.floor=function(e){return j("floor")},n.prototype.round=function(e){return j("round")},n.prototype.sign=function(e){return j("sign")},n.prototype.isNaN=function(e){return j("isNaN")},n.prototype.isInf=function(e){return j("isInf")},n.prototype.isFinite=function(e){return j("isFinite")},n.prototype.pow=function(e,t){return j("pow")},n.prototype.exp=function(e){return j("exp")},n.prototype.expm1=function(e){return j("expm1")},n.prototype.softmax=function(e,t){return j("softmax")},n.prototype.log=function(e){return j("log")},n.prototype.log1p=function(e){return j("log1p")},n.prototype.sqrt=function(e){return j("sqrt")},n.prototype.rsqrt=function(e){return j("rsqrt")},n.prototype.square=function(e){return j("square")},n.prototype.reciprocal=function(e){return j("reciprocal")},n.prototype.relu=function(e){return j("relu")},n.prototype.relu6=function(e){return j("relu6")},n.prototype.prelu=function(e,t){return j("prelu")},n.prototype.elu=function(e){return j("elu")},n.prototype.eluDer=function(e,t){return j("eluDer")},n.prototype.selu=function(e){return j("selu")},n.prototype.int=function(e){return j("int")},n.prototype.clip=function(e,t,r){return j("clip")},n.prototype.abs=function(e){return j("abs")},n.prototype.complexAbs=function(e){return j("complexAbs")},n.prototype.sigmoid=function(e){return j("sigmoid")},n.prototype.softplus=function(e){return j("softplus")},n.prototype.sin=function(e){return j("sin")},n.prototype.cos=function(e){return j("cos")},n.prototype.tan=function(e){return j("tan")},n.prototype.asin=function(e){return j("asin")},n.prototype.acos=function(e){return j("acos")},n.prototype.atan=function(e){return j("atan")},n.prototype.atan2=function(e,t){return j("atan2")},n.prototype.sinh=function(e){return j("sinh")},n.prototype.cosh=function(e){return j("cosh")},n.prototype.tanh=function(e){return j("tanh")},n.prototype.asinh=function(e){return j("asinh")},n.prototype.acosh=function(e){return j("acosh")},n.prototype.atanh=function(e){return j("atanh")},n.prototype.erf=function(e){return j("erf")},n.prototype.step=function(e,t){return j("step")},n.prototype.fusedConv2d=function(e){return j("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return j("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return j("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return j("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return j("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return j("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return j("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return j("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return j("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return j("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return j("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return j("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,o){return j("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return j("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return j("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return j("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return j("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return j("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,o){return j("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return j("reshape")},n.prototype.cast=function(e,t){return j("cast")},n.prototype.tile=function(e,t){return j("tile")},n.prototype.pad=function(e,t,r){return j("pad")},n.prototype.transpose=function(e,t){return j("transpose")},n.prototype.gather=function(e,t,r){return j("gather")},n.prototype.gatherND=function(e,t){return j("gatherND")},n.prototype.scatterND=function(e,t,r){return j("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return j("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return j("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,o){return j("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return j("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,o){return j("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return j("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,o,i,a){return j("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,o,i){return j("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,o,i,a,s){return j("LRNGrad")},n.prototype.multinomial=function(e,t,r,o){return j("multinomial")},n.prototype.oneHot=function(e,t,r,o){return j("oneHot")},n.prototype.cumsum=function(e,t,r,o){return j("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,o,i){return j("nonMaxSuppression")},n.prototype.fft=function(e){return j("fft")},n.prototype.ifft=function(e){return j("ifft")},n.prototype.complex=function(e,t){return j("complex")},n.prototype.real=function(e){return j("real")},n.prototype.imag=function(e){return j("imag")},n.prototype.cropAndResize=function(e,t,r,o,i,a){return j("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return j("depthToSpace")},n.prototype.split=function(e,t,r){return j("split")},n.prototype.sparseToDense=function(e,t,r,o){return j("sparseToDense")},n.prototype.diag=function(e){return j("diag")},n.prototype.fill=function(e,t,r){return j("fill")},n.prototype.onesLike=function(e){return j("onesLike")},n.prototype.zerosLike=function(e){return j("zerosLike")},n.prototype.linspace=function(e,t,r){return j("linspace")},n.prototype.dispose=function(){return j("dispose")},n}();function j(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Bu(n,e,t,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=Rm(e),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,n[3],n[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,n[1],n[1]]}return Vu(n,s,t,r,o,i,!1,a)}function Ep(n,e,t,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=Wb(e),l=c[0],f=c[1],d=c[2];if("NDHWC"===a)u="channelsLast",s=[l,f,d,n[4],n[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,f,d,n[1],n[1]]}return Sp(n,s,t,r,o,!1,u,i)}function Vu(n,e,t,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3];if("channelsLast"===s)c=n[0],l=n[1],f=n[2],d=n[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=n[0],d=n[1],l=n[2],f=n[3]}var h,p=e[0],g=e[1],v=e[3],m=Rm(t),y=m[0],x=m[1],w=Rm(r),_=w[0],b=w[1],C=Vf(p,_),E=Vf(g,b),S=function(B,U,G,H,W,$,K,re){var ce,he,Ce;if("number"==typeof B){ce={top:B,bottom:B,left:B,right:B,type:0===B?"VALID":"NUMBER"};var Re=function(Ue,it,rt,Ot,Mt){null==Ot&&(Ot=Hb(Ue,it,rt));var Ho=Ue[1],Br=Ap((Ue[0]-it+2*Ot)/rt+1,Mt);T(An(Br),function(){return"The output # of rows ("+Br+") must be an integer. Change the stride and/or zero pad parameters"});var Cr=Ap((Ho-it+2*Ot)/rt+1,Mt);return T(An(Cr),function(){return"The output # of columns ("+Cr+") must be an integer. Change the stride and/or zero pad parameters"}),[Br,Cr]}([U,G],$,H,B,re);he=Re[0],Ce=Re[1]}else if("same"===B){he=Math.ceil(U/H),Ce=Math.ceil(G/W);var Fe=Math.max(0,(he-1)*H+$-U),Pe=Math.max(0,(Ce-1)*W+K-G),Se=Math.floor(Fe/2),Xe=Fe-Se,nt=Math.floor(Pe/2);ce={top:Se,bottom:Xe,left:nt,right:Pe-nt,type:"SAME"}}else{if("valid"!==B)throw Error("Unknown padding parameter: "+B);ce={top:0,bottom:0,left:0,right:0,type:"VALID"},he=Math.ceil((U-$+1)/H),Ce=Math.ceil((G-K+1)/W)}return{padInfo:ce,outHeight:he,outWidth:Ce}}(o,l,f,y,x,C,E,i),D=S.outHeight,M=S.outWidth,L=a?v*d:v;return"channelsFirst"===s?h=[c,L,D,M]:"channelsLast"===s&&(h=[c,D,M,L]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:d,outHeight:D,outWidth:M,outChannels:L,padInfo:S.padInfo,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:_,dilationWidth:b,inShape:n,outShape:h,filterShape:e}}function Sp(n,e,t,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3],h=u[4];if("channelsLast"===a)c=n[0],l=n[1],f=n[2],d=n[3],h=n[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=n[0],h=n[1],l=n[2],f=n[3],d=n[4]}var p,g=e[0],v=e[1],m=e[2],y=e[4],x=Wb(t),w=x[0],_=x[1],b=x[2],C=Wb(r),E=C[0],S=C[1],A=C[2],D=Vf(g,E),M=Vf(v,S),L=Vf(m,A),B=function(K,re,ce,he,Ce,Re,Fe,Pe,Se,Xe,nt){var Ue,it,rt,Ot;if("number"==typeof K){Ue={top:K,bottom:K,left:K,right:K,front:K,back:K,type:0===K?"VALID":"NUMBER"};var Mt=function(ha,pa,Hp,ga,is,yE){null==is&&(is=Hb(ha,pa,ga));var gCe=ha[1],vCe=ha[2],xE=Ap((ha[0]-pa+2*is)/ga+1,yE);T(An(xE),function(){return"The output # of depths ("+xE+") must be an integer. Change the stride and/or zero pad parameters"});var wE=Ap((gCe-pa+2*is)/ga+1,yE);T(An(wE),function(){return"The output # of rows ("+wE+") must be an integer. Change the stride and/or zero pad parameters"});var _E=Ap((vCe-pa+2*is)/ga+1,yE);return T(An(_E),function(){return"The output # of columns ("+_E+") must be an integer. Change the stride and/or zero pad parameters"}),[xE,wE,_E,1]}([re,ce,he,1],Pe,0,Ce,K,nt);it=Mt[0],rt=Mt[1],Ot=Mt[2]}else if("same"===K){var nn=((it=Math.ceil(re/Ce))-1)*Ce+Pe-re,Ho=((rt=Math.ceil(ce/Re))-1)*Re+Se-ce,Br=((Ot=Math.ceil(he/Fe))-1)*Fe+Xe-he,Cr=Math.floor(nn/2),di=nn-Cr,to=Math.floor(Ho/2),yo=Ho-to,da=Math.floor(Br/2);Ue={top:to,bottom:yo,left:da,right:Br-da,front:Cr,back:di,type:"SAME"}}else{if("valid"!==K)throw Error("Unknown padding parameter: "+K);Ue={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},it=Math.ceil((re-Pe+1)/Ce),rt=Math.ceil((ce-Se+1)/Re),Ot=Math.ceil((he-Xe+1)/Fe)}return{padInfo:Ue,outDepth:it,outHeight:rt,outWidth:Ot}}(o,l,f,d,w,_,b,D,M,L,s),G=B.outDepth,H=B.outHeight,W=B.outWidth,$=i?y*h:y;return"channelsFirst"===a?p=[c,$,G,H,W]:"channelsLast"===a&&(p=[c,G,H,W,$]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:f,inWidth:d,inChannels:h,outDepth:G,outHeight:H,outWidth:W,outChannels:$,padInfo:B.padInfo,strideDepth:w,strideHeight:_,strideWidth:b,filterDepth:g,filterHeight:v,filterWidth:m,effectiveFilterDepth:D,effectiveFilterHeight:M,effectiveFilterWidth:L,dilationDepth:E,dilationHeight:S,dilationWidth:A,inShape:n,outShape:p,filterShape:e}}function Hb(n,e,t,r){void 0===r&&(r=1);var o=Vf(e,r);return Math.floor((n[0]*(t-1)-t+o)/2)}function Rm(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function Wb(n){return"number"==typeof n?[n,n,n]:n}function Vf(n,e){return e<=1?n:n+(n-1)*(e-1)}function Ap(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function qc(n){var e=Rm(n);return 1===e[0]&&1===e[1]&&1===e[2]}function Zr(n,e){return qc(n)||qc(e)}function Nm(n){if("NHWC"===n)return"channelsLast";if("NCHW"===n)return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function Gb(n,e,t){if("complex64"===e){if("complex64"===n.dtype)return n.clone();var r=On(n.shape),o=n.toFloat(),i=t.complex(o,r);return r.dispose(),o.dispose(),i}if(!iL(n.dtype,e))return k.makeTensorFromDataId(n.dataId,n.shape,e);if("complex64"===n.dtype){var a=t.real(n);return i=a.cast(e),a.dispose(),i}if("int32"===e)return t.int(n);if("bool"===e){var s=Oe(0,n.dtype);return i=t.notEqual(n,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function Om(n,e){return k.makeTensorFromDataId(n.dataId,e,n.dtype)}function zb(n,e,t){var r=(e-n)/(t-1),o=Ff(t,"float32");o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return sa(o,"float32")}function jb(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function g8(n,e){return{real:n[2*e],imag:n[2*e+1]}}function G1e(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function z1e(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function j1e(n,e,t){var r=function(u,c,l){for(var f=0,d=u.length,h=0,p=!1;f<d;){var g=l(c,u[h=f+(d-f>>>1)]);g>0?f=h+1:(d=h,p=!g)}return p?f:-f-1}(n,e,t||$1e);n.splice(r<0?-(r+1):r,0,e)}function $1e(n,e){return n>e?1:n<e?-1:0}function $b(n,e,t,r,o){return v8(n,e,t,r,o,0).selectedIndices}function qb(n,e,t,r,o,i){var a=v8(n,e,t,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function v8(n,e,t,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(e).map(function(w,_){return{score:w,boxIndex:_,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(m8),c=i>0?-.5/i:0,l=[],f=[];l.length<t&&u.length>0;){var d=u.pop(),h=d.score,p=d.boxIndex,g=d.suppressBeginIndex;if(h<o)break;for(var v=!1,m=l.length-1;m>=g;--m){var y=q1e(n,p,l[m]);if(y>=r){v=!0;break}if(d.score=d.score*X1e(r,c,y),d.score<=o)break}d.suppressBeginIndex=l.length,v||(d.score===h?(l.push(p),f.push(d.score)):d.score>o&&j1e(u,d,m8))}var x=l.length;return s&&(l.fill(0,x),f.fill(0,x)),{selectedIndices:sa(l,"int32"),selectedScores:sa(f,"float32"),numValidOutputs:Oe(x,"int32")}}function q1e(n,e,t){var r=n.subarray(4*e,4*e+4),o=n.subarray(4*t,4*t+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(f-c)*(d-l);if(h<=0||p<=0)return 0;var g=Math.max(i,c),v=Math.max(a,l),m=Math.min(s,f),y=Math.min(u,d),x=Math.max(m-g,0)*Math.max(y-v,0);return x/(h+p-x)}function X1e(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function m8(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function y8(n,e,t){var r=new Array(n.rank).fill(0),o=n.shape.slice();return e.map(function(i){o[t]=i;var a=n.slice(r,o);return r[t]+=i,a})}function x8(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var o=Qe(t,n.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(n.rank),s=0;s<a.length;s++)a[s]=i[s]%n.shape[s];var u=n.locToIndex(a);o.values[r]=n.values[u]}return o.toTensor()}function w8(n,e,t,r,o){for(var i=e[e.length-1],a=[n.length/i,i],s=a[0],u=a[1],c=Wc(t,s*r),l=Wc("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=n.subarray(d,d+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(w,_){return _.value-w.value});var v=f*r,m=c.subarray(v,v+r),y=l.subarray(v,v+r);for(g=0;g<r;g++)m[g]=p[g].value,y[g]=p[g].index}var x=e.slice();return x[x.length-1]=r,[Lr(c,x,t),Lr(l,x,"int32")]}function Xb(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var o=Qe(n,"int32"),i=Qe([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=o.indexToLoc(t[r]);i.values.set(a,r*n.length)}return i.toTensor()}Object.freeze({castTensor:Gb,reshapeTensor:Om,linspaceImpl:zb,upcastType:_r,axesAreInnerMostDims:Ob,combineLocations:zL,computeOutAndReduceShapes:kr,expandShapeToKeepDim:mo,assertAxesAreInnerMostDims:Vo,getAxesPermutation:ia,getUndoAxesPermutation:vm,getInnerMostAxes:aa,getBroadcastDims:Vs,getReductionAxes:nr,assertAndGetBroadcastShape:yt,assertParamsConsistent:jL,computeOutShape:zc,computePool2DInfo:Bu,computePool3DInfo:Ep,computeConv2DInfo:Vu,computeConv3DInfo:Sp,computeDefaultPad:Hb,tupleValuesAreOne:qc,eitherStridesOrDilationsAreOne:Zr,convertConv2DDataFormat:Nm,PARALLELIZE_THRESHOLD:Lb,computeOptimalWindowSize:Sm});var K1e=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(o,i){return"T"+i});var t=[];this.variableNames.forEach(function(o){t.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+t.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Y1e=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(o,i){return"T"+i});var t=[];this.variableNames.forEach(function(o){t.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+t.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Z1e=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,a=Math.ceil(n.inSize/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function _8(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function Uo(n,e){return 1===e?[n]:_8(n,e)}function Qr(){var n,e,t,r,o,i,a,s,u,c;return 2===X().getNumber("WEBGL_VERSION")?(n="#version 300 es",e="in",t="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",e="attribute",t="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Xc(n,e,t){void 0===t&&(t="index");var r=Lo(e);return r.map(function(o,i){return"int "+n[i]+" = "+t+" / "+o+"; "+(i===r.length-1?"int "+n[i+1]+" = "+t+" - "+n[i]+" * "+o:"index -= "+n[i]+" * "+o)+";"}).join("")}function Kb(n){var e=Lo(n).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var b8="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Q1e(n,e,t,r){var o=[];n.forEach(function(h){var p=Ee(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,h,s=o.join("\n"),u=n.map(function(h){return function(p,g,v){void 0===v&&(v=!1);var m="";return m+=v?C8(p):Uf(p),p.shapeInfo.logicalShape.length<=g.logicalShape.length&&(m+=v?function(w,_){var b,G,C=w.name,E=C.charAt(0).toUpperCase()+C.slice(1),S="get"+E+"AtOutCoords",A=w.shapeInfo.logicalShape.length,D=_.logicalShape.length,M=Vs(w.shapeInfo.logicalShape,_.logicalShape),L=fn(D),B=D-A,U=["x","y","z","w","u","v"];b=0===A?"":D<2&&M.length>=1?"coords = 0;":M.map(function(ce){return"coords."+U[ce+B]+" = 0;"}).join("\n"),G=D<2&&A>0?"coords":w.shapeInfo.logicalShape.map(function(ce,he){return"coords."+U[he+B]}).join(", ");var H="return outputValue;",W=1===Ee(w.shapeInfo.logicalShape),$=1===Ee(_.logicalShape);if(1!==A||W||$){if(W&&!$)H=1===D?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(M.length){var K=A-2,re=A-1;M.indexOf(K)>-1&&M.indexOf(re)>-1?H="return vec4(outputValue.x);":M.indexOf(K)>-1?H="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":M.indexOf(re)>-1&&(H="return vec4(outputValue.xx, outputValue.zz);")}}else H="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+S+"() {\n      "+L+" coords = getOutputCoords();\n      "+b+"\n      vec4 outputValue = get"+E+"("+G+");\n      "+H+"\n    }\n  "}(p,g):function(w,_){var b=w.name,C=b.charAt(0).toUpperCase()+b.slice(1),E="get"+C+"AtOutCoords",D=w.shapeInfo.logicalShape.length,M=_.logicalShape.length;if(!w.shapeInfo.isUniform&&D===M&&null==w.shapeInfo.flatOffset&&er(w.shapeInfo.texShape,_.texShape))return"\n      float "+E+"() {\n        return sampleTexture("+b+", resultUV);\n      }\n    ";var B=fn(M),U=Vs(w.shapeInfo.logicalShape,_.logicalShape),G=M-D,H=["x","y","z","w","u","v"];return"\n    float "+E+"() {\n      "+B+" coords = getOutputCoords();\n      "+(0===D?"":M<2&&U.length>=1?"coords = 0;":U.map(function($){return"coords."+H[$+G]+" = 0;"}).join("\n"))+"\n      return get"+C+"("+(M<2&&D>0?"coords":w.shapeInfo.logicalShape.map(function($,K){return"coords."+H[K+G]}).join(", "))+");\n    }\n  "}(p,g)),m}(h,e,r)}).join("\n"),c=e.texShape,l=Qr(),f="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",d=(h=l).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+h.varyingFs+" vec2 resultUV;\n    "+h.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+h.defineSpecialNaN+"\n    "+h.defineSpecialInf+"\n    "+h.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+J1e+"\n    "+eye+"\n    "+tye+"\n  ";return e.isPacked?(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return _=p,1===(b=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+b[1]+".0);\n      }\n    ":1===b[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+b[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      return 2 * (resTexRC.x * "+b[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(w,_){var b=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)];if(er(w,_))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+b[0]+", "+b[1]+"));\n      }\n    ";var C=Math.ceil(w[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      int r = 2 * (index / "+C+");\n      int c = imod(index, "+C+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=h,v=p,m=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],x=(y=Math.ceil(g[2]/2))*Math.ceil(g[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+m[0]+", "+m[1]+"));\n      int index = resTexRC.x * "+m[1]+" + resTexRC.y;\n\n      int b = index / "+x+";\n      index -= b * "+x+";\n\n      int r = 2 * (index / "+y+");\n      int c = imod(index, "+y+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(w,_){for(var b=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],C=Math.ceil(w[w.length-1]/2),E=C*Math.ceil(w[w.length-2]/2),S=E,A="",D="b, r, c",M=2;M<w.length-1;M++)A="\n      int b"+M+" = index / "+(S*=w[w.length-M-1])+";\n      index -= b"+M+" * "+S+";\n    "+A,D="b"+M+", "+D;return"\n    ivec"+w.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+A+"\n\n      int b = index / "+E+";\n      index -= b * "+E+";\n\n      int r = 2 * (index / "+C+");\n      int c = imod(index, "+C+") * 2;\n\n      return ivec"+w.length+"("+D+");\n    }\n  "}(h,p)}var _,b,g,v,m,y,x}(e.logicalShape,c),a=function(h){return"\n    void setOutput(vec4 val) {\n      "+h.output+" = val;\n    }\n  "}(l)):(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(y=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+y[1]+".0);\n      }\n    ":1===y[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+y[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      return resTexRC.x * "+y[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(m,y){return er(m,y)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+y[0]+", "+y[1]+"));\n      }\n    ":1===m[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===m[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      int r = index / "+m[1]+";\n      int c = index - r * "+m[1]+";\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=p,v=Xc(["r","c","d"],h),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n      "+v+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(m,y){var x=Xc(["r","c","d","d2"],m);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      "+x+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(h,p);case 5:return function(m,y){var x=Xc(["r","c","d","d2","d3"],m);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+y[0]+",\n                             "+y[1]+"));\n\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      "+x+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(h,p);case 6:return function(m,y){var x=Xc(["r","c","d","d2","d3","d4"],m);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      "+x+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var y,g,v}(e.logicalShape,c),a=function(h){return"\n    void setOutput(float val) {\n      "+h.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=nye),[d,f,a,s,i,u,t].join("\n")}function Uf(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=t.shapeInfo.texShape;if(1===i[0]&&1===i[1])return"\n      float "+o+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=t.shapeInfo.texShape;return"\n    float "+o+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+Kc(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 1:return function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+o+"(int index) {\n        "+Hf(t)+"\n      }\n    ";var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return"\n      float "+o+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=Kc(r);return 1===s?"\n      float "+o+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+a+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===a?"\n      float "+o+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+s+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=t.shapeInfo.texShape;if(null!=a&&er(r,a))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+a[0]+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ";var c=Nu(r),l=c.newShape,f=c.keptDims;if(l.length<r.length)return"\n      "+Uf(Wf(t,l))+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+Gf(["row","col"],f)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Hf(t)+"\n      }\n    ";var p=a[0],g=a[1],v=Kc(o);return 1===g?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+v+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":1===p?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+v+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+g+".0, 0.5);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+v+";\n    vec2 uv = uvFromFlat("+p+", "+g+", index);\n    return sampleTexture("+o+", uv);\n  }\n"}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=Nu(r),c=u.newShape,l=u.keptDims;if(c.length<r.length)return"\n        "+Uf(Wf(t,c))+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+Gf(["row","col","depth"],l)+");\n        }\n      ";if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+s+", 1)));\n        "+Hf(t)+"\n      }\n    ";var h=t.shapeInfo.texShape,p=h[0],g=h[1],v=t.shapeInfo.flatOffset;return g===a&&null==v?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+s+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+g+".0, "+p+".0);\n          return sampleTexture("+o+", uv);\n        }\n      ":g===s&&null==v?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+g+".0, "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+s+" + depth + "+Kc(o)+";\n        vec2 uv = uvFromFlat("+p+", "+g+", index);\n        return sampleTexture("+o+", uv);\n      }\n  "}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=Nu(r),l=c.newShape,f=c.keptDims;if(l.length<r.length)return"\n      "+Uf(Wf(t,l))+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+Gf(["row","col","depth","depth2"],f)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+s+", "+a+", 1)));\n        "+Hf(t)+"\n      }\n    ";var h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,g=p[0],v=p[1];return v===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":v===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+g+", "+v+", index + "+Kc(o)+");\n      return sampleTexture("+o+", uv);\n    }\n  "}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=Nu(r),f=l.newShape,d=l.keptDims;if(f.length<r.length)return"\n      "+Uf(Wf(t,f))+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+Gf(["row","col","depth","depth2","depth3"],d)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+a+")) +\n          depth3;\n        "+Hf(t)+"\n      }\n    ";var p=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,v=g[0],m=g[1];return m===c&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":m===a&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+s+" +\n          depth2 * "+a+" + depth3 + "+Kc(o)+";\n      vec2 uv = uvFromFlat("+v+", "+m+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=Nu(r),s=a.newShape,u=a.keptDims;if(s.length<r.length)return"\n      "+Uf(Wf(t,s))+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+Gf(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var l=r[5],f=r[4]*l,d=r[3]*f,h=r[2]*d,p=r[1]*h;if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+h+", "+d+", "+f+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+Hf(t)+"\n      }\n    ";var g=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,m=v[0],y=v[1];return y===p&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+d+", "+f+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":y===l&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+h+" + depth * "+d+" +\n          depth2 * "+f+" + depth3 * "+l+" + depth4 + "+Kc(o)+";\n      vec2 uv = uvFromFlat("+m+", "+y+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function C8(n){var e,o,i,a,s,u,c;switch(n.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(e=n.name).charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+Qr().texture2D+"("+e+", halfCR);\n    }\n  ";case 1:return a="get"+(i=(o=n).name).charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Qr(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+i+", uv);\n    }\n  ";case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],f=Qr();if(null!=u&&er(i,u))return"\n      vec4 "+s+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+l+".0, "+c+".0);\n\n        return "+f.texture2D+"("+a+", uv);\n      }\n    ";var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+s+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(i[1]/2)+", "+d[0]+", "+d[1]+", row, col);\n      return "+f.texture2D+"("+a+", uv);\n    }\n  "}(n);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===i[0])return"\n        "+C8(Wf(o,i.slice(1)))+"\n        vec4 "+s+"(int b, int row, int col) {\n          return "+s+"("+Gf(["b","row","col"],[1,2])+");\n        }\n      ";var d=c[0],h=c[1],p=Math.ceil(i[2]/2);return"\n    vec4 "+s+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+d+", "+h+", "+p*Math.ceil(i[1]/2)+", "+p+", b, row, col);\n      return "+Qr().texture2D+"("+a+", uv);\n    }\n  "}(n);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],f=l[0],d=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),g="int b, int row, int col",v="b * "+p+" + (row / 2) * "+h+" + (col / 2)",m=2;m<a-1;m++)g="int b"+m+", "+g,v="b"+m+" * "+(p*=i[a-m-1])+" + "+v;return"\n    vec4 "+u+"("+g+") {\n      int index = "+v+";\n      int texR = index / "+d+";\n      int texC = index - texR * "+d+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+", "+f+");\n      return "+Qr().texture2D+"("+s+", uv);\n    }\n  "}(n)}}var J1e="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",eye="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",tye="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",nye="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Kc(n){return"offset"+n}function Hf(n){var e=n.name,t=Ee(n.shapeInfo.logicalShape);return t<2?"return "+e+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function fn(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Wf(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Gf(n,e){return e.map(function(t){return n[t]}).join(", ")}var rye=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=Math.ceil(n[n.length-1]/e);this.outputShape=n.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=fn(c),f=Uo("coords",c);if(1===i){var d=fn(s=c+1);a="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],g=h.map(function(E){return"int "+E}),v=Uo("sourceLocR",s-1).concat("inIdx.r"),m=Uo("sourceLocG",s-1).concat("inIdx.g"),y=Uo("sourceLocB",s-1).concat("inIdx.b"),x=Uo("sourceLocA",s-1).concat("inIdx.a"),w="max"===t?"greaterThan":"lessThan",_=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",b="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+b+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+_+"\n          vec4 candidate = "+b+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},oye=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var s=n.effectiveFilterHeight,u=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-n.padInfo.top)+", "+(u-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},iye=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var l=n.effectiveFilterDepth,f=n.effectiveFilterHeight,d=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(l-1-n.padInfo.front)+", "+(f-1-n.padInfo.top)+", "+(d-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterDepth*n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},aye=function(n,e,t,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],yt(n,e),yt(n,t);var a="0.0";null!=r&&(yt(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(yt(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},sye=function(n,e,t,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],yt(n,e),yt(n,t);var a="vec4(0.0)";null!=r&&(yt(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(yt(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},E8=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=yt(e,t),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Yb="return a + b;",Zb="return a - b;",S8="return a * b;",A8="return (a < 0.) ? b * a : a;",Pn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=yt(e,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},I8="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Qa=function(n,e,t,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=yt(e,t);var o=this.outputShape.length,i="";if(r)if(0===o||1===Ee(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+fn(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Uo("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},dye=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,e),o.gl.uniform1f(r.maxLoc,t)}},n}(),hye=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,e),o.gl.uniform1f(r.maxLoc,t)}},n}(),pye=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},gye=function(n){this.outputShape=[],this.outputShape=zc(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++)r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+e[t-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},vye=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=zc(n,e);var t=this.outputShape,r=t.length,o=fn(r),i=Uo("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(v,m){return"T"+m});var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var c=a[e],l=a.slice(-2),f=a.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Mm(a,c,h)+"),\n            vec2("+Mm(l,c,h)+"));\n        }"}var g=s[s.length-1];d+="\n        return getChannel(\n          getT"+s.length+"("+Mm(a,c,g)+"),\n          vec2("+Mm(l,c,g)+"));",this.userCode="\n      float getValue("+a.map(function(v){return"int "+v})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+t[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+t[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+t[r-2]+" &&\n            "+i[r-1]+" < "+t[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function Mm(n,e,t){var r=n.indexOf(e);return n.map(function(o,i){return i===r?o+" - "+t:o}).join()}var mye=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===n.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},yye=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,i="channelsLast"===n.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(i?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(i?1:2)+"], coords["+(i?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xye=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},wye=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-n.padInfo.front)+", "+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+t+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+t+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_ye=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},bye=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,s=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-n.padInfo.top)+", "+(t-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},D8=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.padInfo.top,i=n.padInfo.left,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,l=n.filterHeight,f=n.filterWidth,d=4*Math.floor(n.inChannels/4),h=n.inChannels%4,p="channelsLast"===n.dataFormat,g=p?1:2,v=p?2:3,m=p?3:1,y="",x="";t&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"\n          float activation(float x) {\n            "+t+"\n          }\n        ",x="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+m+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+x+"\n        setOutput(result);\n      }\n    "},Cye=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,i=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,l=n.filterDepth,f=n.filterHeight,d=n.filterWidth,h=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+t+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},T8=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.inHeight,i=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,c=n.strideWidth,l=n.dilationHeight,f=n.dilationWidth,d=n.filterHeight,h=n.filterWidth,p=n.outChannels/n.inChannels,g="",v="";t&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"\n          float activation(float x) {\n            "+t+"\n          }\n        ",v="result = activation(result);");var m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+m+"\n        "+v+"\n        setOutput(result);\n      }\n    "},R8=function(n,e,t,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var o=n.inHeight,i=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,c=n.strideWidth,l=n.dilationHeight,f=n.dilationWidth,d=n.filterHeight,h=n.filterWidth,p=h,g="int xR; int xC; int xCOffset;",v=0;v<d;v++)for(var m=0;m<h;m++)g+="\n          vec4 xTexelR"+v+"C"+2*m+" = vec4(0.);\n          vec4 wR"+v+"C"+m+" = vec4(0.);\n          vec4 xR"+v+"C"+m+" = vec4(0.);";for(v=0;v<d;v++)for(var y=0;y<p;y++){if(g+="\n          xR = xRCorner + "+v*l+";\n          xC = xCCorner + "+(m=2*y)*f+";\n        ",1===c){if(m<h&&(g+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+v+"C"+m+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+m+" = vec4(previous.zw, xTexelR"+v+"C"+m+".xy);\n                } else {\n                  xR"+v+"C"+m+" = vec4(0, 0, xTexelR"+v+"C"+m+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                xR"+v+"C"+m+" = xTexelR"+v+"C"+m+";\n              ",m+1<h)){var x=s%2==0?lb(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(g+="\n                  xCOffset = xC + "+s%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+v+"C"+m+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+m+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+v+"C"+(m+1)+" = vec4(\n                    xTexelR"+v+"C"+m+".zw, xTexelR"+v+"C"+(m+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(m+1)+" = xTexelR"+v+"C"+(m+2)+";\n                "}}else m<h&&(g+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(g+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(m+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+m+" = vec4(\n                  xTexelR"+v+"C"+m+".zw, xTexelR"+v+"C"+(m+2)+".zw);\n              ",m+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(m+1)+" = vec4(xTexelR"+v+"C"+(m+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(m+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+m+" = vec4(\n                  xTexelR"+v+"C"+m+".xy, xTexelR"+v+"C"+(m+2)+".xy);\n              ",m+1<h&&(g+="\n                  xR"+v+"C"+(m+1)+" = vec4(\n                    xTexelR"+v+"C"+m+".zw, xTexelR"+v+"C"+(m+2)+".zw);\n                ")),g+="}");m<h&&(g+="\n            vec4 wTexelR"+v+"C"+m+" = getW("+v+", "+m+", d1, q);\n            wR"+v+"C"+m+" = vec4(wTexelR"+v+"C"+m+".xz, wTexelR"+v+"C"+m+".xz);\n          ",m+1<h&&(g+="\n              vec4 wTexelR"+v+"C"+(m+1)+" = getW("+v+", "+(m+1)+", d1, q);\n              wR"+v+"C"+(m+1)+" =\n                vec4(wTexelR"+v+"C"+(m+1)+".xz, wTexelR"+v+"C"+(m+1)+".xz);"))}for(v=0;v<d;v++)for(m=0;m<h;m++)g+="dotProd += xR"+v+"C"+m+" * wR"+v+"C"+m+";";var w="",_="";t&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+t+"\n        }":"vec4 activation(vec4 x) {\n          "+t+"\n        }",_="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+b+"\n        "+_+"\n        setOutput(result);\n      }\n    "},Eye=function(n,e,t,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=n[0],a=n[1],s=n[2],l=t[0],f=t[1];this.outputShape=[e[0],l,f,n[3]];var h=[a-1+".0",s-1+".0"],p=h[0],g=h[1],v=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],w=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g];this.userCode="\n      const float height_ratio = float("+v[0]+");\n      const float width_ratio = float("+w[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+v[1]+";\n        float width_scale = "+w[1]+";\n\n        float in_y = "+v[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+w[2]+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Sye=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],i=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+fn(r)+" coords = getOutputCoords();\n        int end = "+N8(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+N8(r,"coords")+" = idx;\n          val += getX("+function(a,s){if(1===a)return""+s;if(2===a)return s+".x, "+s+".y";if(3===a)return s+".x, "+s+".y, "+s+".z";if(4===a)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function N8(n,e){if(1===n)return""+e;if(2===n)return e+".y";if(3===n)return e+".z";if(4===n)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var Aye=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=pp.DENSE;var e=gp(n),t=Qr();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Xc(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+t.output+" = result;\n      }\n    "},Iye=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=pp.DENSE;var e=gp(n),t=Qr();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Xc(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+t.output+" = result;\n      }\n    "},Dye=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),Tye=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Rye=function(n){this.variableNames=["A"],this.outTexUsage=ii.DOWNLOAD;var e=Qr();this.outputShape=n,this.userCode="\n      "+b8+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},Nye=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ii.DOWNLOAD;var e=Qr();this.outputShape=n,this.userCode="\n      "+b8+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},Oye=function(n,e,t){void 0===t&&(t=!1),this.variableNames=["A"];var r=Qr(),o=e[0],i=e[1];this.outputShape=n;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+Kb(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},Mye=function(n,e,t){void 0===t&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Qr(),o=e[0],i=e[1];this.outputShape=n;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+n[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+n[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Kb(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},O8=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(t?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Fye=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,o){null==t.valueLoc&&(t.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),Lye=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var o=fn(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],f=0;f<a.length;f++)l.push(f===s?"int(getIndices("+c[f]+"))":""+c[f]);return l.join()}(n,t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Bye=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=fn(e.length),o=fn(t.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function M8(n,e){var t=Qr();return wL(n,e,t.version+"\n    precision highp float;\n    "+t.attribute+" vec3 clipSpacePos;\n    "+t.attribute+" vec2 uv;\n    "+t.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function P8(n,e){return EL(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function k8(n,e){return SL(n,e,new Uint16Array([0,1,2,2,1,3]))}function Ip(n,e,t,r,o,i,a){IL(t,r);var s=AL(n,e),u=n.TEXTURE_2D;return be(n,e,function(){return n.bindTexture(u,s)}),be(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),be(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),be(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),be(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),be(n,e,function(){return n.texImage2D(u,0,o,t,r,0,i,a,null)}),be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function F8(n,e,t,r,o){var i=um(t,r);return Ip(n,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function L8(n,e,t,r,o){var i=um(t,r);return Ip(n,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function B8(n,e,t,r,o){var i=um(t,r);return Ip(n,e,i[0],i[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function V8(n,e,t,r,o){var i=vp(t,r);return Ip(n,e,i[0],i[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function U8(n,e,t,r,o){var i=vp(t,r);return Ip(n,e,i[0],i[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function H8(n,e,t,r){return be(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Db(n,e,t,"clipSpacePos",r,3,20,0)&&Db(n,e,t,"uv",r,2,20,12)}function W8(n,e,t,r,o,i,a){var s,u,c;be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=n.UNSIGNED_BYTE,c=n.RGBA):(s=new Float32Array(r*o*4),u=n.FLOAT,c=a.internalFormatPackedFloat),s.set(i),be(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,c,r,o,0,n.RGBA,u,s)}),be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function G8(n,e,t,r){be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?be(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):be(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),be(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function z8(n,e,t,r,o){var i=n.createBuffer();be(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,i)});var a=16*t*r;return be(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)}),be(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),be(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),i}function j8(n,e,t){var r=n,o=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function $8(n,e,t,r,o){var i=um(t,r),a=i[0],s=i[1],u=new Uint8Array(t*r*4);return be(n,e,function(){return n.readPixels(0,0,a,s,o.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function q8(n,e,t,r,o,i,a,s){var d,u=n,c=new Float32Array((d=vp(i,a))[0]*d[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function X8(n,e,t,r){var o=new Float32Array(t*r*4);return be(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,o)}),o}var Vye=Object.freeze({createVertexShader:M8,createVertexBuffer:P8,createIndexBuffer:k8,createFloat32MatrixTexture:F8,createFloat16MatrixTexture:L8,createUnsignedBytesMatrixTexture:B8,createPackedMatrixTexture:V8,createFloat16PackedMatrixTexture:U8,bindVertexProgramAttributeStreams:H8,uploadDenseMatrixToTexture:W8,uploadPixelDataToTexture:G8,createBufferFromOutputTexture:z8,downloadFloat32MatrixFromBuffer:j8,downloadByteEncodedFloatMatrixFromOutputTexture:$8,downloadPackedMatrixFromBuffer:q8,downloadMatrixFromPackedOutputTexture:X8}),K8=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=X().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,mL(t,e)):this.gl=Xa(t);var r="WEBGL_color_buffer_float";if(1===X().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=mp(this.gl,this.debug,"OES_texture_float"),si(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=mp(this.gl,this.debug,"OES_texture_half_float");else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),si(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=mp(this.gl,this.debug,"EXT_color_buffer_half_float");else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(si(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!si(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=P8(this.gl,this.debug),this.indexBuffer=k8(this.gl,this.debug),this.framebuffer=DL(this.gl,this.debug),this.textureConfig=Ib(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return X().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;be(t,this.debug,function(){return t.finish()}),be(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),be(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),be(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),be(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),be(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),F8(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),L8(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),B8(this.gl,this.debug,e,t)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),G8(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,o){this.throwIfDisposed(),W8(this.gl,this.debug,e,t,r,o,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),U8(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),V8(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Tb(this.gl,this.debug,this.framebuffer),this.outputTexture=null),be(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var o=this;return this.downloadMatrixDriver(e,function(){return $8(o.gl,o.debug,t,r,o.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,o,i,a){return q8(this.gl,e,0,0,0,i,a)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return j8(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var o=z8(this.gl,this.debug,t,r);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,o=this;if(X().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},t=a}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var o=this;return this.downloadMatrixDriver(e,function(){return X8(o.gl,o.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=_L(t,this.debug,e),o=M8(t,this.debug),i=bL(t,this.debug);return be(t,this.debug,function(){return t.attachShader(i,o)}),be(t,this.debug,function(){return t.attachShader(i,r)}),CL(t,this.debug,i),this.debug&&fm(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=H8(t,this.debug,this.program,this.vertexBuffer)),i},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&be(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&fm(this.gl,this.debug,this.program),be(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?RL(this.gl,this.debug,e,t):NL(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),be(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),OL(this.gl,this.debug,0,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var o=vp(t,r);this.setOutputMatrixTextureDriver(e,o[0],o[1])},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,o){this.setOutputMatrixWriteRegionDriver(r,e,o,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&fm(this.gl,this.debug,this.program),yp(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),be(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),be(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=mp(this.gl,this.debug,2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(2!==X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return De(this,void 0,void 0,function(){var t=this;return Te(this,function(r){switch(r.label){case 0:return[4,fb(function(){return t.disposed||t.isQueryAvailable(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(e,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||fb(function(){return r.pollItems(),0===r.itemsToPoll.length})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),dm(this.gl,this.debug,e,this.framebuffer),this.debug&&yp(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(dm(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&yp(this.gl)):Tb(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var o=this.gl;dm(o,this.debug,e,this.framebuffer),this.debug&&yp(o),this.outputTexture=e,be(o,this.debug,function(){return o.viewport(0,0,t,r)}),be(o,this.debug,function(){return o.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,o){var i=this;this.throwIfDisposed(),be(this.gl,this.debug,function(){return i.gl.scissor(e,t,r,o)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function Y8(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var o=t.logicalShape,i=e[r],a=i.shape;if(!er(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!t.isUniform||!i.isUniform){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!er(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var Uye=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var o=t.inChannels,i=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,c=t.dilationWidth,l=t.dilationHeight,f=t.dataFormat,d=s.left,h=s.top,p=o*t.filterWidth,g=Qr(),v="channelsLast"===f,m=v?0:1,y=v?1:2,x="",w=0;w<=1;w++)for(var _=0;_<=1;_++)x+="\n          blockIndex = rc.y + "+_+";\n          pos = rc.x + "+w+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+e[m]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+e[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*w+_)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*w+_)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+x+"\n\n        "+g.output+" = result;\n      }\n    "},Hye=function(n,e,t,r,o){this.variableNames=["x"],this.outputShape=[];var a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Wye=function(n,e,t,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+t+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Gye=function(n,e,t,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},zye=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var o=n.effectiveFilterHeight,i=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-n.padInfo.top)+", "+(i-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*i-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jye=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(s-1-n.padInfo.front)+", "+(u-1-n.padInfo.top)+", "+(c-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(s*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qb=function(n,e,t,r,o,i,a){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=Math.ceil((t?n[1]:n[2])/2),c=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+d[0]+");\n          result += ("+f[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},$ye=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,o){null==t.seedLoc&&(t.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),qye=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+t+"),\n                      float(index == coords.y)));\n      }\n    "},Xye=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var s,c,l,e=n.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var t=Uo("rc",e),r=fn(e),o=function(s,u,c){if(1===s)return"rc > "+u[0];for(var l="",f=s-2;f<s;f++)l+=c[f]+" >= "+u[f],f<s-1&&(l+="||");return l}(e,n,t),i=function(s,u,c,l){if(1===s)return"";var f=l.slice(-2);return"\n    int r = "+f[0]+";\n    int c = "+f[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(e,n[n.length-1],n[n.length-2],t),a=(l=function(f,d){for(var h=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var v=(0===p?"r":"rp1")+", "+(0===g?"c":"cp1"),m=2;m<f;m++)v=d[d.length-1-m]+","+v;h.push(v)}return h}(c=(s=n).length,t),1===c?"getA(rc),\n            rc + 1 >= "+s[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+l[0]+"),\n          cEdge ? 0. : getA("+l[1]+"),\n          rEdge ? 0. : getA("+l[2]+"),\n          rEdge || cEdge ? 0. : getA("+l[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Kye=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,c){return u[0]+n[c]+u[1]});var r=n.length,o=fn(r),i=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,c){return u[0]+n[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Yye=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(v,m){return v[0]+n[m]+v[1]});for(var r=n.length,o=fn(r),i=e.map(function(v){return v[0]}).join(","),a=e.map(function(v,m){return v[0]+n[m]}).join(","),s=Uo("rc",r),u=Uo("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+t+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Dp=function(n,e,t,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var i=n.filterWidth,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,l=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var p="avg"===e,m="0.0";if(p||(m="-1.0 / 1e-20"),t)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+s+");\n        const ivec2 pads = ivec2("+d+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+c+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?o?"((batch  * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + d":"(xR * "+n.inWidth+" + xC) * "+n.inChannels+" + d":"wR * "+f+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var x=4*Math.floor(i/4),w=i%4,_="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+d+", "+h+");\n      const float initializationValue = "+m+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+m+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+l+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+x+"; wC += 4) {\n            int xC = xCCorner + wC * "+c+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              getValue(batch, xR, xC + 3 * "+c+", d)\n            );\n\n            "+_+"\n          }\n\n          int xC = xCCorner + "+x+";\n          if ("+(1===w)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+_+"\n          } else if ("+(2===w)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+_+"\n          } else if ("+(3===w)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              initializationValue\n            );\n\n            "+_+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},Jb=function(n,e,t,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var i=n.filterWidth,a=n.strideDepth,s=n.strideHeight,u=n.strideWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,g=n.padInfo.front,v=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;var y="avg"===e,x="0.0";if(y||(x="-1.0 / 1e-20"),t)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+g+", "+v+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+c+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+l+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?o?"(((batch * "+n.inDepth+" + xD) * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"((xD * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"wD * "+h+" * "+p+" +\n                      wR * "+p+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var w=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(w="avgValue / count");var _=4*Math.floor(i/4),b=i%4,C="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+g+", "+v+", "+m+");\n      const float initializationValue = "+x+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+x+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+c+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+l+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+_+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+C+"\n            }\n\n            int xC = xCCorner + "+_+";\n            if ("+(1===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+C+"\n            } else if ("+(2===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+C+"\n            } else if ("+(3===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+C+"\n            }\n          }\n          setOutput("+w+");\n        }\n      }\n    "}},Zye=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,o=n.inSize,i=Math.ceil(o/t);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(t/4),l=t%4,f="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===e?(a="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(a="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";o%t>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Qye=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),t+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Xc(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Kb(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+t+"\n\n        setOutput(result);\n      }\n    "},Jye=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=n.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,g=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},exe=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[1],a=n[2];this.outputShape=[n[0],e,t,n[3]];var u=[r&&e>1?i-1:i,r&&t>1?a-1:a],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},txe=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[1],a=n[2],s=n[3];this.outputShape=[n[0],e,t,s];var u=[r&&e>1?i-1:i,r&&t>1?a-1:a],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(t-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},nxe=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=n.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,g=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+t+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+t+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},rxe=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[1],a=n[2];this.outputShape=[n[0],e,t,n[3]];var u=[r&&e>1?i-1:i,r&&t>1?a-1:a],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},oxe=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,1!==t){var r=n.map(function(i,a){return-1!==e.indexOf(s=a)&&1!==n[s]?n[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=fn(t);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},ixe=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var u,r=Uo("rc",t),o=r[t-1]+" + 1 < "+this.outputShape[t-1],i=r[t-2]+" + 1 < "+this.outputShape[t-2],a=fn(t);function s(u){var c=n.map(function(l,f){return h=u,-1!==e.indexOf(d=f)&&1!==n[d]?n[d]+" - "+h[d]+" - 1":""+h[d];var d,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===t?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1),\n            "+n[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1),\n                "+n[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+((u=r.slice())[t-1]="("+u[t-1]+" + 1)",s(u)+";\n          }\n          if(")+i+") {\n            result.b = "+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Z8=function(n,e,t,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=fn(o.length),u=fn(i.length),c="";1===t?c="i":2===t&&(c="i, j");var f="";1===r?f="i":2===r&&(f="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+f+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},axe=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,o=n.inSize,i=n.numSegments,a=i*Math.ceil(o/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%t>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%t>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+t+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},sxe=function(n,e,t){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(1===t)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<n&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=fn(t);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},uxe=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=fn(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(1===a)return"sourceLoc";if(a<=6)return eC.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);t="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+e.map(function(a,s){return"sourceLoc."+eC[s]+" = start["+s+"] + coords."+eC[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,o){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),eC=["x","y","z","w","u","v"],cxe=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=fn(this.rank),r=Uo("coords",this.rank),o=Uo("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+a+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(l,f){return"start["+f+"]"}).join()+");":e.map(function(l,f){return o[f]+" = "+r[f]+" + start["+f+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,o){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,e)}},n}(),lxe=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=fn(t.length),i=fn(t.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=t.map(function(u,c){return s++,1===t.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+n+");\n      "+o+" strides = "+o+"("+e+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},fxe=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var o,i=Q8(t,r),a=J8(e,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===ai.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===ai.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===ai.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===ai.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===ai.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),o},n.prototype.releaseTexture=function(e,t,r,o){if(null!=this.freeTextures){var i=J8(t,Q8(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(o){e.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function Q8(n,e){if(n===ii.UPLOAD)return ai.PACKED_2X2_FLOAT32;if(n===ii.RENDER||null==n)return t=e,X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?ai.PACKED_2X2_FLOAT32:ai.UNPACKED_FLOAT32:t?ai.PACKED_2X2_FLOAT16:ai.UNPACKED_FLOAT16;var t;if(n===ii.DOWNLOAD||n===ii.PIXELS)return ai.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function J8(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var dxe=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var o=fn(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(1===s)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},tC=1.7580993408473768,nC=1.0507009873554805,lt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},la="if (isnan(x)) return x;",hxe="return x;",eB="return abs(x);",tB=la+"\n  return (x < 0.0) ? 0.0 : x;\n",nB=la+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",rB="return (x >= 0.0) ? x : (exp(x) - 1.0);",pxe="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+tC+";\n  float scale = "+nC+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",oB="return -x;",iB="return ceil(x);",aB="return floor(x);",sB="return exp(x);",uB="return exp(x) - 1.0;",gxe=la+"\n  return sin(x);\n",vxe=la+"\n  return cos(x);\n",mxe=la+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",yxe=la+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",xxe=la+"\n  return atan(x);\n",wxe=la+"return log(x + sqrt(x * x + 1.0));",_xe=la+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",bxe=la+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Pm="return x;",Cxe="return x;",cB="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",lB="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",fB="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Tp=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Exe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=Uo("rc",e),r=fn(e),o=function(s,u){if(1===s)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(e,t),i=t.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},km={};function Fm(n,e){if(void 0===e&&(e=!1),"linear"===n)return e?Cxe:hxe;if("relu"===n)return e?cB:tB;if("elu"===n)return e?fB:rB;if("relu6"===n)return e?lB:nB;if("prelu"===n)return e?I8:A8;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var Sxe=600,dB=function(n){function e(t){var r,o=n.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=Xa(X().getNumber("WEBGL_VERSION"));o.binaryCache=((r=X().getNumber("WEBGL_VERSION"))in km||(km[r]={}),km[r]),o.gpgpu=new K8(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=t,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=t.gl.canvas;return o.textureManager=new fxe(o.gpgpu),o.numMBBeforeWarning=null==X().global.screen?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*Sxe/1024/1024,o.texData=new h8(o,k),o}return ra(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,o){if(X().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===o&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:t,usage:ii.UPLOAD}),i},e.prototype.move=function(t,r,o,i){if(X().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:o,dtype:i,values:r,usage:ii.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),o=r.values,i=r.dtype,a=r.complexTensors,u=r.shape;if(null!=r.slice){var l;l=r.isPacked?new Tp(u,Pm):new lt(u,Pm);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),d=this.readSync(f.dataId);return this.disposeData(f.dataId),d}if(null!=o)return this.convertAndCacheOnCPU(t);if("string"===i)return o;var h,p,g=null!=this.activeTimers;return g&&(h=oa()),p="complex64"===i?jb(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(t),g&&(this.downloadWaitMs+=oa()-h),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return De(this,void 0,void 0,function(){var r,o,i,a,u,c,l,f,d,h,p,g,v,m,y,_,b,C,E;return Te(this,function(S){switch(S.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(A){return r.push(A)})];if(o=this.texData.get(t),i=o.values,a=o.shape,u=o.dtype,c=o.complexTensors,l=o.isPacked,null!=o.slice)return f=l?new Tp(a,Pm):new lt(a,Pm),d=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:u}],u),h=this.read(d.dataId),this.disposeData(d.dataId),[2,h];if(null!=i)return[2,this.convertAndCacheOnCPU(t)];if(!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===X().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&X().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(t),v=this.texData.get(g.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[v.texture].concat(gp(a)))),this.pendingRead.set(t,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return y=S.sent(),m=jb(y[0],y[1]),[3,5];case 4:null==p?m=this.getValuesFromTexture(t):(_=Ee(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(p,_)),S.label=5;case 5:return null!=g&&this.disposeData(g.dataId),b=this.convertAndCacheOnCPU(t,m),C=this.pendingRead.get(t),this.pendingRead.delete(t),C.forEach(function(A){return A(b)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,b]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var r=0;r<t.length;r++){var o=t[r];if(!yL(o))throw X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.isPacked,u=Ee(i);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(gp(i))).subarray(0,u);return this.disposeData(c.dataId),f}var d=X().getBool("WEBGL_PACK")&&!0===s,h=d?hm(i):i,p=d?new Nye(h):new Rye(h),g=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:t}],"float32"),v=this.texData.get(g.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),m},e.prototype.time=function(t){return De(this,void 0,void 0,function(){var r,o,i,a,s,u,c;return Te(this,function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,null==this.programTimersStack?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,t(),a=ks(this.activeTimers.map(function(f){return f.query})).filter(function(f){return null!=f}),s=ks(this.activeTimers.map(function(f){return f.name})).filter(function(f){return null!=f}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=eL(c),u.getExtraProfileInfo=function(){return c.map(function(f,d){return{name:s[d],ms:f}}).map(function(f){return f.name+": "+f.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:oa(),endMs:null}},e.prototype.endTimer=function(t){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=oa(),t)},e.prototype.getQueryTime=function(t){return De(this,void 0,void 0,function(){var r;return Te(this,function(o){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),null!=o&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return X().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=k.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var o=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&t.every(function(i){return null==o.texData.get(i.dataId).texture&&Ee(i.shape)<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var o=this.makeOutput(t.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:k.keep(t.clone()),imag:k.keep(r.clone())},o},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,o);if(0===Ee(o))return Lr([],o,t.dtype);var i=this.texData.get(t.dataId).isPacked,a=Vb(t.shape,r,o);if(i||!a){var s=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cxe(o):new uxe(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,o)},e.prototype.shallowSlice=function(t,r,o){var i=this.texData.get(t.dataId),a=this.makeOutput(o,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=t.dtype;var u=Ub(r,t.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||t.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},e.prototype.stridedSlice=function(t,r,o,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,o,i);var a=Am(r,o,i);if(a.some(function(u){return 0===u}))return Lr([],a);var s=new lxe(r,i,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,r){var o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ixe(t.shape,r):new oxe(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.concat=function(t,r){if("complex64"===t[0].dtype){var o=t.map(function(h){return Oi(h)}),i=t.map(function(h){return Ya(h)});return Fr(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(1===t.length)return t[0];if(t.length>X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),u=this.concat(t.slice(a),r);return this.concat([s,u],r)}if(X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new vye(t.map(function(h){return h.shape}),r);return this.compileAndRun(c,t)}var l=zc(t.map(function(h){return h.shape}),r),f=t.map(function(h){return h.as2D(-1,Ee(h.shape.slice(r)))}),d=new gye(f.map(function(h){return h.shape}));return this.compileAndRun(d,f).reshape(l)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,oB,t.dtype);var r=new lt(t.shape,oB);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,o,i){var a=o?t.shape[2]:t.shape[1],s=i?r.shape[1]:r.shape[2],u=o?t.shape[1]:t.shape[2],c=t.shape[0];if((1===a||1===s)&&u>1e3){o&&(t=ca(t,[0,2,1])),i&&(r=ca(r,[0,2,1]));var l=1===s?t:t.as3D(c,u,1),f=1===s?2:1,d=1===s?r.as3D(c,1,u):r;return this.multiply(l,d).sum(f,!0)}var h=_r(t.dtype,r.dtype),p=new Qb(t.shape,[c,a,s],o,i);return this.compileAndRun(p,[t,r],h)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=i?r.shape[2]:r.shape[1],f=a?o.shape[1]:o.shape[2],d=r.shape[0],h=_r(r.dtype,o.dtype),p=null!=s,g=null!=c,v=u?Fm(u,!0):null,m=new Qb(r.shape,[d,l,f],i,a,p,v,g),y=[r,o];return s&&y.push(s),c&&y.push(c),this.compileAndRun(m,y,h)},e.prototype.multiply=function(t,r){if("complex64"===t.dtype){var o=this.texData.get(t.dataId),i=this.texData.get(r.dataId),a=new E8("return areal * breal - aimag * bimag;",t.shape,r.shape),s=new E8("return areal * bimag + aimag * breal;",t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),f=this.complex(c,l);return c.dispose(),l.dispose(),f}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,S8,t.dtype);var d=new Pn(S8,t.shape,r.shape);return this.compileAndRun(d,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,o,i,a,s){var u=[t,r,o],c=null;null!=s&&(c=s.shape,u.push(s));var l=null;if(null!=a&&(l=a.shape,u.push(a)),X().getBool("WEBGL_PACK_NORMALIZATION")){var f=new sye(t.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)}var d=new aye(t.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)},e.prototype.localResponseNormalization4D=function(t,r,o,i,a){var s=X().getBool("WEBGL_PACK_NORMALIZATION")?new Gye(t.shape,r,o,i,a):new Hye(t.shape,r,o,i,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,r,o,i,a,s,u){var c=new Wye(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,t])},e.prototype.tile=function(t,r){if("string"===t.dtype){var o=this.readSync(t.dataId).map(function(a){return cp(a)});return x8(Qe(t.shape,t.dtype,o),r)}var i=new dxe(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.pad=function(t,r,o){var i=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Yye(t.shape,r,o):new Kye(t.shape,r,o);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,o){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,o);var i=new Lye(t.shape,r.size,o);return this.compileAndRun(i,[t,r])},e.prototype.batchToSpaceND=function(t,r,o){T(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,d){return f*d}),a=xm(t.shape,r,i),s=wm(a.length,r.length),u=_m(t.shape,r,i),c=ZL(o,r.length),l=QL(u,o,r.length);return ca(t.reshape(a),s).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(t,r,o){T(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,h){return d*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=xm(u.shape,r,i,!1),l=wm(c.length,r.length,!1),f=_m(u.shape,r,i,!1);return ca(u.reshape(c),l).reshape(f)},e.prototype.reduce=function(t,r,o){var i=t.shape[0],a=t.shape[1],s=Sm(a),u=new Zye({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[t],o);return 1===c.shape[1]?c:this.reduce(c,r,o)},e.prototype.argReduce=function(t,r,o){void 0===o&&(o=null);var i=t.shape[0],a=t.shape[1];null!=o&&(i=o.shape[0],a=o.shape[1]);var s=Sm(a),u=new Z1e({windowSize:s,inSize:a,batchSize:i},r,null==o),c=[t];null!=o&&c.push(o);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(t,r,l)},e.prototype.argReducePacked=function(t,r,o){void 0===o&&(o=null);var i=null!=o?o.shape:t.shape,a=Sm(i[i.length-1]),s=new rye(i,a,r,null==o),c=this.compileAndRun(s,null==o?[t]:[t,o],"int32");return c.rank===t.rank?this.argReducePacked(t,r,c):c},e.prototype.sum=function(t,r){Vo("sum",r,t.rank);var o=kr(t.shape,r),i=o[0],a=Ee(o[1]),s=t.as2D(-1,a),u=Cb(t.dtype);return this.reduce(s,"sum",u).reshape(i)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var o=kr(t.shape,r),i=o[0],a=Ee(o[1]),s=t.as2D(-1,a),u=Cb(t.dtype);return this.reduce(s,"prod",u).reshape(i)},e.prototype.unsortedSegmentSum=function(t,r,o){var i=0,a=ia([i],t.rank),s=t;null!=a&&(s=ca(t,a),i=aa(1,t.rank)[0]);var u=function(h,p,g){for(var v=[],m=h.length,y=0;y<m;y++)v.push(y!==p?h[y]:g);return v}(s.shape,i,o),c=Ee([s.shape[i]]),l=s.as2D(-1,c),f=Cb(t.dtype),d=this.segOpCompute(l,"unsortedSegmentSum",r,f,o).reshape(u);return null!=a&&(d=ca(d,vm(a))),d},e.prototype.segOpCompute=function(t,r,o,i,a){var s=t.shape[0],u=t.shape[1],c=function(d,h){var p,g=!1;for(d<=Lb?(p=d,g=!0):p=am(d,Math.floor(Math.sqrt(d)));!g;)p>h||p===d?g=!0:p=am(d,p+1);return p}(u,a),l=new axe({windowSize:c,inSize:u,batchSize:s,numSegments:a},r),f=this.compileAndRun(l,[t,o],i);return f.shape[1]===a?f:(o=mm(0,a).tile([u/c]),this.segOpCompute(f,r,o,i,a))},e.prototype.argMinMaxReduce=function(t,r,o){var i=[r];if(Vo("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,t.rank),!X().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=kr(t.shape,i),s=a[0],u=Ee(a[1]),c=t.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(t,o)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,o,i){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new Sye(t.shape,o,i);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(equal(a, b));\n","bool");var o=new Pn("return float(a == b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(notEqual(a, b));\n","bool");var o=new Pn("return float(a != b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(lessThan(a, b));\n","bool");var o=new Pn("return float(a < b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var o=new Pn("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(greaterThan(a, b));\n","bool");var o=new Pn("return float(a > b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var o=new Pn("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new lt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var o=new Pn("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var o=new Pn("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},e.prototype.select=function(t,r,o){var i=new sxe(t.rank,r.shape,r.rank);return this.compileAndRun(i,[t,r,o],_r(r.dtype,o.dtype))},e.prototype.where=function(t){gm("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Xb(t.shape,r)},e.prototype.topk=function(t,r,o){return w8(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Vo("min",r,t.rank);var o=kr(t.shape,r),i=o[0],a=Ee(o[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Pn("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.mod=function(t,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Pn("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Vo("max",r,t.rank);var o=kr(t.shape,r),i=o[0],a=Ee(o[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Pn("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.all=function(t,r){Vo("all",r,t.rank);var o=kr(t.shape,r),i=o[0],a=Ee(o[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},e.prototype.any=function(t,r){Vo("any",r,t.rank);var o=kr(t.shape,r),i=o[0],a=Ee(o[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},e.prototype.floorDiv=function(t,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var o=new Pn("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,r.shape);return this.compileAndRun(o,[t,r],"int32")},e.prototype.add=function(t,r){if("complex64"===t.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(t,r,Yb);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var o=_r(t.dtype,r.dtype);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Yb,o);var i=new Pn(Yb,t.shape,r.shape);return this.compileAndRun(i,[t,r],o)},e.prototype.packedUnaryOp=function(t,r,o){var i=new Tp(t.shape,r);return this.compileAndRun(i,[t],o)},e.prototype.packedBinaryOp=function(t,r,o,i,a){void 0===a&&(a=!1);var s=new Qa(o,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],i)},e.prototype.complexSeparableBinaryOp=function(t,r,o){var i=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(d){var h=d[0],p=d[1],g=i.makeComplexComponentTensorInfo(t,h),v=i.makeComplexComponentTensorInfo(r,p),m=new Pn(o,t.shape,r.shape);return i.compileAndRun(m,[g,v],_r(h.dtype,p.dtype))}),c=u[0],l=u[1],f=this.complex(c,l);return c.dispose(),l.dispose(),f},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>X().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),o=this.addN(t.slice(0,r)),i=this.addN(t.slice(r));return this.addN([o,i])}var a=t.map(function(c){return c.dtype}).reduce(function(c,l){return _r(c,l)}),s=t.map(function(c){return c.shape}),u=X().getBool("WEBGL_PACK")?new Y1e(t[0].shape,s):new K1e(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,r){if("complex64"===t.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(t,r,Zb);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var o=_r(t.dtype,r.dtype);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Zb,t.dtype);var i=new Pn(Zb,t.shape,r.shape);return this.compileAndRun(i,[t,r],o)},e.prototype.pow=function(t,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Pn("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,r.shape),i=_r(t.dtype,r.dtype);return this.compileAndRun(o,[t,r],i)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,iB,t.dtype);var r=new lt(t.shape,iB);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,aB,t.dtype);var r=new lt(t.shape,aB);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new lt(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new lt(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new lt(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new lt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new lt(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,sB,t.dtype);var r=new lt(t.shape,sB);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,uB,t.dtype);var r=new lt(t.shape,uB);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var o=tr([r],t.shape),i=this.max(t,o),a=mo(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return Lu(u,c)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var r=new lt(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new lt(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new lt(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new lt(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new lt(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=X().getBool("WEBGL_PACK")?new Tp(t.shape,cB):new lt(t.shape,tB),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=X().getBool("WEBGL_PACK")?new Tp(t.shape,lB):new lt(t.shape,nB),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa(I8,t.shape,r.shape):new Pn(A8,t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.elu=function(t){if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,fB,t.dtype);var r=new lt(t.shape,rB);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,r.shape):new Pn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.selu=function(t){var r=new lt(t.shape,pxe);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new lt(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,o){var i,a=(i=X().getBool("WEBGL_PACK_CLIP")?new hye(t.shape):new dye(t.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,eB,t.dtype);var r=new lt(t.shape,eB);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),o=new pye(t.shape),i=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(o,i)},e.prototype.sigmoid=function(t){var r=new lt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new lt(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new lt(t.shape,gxe);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new lt(t.shape,vxe);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new lt(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new lt(t.shape,mxe);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new lt(t.shape,yxe);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new lt(t.shape,xxe);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,r.shape):new Pn("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,r.shape);return this.compileAndRun(o,[t,r])},e.prototype.sinh=function(t){var r=new lt(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new lt(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new lt(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new lt(t.shape,wxe);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new lt(t.shape,_xe);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new lt(t.shape,bxe);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new lt(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i,o=new lt(t.shape,(void 0===(i=r)&&(i=0),la+"\n    return x > 0.0 ? 1.0 : float("+i+");\n  "));return this.compileAndRun(o,[t])},e.prototype.conv2dByMatMul=function(t,r,o,i,a,s){var u=t.shape,c=this.texData.get(t.dataId),h="channelsLast"===o.dataFormat,g=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===o.outChannels)&&o.inChannels>1e3||!X().getBool("WEBGL_LAZILY_UNPACK")||!X().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var m=this.reshape(t,[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],o.inChannels]),y=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:y,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var w={dataId:t.dataId,shape:[1,h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),o.inChannels],dtype:t.dtype},_=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,T(_p(c.shape,w.shape),function(){return"packed reshape "+c.shape+" to "+w.shape+" isn't free"});var b=this.reshape(r,[1,o.inChannels,o.outChannels]),C=this.fusedBatchMatMul({a:w,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),E=this.texData.get(C.dataId);return T(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=_,E.shape=o.outShape,k.makeTensorFromDataId(C.dataId,o.outShape,C.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,o,i,a,s){var f=o.outWidth,d=o.outHeight,h="channelsLast"===o.dataFormat,p=o.filterWidth*o.filterHeight*o.inChannels,g=d*f,v=[p,g],m=t.squeeze([0]),y=r.reshape([1,p,-1]),x=new Uye(v,m.shape,o),w=this.compileAndRun(x,[m]).reshape([1,v[0],v[1]]),_=null!=i,b=null!=s,C=a?Fm(a,!0):null,E=new Qb(w.shape,[1,g,o.outChannels],!0,!1,_,C,b),S=[w,y];return i&&S.push(i),b&&S.push(s),this.compileAndRun(E,S).reshape(h?[1,d,f,o.outChannels]:[1,o.outChannels,d,f])},e.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(r,o,i,a,s,u);if(X().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=null!=a,l=null!=u,f=s?Fm(s,!1):null,d=new D8(i,c,f,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(d,h)},e.prototype.conv2d=function(t,r,o){if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(t,r,o);if(X().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,r,o);var i=new D8(o);return this.compileAndRun(i,[t,r])},e.prototype.conv2dDerInput=function(t,r,o){var i=new yye(o);return this.compileAndRun(i,[t,r])},e.prototype.conv2dDerFilter=function(t,r,o){var i=new mye(o);return this.compileAndRun(i,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,o=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,f=u?Fm(u,l):null,d=[o,i],h=null!=s,p=null!=c;return h&&d.push(s),p&&d.push(c),l?(r=new R8(a,h,f,p),this.compileAndRun(r,d)):(r=new T8(a,h,f,p),this.compileAndRun(r,d))},e.prototype.depthwiseConv2D=function(t,r,o){var i;return X().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new R8(o),this.compileAndRun(i,[t,r])):(i=new T8(o),this.compileAndRun(i,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,o){var i=new bye(o);return this.compileAndRun(i,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,o){var i=new _ye(o);return this.compileAndRun(i,[t,r])},e.prototype.conv3d=function(t,r,o){var i=new Cye(o);return this.compileAndRun(i,[t,r])},e.prototype.conv3dDerInput=function(t,r,o){var i=new wye(o);return this.compileAndRun(i,[t,r])},e.prototype.conv3dDerFilter=function(t,r,o){var i=new xye(o);return this.compileAndRun(i,[t,r])},e.prototype.maxPool=function(t,r){var o=new Dp(r,"max",!1);return this.compileAndRun(o,[t])},e.prototype.avgPool=function(t,r){var o=new Dp(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,o,i){var a=new Dp(i,"max",!0),s=this.compileAndRun(a,[r]),u=new zye(i),c=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),c},e.prototype.avgPoolBackprop=function(t,r,o){var i=new oye(o);return this.compileAndRun(i,[t],r.dtype)},e.prototype.cast=function(t,r){return Gb(t,r,this)},e.prototype.unstack=function(t,r){for(var o=t.shape[r],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(t,u,c).reshape(i);return l},e.prototype.avgPool3d=function(t,r){var o=new Jb(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,o){var i=new iye(o);return this.compileAndRun(i,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var o=new Jb(r,"max",!1);return this.compileAndRun(o,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,o,i){var a=new Jb(i,"max",!0),s=this.compileAndRun(a,[r]),u=new jye(i),c=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),c},e.prototype.reshape=function(t,r){var o=this.texData.get(t.dataId);if(o.isPacked&&!_p(t.shape,r)&&(null===o.texture||!_p(o.shape,r))){var i=this.packedReshape(t,r);return k.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return Om(t,r)},e.prototype.resizeBilinear=function(t,r,o,i){var a=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new txe(t.shape,r,o,i):new exe(t.shape,r,o,i);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,o){var i=new Jye(t,r,o);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighbor=function(t,r,o,i){var a=new rxe(t.shape,r,o,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,o){var i=new nxe(t,r,o);return this.compileAndRun(i,[t])},e.prototype.multinomial=function(t,r,o,i){var a=r?t:Tm(t),c=new $ye(a.shape[0],a.shape[1],o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},e.prototype.oneHot=function(t,r,o,i){var a=new qye(t.size,r,o,i);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var r=new Tye(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,o,i,a){return gm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),$b(t.dataSync(),r.dataSync(),o,i,a)},e.prototype.cropAndResize=function(t,r,o,i,a,s){var u=new Eye(t.shape,r.shape,i,a,s);return this.compileAndRun(u,[t,r,o],"float32")},e.prototype.depthToSpace=function(t,r,o){T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=t.shape[0],c=("NHWC"===o?t.shape[1]:t.shape[2])*r,l=("NHWC"===o?t.shape[2]:t.shape[3])*r,f=("NHWC"===o?t.shape[3]:t.shape[1])/(r*r),d=new Dye("NHWC"===o?[i,c,l,f]:[i,f,c,l],r,o);return this.compileAndRun(d,[t])},e.prototype.split=function(t,r,o){return y8(t,r,o)},e.prototype.scatterND=function(t,r,o){var i=Cp(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,f=[l/u,u],d=t.reshape([s,a]),h=r.reshape([s,u]);if(0===l)return Om(Lr([]),o);var p=Oe(0),g=new Z8(s,a,d.rank,h.rank,c,f);return this.compileAndRun(g,[h,d,p]).reshape(o)},e.prototype.sparseToDense=function(t,r,o,i){var a=Cp(0,t,o),f=new Z8(a.numUpdates,a.sliceRank,t.rank,r.rank,a.strides,[a.outputSize,1],!1);return this.compileAndRun(f,[r,t,i]).reshape(o)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var o=this.texData.get(t.dataId),i=new O8("return real * expR - imag * expI;",t.shape,r),a=new O8("return real * expI + imag * expR;",t.shape,r),s=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(t.shape[0],t.shape[1]);return u.dispose(),c.dispose(),l},e.prototype.gatherND=function(t,r){var o=r.shape,i=o[o.length-1],a=Fb(t,r),s=a[0],u=a[1],c=a[2],l=a[3],f=r.reshape([u,i]),d=t.reshape([t.size/c,c]),h=new Bye(i,l,[u,c]);return this.compileAndRun(h,[d,f]).reshape(s)},e.prototype.fill=function(t,r,o){if("string"===(o=o||kf(r))){var i=up(o,Ee(t));return i.fill(r),k.makeTensor(i,t,o,this)}var a=new Fye(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,r,o){return zb(t,r,o)},e.prototype.makeTensorInfo=function(t,r){var o=this.write(null,t,r);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var o=this.makeTensorInfo(t,r).dataId;return k.makeTensorFromDataId(o,t,r,this)},e.prototype.unpackTensor=function(t){var r=new Exe(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new Xye(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var o=[xp(t.shape)].concat(wp(t.shape)),i={dtype:t.dtype,shape:o,dataId:t.dataId},a=[xp(r)].concat(wp(r)),s=new Qye(a,o),u=this.runWebGLProgram(s,[i],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,o=this.texData.get(t),i=o.isPacked,a=o.shape,s=o.dtype,u=hm(a);return r=i?new Iye(u):new Aye(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,o,i,a){var s=this;void 0===a&&(a=!1);var u=this.makeTensorInfo(t.outputShape,o),c=this.texData.get(u.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===pp.DENSE){var l=gp(t.outputShape);c.texShape=l.map(function(x){return 2*x})}if(null!=t.outTexUsage&&(c.usage=t.outTexUsage),0===Ee(u.shape))return c.values=Wc(u.dtype,0),u;var f=[],d=r.map(function(x){if("complex64"===x.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(x.dataId);if(null==w.texture){if(!t.packedInputs&&Ee(x.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:w.values};t.packedInputs&&(w.isPacked=!0,w.shape=x.shape)}else if(!!w.isPacked!=!!t.packedInputs)x=w.isPacked?s.unpackTensor(x):s.packTensor(x),f.push(x),w=s.texData.get(x.dataId);else if(w.isPacked&&!_p(w.shape,x.shape)){var _=x,b=x.shape;x.shape=w.shape,x=s.packedReshape(x,b),f.push(x),w=s.texData.get(x.dataId),_.shape=b}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var h,x,b,p={shape:u.shape,texData:c,isUniform:!1},g=(x=t,b="",d.concat(p).forEach(function(S){b+=S.shape+"_"+(S.isUniform?"uniform":S.texData.texShape)+"_"+(null!=S.texData&&null!=S.texData.slice&&S.texData.slice.flatOffset>0)}),x.constructor.name+"_"+b+"_"+x.userCode),v=this.getAndSaveBinary(g,function(){return function(x,w,_,b){var C=w.userCode,E=_.map(function(W,$){var K={logicalShape:W.shape,texShape:W.isUniform?null:W.texData.texShape,isUniform:W.isUniform,isPacked:!W.isUniform&&W.texData.isPacked,flatOffset:null};return null!=W.texData&&null!=W.texData.slice&&W.texData.slice.flatOffset>0&&(K.flatOffset=W.texData.slice.flatOffset),{name:w.variableNames[$],shapeInfo:K}}),S=E.map(function(W){return W.shapeInfo}),A={logicalShape:b.shape,texShape:b.texData.texShape,isUniform:!1,isPacked:b.texData.isPacked,flatOffset:null},D=Q1e(E,A,C,w.packedInputs),M=x.createProgram(D),L=null,B=x.getUniformLocation(M,"NAN",!1);1===X().getNumber("WEBGL_VERSION")&&(L=x.getUniformLocation(M,"INFINITY",!1));for(var U={},G=0;G<w.variableNames.length;G++){var H=w.variableNames[G];U[H]=x.getUniformLocation(M,H,!1),U["offset"+H]=x.getUniformLocation(M,"offset"+H,!1)}return{program:w,source:D,webGLProgram:M,uniformLocations:U,inShapeInfos:S,outShapeInfo:A,infLoc:L,nanLoc:B}}(s.gpgpu,t,d,p)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(x,w,_,b,C){Y8(w.inShapeInfos,_),Y8([w.outShapeInfo],[b]);var E=b.texData.texture,S=b.texData.texShape;b.texData.isPacked?x.setOutputPackedMatrixTexture(E,S[0],S[1]):x.setOutputMatrixTexture(E,S[0],S[1]),x.setProgram(w.webGLProgram),1===X().getNumber("WEBGL_VERSION")&&null!==w.infLoc&&x.gl.uniform1f(w.infLoc,1/0),null!==w.nanLoc&&x.gl.uniform1f(w.nanLoc,NaN),_.forEach(function(A,D){var M=w.program.variableNames[D],L=w.uniformLocations[M],B=w.uniformLocations["offset"+M];if(null!=L)if(A.isUniform)if(Ee(A.shape)<2)x.gl.uniform1f(L,A.uniformValues[0]);else{var U=A.uniformValues;U instanceof Float32Array||(U=new Float32Array(U)),x.gl.uniform1fv(L,U)}else null!=A.texData.slice&&null!=B&&x.gl.uniform1i(B,A.texData.slice.flatOffset),x.setInputMatrixTexture(A.texData.texture,L,D)}),C?.(x,w.webGLProgram),x.executeProgram()}(this.gpgpu,v,d,p,i),f.forEach(function(x){return s.disposeData(x.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!X().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===a){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},e.prototype.compileAndRun=function(t,r,o,i,a){void 0===a&&(a=!1);var s=this.runWebGLProgram(t,r,o=o||r[0].dtype,i,a);return k.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(X().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Gt(function(){if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=X().getBool("DEBUG");X().set("DEBUG",!1);var o=t.abs(Oe(1e-8)).dataSync()[0];if(X().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.values,c=o.usage,l=o.isPacked;if(null==o.texture){var f,d=null!=this.activeTimers;d&&(f=oa());var h=o.texShape;if(null==h&&(h=kL(i,l),o.texShape=h),null!=s){var p=hm(i),g=void 0,v=h[1],m=h[0],y=s instanceof Uint8Array;l?(v=(r=vp(h[0],h[1]))[0],g=new Mye(p,[m=r[1],v],y)):g=new Oye(p,[m,v],y);var x=this.makeTensorInfo([m,v],a);this.texData.get(x.dataId).usage=y?ii.PIXELS:ii.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),v,m,s);var w=this.runWebGLProgram(g,[x],a,null,!0),_=this.texData.get(w.dataId);o.texture=_.texture,o.texShape=_.texShape,o.isPacked=_.isPacked,o.usage=_.usage,this.disposeData(x.dataId),this.texData.delete(w.dataId),o.values=null,d&&(this.uploadWaitMs+=oa()-f)}else{var b=this.acquireTexture(h,c,a,l);o.texture=b}}},e.prototype.convertAndCacheOnCPU=function(t,r){var o=this.texData.get(t),i=o.dtype;return this.releaseGPUData(t),null!=r&&(o.values=function(a,s){if("float32"===s||"complex64"===s)return a;if("int32"===s||"bool"===s){for(var u="int32"===s?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},e.prototype.acquireTexture=function(t,r,o,i){if(this.numBytesInGPU+=this.computeBytes(t,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*db(r)},e}(p8);function Yc(n,e){return n(e={exports:{}},e.exports),e.exports}vL()&&k.registerBackend("webgl",function(){return new dB},2),typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var Axe=Yc(function(n){!function(e,t,r){function o(s){var u,c=this,l=(u=4022871197,function(f){f=f.toString();for(var d=0;d<f.length;d++){var h=.02519603282416938*(u+=f.charCodeAt(d));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var f=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=0|f)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,f=c.next;return f.int32=function(){return 4294967296*c.next()|0},f.double=function(){return f()+11102230246251565e-32*(2097152*f()|0)},f.quick=f,l&&("object"==typeof l&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.alea=a}(0,n)}),Ixe=Yc(function(n){!function(e,t,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do{var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===d);return d},f.int32=c.next,f.quick=f,l&&("object"==typeof l&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xor128=a}(0,n)}),Dxe=Yc(function(n){!function(e,t,r){function o(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^f^f<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do{var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===d);return d},f.int32=c.next,f.quick=f,l&&("object"==typeof l&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xorwow=a}(0,n)}),Txe=Yc(function(n){!function(e,t,r){function o(s){var u=this;u.next=function(){var c,l,f=u.x,d=u.i;return c=f[d],l=(c^=c>>>7)^c<<24,l^=(c=f[d+1&7])^c>>>10,l^=(c=f[d+3&7])^c>>>3,l^=(c=f[d+4&7])^c<<7,c=f[d+7&7],l^=(c^=c<<13)^c<<9,f[d]=l,u.i=d+1&7,l},function(c,l){var f,d=[];if(l===(0|l))d[0]=l;else for(l=""+l,f=0;f<l.length;++f)d[7&f]=d[7&f]<<15^l.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&0===d[f];++f);for(8==f&&(d[7]=-1),c.x=d,c.i=0,f=256;f>0;--f)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do{var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===d);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xorshift7=a}(0,n)}),Rxe=Yc(function(n){!function(e,t,r){function o(s){var u=this;u.next=function(){var c,l,f=u.w,d=u.X,h=u.i;return u.w=f=f+1640531527|0,l=d[h+34&127],c=d[h=h+1&127],l^=l<<13,c^=c<<17,l=d[h]=(l^=l>>>15)^(c^=c>>>12),u.i=h,l+(f^f>>>16)|0},function(c,l){var f,d,h,p,g,v=[],m=128;for(l===(0|l)?(d=l,l=null):(l+="\0",d=0,m=Math.max(m,l.length)),h=0,p=-32;p<m;++p)l&&(d^=l.charCodeAt((p+32)%l.length)),0===p&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(h=0==(f=v[127&p]^=d+(g=g+1640531527|0))?h+1:0);for(h>=128&&(v[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)d=v[h+34&127],f=v[h=h+1&127],d^=d<<13,f^=f<<17,v[h]=(d^=d>>>15)^(f^=f>>>12);c.w=g,c.X=v,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do{var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===d);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xor4096=a}(0,n)}),Nxe=Yc(function(n){!function(e,t,r){function o(s){var u=this,c="";u.next=function(){var f=u.b,d=u.c,h=u.d,p=u.a;return f=f<<25^f>>>7^d,d=d-h|0,h=h<<24^h>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^d,u.c=d=d-h|0,u.d=h<<16^d>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do{var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===d);return d},f.int32=c.next,f.quick=f,l&&("object"==typeof l&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.tychei=a}(0,n)}),Zc=Yc(function(n){!function(e,t){var r,o=this,i=256,a=6,s="random",u=t.pow(i,a),c=t.pow(2,52),l=2*c,f=i-1;function d(m,y,x){var w=[],_=g(function E(S,A){var D,M=[],L=typeof S;if(A&&"object"==L)for(D in S)try{M.push(E(S[D],A-1))}catch{}return M.length?M:"string"==L?S:S+"\0"}((y=1==y?{entropy:!0}:y||{}).entropy?[m,v(e)]:m??function(){try{var E;return r&&(E=r.randomBytes)?E=E(i):(E=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(E)),v(E)}catch{var S=o.navigator,A=S&&S.plugins;return[+new Date,o,A,o.screen,v(e)]}}(),3),w),b=new h(w),C=function(){for(var E=b.g(a),S=u,A=0;E<c;)E=(E+A)*i,S*=i,A=b.g(1);for(;E>=l;)E/=2,S/=2,A>>>=1;return(E+A)/S};return C.int32=function(){return 0|b.g(4)},C.quick=function(){return b.g(4)/4294967296},C.double=C,g(v(b.S),e),(y.pass||x||function(E,S,A,D){return D&&(D.S&&p(D,b),E.state=function(){return p(b,{})}),A?(t[s]=E,S):E})(C,_,"global"in y?y.global:this==t,y.state)}function h(m){var y,x=m.length,w=this,_=0,b=w.i=w.j=0,C=w.S=[];for(x||(m=[x++]);_<i;)C[_]=_++;for(_=0;_<i;_++)C[_]=C[b=f&b+m[_%x]+(y=C[_])],C[b]=y;(w.g=function(E){for(var S,A=0,D=w.i,M=w.j,L=w.S;E--;)S=L[D=f&D+1],A=A*i+L[f&(L[D]=L[M=f&M+S])+(L[M]=S)];return w.i=D,w.j=M,A})(i)}function p(m,y){return y.i=m.i,y.j=m.j,y.S=m.S.slice(),y}function g(m,y){for(var x,w=m+"",_=0;_<w.length;)y[f&_]=f&(x^=19*y[f&_])+w.charCodeAt(_++);return v(y)}function v(m){return String.fromCharCode.apply(0,m)}if(t["seed"+s]=d,g(t.random(),e),n.exports){n.exports=d;try{r=xo(902)}catch{}}}([],Math)});Zc.alea=Axe,Zc.xor128=Ixe,Zc.xorwow=Dxe,Zc.xorshift7=Txe,Zc.xor4096=Rxe,Zc.tychei=Nxe;var Lm=Zc.alea,Oxe=F({addN_:function(n){T(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),T(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(o,i){return I(o,"tensors"+i,"addN")}),t=e[0];return e.forEach(function(o){if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(o){if(!er(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),k.runKernelFunc(function(o,i){return o.addN(e)},e,null,"AddN")}});function Bm(){WL("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function hB(n){return 0===n.rank||1===n.rank?n.as4D(1,1,1,n.size):2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function pB(n,e,t,r,o,i){null==i&&(i=.001);var a,s,u=I(n,"x","batchNorm"),c=I(e,"mean","batchNorm"),l=I(t,"variance","batchNorm");return null!=o&&(a=I(o,"scale","batchNorm")),null!=r&&(s=I(r,"offset","batchNorm")),T(c.rank===l.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),T(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),T(null==a||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),k.runKernelFunc(function(h,p){var g=hB(u),v=h.batchNormalization(g,Vm(c),Vm(l),i,Vm(a),Vm(s));return p([u,c,l,a]),v},{x:u,scale:a,offset:s,mean:c,variance:l},null,"FusedBatchNorm",{varianceEpsilon:i}).reshape(u.shape)}function Vm(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}var Mxe=F({batchNormalization_:function(n,e,t,r,o,i){return void 0===r&&(r=.001),Bm(),pB(n,e,t,i,o,r)}}),Rp=F({batchNorm_:pB});function gB(n,e,t,r,o,i){var a,s,u=I(n,"x","batchNorm"),c=I(e,"mean","batchNorm"),l=I(t,"variance","batchNorm");return null!=o&&(a=I(o,"scale","batchNorm")),null!=r&&(s=I(r,"offset","batchNorm")),T(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),T(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),T(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&T(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&T(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Rp(u,c,l,s,a,i)}var Pxe=F({batchNormalization2d_:function(n,e,t,r,o,i){return void 0===r&&(r=.001),Bm(),gB(n,e,t,i,o,r)}}),kxe=F({batchNorm2d_:gB});function vB(n,e,t,r,o,i){var a,s,u=I(n,"x","batchNorm"),c=I(e,"mean","batchNorm"),l=I(t,"variance","batchNorm");return null!=o&&(a=I(o,"scale","batchNorm")),null!=r&&(s=I(r,"offset","batchNorm")),T(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),T(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),T(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&T(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&T(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Rp(u,c,l,s,a,i)}var Fxe=F({batchNormalization3d_:function(n,e,t,r,o,i){return void 0===r&&(r=.001),Bm(),vB(n,e,t,i,o,r)}}),Lxe=F({batchNorm3d_:vB});function mB(n,e,t,r,o,i){var a,s,u=I(n,"x","batchNorm"),c=I(e,"mean","batchNorm"),l=I(t,"variance","batchNorm");return null!=o&&(a=I(o,"scale","batchNorm")),null!=r&&(s=I(r,"offset","batchNorm")),T(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),T(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),T(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&T(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&T(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Rp(u,c,l,s,a,i)}var Bxe=F({batchNormalization4d_:function(n,e,t,r,o,i){return void 0===r&&(r=.001),Bm(),mB(n,e,t,i,o,r)}}),Vxe=F({batchNorm4d_:mB}),yB=F({broadcastTo_:function(n,e){var t=I(n,"broadcastTo","x"),r=t.shape;if(e.some(function(f){return!(f>0)||f%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var o=t.shape.slice();o.length<e.length;)o.unshift(1);t=t.reshape(o)}for(var i=t.shape,a=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])a[s]=1;else if(1!==t.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=a.map(function(f,d){return f>1?d:-1}).filter(function(f){return f>=0});return 0===u.length?t.clone():k.runKernelFunc(function(f){return f.tile(t,a)},{x:t},function(f){return{x:function(){return f.sum(u,!0)}}},e8,{shape:e,inputShape:i})}}),Uxe=F({clone_:function(n){var e=I(n,"x","clone",null);return k.runKernelFunc(function(){return k.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{x:e},null,n8)}}),Um=F({logicalAnd_:function(n,e){var t=I(n,"a","logicalAnd","bool"),r=I(e,"b","logicalAnd","bool");return yt(t.shape,r.shape),k.runKernelFunc(function(o){return o.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),Hxe=F({logicalNot_:function(n){var e=I(n,"x","logicalNot","bool");return k.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),xB=F({logicalOr_:function(n,e){var t=I(n,"a","logicalOr","bool"),r=I(e,"b","logicalOr","bool");return yt(t.shape,r.shape),k.runKernelFunc(function(o){return o.logicalOr(t,r)},{$a:t,$b:r})}}),Wxe=F({logicalXor_:function(n,e){var t=I(n,"a","logicalXor","bool"),r=I(e,"b","logicalXor","bool");return yt(t.shape,r.shape),xB(n,e).logicalAnd(Um(n,e).logicalNot())}}),Qc=F({where_:function(n,e,t){var r=I(e,"a","where"),o=I(t,"b","where"),i=I(n,"condition","where","bool");return Dt(r.shape,o.shape,"Error in where: "),1===i.rank?T(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Dt(i.shape,o.shape,"Error in where: "),k.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Tt(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),wB=function(n){return De(this,void 0,void 0,function(){var e,t,r;return Te(this,function(o){switch(o.label){case 0:return[4,(e=I(n,"condition","whereAsync","bool")).data()];case 1:return t=o.sent(),r=Xb(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},_B=F({divNoNan_:function(n,e){var t,r=I(n,"a","div"),o=I(e,"b","div");r=(t=wn(r,o))[0];var i=Lu(r,o=t[1]),a=Tt(i),s=o.equal(a);return Qc(s,a,i)}}),zf=F({tile_:function(n,e){var t=I(n,"x","tile",null);return T(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),k.runKernelFunc(function(a,s){var u=a.tile(t,e);return s([t]),u},{x:t},null,"Tile",{reps:e},[t])}}),bB=F({eye_:function(n,e,t,r){void 0===r&&(r="float32"),null==e&&(e=n);for(var o=Qe([n,e],r),i=n<=e?n:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(n,e);if(null==t)return s;if(1===t.length)return zf(ku(s,0),[t[0],1,1]);if(2===t.length)return zf(ku(ku(s,0),0),[t[0],t[1],1,1]);if(3===t.length)return zf(ku(ku(ku(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Gxe=F({multinomial_:function(n,e,t,r){void 0===r&&(r=!1);var o=I(n,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=1===a?o.as2D(1,-1):o,u=k.runKernelFunc(function(c){return c.multinomial(s,r,e,t)},{logits2D:s});return 1===a?u.as1D():u}}),Hm=F({oneHot_:function(n,e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=I(n,"indices","oneHot","int32"),i=o.shape.concat([e]),a={indices:o=o.flatten()};return k.runKernelFunc(function(u,c){return c([o]),u.oneHot(o,e,t,r)},a,null,"OneHot",{depth:e,onValue:t,offValue:r}).reshape(i)}}),Us=F({pad_:function(n,e,t){void 0===t&&(t=0);var r=I(n,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return k.runKernelFunc(function(a,s){return s([r]),a.pad(r,e,t)},{x:r},null,"PadV2",{paddings:e,constantValue:t})}}),zxe=F({pad1d_:function(n,e,t){return void 0===t&&(t=0),T(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),Us(n,[e],t)}}),jxe=F({pad2d_:function(n,e,t){return void 0===t&&(t=0),T(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Us(n,e,t)}}),$xe=F({pad3d_:function(n,e,t){return void 0===t&&(t=0),T(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Us(n,e,t)}}),qxe=F({pad4d_:function(n,e,t){return void 0===t&&(t=0),T(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Us(n,e,t)}}),Xxe=F({rand_:function(n,e,t){var r=Ee(n),o=null;if(null==t||"float32"===t)o=new Float32Array(r);else if("int32"===t)o=new Int32Array(r);else{if("bool"!==t)throw new Error("Unknown data type "+t);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return k.makeTensor(o,n,t)}}),Kxe=.001,CB=.1;function rC(){return 32===k.backend.floatPrecision()?Kxe:CB}function oC(n,e,t){var r=!0;if((Pr(n)||Pr(e))&&(r=!1),Pr(n)&&Pr(e)&&(r=!0),r){var o=n.constructor.name,i=e.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(n)&&Array.isArray(e)){var a=Ka(n),s=Ka(e);if(!er(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=Pr(n)?n:ks(n),c=Pr(e)?e:ks(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],d=c[l];if(!t(f,d))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function iC(n,e,t){return!isFinite(n)&&!isFinite(e)||!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}Object.freeze({TEST_EPSILON_FLOAT16:CB,expectArraysClose:function(n,e,t){return null==t&&(t=rC()),oC(n,e,function(r,o){return iC(r,o,t)})},testEpsilon:rC,expectPromiseToFail:function(n,e){n().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(n,e){var t="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Ou(n)||Ou(n[0])||Ou(e)||Ou(e[0])?oC(n,t,function(r,o){return r==o}):oC(n,e,function(r,o){return iC(r,o,0)})},expectNumbersClose:function(n,e,t){if(null==t&&(t=rC()),!iC(n,e,t))throw new Error("Numbers differ: actual === "+n+", expected === "+e)},expectValuesInRange:function(n,e,t){for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:"+n[r]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(n,e){expect(new Float32Array(n)).toEqual(new Float32Array(e))}});var aC=function(){function n(e,t,r,o,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Lm(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),Yxe=function(){function n(e,t,r,o){this.alpha=e,this.beta=1/t,this.dtype=r;var i=o||Math.random();this.randu=Lm(i.toString()),this.randn=new aC(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,o,i,a;;){do{o=this.randn.nextValue(),a=1+this.c*o}while(a<=0);if(t=1-.331*(e=o*o)*e,r=.5*e+this.d*(1-(a*=a*a)+Math.log(a)),(i=this.randu())<t||Math.log(i)<r)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},n.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},n}(),Zxe=function(){function n(e,t,r,o){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=r,null==o&&(o=Math.random()),"number"==typeof o&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Lm(o)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}(),Qxe=F({randomGamma_:function(n,e,t,r,o){if(void 0===t&&(t=1),void 0===r&&(r="float32"),null==t&&(t=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new Yxe(e,t,r,o),a=Qe(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Jxe=F({randomNormal_:function(n,e,t,r,o){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new aC(e,t,r,!1,o),a=Qe(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),EB=F({randomUniform_:function(n,e,t,r,o){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r="float32");for(var i=Qe(n,r),a=new Zxe(e,t,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),SB=F({square_:function(n){var e=I(n,"x","square");return k.runKernelFunc(function(r,o){return o([e]),r.square(e)},{x:e},null,"Square",{},[e],[])}}),AB=F({squaredDifference_:function(n,e){var t,r=I(n,"a","squaredDifference"),o=I(e,"b","squaredDifference");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],f=Oe(2);return{a:function(){return s.mul(c.sub(l).mul(f))},b:function(){return s.mul(l.sub(c).mul(f))}}},Cm,{},[r,o],[])}}),ewe=F({truncatedNormal_:function(n,e,t,r,o){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new aC(e,t,r,!0,o),a=Qe(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),IB=F({equal_:function(n,e){var t,r=I(n,"a","equal"),o=I(e,"b","equal");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),twe=F({equalStrict_:function(n,e){var t=I(n,"a","equalStrict"),r=I(e,"b","equalStrict");return Dt(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),nwe=F({greater_:function(n,e){var t,r=I(n,"a","greater"),o=I(e,"b","greater");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),DB=F({greaterEqual_:function(n,e){var t,r=I(n,"a","greaterEqual"),o=I(e,"b","greaterEqual");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return Tt(s)},b:function(){return Tt(u)}}},"GreaterEqual")}}),rwe=F({greaterEqualStrict_:function(n,e){var t=I(n,"a","greaterEqualStrict"),r=I(e,"b","greaterEqualStrict");return Dt(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),owe=F({greaterStrict_:function(n,e){var t=I(n,"a","greaterStrict"),r=I(e,"b","greaterStrict");return Dt(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),iwe=F({less_:function(n,e){var t,r=I(n,"a","less"),o=I(e,"b","less");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),awe=F({lessEqual_:function(n,e){var t,r=I(n,"a","lessEqual"),o=I(e,"b","lessEqual");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),swe=F({lessEqualStrict_:function(n,e){var t=I(n,"a","lessEqualStrict"),r=I(e,"b","lessEqualStrict");return Dt(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),uwe=F({lessStrict_:function(n,e){var t=I(n,"a","lessStrict"),r=I(e,"b","lessStrict");return Dt(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),cwe=F({notEqual_:function(n,e){var t,r=I(n,"a","notEqual"),o=I(e,"b","notEqual");return t=wn(r,o),yt((r=t[0]).shape,(o=t[1]).shape),k.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),lwe=F({notEqualStrict_:function(n,e){var t=I(n,"a","notEqualStrict"),r=I(e,"b","notEqualStrict");return Dt(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function TB(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function RB(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var sC=F({gather_:function(n,e,t){void 0===t&&(t=0);var r=I(n,"x","gather"),o=I(e,"indices","gather","int32");t=tr(t,r.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],f=1,d=1,h=0;h<u;h++)l.push(a.shape[h]),f*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),d*=a.shape[h];return{batchSize:f,sliceSize:d,dimSize:c,outputShape:l}}(r,o,t);return k.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),t);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,f=c.slice(0,t),d=f.length,h=c.slice(t,c.length).slice(1),p=h.length,g=TB(0,d),v=TB(d+1,d+1+p),m=RB([f,[l],h]),y=a.reshape(m),x=u.reshape([l]),w=RB([[d],g,v]),_=y.transpose(w),b=NB(_,x,r.shape[t]),C=vm(w);return b.transpose(C)},indices:function(){return u}}},"Gather",{axis:t}).reshape(i.outputShape)}}),NB=F({unsortedSegmentSum_:function(n,e,t){var r=I(n,"x","unsortedSegmentSum"),o=I(e,"segmentIds","unsortedSegmentSum","int32");return T(An(t),function(){return"numSegments must be of dtype int"}),k.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,t);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=kb(c,Tt(c)),f=sC(u,l),d=DB(c,Oe(0,"int32")),h=f.rank-d.rank,p=0;p<h;++p)d=ku(d,p+1);d=Um(d,Bf(f.shape,"bool"));var g=Tt(f);return Qc(d,f,g)}(i,s)}}})}});function OB(n,e,t,r,o,i,a){void 0===i&&(i="NHWC"),T(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var s=n,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,n[0],n[1],n[2]]),T(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),T(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),T(4===t.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var l="NHWC"===i?s[3]:s[1],f="NHWC"===i?u.shape[3]:u.shape[1];T(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),T(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+t.shape[3]+"."}),null!=a&&T(An(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=Nm(i),h=Vu(s,t.shape,r,1,o,a,!1,d),p=k.runKernelFunc(function(g,v){var m=g.conv2dDerInput(u,t,h);return v([t,u]),m},{dy4D:u,filter:t},function(g,v){var m=v[0],y=v[1];return{dy4D:function(){return Jc(g,m,r,o,i,1,a)},filter:function(){return cC(g,y,m.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function uC(n){var i,e="number"==typeof(i=n)?[i,i,i]:2===i.length?[i[0],i[1],1]:i;return 1===e[0]&&1===e[1]&&1===e[2]}function MB(n,e,t,r,o){T(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var i=n,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=a.shape[4];T(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),T(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),T(5===t.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),T(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),T(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."});var l=Sp(i,t.shape,r,1,o),f=k.runKernelFunc(function(d){return d.conv3dDerInput(a,t,l)},{dy5D:a});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var dwe=F({conv1d_:function(n,e,t,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=I(n,"x","conv1d"),u=I(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),T(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),T(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&T(An(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),T(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),T(Zr(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+i+"'"}),T("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Jc(d,f,[1,t],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Jc=F({conv2d_:function(n,e,t,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=I(n,"x","conv2d"),u=I(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),T(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&T(An(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f="NHWC"===o?c.shape[3]:c.shape[1];T(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."}),T(Zr(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"});var d=Nm(o),h=Vu(c.shape,u.shape,t,i,r,a,!1,d),g=k.runKernelFunc(function(v,m){var y=v.conv2d(c,u,h);return m([u,c]),y},{x:c,filter:u},function(v,m){var x=m[0],w=m[1];return T(qc(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return PB(w.shape,v,x,t,r,o)},filter:function(){return cC(w,v,x.shape,t,r,o)}}},"Conv2D",h,[u,c]);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),hwe=F({conv3d_:function(n,e,t,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var h,a=I(n,"x","conv3d"),s=I(e,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),T(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),T(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),T(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),T((h=i,uC(t)||uC(h)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),T("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=Sp(u.shape,s.shape,t,i,r),f=k.runKernelFunc(function(d,h){var p=d.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(d,h){T(uC(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],g=h[1];return{x:function(){return MB(p.shape,d,g,t,r)},$filter:function(){return function(v,m,y,x,w){var _=v;4===v.rank&&(_=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var b=m;4===b.rank&&(b=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),T(5===_.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+_.shape+"."}),T(5===b.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+b.shape+"."}),T(5===y.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),T(_.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+_.shape[4]+") must match input depth in filter ("+y[3]+"."}),T(b.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+b.shape[4]+") must match output depth for filter ("+y[4]+")."});var C=Sp(_.shape,y,x,1,w);return k.runKernelFunc(function(E){return E.conv3dDerFilter(_,b,C)},{x5D:_,dy5D:b})}(p,d,g.shape,t,r)}}});return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),cC=F({conv2dDerFilter_:function(n,e,t,r,o,i,a){void 0===i&&(i="NHWC");var s=n;3===n.rank&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),T(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),T(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),T(4===t.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];T(c===t[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."}),T(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."}),null!=a&&T(An(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=Nm(i),d=Vu(s.shape,t,r,1,o,a,!1,f);return k.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),PB=F({conv2dDerInput_:OB}),lC=F({depthwiseConv2d_:function(n,e,t,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=I(n,"x","depthwiseConv2d"),u=I(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),T(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),T(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),T(Zr(t,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}),null!=a&&T(An(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var f=Vu(c.shape,u.shape,t,i,r,a,!0),h=k.runKernelFunc(function(p,g){var v=p.depthwiseConv2D(c,u,f);return g([c,u]),v},{x:c,filter:u},function(p,g){T(qc(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var v=g[0],m=g[1];return{x:function(){return kB(v.shape,p,m,f)},filter:function(){return FB(v,p,m.shape,f)}}},"DepthwiseConv2dNative",f,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),kB=F({depthwiseConv2dDerInput_:function(n,e,t,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=k.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,t,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),FB=F({depthwiseConv2dDerFilter_:function(n,e,t,r){var o=n;3===n.rank&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),k.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),LB=F({separableConv2d_:function(n,e,t,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=I(n,"x","separableConv2d"),u=I(e,"depthwiseFilter","separableConv2d"),c=I(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),T(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),T(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),T(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),T(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],h=u.shape[3];T(c.shape[2]===d*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+c.shape[2]+"."});var p=lC(l,u,r,o,a,i),g=Jc(p,c,1,"valid",a);return f?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),pwe=F({conv2dTranspose_:function(n,e,t,r,o,i){return OB(t,I(n,"x","conv2dTranspose"),I(e,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),gwe=F({conv3dTranspose_:function(n,e,t,r,o){return MB(t,I(n,"x","conv3dTranspose"),I(e,"filter","conv3dTranspose"),r,o)}}),BB=F({matMul_:function(n,e,t,r){var o;void 0===t&&(t=!1),void 0===r&&(r=!1);var i=I(n,"a","matMul"),a=I(e,"b","matMul");o=wn(i,a),i=o[0],a=o[1];var s=t?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=t?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=i.shape.slice(0,-2),d=a.shape.slice(0,-2),h=Ee(f),p=Ee(d);T(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),T(er(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),T(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var g=i.shape.slice(0,-2).concat([c,l]),v=t?i.as3D(h,s,c):i.as3D(h,c,s),m=r?a.as3D(p,l,u):a.as3D(p,u,l);return k.runKernelFunc(function(x,w){var _=x.batchMatMul(v,m,t,r);return w([v,m]),_},{a:v,b:m},function(x,w){var b=w[0],C=w[1];return t||r?!t&&r?{a:function(){return x.matMul(C,!1,!1)},b:function(){return x.matMul(b,!0,!1)}}:t&&!r?{a:function(){return C.matMul(x,!1,!0)},b:function(){return b.matMul(x,!1,!1)}}:{a:function(){return C.matMul(x,!0,!0)},b:function(){return x.matMul(b,!0,!0)}}:{a:function(){return x.matMul(C,!1,!0)},b:function(){return b.matMul(x,!0,!1)}}},"BatchMatMul",{transposeA:t,transposeB:r}).reshape(g)}}),vwe=F({dot_:function(n,e){var t=I(n,"t1","dot"),r=I(e,"t2","dot");T(!(1!==t.rank&&2!==t.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var o=1===t.rank?t.size:t.shape[1],i=1===r.rank?r.size:r.shape[0];return T(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===t.rank&&1===r.rank?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===t.rank&&2===r.rank?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===t.rank&&1===r.rank?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),mwe=F({outerProduct_:function(n,e){var t=I(n,"v1","outerProduct"),r=I(e,"v2","outerProduct");return T(1===t.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Np=F({reverse_:function(n,e){var t=I(n,"x","reverse");if(0===t.rank)return t.clone();var r=tr(e,t.shape);return k.runKernelFunc(function(o){return o.reverse(t,r)},{$x:t},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(t)}}),ywe=F({reverse1d_:function(n){var e=I(n,"x","reverse");return T(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Np(e,0)}}),xwe=F({reverse2d_:function(n,e){var t=I(n,"x","reverse");return T(2===t.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Np(t,e)}}),wwe=F({reverse3d_:function(n,e){var t=I(n,"x","reverse");return T(3===t.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Np(t,e)}}),_we=F({reverse4d_:function(n,e){var t=I(n,"x","reverse");return T(4===t.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Np(t,e)}});function VB(n,e,t,r,o,i){var a=I(n,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),T(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),T(Zr(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),null!=i&&T(An(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Bu(s.shape,e,t,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&er(c.inShape,c.outShape))return a.clone();var f=k.runKernelFunc(function(d,h){var p=d.maxPool(s,c);return h([s,p]),p},{x:s},function(d,h){var p=h[0],g=h[1];return{x:function(){return function(v,m,y,x,w,_,b,C){var E=I(v,"dy","maxPoolBackprop"),S=I(m,"input","maxPoolBackprop"),A=I(y,"output","maxPoolBackprop");T(S.rank===E.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+E.rank+")"}),null==_&&(_=[1,1]),T(Zr(w,_),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+_+"'"}),T(4===E.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),T(4===S.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."});var D=Bu(S.shape,x,w,_,b,void 0);return k.runKernelFunc(function(M){return M.maxPoolBackprop(E,S,A,D)},{$dy:E,$input:S})}(d,p,g,e,t,r,o)}}},"MaxPool",c,[s]);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function UB(n,e,t,r,o,i){var a=I(n,"x","avgPool","float32");null==r&&(r=[1,1]),T(Zr(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&T(An(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Bu(s.shape,e,t,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&er(c.inShape,c.outShape))return a.clone();var l=k.runKernelFunc(function(f){return f.avgPool(s,c)},{x:s},function(f){return{x:function(){return function(d,h,p,g,v,m){var y=I(d,"dy","avgPoolBackprop"),x=I(h,"input","avgPoolBackprop");T(x.rank===y.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+y.rank+")"}),null==v&&(v=[1,1]),T(Zr(g,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"});var w=x,_=y,b=!1;3===x.rank&&(b=!0,w=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),_=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),T(4===_.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),T(4===w.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var C=Bu(w.shape,p,g,v,m),E=k.runKernelFunc(function(S){return S.avgPoolBackprop(_,w,C)},{dy4D:_,input4D:w});return b?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}(f,s,e,t,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var ui=F({maxPool_:function(n,e,t,r,o){return VB(n,e,t,1,r,o)}}),bwe=F({avgPool_:function(n,e,t,r,o){return UB(n,e,t,1,r,o)}}),Cwe=F({pool_:function(n,e,t,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=I(n,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(Zr(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,_,b,C,E,l=Bu(s.shape,e,i,o,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?(_=f,b=[l.filterHeight,l.filterWidth].map(function(S,A){return S+(S-1)*(_[A]-1)}).map(function(S){return S-1}),C=b.map(function(S){return Math.floor(S/2)}),E=b.map(function(S,A){return S-C[A]}),b.map(function(S,A){return[C[A],E[A]]})):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function(w,_,b){var C=b.map(function(B){return B[0]}),E=b.map(function(B){return B[1]}),S=w.concat(C,E),A=_.map(function(B,U){return(B-S[U]%B)%B}),D=E.map(function(B,U){return B+A[U]});return[_.map(function(B,U){return[C[U],D[U]]}),_.map(function(B,U){return[0,A[U]]})]}([l.inHeight,l.inWidth],f,c),g=h[1],v=d?r:"valid",m=d?s:KL(s,f,h[0]),y=("avg"===t?function(){return UB(m,e,i,1,v)}:function(){return VB(m,e,i,1,v)})(),x=d?y:XL(y,f,g);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Ewe=F({maxPool3d_:function(n,e,t,r,o,i,a){void 0===i&&(i="NDHWC");var s=I(n,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),T(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),T("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),T(Zr(t,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),null!=o&&T(An(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Ep(u.shape,e,t,a,r,o,i),f=k.runKernelFunc(function(d,h){var p=d.maxPool3d(u,l);return h([u,p]),p},{x:u},function(d,h){var p=h[0],g=h[1];return{x:function(){return function(v,m,y,x,w,_,b,C){var E=I(v,"dy","maxPool3dBackprop"),S=I(m,"input","maxPool3dBackprop"),A=I(y,"output","maxPool3dBackprop"),D=E,M=S,L=A,B=!1;4===S.rank&&(B=!0,D=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),M=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),L=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3])),T(5===D.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."}),T(5===M.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),T(5===L.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+L.rank+"."}),null==_&&(_=[1,1,1]),T(Zr(w,_),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+_+"'"}),null!=C&&T(An(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+b+"."});var U=Ep(M.shape,x,w,_,b,C),G=k.runKernelFunc(function(H){return H.maxPool3dBackprop(D,M,L,U)},{dy5D:D,input5D:M});return B?G.as4D(G.shape[1],G.shape[2],G.shape[3],G.shape[4]):G}(d,p,g,e,t,a,r,o)}}});return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Swe=F({avgPool3d_:function(n,e,t,r,o,i,a){void 0===i&&(i="NDHWC");var s=I(n,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),T(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),T("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),T(Zr(t,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),null!=o&&T(An(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Ep(u.shape,e,t,a,r,o,i),f=k.runKernelFunc(function(d){return d.avgPool3d(u,l)},{x:u},function(d){return{x:function(){return function(h,p,g,v,m,y,x){var w=I(h,"dy","avgPool3dBackprop"),_=I(p,"input","avgPool3dBackprop"),b=w,C=_,E=!1;4===_.rank&&(E=!0,b=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),C=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),T(5===b.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+b.rank+"."}),T(5===C.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+C.rank+"."}),null==m&&(m=[1,1,1]),T(Zr(v,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"}),null!=x&&T(An(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+y+"."});var S=Ep(C.shape,g,v,m,y,x),A=k.runKernelFunc(function(D){return D.avgPool3dBackprop(b,C,S)},{dy5D:b,input5D:C});return E?A.as4D(A.shape[1],A.shape[2],A.shape[3],A.shape[4]):A}(d,u,e,t,a,r,o)}}});return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Awe=F({maxPoolWithArgmax_:function(n,e,t,r,o){void 0===o&&(o=!1);var i=I(n,"x","maxPoolWithArgmax"),s=k.runKernel("MaxPoolWithArgmax",{x:i},{filterSize:e,strides:t,pad:r,includeBatchInIndex:o});return{result:s[0],indexes:s[1]}}}),Uu=F({slice_:function(n,e,t){var r,o,i=I(n,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice()).forEach(function(u){T(-1!==u,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==t?new Array(i.rank).fill(-1):"number"==typeof t?[t].concat(new Array(i.rank-1).fill(-1)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(-1)):t).map(function(u,c){return u>=0?u:(T(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-r[c])}),l8(i,r,o);var a=i.shape;return k.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return Us(u,c)}}},"Slice",{begin:r,size:o})}}),Iwe=F({slice1d_:function(n,e,t){var r=I(n,"x","slice1d");return T(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Uu(r,[e],[t])}}),Dwe=F({slice2d_:function(n,e,t){var r=I(n,"x","slice2d");return T(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Uu(r,e,t)}}),Twe=F({slice3d_:function(n,e,t){var r=I(n,"x","slice3d");return T(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Uu(r,e,t)}}),Rwe=F({slice4d_:function(n,e,t){var r=I(n,"x","slice4d");return T(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Uu(r,e,t)}});function HB(n,e,t,r,o){return e.rank<t.rank&&(e=e.reshape(mo(e.shape,r))),n.rank<t.rank&&(n=n.reshape(mo(n.shape,r))),{x:function(){var i=n.mul(t.equal(e).cast(n.dtype));return null==o?i:i.transpose(o)}}}var Nwe=F({all_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","all","bool"),o=tr(e,r.shape),i=o,a=ia(i,r.rank);null!=a&&(r=r.transpose(a),i=aa(i.length,r.rank));var s=k.runKernelFunc(function(c){return c.all(r,i)},{$x:r});if(t){var u=mo(s.shape,o);return s.reshape(u)}return s}}),Owe=F({any_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","any","bool"),o=tr(e,r.shape),i=o,a=ia(i,r.rank);null!=a&&(r=r.transpose(a),i=aa(i.length,r.rank));var s=k.runKernelFunc(function(c){return c.any(r,i)},{$x:r});if(t){var u=mo(s.shape,o);return s.reshape(u)}return s}}),Mwe=F({argMax_:function(n,e){void 0===e&&(e=0);var t=I(n,"x","argMax");null==e&&(e=0);var r=tr(e,t.shape),o=ia(r,t.rank);return null!=o&&(t=t.transpose(o),r=aa(r.length,t.rank)),k.runKernelFunc(function(s,u){var c=s.argMax(t,r[0]);return u([t]),c},{x:t},function(s,u){var c=u[0];return{x:function(){return Tt(c)}}},"ArgMax",{axis:r[0]},[t])}}),Pwe=F({argMin_:function(n,e){void 0===e&&(e=0);var t=I(n,"x","argMin");null==e&&(e=0);var r=tr(e,t.shape),o=ia(r,t.rank);return null!=o&&(t=t.transpose(o),r=aa(r.length,t.rank)),k.runKernelFunc(function(i,a){var s=i.argMin(t,r[0]);return a([t]),s},{$x:t},function(i,a){var s=a[0];return{$x:function(){return Tt(s)}}})}}),kwe=F({logSumExp_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","logSumExp"),o=tr(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(t){var u=mo(s.shape,o);return s.reshape(u)}return s}}),Fwe=F({max_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","max"),o=r,i=tr(e,r.shape),a=i,s=ia(a,r.rank);null!=s&&(r=r.transpose(s),a=aa(a.length,r.rank));var c=k.runKernelFunc(function(f,d){var h=f.max(r,a);return d([o,h]),h},{x:r},function(f,d){return HB(f,d[1],d[0],i,s)},"Max",{axes:a},[r],[!0]);if(t){var l=mo(c.shape,i);c=c.reshape(l)}return c}}),Lwe=F({mean_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","mean"),o=tr(e,r.shape),i=Ee(kr(r.shape,o)[1]);return Im(function(a){var s=Oe(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(Bf(a.shape,"float32")).div(i)}}})(r)}}),Bwe=F({min_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","min"),o=r,i=tr(e,r.shape),a=i,s=ia(a,r.rank);null!=s&&(r=r.transpose(s),a=aa(a.length,r.rank));var c=k.runKernelFunc(function(f,d){var h=f.min(r,a);return d([o,h]),h},{x:r},function(f,d){return HB(f,d[1],d[0],i,s)},"Min",{axes:a},[r],[!0]);if(t){var l=mo(c.shape,i);c=c.reshape(l)}return c}}),Vwe=F({moments_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=tr(e,(n=I(n,"x","moments")).shape),o=n.mean(r,t),i=o.shape;t||(i=mo(o.shape,r));var a=n.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,t)}}}),Hu=F({sum_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=tr(e,r.shape);return Im(function(i){var a=ia(o,i.rank),s=o,u=i;null!=a&&(u=i.transpose(a),s=aa(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach(function(g){p[g]=1}),h.reshape(p).mul(Bf(i.shape,"float32"))},f=k.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",{axes:s});if(t){var d=mo(f.shape,o);f=f.reshape(d)}return{value:f,gradFunc:c}})(r)}}),Uwe=F({prod_:function(n,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var r=I(n,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=tr(e,r.shape),i=ia(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=aa(a.length,r.rank));var u=k.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(t){var c=mo(u.shape,o);u=u.reshape(c)}return u}}),WB=F({elu_:function(n){var e=I(n,"x","elu");return k.runKernelFunc(function(t,r){var o=t.elu(e);return r([o]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){return k.runKernelFunc(function(i){return i.eluDer(t,o)},{dy:t,y:o})}}})}}),Hwe=F({leakyRelu_:function(n,e){void 0===e&&(e=.2);var t=I(n,"x","leakyRelu");return kb(Oe(e).mul(t),t)}}),GB=F({prelu_:function(n,e){var t=I(n,"x","prelu"),r=I(e,"alpha","prelu");return k.runKernelFunc(function(o,i){var a=o.prelu(t,r);return i([t,r]),a},{x:t,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return Qc(u,o,o.mul(s))},alpha:function(){var c=Qc(u,Tt(o),o.mul(a)),l=nr(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),Wm=F({relu_:function(n){var e=I(n,"x","relu");return"bool"===e.dtype?e.toInt():k.runKernelFunc(function(t,r){var o=t.relu(e);return r([e]),o},{x:e},function(t,r){var o=r[0];return{x:function(){return t.mulStrict(o.step().toFloat())}}},"Relu")}}),zB=F({relu6_:function(n){var e=I(n,"x","relu6");return"bool"===e.dtype?e.toInt():k.runKernelFunc(function(t,r){var o=t.relu6(e);return r([e]),o},{x:e},function(t,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return t.mulStrict(i.toFloat())}}},"Relu6")}}),Wwe=F({selu_:function(n){var e=I(n,"x","selu");return k.runKernelFunc(function(t,r){var o=t.selu(e);return r([e]),o},{$x:e},function(t,r){var o=r[0];return{$x:function(){var i=o.greater(Oe(0)),a=Oe(tC),s=Oe(nC),u=t.mul(s),c=t.mul(a).mul(o.toFloat().exp());return Qc(i,u,c)}}})}}),Gwe=F({localResponseNormalization_:function(n,e,t,r,o){void 0===e&&(e=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=I(n,"x","localResponseNormalization");T(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),T(An(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=k.runKernelFunc(function(c,l){var f=c.localResponseNormalization4D(a,e,t,r,o);return l([a,f]),f},{x4D:a},function(c,l){var f=l[0],d=l[1];return{x4D:function(){return k.runKernelFunc(function(h){return h.LRNGrad(c,f,d,e,t,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jB=F({norm_:function(n,e,t,r){void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1);var o=function s(u,c,l){if(void 0===l&&(l=null),0===u.rank)return u.abs();if(1!==u.rank&&null===l)return s(u.reshape([-1]),c,l);if(1===u.rank||"number"==typeof l||Array.isArray(l)&&1===l.length){if(1===c)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if("euclidean"===c||2===c)return u.abs().pow(Oe(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&2===l.length){if(1===c)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if("fro"===c||"euclidean"===c)return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(n=I(n,"x","norm"),e,t),i=o.shape;if(r){var a=tr(t,n.shape);i=mo(o.shape,a)}return o.reshape(i)}}),zwe=F({basicLSTMCell_:function(n,e,t,r,o,i){var a=I(n,"forgetBias","basicLSTMCell"),s=I(e,"lstmKernel","basicLSTMCell"),u=I(t,"lstmBias","basicLSTMCell"),c=I(r,"data","basicLSTMCell"),l=I(o,"c","basicLSTMCell"),f=I(i,"h","basicLSTMCell"),d=c.concat(f,1).matMul(s).add(u),p=d.shape[1]/4,g=[d.shape[0],p],v=d.slice([0,0],g),m=d.slice([0,p],g),y=d.slice([0,2*p],g),x=d.slice([0,3*p],g),w=v.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(y).sigmoid())),_=w.tanh().mulStrict(x.sigmoid());return[w,_]}}),jwe=F({multiRNNCell_:function(n,e,t,r){for(var o=I(e,"data","multiRNNCell"),i=bp(t,"c","multiRNNCell"),a=bp(r,"h","multiRNNCell"),s=o,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],d=[];for(c=0;c<u.length;c+=2)f.push(u[c]),d.push(u[c+1]);return[f,d]}}),$we=F({movingAverage_:function(n,e,t,r,o){void 0===o&&(o=!0);var i=I(n,"v","movingAverage"),a=I(e,"x","movingAverage"),s=I(t,"decay","movingAverage");pL(i,a),T(er(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Oe(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){T(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=I(r,"step","movingAverage");l=l.div(u.sub(Em(s,f)))}return i.add(l)}}),qwe=F({stridedSlice_:function(n,e,t,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=I(n,"x","stridedSlice"),l=Bb(s),f=c.shape.slice();l.forEach(function(v){e[v]=0,t[v]=1,f.splice(v,0,1)}),c=c.reshape(f);for(var d=0;d<c.rank;d++)e[d]=f8(o,e,r,c.shape,d),t[d]=d8(i,t,r,c.shape,d),r[d]=r[d]||1;var h=Bb(u);h.forEach(function(v){t[v]=e[v]+1,r[v]=1});var p=Am(e,t,r),g=p.filter(function(v,m){return-1===h.indexOf(m)});return r.every(function(v){return 1===v})?Uu(c,e,p).reshape(g):k.runKernelFunc(function(v){return v.stridedSlice(c,e,t,r)},{$x:c}).reshape(g)}}),Xwe=F({topk_:function(n,e,t){void 0===e&&(e=1),void 0===t&&(t=!0);var r=I(n,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=k.runKernelFunc(function(a){return a.topk(r,e,t)},{$x:r});return{values:i[0],indices:i[1]}}}),Kwe=F({scatterND_:function(n,e,t){var r=I(n,"indices","scatterND","int32"),o=I(e,"updates","scatterND");return c8(o,r,t),k.runKernelFunc(function(i){return i.scatterND(r,o,t)},{indices:r,updates:o},null,"ScatterNd",{shape:t})}}),fC=F({fft_:function(n){T("complex64"===n.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return k.runKernelFunc(function(o){return o.fft(r)},{input:n}).reshape(n.shape)}}),Gm=F({ifft_:function(n){T("complex64"===n.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],r=n.as2D(n.size/e,e);return k.runKernelFunc(function(o){return o.ifft(r)},{input:n}).reshape(n.shape)}}),dC=F({rfft_:function(n,e){T("float32"===n.dtype,function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],o=n.size/r;if(null!=e&&e<r){var i=n.shape.map(function(m){return 0}),a=n.shape.map(function(m){return m});a[n.shape.length-1]=e,t=n.slice(i,a),r=e}else if(null!=e&&e>r){var s=n.shape.map(function(m){return m});s[n.shape.length-1]=e-r,t=n.concat(On(s),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),c=Fr(t,u).as2D(o,r),l=fC(c),f=Math.floor(r/2)+1,d=Oi(l),h=Ya(l),p=d.split([f,r-f],d.shape.length-1),g=h.split([f,r-f],h.shape.length-1),v=t.shape.slice();return v[t.shape.length-1]=f,Fr(p[0],g[0]).reshape(v)}}),$B=F({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),o=Gm(r);return Oi(o)}var i=[t,2*(e-1)],a=Oi(n).as2D(t,e),s=Ya(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),c=s.slice([0,1],[t,e-2]).reverse(1).mul(Oe(-1)),l=a.concat(u,1),f=s.concat(c,1);return r=Fr(l,f).as2D(i[0],i[1]),o=Gm(r),Oi(o)}}),Ywe=Object.freeze({fft:fC,ifft:Gm,rfft:dC,irfft:$B}),Zwe=F({sparseToDense_:function(n,e,t,r){void 0===r&&(r=0);var o=I(n,"sparseIndices","sparseToDense","int32"),i=I(e,"sparseValues","sparseToDense"),a=I(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var f=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(c.length!==d)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+d+".");if(0!==u.rank&&(1!==u.rank||u.size!==f))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+f+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,t,a),k.runKernelFunc(function(s){return s.sparseToDense(o,i,t,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),Qwe=F({gatherND_:function(n,e){var t=I(e,"indices","gatherND","int32"),r=I(n,"x","gatherND");return k.runKernelFunc(function(o){return o.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),Jwe=F({diag_:function(n){var e=I(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return k.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),e_e=F({dropout_:function(n,e,t,r){var o=I(n,"x","dropout");if(T("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),T(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return n instanceof Qt?o.clone():o;var i=function(u,c){if(null==c)return u.shape.slice();if(er(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],f=0;f<u.shape.length;f++)l.push(null==c[f]&&null!=u.shape[f]?u.shape[f]:c[f]);return l}return c}(o,t),a=1-e,s=EB(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function qB(n,e,t){for(var r=1-n%2,o=new Float32Array(n),i=0;i<n;++i){var a=2*Math.PI*i/(n+r-1);o[i]=e-t*Math.cos(a)}return sa(o,"float32")}var Jr,hC=F({hannWindow_:function(n){return qB(n,.5,.5)}}),XB=F({hammingWindow_:function(n){return qB(n,.54,.46)}}),pC=F({frame_:function(n,e,t,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+e<=n.size;)a.push(Uu(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Mi([Uu(n,i,e-s),$c([s],o)]);a.push(u),i+=t}return 0===a.length?jc([],[0,e]):Mi(a).as2D(a.length,e)}}),KB=F({stft_:function(n,e,t,r,o){void 0===o&&(o=hC),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))));for(var a=pC(n,e,t),s=Mn(a,o(e)),u=[],c=0;c<a.shape[0];c++)u.push(dC(s.slice([c,0],[1,e]),r));return Mi(u)}}),t_e=Object.freeze({hannWindow:hC,hammingWindow:XB,frame:pC,stft:KB});!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Jr||(Jr={}));var r_e=F({absoluteDifference_:function(n,e,t,r){void 0===r&&(r=Jr.SUM_BY_NONZERO_WEIGHTS);var o=I(n,"labels","absoluteDifference"),i=I(e,"predictions","absoluteDifference"),a=null;null!=t&&(a=I(t,"weights","absoluteDifference")),Dt(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Hs(s,a,r)}}),Hs=F({computeWeightedLoss_:function(n,e,t){void 0===t&&(t=Jr.SUM_BY_NONZERO_WEIGHTS);var r=I(n,"losses","computeWeightedLoss"),o=null;null!=e&&(o=I(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(t===Jr.NONE)return i;if(t===Jr.SUM)return i.sum();if(t===Jr.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(Oe(a)):s}if(t===Jr.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(Oe(r.size));var u=o.mul(Bf(r.shape)).notEqual(Oe(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+t)}}),o_e=F({cosineDistance_:function(n,e,t,r,o){void 0===o&&(o=Jr.SUM_BY_NONZERO_WEIGHTS);var i=I(n,"labels","cosineDistance"),a=I(e,"predictions","cosineDistance"),s=null;null!=r&&(s=I(r,"weights","cosineDistance")),Dt(i.shape,a.shape,"Error in cosineDistance: ");var u=Oe(1).sub(i.mul(a).sum(t,!0));return Hs(u,s,o)}}),i_e=F({hingeLoss_:function(n,e,t,r){void 0===r&&(r=Jr.SUM_BY_NONZERO_WEIGHTS);var o=I(n,"labels","hingeLoss"),i=I(e,"predictions","hingeLoss"),a=null;null!=t&&(a=I(t,"weights","hingeLoss")),Dt(o.shape,i.shape,"Error in hingeLoss: ");var s=Oe(1);o=Oe(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Hs(u,a,r)}}),a_e=F({huberLoss_:function(n,e,t,r,o){void 0===r&&(r=1),void 0===o&&(o=Jr.SUM_BY_NONZERO_WEIGHTS);var i=I(n,"labels","huberLoss"),a=I(e,"predictions","huberLoss"),s=null;null!=t&&(s=I(t,"weights","huberLoss")),Dt(i.shape,a.shape,"Error in huberLoss: ");var u=Oe(r),c=a.sub(i).abs(),l=s8(c,u),f=c.sub(l),d=Oe(.5).mul(l.square()).add(u.mul(f));return Hs(d,s,o)}}),s_e=F({logLoss_:function(n,e,t,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Jr.SUM_BY_NONZERO_WEIGHTS);var i=I(n,"labels","logLoss"),a=I(e,"predictions","logLoss"),s=null;null!=t&&(s=I(t,"weights","logLoss")),Dt(i.shape,a.shape,"Error in logLoss: ");var u=Oe(1),c=Oe(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Hs(l,s,o)}}),u_e=F({meanSquaredError_:function(n,e,t,r){void 0===r&&(r=Jr.SUM_BY_NONZERO_WEIGHTS);var o=I(n,"labels","meanSquaredError"),i=I(e,"predictions","meanSquaredError"),a=null;null!=t&&(a=I(t,"weights","meanSquaredError")),Dt(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Hs(s,a,r)}}),c_e=F({sigmoidCrossEntropy_:function(n,e,t,r,o){void 0===r&&(r=0),void 0===o&&(o=Jr.SUM_BY_NONZERO_WEIGHTS);var i=I(n,"multiClassLabels","sigmoidCrossEntropy"),a=I(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=t&&(s=I(t,"weights","sigmoidCrossEntropy")),Dt(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Oe(r),c=Oe(1),l=Oe(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var f=function(d,h){var p=I(d,"labels","sigmoidCrossEntropyWithLogits"),g=I(h,"logits","sigmoidCrossEntropyWithLogits");Dt(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=g.relu(),m=g.mul(p),y=g.abs().neg().exp().log1p();return v.sub(m).add(y)}(i,a);return Hs(f,s,o)}}),l_e=F({softmaxCrossEntropy_:function(n,e,t,r,o){void 0===r&&(r=0),void 0===o&&(o=Jr.SUM_BY_NONZERO_WEIGHTS);var i=I(n,"onehotLabels","softmaxCrossEntropy"),a=I(e,"logits","softmaxCrossEntropy"),s=null;if(null!=t&&(s=I(t,"weights","softmaxCrossEntropy")),Dt(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Oe(r),c=Oe(1),l=Oe(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var f=function(d,h,p){if(void 0===p&&(p=-1),-1===p&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return Im(function(g,v,m){var y=v.logSumExp([p],!0),x=v.toFloat().sub(y);return m([g,x]),{value:x.mul(g).neg().sum([p]),gradFunc:function(w,_){var b=_[0],C=_[1],E=mo(w.shape,[p]);return[w.reshape(E).mul(b.toFloat().sub(C.exp())),w.reshape(E).mul(C.exp().sub(b.toFloat()))]}}})(d,h)}(i,a);return Hs(f,s,o)}}),f_e=Object.freeze({get Reduction(){return Jr},absoluteDifference:r_e,computeWeightedLoss:Hs,cosineDistance:o_e,hingeLoss:i_e,huberLoss:a_e,logLoss:s_e,meanSquaredError:u_e,sigmoidCrossEntropy:c_e,softmaxCrossEntropy:l_e});function YB(n,e){return void 0===e&&(e=!1),k.tidy(function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],o=bB(t),i=n.clone(),a=jc([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,c=function(f){var d,h=i,p=s,g=o;d=k.tidy(function(){var v=i.slice([f,f],[t-f,1]),m=v.norm(),y=i.slice([f,f],[1,1]),x=jc([[-1]]).where(y.greater(0),jc([[1]])),w=y.sub(x.mul(m)),_=v.div(w);s=1===_.shape[0]?a.clone():a.concat(_.slice([1,0],[_.shape[0]-1,_.shape[1]]),0);var b=x.matMul(w).div(m).neg(),C=i.slice([f,0],[t-f,r]),E=b.mul(s),S=s.transpose();if(0===f)i=C.sub(E.matMul(S.matMul(C)));else{var A=C.sub(E.matMul(S.matMul(C)));i=i.slice([0,0],[f,r]).concat(A,0)}var D=E.transpose(),M=o.slice([0,f],[t,o.shape[1]-f]);if(0===f)o=M.sub(M.matMul(s).matMul(D));else{var L=M.sub(M.matMul(s).matMul(D));o=o.slice([0,0],[t,f]).concat(L,1)}return[s,i,o]}),s=d[0],i=d[1],o=d[2],Bo([h,p,g])},l=0;l<u;++l)c(l);return!e&&t>r&&(o=o.slice([0,0],[t,r]),i=i.slice([0,0],[r,r])),[o,i]})}var d_e=F({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=I(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=mm(0,a,1,"int32").reshape([-1,1]),c=mm(0,s,1,"int32"),l=ua(u,c),f=Um(l.lessEqual(Oe(+e,"int32")),l.greaterEqual(Oe(-t,"int32"))),d=On([a,s],r.dtype);return Fu(ym(r.reshape([-1,a,s])).map(function(h){return Qc(f,h,d)})).reshape(o)}}),h_e=F({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,T(null!=n&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){T(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},o=1;o<n.length;++o)r(o)}else e=!0,n=Mb(n,n.shape[0],0).map(function(u){return YL(u,[0])});T(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var i=[],a=n,s=function(u){i.push(k.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var f=Hu(i[l].mulStrict(c)).mul(i[l]);c=c.sub(f)}return c.div(jB(c,"euclidean"))}))};for(o=0;o<n.length;++o)s(o);return e?Fu(i,0):i}}),p_e=F({qr_:function(n,e){if(void 0===e&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return YB(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(a,s){return a*s}),r=ym(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=YB(a,e),c=s[1];o.push(s[0]),i.push(c)}),[Fu(o,0).reshape(n.shape),Fu(i,0).reshape(n.shape)]}}),g_e=Object.freeze({bandPart:d_e,gramSchmidt:h_e,qr:p_e});function zm(n,e,t,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=n.shape[0];return t=Math.min(t,a),T(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),T(2===n.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),T(4===n.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),T(1===e.rank,function(){return"scores must be a 1D tensor"}),T(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),T(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var v_e=F({resizeBilinear_:function(n,e,t){void 0===t&&(t=!1);var r=I(n,"images","resizeBilinear");T(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=k.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,t)},{x:o},function(c,l){return{x:function(){return k.runKernelFunc(function(f){return f.resizeBilinearBackprop(c,l[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),m_e=F({resizeNearestNeighbor_:function(n,e,t){void 0===t&&(t=!1);var r=I(n,"images","resizeNearestNeighbor");T(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),T("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=k.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,t)},{batchImages:o},function(c,l){return{batchImages:function(){return k.runKernelFunc(function(f){return f.resizeNearestNeighborBackprop(c,l[0],t)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),y_e=F({nonMaxSuppression_:function(n,e,t,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=I(n,"boxes","nonMaxSuppression"),a=I(e,"scores","nonMaxSuppression"),s=zm(i,a,t,r,o);return k.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,t,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:t=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),w_e=F({nonMaxSuppressionWithScore_:function(n,e,t,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=I(n,"boxes","nonMaxSuppression"),s=I(e,"scores","nonMaxSuppression"),u=zm(a,s,t,r,o,i),c={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=k.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),b_e=F({cropAndResize_:function(n,e,t,r,o,i){var a=I(n,"image","cropAndResize"),s=I(e,"boxes","cropAndResize","float32"),u=I(t,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return T(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),T(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),T(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),T(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),T(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),T("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),k.runKernelFunc(function(l,f){return l.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),ZB=Object.freeze({resizeBilinear:v_e,resizeNearestNeighbor:m_e,nonMaxSuppression:y_e,nonMaxSuppressionAsync:function(n,e,t,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),De(this,void 0,void 0,function(){var i,a,s,u,f;return Te(this,function(d){switch(d.label){case 0:return i=I(n,"boxes","nonMaxSuppressionAsync"),a=I(e,"scores","nonMaxSuppressionAsync"),s=zm(i,a,t,r,o),t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=d.sent(),f=$b(u[0],u[1],t,r,o),i!==n&&i.dispose(),a!==e&&a.dispose(),[2,f]}})})},nonMaxSuppressionWithScore:w_e,nonMaxSuppressionWithScoreAsync:function(n,e,t,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),De(this,void 0,void 0,function(){var a,s,u,c,d;return Te(this,function(h){switch(h.label){case 0:return a=I(n,"boxes","nonMaxSuppressionAsync"),s=I(e,"scores","nonMaxSuppressionAsync"),u=zm(a,s,t,r,o,i),t=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),d=qb(c[0],c[1],t,r,o,i),a!==n&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},cropAndResize:b_e}),gC=function(n,e){return!(n>0)||"linear"===e},vC=function(n,e,t){if(null==t||"linear"===t)return n;if("relu"===t)return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},mC=function(n,e){var t=e,r=nr(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},yC=function(n,e,t){if("linear"===e)return n;if("relu"===e)return Wm(n);if("elu"===e)return WB(n);if("relu6"===e)return zB(n);if("prelu"===e)return GB(n,t);throw new Error("Unknown fused activation "+e+".")},C_e=F({fusedMatMul_:function(n){var e,t=n.a,r=n.b,o=n.transposeA,i=void 0!==o&&o,a=n.transposeB,s=void 0!==a&&a,u=n.bias,c=n.activation,l=void 0===c?"linear":c,f=n.preluActivationWeights;if(!1===gC(k.state.gradientDepth,l)){var d=BB(t,r,i,s);return null!=u&&(d=Pi(d,u)),yC(d,l,f)}var h=I(t,"a","fused matMul"),p=I(r,"b","fused matMul");e=wn(h,p),h=e[0],p=e[1];var g=i?h.shape[h.rank-2]:h.shape[h.rank-1],v=s?p.shape[p.rank-1]:p.shape[p.rank-2],m=i?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),w=p.shape.slice(0,-2),_=Ee(x),b=Ee(w);T(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),T(er(x,w),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+w+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),T(g===v,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+v+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var C,E,S=h.shape.slice(0,-2).concat([m,y]),A=i?h.as3D(_,g,m):h.as3D(_,m,g),D=s?p.as3D(b,y,v):p.as3D(b,v,y);null!=u&&yt(S,(C=wn(C=I(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(E=I(f,"prelu weights","fused matMul"));var M={a:A,b:D};return null!=u&&(M.bias=C),null!=f&&(M.preluActivationWeights=E),k.runKernelFunc(function(B,U){var G=B.fusedBatchMatMul({a:A,b:D,transposeA:i,transposeB:s,bias:C,activation:l,preluActivationWeights:E});return U([A,D,G]),G},M,function(B,U){var G=U[0],H=U[1],$=vC(B,U[2],l),K={};return null!=u&&(K={bias:function(){return mC(C,$)}}),Object.assign(i||s?!i&&s?{a:function(){return $.matMul(H,!1,!1)},b:function(){return $.matMul(G,!0,!1)}}:i&&!s?{a:function(){return H.matMul($,!1,!0)},b:function(){return G.matMul($,!1,!1)}}:{a:function(){return H.matMul($,!0,!0)},b:function(){return $.matMul(G,!0,!0)}}:{a:function(){return $.matMul(H,!1,!0)},b:function(){return G.matMul($,!0,!1)}},K)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},[A,D],[!0]).reshape(S)}}),E_e=F({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,o=n.pad,i=n.dataFormat,a=void 0===i?"NHWC":i,s=n.dilations,u=void 0===s?[1,1]:s,c=n.dimRoundingMode,l=n.bias,f=n.activation,d=void 0===f?"linear":f,h=n.preluActivationWeights;if(!1===gC(k.state.gradientDepth,d=d||"linear")){var p=Jc(e,t,r,o,a,u,c);return null!=l&&(p=Pi(p,l)),yC(p,d,h)}var g=I(e,"x","conv2d"),v=I(t,"filter","conv2d"),m=g,y=!1;3===g.rank&&(y=!0,m=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),T(4===m.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),T(4===v.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),null!=c&&T(An(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),T(m.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),T(Zr(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),T("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,w,_=Vu(m.shape,v.shape,r,u,o,c);null!=l&&(x=wn(x=I(l,"bias","fused conv2d"),g)[0],yt(_.outShape,x.shape)),null!=h&&(w=I(h,"prelu weights","fused conv2d"));var b={x:m,filter:v};null!=l&&(b.bias=x),null!=h&&(b.preluActivationWeights=w);var E=k.runKernelFunc(function(S,A){var D=S.fusedConv2d({input:m,filter:v,convInfo:_,bias:x,activation:d,preluActivationWeights:w});return A([v,m,D]),D},b,function(S,A){var M=A[0],L=A[1],U=vC(S,A[2],d);T(qc(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var G={};return null!=l&&(G={bias:function(){return mC(x,U)}}),Object.assign({x:function(){return PB(L.shape,U,M,r,o)},filter:function(){return cC(L,U,M.shape,r,o)}},G)},"FusedConv2D",{convInfo:_,activation:d},[v,m],[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),S_e=F({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,o=n.pad,i=n.dataFormat,a=void 0===i?"NHWC":i,s=n.dilations,u=void 0===s?[1,1]:s,c=n.dimRoundingMode,l=n.bias,f=n.activation,d=void 0===f?"linear":f,h=n.preluActivationWeights;if(!1===gC(k.state.gradientDepth,d)){var p=lC(e,t,r,o,a,u,c);return null!=l&&(p=Pi(p,l)),yC(p,d,h)}var g=I(e,"x","depthwiseConv2d"),v=I(t,"filter","depthwiseConv2d"),m=g,y=!1;3===g.rank&&(y=!0,m=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),T(4===m.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),T(4===v.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),T(m.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),null==u&&(u=[1,1]),T(Zr(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&T(An(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var x,w,_=Vu(m.shape,v.shape,r,u,o,c,!0);null!=l&&(x=wn(x=I(l,"bias","fused conv2d"),g)[0],yt(_.outShape,x.shape)),null!=h&&(w=I(h,"prelu weights","fused depthwiseConv2d"));var b={x:m,filter:v};null!=l&&(b.bias=x),null!=h&&(b.preluActivationWeights=w);var E=k.runKernelFunc(function(S,A){var D=S.fusedDepthwiseConv2D({input:m,filter:v,convInfo:_,bias:x,activation:d,preluActivationWeights:w});return A([v,m,D]),D},b,function(S,A){T(qc(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var D=A[0],M=A[1],B=vC(S,A[2],d),U={};return null!=l&&(U={bias:function(){return mC(x,B)}}),Object.assign({x:function(){return kB(M.shape,B,D,_)},filter:function(){return FB(M,B,D.shape,_)}},U)},"FusedDepthwiseConv2D",{convInfo:_,activation:d},[v,m],[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),A_e=Object.freeze({matMul:C_e,conv2d:E_e,depthwiseConv2d:S_e}),I_e=Object.freeze({image:ZB,linalg:g_e,losses:f_e,spectral:Ywe,fused:A_e,signal:t_e,add:Pi,addN:Oxe,batchNorm:Rp,batchNormalization:Mxe,batchNorm2d:kxe,batchNormalization2d:Pxe,batchNorm3d:Lxe,batchNormalization3d:Fxe,batchNorm4d:Vxe,batchNormalization4d:Bxe,broadcastTo:yB,clone:Uxe,div:Lu,divNoNan:_B,eye:bB,multinomial:Gxe,oneHot:Hm,pad:Us,pad1d:zxe,pad2d:jxe,pad3d:$xe,pad4d:qxe,rand:Xxe,randomGamma:Qxe,randomNormal:Jxe,randomUniform:EB,square:SB,squaredDifference:AB,tile:zf,truncatedNormal:ewe,conv1d:dwe,conv2d:Jc,conv3d:hwe,depthwiseConv2d:lC,separableConv2d:LB,conv2dTranspose:pwe,conv3dTranspose:gwe,op:F,booleanMaskAsync:function(n,e,t){return De(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,f,d,h,p,g;return Te(this,function(v){switch(v.label){case 0:for(r=I(n,"tensor","boolMask"),o=I(e,"mask","boolMask","bool"),i=t??0,s=r.shape,T((a=o.rank)>0,function(){return"mask cannot be scalar"}),Dt(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),f=r.reshape(l),d=o.reshape([-1]),[4,wB(d)];case 1:return h=v.sent(),p=h.squeeze([1]),g=sC(f,p,i),n!==r&&r.dispose(),e!==o&&o.dispose(),p.dispose(),f.dispose(),d.dispose(),h.dispose(),[2,g]}})})},complex:Fr,real:Oi,imag:Ya,concat:Mi,concat1d:Gme,concat2d:zme,concat3d:jme,concat4d:$me,split:Mb,matMul:BB,dot:vwe,outerProduct:mwe,reverse:Np,reverse1d:ywe,reverse2d:xwe,reverse3d:wwe,reverse4d:_we,maxPool:ui,avgPool:bwe,pool:Cwe,maxPool3d:Ewe,avgPool3d:Swe,maxPoolWithArgmax:Awe,slice:Uu,slice1d:Iwe,slice2d:Dwe,slice3d:Twe,slice4d:Rwe,abs:Qme,acos:Jme,acosh:e1e,asin:t1e,asinh:n1e,atan:r1e,atanh:o1e,ceil:i1e,clipByValue:a1e,cos:s1e,cosh:u1e,erf:c1e,exp:l1e,expm1:f1e,floor:d1e,log:h1e,log1p:p1e,logSigmoid:g1e,neg:Pb,reciprocal:v1e,round:m1e,rsqrt:i8,sigmoid:y1e,sign:x1e,isNaN:w1e,isInf:_1e,isFinite:b1e,sin:C1e,sinh:E1e,softplus:S1e,sqrt:A1e,step:I1e,tan:D1e,tanh:T1e,all:Nwe,any:Owe,argMax:Mwe,argMin:Pwe,logSumExp:kwe,max:Fwe,mean:Lwe,min:Bwe,moments:Vwe,sum:Hu,prod:Uwe,equal:IB,equalStrict:twe,greater:nwe,greaterEqual:DB,greaterEqualStrict:rwe,greaterStrict:owe,less:iwe,lessEqual:awe,lessEqualStrict:swe,lessStrict:uwe,notEqual:cwe,notEqualStrict:lwe,addStrict:R1e,atan2:N1e,divStrict:O1e,floorDiv:a8,maximum:kb,maximumStrict:M1e,minimum:s8,minimumStrict:P1e,mod:k1e,modStrict:F1e,mul:Mn,mulStrict:L1e,pow:Em,powStrict:B1e,squaredDifferenceStrict:V1e,sub:ua,subStrict:U1e,elu:WB,leakyRelu:Hwe,prelu:GB,relu:Wm,relu6:zB,selu:Wwe,logicalAnd:Um,logicalNot:Hxe,logicalOr:xB,logicalXor:Wxe,where:Qc,whereAsync:wB,buffer:Qe,print:function qme(n,e){void 0===e&&(e=!1),console.log(n.toString(e))},batchToSpaceND:XL,cast:Xme,cumsum:Kme,depthToSpace:Yme,expandDims:ku,reshape:Bs,spaceToBatchND:KL,squeeze:YL,stack:Fu,unstack:ym,setdiff1dAsync:function(n,e){return De(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,f;return Te(this,function(d){switch(d.label){case 0:return t=I(n,"x","setdiff1d"),r=I(e,"y","setdiff1d"),T(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),T(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),T(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new hp([s],t.dtype),c=new hp([s],"int32"),l=0,f=0;l<o.length;l++)a.has(o[l])||(u.values[f]=o[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:$c,linspace:function Wme(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return k.runKernelFunc(function(r){return r.linspace(n,e,t)},{})},ones:Bf,range:mm,scalar:Oe,tensor:Lr,tensor1d:sa,tensor2d:jc,tensor3d:$L,tensor4d:Za,tensor5d:function Vme(n,e,t){if(Uc(n),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ka(n,t);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Pu(n,e,r,t)},tensor6d:function Ume(n,e,t){if(Uc(n),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ka(n,t);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Pu(n,e=e||r,r,t)},variable:function Hme(n,e,t,r){return void 0===e&&(e=!0),k.makeVariable(n,e,t,r)},zeros:On,onesLike:qL,zerosLike:Tt,transpose:ca,softmax:Tm,logSoftmax:W1e,localResponseNormalization:Gwe,norm:jB,gather:sC,unsortedSegmentSum:NB,basicLSTMCell:zwe,multiRNNCell:jwe,movingAverage:$we,stridedSlice:qwe,topk:Xwe,scatterND:Kwe,fft:fC,ifft:Gm,rfft:dC,irfft:$B,sparseToDense:Zwe,gatherND:Qwe,diag:Jwe,dropout:e_e,hannWindow:hC,hammingWindow:XB,frame:pC,stft:KB,inTopKAsync:function(n,e,t){return void 0===t&&(t=1),De(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,f,d,h,p,g,v;return Te(this,function(m){switch(m.label){case 0:return r=I(n,"predictions","inTopK"),o=I(e,"targets","inTopK"),T(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),T(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Dt(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],T(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+t}),[4,r.data()];case 1:return a=m.sent(),[4,o.data()];case 2:for(s=m.sent(),l=(u=[a.length/i,i])[1],f=Wc("bool",c=u[0]),d=0;d<c;d++){for(p=a.subarray(h=d*l,h+l),g=[],v=0;v<p.length;v++)g.push({value:p[v],index:v});for(g.sort(function(y,x){return x.value-y.value}),f[d]=0,v=0;v<t;v++)if(g[v].index===s[d]){f[d]=1;break}}return n!==r&&r.dispose(),e!==o&&o.dispose(),[2,Lr(f,o.shape,"bool")]}})})}});function te(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){null!=t&&T("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function xC(n,e,t,r,o,i){for(var a=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,c=o.dilationWidth,l=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=o.padInfo.top,h=o.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Qe(o.outShape,t),v=g.values,m=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],x=o.outShape[3],w=0;w<o.batchSize;++w)for(var _=w*m,b=w*r[0],C=0;C<o.inChannels;++C)for(var E=0;E<o.outHeight;++E)for(var S=E*a-d,A=Math.max(0,S),D=Math.min(o.inHeight,l+S),M=_+E*y,L=0;L<o.outWidth;++L){for(var B=L*s-h,U=Math.max(0,B),G=Math.min(o.inWidth,f+B),H=p,W=0,$=0,K=A;K<D;K+=u){for(var re=b+K*r[1],ce=U;ce<G;ce+=c){var he=n[re+ce*r[2]+C];"max"===i&&he>H?H=he:"avg"===i&&(W+=he,$++)}if(isNaN(H))break}v[M+L*x+C]="avg"===i?W/$:H}return g}function QB(n,e,t,r,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);for(var a=Qe(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,g=Qe(e,t,n),v=0;v<r.batchSize;++v)for(var m=0;m<r.inChannels;++m)for(var y=0;y<r.outHeight;++y){for(var x=y*s-h,w=x;w<0;)w+=c;for(var _=Math.min(r.inHeight,f+x),b=0;b<r.outWidth;++b){for(var C=b*u-p,E=C;E<0;)E+=l;for(var S=Math.min(r.inWidth,d+C),A=Number.NEGATIVE_INFINITY,D=-1,M=w;M<_;M+=c)for(var L=M-x,B=E;B<S;B+=l){var U=B-C,G=g.get(v,M,B,m);G>A&&(A=G,D=o?i?((v*r.inHeight+M)*r.inWidth+B)*r.inChannels+m:(M*r.inWidth+B)*r.inChannels+m:L*d+U)}a.set(D,v,y,b,m)}}return a}function wC(n,e,t,r){if("linear"===t)return n.linear(e);if("relu"===t)return n.relu(e);if("elu"===t)return n.elu(e);if("relu6"===t)return n.relu6(e);if("prelu"===t)return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var D_e=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new h8(t,k),t}return ra(e,n),e.prototype.write=function(t,r,o){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&gm("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var i={};return this.data.set(i,{values:t,dtype:o}),i},e.prototype.move=function(t,r,o,i){this.data.set(t,{values:r,dtype:i})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return De(this,void 0,void 0,function(){return Te(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.complexTensors;return"complex64"===r.dtype?jb(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),o=r;if("string"===t.dtype)try{o=r.map(function(i){return cp(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Qe(t.shape,t.dtype,o)},e.prototype.makeOutput=function(t,r,o){var i=this.write(t,r,o);return k.makeTensorFromDataId(i,r,o,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return De(this,void 0,void 0,function(){var r;return Te(this,function(o){return r=oa(),t(),[2,{kernelMs:oa()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var o=this.makeOutput(null,t.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:k.keep(t.clone()),imag:k.keep(r.clone())},o},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,o){if(te(t,"slice"),Vb(t.shape,r,o)){var i=Ub(r,t.strides),a=Ee(o);return Lr(this.readSync(t.dataId).subarray(i,i+a),o,t.dtype)}for(var s=Qe(o,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(f,d){return f+r[d]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},e.prototype.stridedSlice=function(t,r,o,i){te(t,"stridedSlice");var a=Am(r,o,i);if(a.some(function(h){return 0===h}))return Lr([],a);for(var s=Qe(a,t.dtype),u=this.bufferSync(t),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),f=new Array(l.length),d=0;d<f.length;d++)f[d]=l[d]*i[d]+r[d];s.set.apply(s,[u.get.apply(u,f)].concat(l))}return s.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),o=Qe([t.size,t.size],t.dtype),i=o.values,a=0;a<r.length;a++)i[a*t.size+a]=r[a];return o.toTensor()},e.prototype.unstack=function(t,r){for(var o=t.shape[r],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(t,u,c).reshape(i);return l},e.prototype.reverse=function(t,r){te(t,"reverse");for(var o=Qe(t.shape,t.dtype),i=this.bufferSync(t),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach(function(f){return l[f]=t.shape[f]-1-l[f]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},e.prototype.concat=function(t,r){var o=this;if("complex64"===t[0].dtype){var i=t.map(function(h){return Oi(h)}),a=t.map(function(h){return Ya(h)});return Fr(this.concat(i,r),this.concat(a,r))}var s=t.map(function(h){var p=Ee(h.shape.slice(r));return h.as2D(-1,p)}),u=zc(s.map(function(h){return h.shape}),1),c=Qe(u,t[0].dtype).values;if(1===s[0].shape[0]){var l=0;s.forEach(function(h){c.set(o.readSync(h.dataId),l),l+=h.size})}else{var f=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),g=0,v=0;v<h.shape[0];++v)for(var m=v*u[1]+f,y=0;y<h.shape[1];++y)c[m+y]=p[g++];f+=h.shape[1]})}var d=zc(t.map(function(h){return h.shape}),r);return Lr(c,d,t[0].dtype)},e.prototype.neg=function(t){return te(t,"neg"),this.multiply(Oe(-1),t)},e.prototype.add=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(t,r,_r(t.dtype,r.dtype),function(o,i){return o+i})},e.prototype.addN=function(t){var r=this;te(t,"addN");for(var o=t.map(function(l){return r.readSync(l.dataId)}),i=Qe(t[0].shape,t[0].dtype),a=i.values,s=0;s<t.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},e.prototype.softmax=function(t,r){var o=tr([r],t.shape),i=this.max(t,o),a=mo(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return Lu(u,c)},e.prototype.subtract=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(t,r,_r(t.dtype,r.dtype),function(o,i){return o-i})},e.prototype.pow=function(t,r){return te([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){return Math.pow(o,i)})},e.prototype.batchMatMul=function(t,r,o,i){te([t,r],"matMul");for(var a=o?t.shape[1]:t.shape[2],s=o?t.shape[2]:t.shape[1],u=i?r.shape[1]:r.shape[2],c=t.shape[0],l=this.readSync(t.dataId),f=this.readSync(r.dataId),d=o?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=d[0],p=d[1],g=d[2],v=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=v[0],y=v[1],x=v[2],w=s*u,_=Qe([c,s,u],t.dtype),b=_.values,C=this.blockSize,E=0;E<c;E++)for(var S=0;S<s;S+=C)for(var A=0;A<u;A+=C)for(var D=0;D<a;D+=C)for(var M=Math.min(S+C,s),L=Math.min(A+C,u),B=Math.min(D+C,a),U=S;U<M;U++)for(var G=A;G<L;G++){for(var H=0,W=D;W<B;W++)H+=l[E*h+U*p+W*g]*f[W*m+G*y+E*x];b[E*w+(U*u+G)]+=H}return _.toTensor()},e.prototype.fusedBatchMatMul=function(t){var s=t.bias,u=t.activation,c=t.preluActivationWeights,l=this.batchMatMul(t.a,t.b,t.transposeA,t.transposeB);return s&&(l=this.add(l,s)),u&&(l=wC(this,l,u,c)),l},e.prototype.multiply=function(t,r){return"complex64"===t.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(t,r,_r(t.dtype,r.dtype),function(o,i){return o*i})},e.prototype.floorDiv=function(t,r){return te([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(o,i){return Math.floor(o/i)})},e.prototype.sum=function(t,r){te(t,"sum"),Vo("sum",r,t.rank);for(var o=kr(t.shape,r),a=o[1],s=On(o[0],_r(t.dtype,"int32")),u=Ee(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=0,p=0;p<u;++p)h+=l[d+p];c[f]=h}return s},e.prototype.prod=function(t,r){te(t,"sum");for(var o=kr(t.shape,r),a=o[1],s=On(o[0],_r(t.dtype,"int32")),u=Ee(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=1,p=0;p<u;++p)h*=l[d+p];c[f]=h}return s},e.prototype.unsortedSegmentSum=function(t,r,o){te(t,"unsortedSegmentSum");for(var i=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=Oe(s,"int32"),c=IB(u,r).asType("float32").mul(t).sum(0);i.push(c)}return Fu(i)},e.prototype.argMin=function(t,r){te(t,"argMin");var o=[r];Vo("argMin",o,t.rank);for(var i=kr(t.shape,o),s=i[1],u=On(i[0],"int32"),c=Ee(s),l=this.readSync(u.dataId),f=this.readSync(t.dataId),d=0;d<l.length;++d){for(var h=d*c,p=f[h],g=0,v=0;v<c;++v){var m=f[h+v];m<p&&(p=m,g=v)}l[d]=g}return u},e.prototype.argMax=function(t,r){te(t,"argMax");var o=[r];Vo("argMax",o,t.rank);for(var i=kr(t.shape,o),s=i[1],u=On(i[0],"int32"),c=Ee(s),l=this.readSync(u.dataId),f=this.readSync(t.dataId),d=0;d<l.length;++d){for(var h=d*c,p=f[h],g=0,v=0;v<c;++v){var m=f[h+v];m>p&&(p=m,g=v)}l[d]=g}return u},e.prototype.cumsum=function(t,r,o,i){if(te(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=_r(t.dtype,"int32"),s=On(t.shape,a),u=this.readSync(s.dataId),c=this.readSync(t.dataId),l=t.shape[t.rank-1],f=i?function(v,m){return v+l-m-1}:function(v,m){return v+m},d=0;d<c.length;d+=l)for(var h=0;h<l;h++){var p=f(d,h);if(0===h)u[p]=o?0:c[p];else{var g=f(d,h-1);u[p]=o?c[g]+u[g]:c[p]+u[g]}}return s},e.prototype.equal=function(t,r){return te([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o===i?1:0})},e.prototype.notEqual=function(t,r){return te([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o!==i?1:0})},e.prototype.less=function(t,r){return te([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o<i?1:0})},e.prototype.lessEqual=function(t,r){return te([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o<=i?1:0})},e.prototype.greater=function(t,r){return te([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o>i?1:0})},e.prototype.greaterEqual=function(t,r){return te([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o>=i?1:0})},e.prototype.logicalNot=function(t){te(t,"logicalNot");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return te([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o&&i})},e.prototype.logicalOr=function(t,r){return te([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(o,i){return o||i})},e.prototype.select=function(t,r,o){te([t,r,o],"select");for(var i=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=On(r.shape,_r(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,f=0===t.rank||t.rank>1||1===r.rank?1:Ee(r.shape.slice(1)),d=0;d<i.length;d++)for(var h=0;h<f;h++)c[l++]=1===i[d]?a[d]:s[d];return u},e.prototype.where=function(t){te([t],"where");var r=this.readSync(t.dataId);return Xb(t.shape,r)},e.prototype.topk=function(t,r,o){return te(t,"topk"),w8(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){te(t,"min"),Vo("min",r,t.rank);for(var o=kr(t.shape,r),a=o[1],s=On(o[0],t.dtype),u=Ee(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p){var g=l[d+p];g<h&&(h=g)}c[f]=h}return s},e.prototype.minimum=function(t,r){return te([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){return Math.min(o,i)})},e.prototype.mod=function(t,r){return te([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},e.prototype.max=function(t,r){te(t,"max"),Vo("max",r,t.rank);for(var o=kr(t.shape,r),a=o[1],s=On(o[0],t.dtype),u=Ee(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p){var g=l[d+p];g>h&&(h=g)}c[f]=h}return s},e.prototype.maximum=function(t,r){return te([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){return Math.max(o,i)})},e.prototype.all=function(t,r){te(t,"all"),Vo("all",r,t.rank);for(var o=kr(t.shape,r),a=o[1],s=On(o[0],t.dtype),u=Ee(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p)h=h&&l[d+p];c[f]=h}return s},e.prototype.any=function(t,r){te(t,"any"),Vo("any",r,t.rank);for(var o=kr(t.shape,r),a=o[1],s=On(o[0],t.dtype),u=Ee(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p)h=h||l[d+p];c[f]=h}return s},e.prototype.squaredDifference=function(t,r){return te([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){var a=o-i;return a*a})},e.prototype.ceil=function(t){te(t,"ceil");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.floor=function(t){te(t,"floor");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.sign=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=r[i]<0?-1:r[i]>0?1:0;return this.makeOutput(o,t.shape,"float32")},e.prototype.isNaN=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.isInf=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.isFinite=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},e.prototype.round=function(t){te(t,"round");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);o[i]=r[i]-a<.5?Math.floor(r[i]):r[i]-a>.5?Math.ceil(r[i]):a%2==0?a:a+1}return this.makeOutput(o,t.shape,"float32")},e.prototype.exp=function(t){te(t,"exp");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.expm1=function(t){te(t,"expm1");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.log=function(t){te(t,"log");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.log1p=function(t){te(t,"log1p");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log1p(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.sqrt=function(t){te(t,"sqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.sqrt(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.rsqrt=function(t){te(t,"rsqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/Math.sqrt(r[i]);return this.makeOutput(o,t.shape,"float32")},e.prototype.reciprocal=function(t){te(t,"reciprocal");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){te(t,"relu");for(var r=On(t.shape,t.dtype),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},e.prototype.relu6=function(t){te(t,"relu");for(var r=On(t.shape,t.dtype),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},e.prototype.prelu=function(t,r){return te([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){return o<0?i*o:o})},e.prototype.elu=function(t){te(t,"elu");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){te([t,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},e.prototype.selu=function(t){te(t,"selu");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(i,t.shape,"float32")},e.prototype.clip=function(t,r,o){te(t,"clip");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<t.size;++i)r[i]=Math.hypot(o[2*i],o[2*i+1]);return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){te(t,"int");for(var r=new Int32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){te(t,"sigmoid");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){te(t,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var l,s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]);l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,t.shape,"float32")},e.prototype.sin=function(t){te(t,"sin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){te(t,"cos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){te(t,"tan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){te(t,"asin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){te(t,"acos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){te(t,"atan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return te([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(o,i){return Math.atan2(o,i)})},e.prototype.sinh=function(t){te(t,"sinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){te(t,"cosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){te(t,"tanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=tL(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){te(t,"asinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){te(t,"acosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){te(t,"atanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){te(t,"erf");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){void 0===r&&(r=0),te(t,"step");for(var o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a];o[a]=isNaN(s)?NaN:s>0?1:r}return this.makeOutput(o,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.conv2d(t.input,t.filter,t.convInfo);return a&&(c=this.add(c,a)),s&&(c=wC(this,c,s,u)),c},e.prototype.conv2d=function(t,r,o){te([t,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,f="channelsLast"===o.dataFormat,d=Qe(o.outShape,t.dtype),h=t.strides[0],p=f?t.strides[1]:t.strides[2],g=f?t.strides[2]:1,v=f?1:t.strides[1],m=d.strides[0],y=f?d.strides[1]:d.strides[2],x=f?d.strides[2]:1,w=f?1:d.strides[1],_=this.readSync(t.dataId),b=this.readSync(r.dataId),C=d.values,E=0;E<o.batchSize;++E)for(var S=E*h,A=E*m,D=0;D<o.outHeight;++D)for(var M=A+D*y,L=D*o.strideHeight-l,B=0;B<i;B++){var U=L+B*s;if(!(U<0||U>=o.inHeight))for(var G=B*r.strides[0],H=S+U*p,W=0;W<o.outWidth;++W)for(var $=M+W*x,K=W*o.strideWidth-c,re=0;re<a;re++){var ce=K+re*u;if(!(ce<0||ce>=o.inWidth))for(var he=H+ce*g,Ce=G+re*r.strides[1],Re=0;Re<o.inChannels;++Re){for(var Fe=_[he+Re*v],Pe=0;Pe<o.outChannels;++Pe)C[$+Pe*w]+=Fe*b[Ce+Pe];Ce+=o.outChannels}}}return d.toTensor()},e.prototype.conv3d=function(t,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,f=o.padInfo.front,d=o.padInfo.left,h=o.padInfo.top,p=Qe(o.outShape,t.dtype),g=this.readSync(t.dataId),v=this.readSync(r.dataId),m=p.values,y=0;y<o.batchSize;++y)for(var x=y*t.strides[0],w=y*p.strides[0],_=0;_<o.outDepth;++_)for(var b=w+_*p.strides[1],C=_*o.strideDepth-f,E=0;E<i;E++){var S=C+E*u;if(!(S<0||S>=o.inDepth))for(var A=E*r.strides[0],D=x+S*t.strides[1],M=0;M<o.outHeight;++M)for(var L=b+M*p.strides[2],B=M*o.strideHeight-h,U=0;U<a;U++){var G=B+U*c;if(!(G<0||G>=o.inHeight))for(var H=A+U*r.strides[1],W=D+G*t.strides[2],$=0;$<o.outWidth;++$)for(var K=L+$*o.outChannels,re=$*o.strideWidth-d,ce=0;ce<s;ce++){var he=re+ce*l;if(!(he<0||he>=o.inWidth))for(var Re=W+he*o.inChannels,Fe=H+ce*r.strides[2],Pe=0;Pe<o.inChannels;++Pe){for(var Se=g[Re+Pe],Xe=0;Xe<o.outChannels;++Xe)m[K+Xe]+=Se*v[Fe+Xe];Fe+=o.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,r,o){te([t,r],"conv2dDerInput");for(var i=Qe(o.inShape,"float32"),a=i.values,s=this.readSync(t.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],f=c[1],d=c[2],h=o.batchSize,p=o.filterHeight,g=o.filterWidth,v=o.inChannels,m=o.inHeight,y=o.inWidth,x=o.outChannels,w=o.outHeight,_=o.outWidth,b=o.strideHeight,C=o.strideWidth,S=p-1-o.padInfo.top,A=g-1-o.padInfo.left,D="channelsLast"===o.dataFormat,M=i.strides[0],L=D?i.strides[1]:i.strides[2],B=D?i.strides[2]:1,U=D?1:i.strides[1],G=t.strides[0],H=D?t.strides[1]:t.strides[2],W=D?t.strides[2]:1,$=D?1:t.strides[1],K=0;K<h;++K)for(var re=0;re<v;++re)for(var ce=0;ce<m;++ce)for(var he=ce-S,Ce=Math.max(0,Math.ceil(he/b)),Re=Math.min(w,(p+he)/b),Fe=0;Fe<y;++Fe){for(var Pe=Fe-A,Se=Math.max(0,Math.ceil(Pe/C)),Xe=Math.min(_,(g+Pe)/C),nt=0,Ue=Ce;Ue<Re;++Ue)for(var it=Ue*b-he,rt=Se;rt<Xe;++rt)for(var Ot=G*K+H*Ue+W*rt,Mt=l*(p-1-it)+f*(g-1-(rt*C-Pe))+d*re,nn=0;nn<x;++nn)nt+=s[Ot+$*nn]*u[Mt+nn];a[M*K+L*ce+B*Fe+U*re]=nt}return i.toTensor()},e.prototype.conv3dDerInput=function(t,r,o){for(var i=Qe(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],f=s[3],d=this.readSync(t.dataId),h=t.strides,p=h[0],g=h[1],v=h[2],m=h[3],y=this.readSync(r.dataId),x=r.strides,w=x[0],_=x[1],b=x[2],C=x[3],E=o.batchSize,S=o.filterDepth,A=o.filterHeight,D=o.filterWidth,M=o.inChannels,L=o.inDepth,B=o.inHeight,U=o.inWidth,G=o.outChannels,H=o.outDepth,W=o.outHeight,$=o.outWidth,K=o.strideDepth,re=o.strideHeight,ce=o.strideWidth,he=S-1-o.padInfo.front,Ce=A-1-o.padInfo.top,Re=D-1-o.padInfo.left,Fe=0;Fe<E;++Fe)for(var Pe=0;Pe<M;++Pe)for(var Se=0;Se<L;++Se)for(var Xe=Se-he,nt=Math.max(0,Math.ceil(Xe/K)),Ue=Math.min(H,(S+Xe)/K),it=0;it<B;++it)for(var rt=it-Ce,Ot=Math.max(0,Math.ceil(rt/re)),Mt=Math.min(W,(A+rt)/re),nn=0;nn<U;++nn){for(var Ho=nn-Re,Br=Math.max(0,Math.ceil(Ho/ce)),Cr=Math.min($,(D+Ho)/ce),di=0,to=nt;to<Ue;++to)for(var yo=to*K-Xe,da=Ot;da<Mt;++da)for(var ha=da*re-rt,pa=Br;pa<Cr;++pa)for(var Hp=p*Fe+g*to+v*da+m*pa,ga=w*(S-1-yo)+_*(A-1-ha)+b*(D-1-(pa*ce-Ho))+C*Pe,is=0;is<G;++is)di+=d[Hp+is]*y[ga+is];a[u*Fe+c*Se+l*it+f*nn+Pe]=di}return i.toTensor()},e.prototype.conv2dDerFilter=function(t,r,o){te([t,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c="channelsLast"===o.dataFormat,l=Qe(o.filterShape,"float32"),f=o.padInfo.left,d=o.padInfo.top,h=this.bufferSync(t),p=this.bufferSync(r),g=0;g<s;++g)for(var v=Math.max(0,Math.ceil((d-g)/i)),m=Math.min(o.outHeight,(o.inHeight+d-g)/i),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((f-y)/a)),w=Math.min(o.outWidth,(o.inWidth+f-y)/a),_=0;_<o.inChannels;++_)for(var b=0;b<o.outChannels;++b){for(var C=0,E=0;E<o.batchSize;++E)for(var S=v;S<m;++S)for(var A=g+S*i-d,D=x;D<w;++D){var M=y+D*a-f;C+=c?h.get(E,A,M,_)*p.get(E,S,D,b):h.get(E,_,A,M)*p.get(E,b,S,D)}l.set(C,g,y,_,b)}return l.toTensor()},e.prototype.conv3dDerFilter=function(t,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,f=Qe(o.filterShape,"float32"),d=f.values,h=f.strides,p=h[0],g=h[1],v=h[2],m=h[3],y=this.readSync(r.dataId),x=r.strides,w=x[0],_=x[1],b=x[2],C=x[3],E=this.readSync(t.dataId),S=t.strides,A=S[0],D=S[1],M=S[2],L=S[3],B=o.padInfo.front,U=o.padInfo.left,G=o.padInfo.top,H=0;H<u;++H)for(var W=Math.max(0,Math.ceil((B-H)/i)),$=Math.min(o.outDepth,(o.inDepth+B-H)/i),K=H*p,re=0;re<c;++re)for(var ce=Math.max(0,Math.ceil((G-re)/a)),he=Math.min(o.outHeight,(o.inHeight+G-re)/a),Ce=re*g+K,Re=0;Re<l;++Re)for(var Fe=Math.max(0,Math.ceil((U-Re)/s)),Pe=Math.min(o.outWidth,(o.inWidth+U-Re)/s),Se=Re*v+Ce,Xe=0;Xe<o.inChannels;++Xe)for(var nt=Xe*m+Se,Ue=0;Ue<o.outChannels;++Ue){for(var it=0,rt=0;rt<o.batchSize;++rt)for(var Ot=rt*A,Mt=rt*w,nn=W;nn<$;++nn)for(var Ho=(H+nn*i-B)*D+Ot,Br=nn*_+Mt,Cr=ce;Cr<he;++Cr)for(var di=(re+Cr*a-G)*M+Ho,to=Cr*b+Br,yo=Fe;yo<Pe;++yo)it+=E[(Re+yo*s-U)*L+di+Xe]*y[yo*C+to+Ue];d[nt+Ue]=it}return f.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.depthwiseConv2D(t.input,t.filter,t.convInfo);return a&&(c=this.add(c,a)),s&&(c=wC(this,c,s,u)),c},e.prototype.depthwiseConv2D=function(t,r,o){te([t,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,f=o.outChannels/o.inChannels,d=Qe(o.outShape,t.dtype),h=this.readSync(t.dataId),p=this.readSync(r.dataId),g=d.values,v=0;v<o.batchSize;++v)for(var m=v*t.strides[0],y=v*d.strides[0],x=0;x<o.outHeight;++x)for(var w=y+x*d.strides[1],_=x*o.strideHeight-c,b=0;b<i;++b){var C=_+b*s;if(!(C<0||C>=o.inHeight))for(var E=b*r.strides[0],S=m+C*t.strides[1],A=0;A<o.outWidth;++A)for(var D=w+A*d.strides[2],M=A*o.strideWidth-l,L=0;L<a;++L){var B=M+L*u;if(!(B<0||B>=o.inWidth))for(var G=S+B*o.inChannels,H=D,W=E+L*r.strides[1],$=0;$<o.inChannels;++$){for(var K=h[G+$],re=0;re<f;++re)g[H+re]+=K*p[W+re];H+=f,W+=f}}}return d.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,o){te([t,r],"depthwiseConv2DDerInput");for(var i=Qe(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],f=this.readSync(t.dataId),d=t.strides,h=d[0],p=d[1],g=d[2],v=this.readSync(r.dataId),m=r.strides,y=m[0],x=m[1],w=m[2],_=o.batchSize,b=o.filterHeight,C=o.filterWidth,E=o.inChannels,S=o.inHeight,A=o.inWidth,M=o.outHeight,L=o.outWidth,B=o.strideHeight,U=o.strideWidth,G=b-1-o.padInfo.top,H=C-1-o.padInfo.left,W=o.outChannels/E,$=0;$<_;++$)for(var K=0;K<E;++K)for(var re=0;re<S;++re)for(var ce=re-G,he=Math.max(0,Math.ceil(ce/B)),Ce=Math.min(M,(b+ce)/B),Re=0;Re<A;++Re){for(var Fe=Re-H,Pe=Math.max(0,Math.ceil(Fe/U)),Se=Math.min(L,(C+Fe)/U),Xe=0,nt=he;nt<Ce;++nt)for(var Ue=nt*B-ce,it=Pe;it<Se;++it)for(var rt=h*$+p*nt+g*it,Ot=y*(b-1-Ue)+x*(C-1-(it*U-Fe))+w*K,Mt=0;Mt<W;++Mt)Xe+=f[rt+(K*W+Mt)]*v[Ot+Mt];a[u*$+c*re+l*Re+K]=Xe}return i.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,o){te([t,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=Qe(o.filterShape,"float32"),l=o.padInfo.left,f=o.padInfo.top,d=o.outChannels/o.inChannels,h=this.bufferSync(t),p=this.bufferSync(r),g=0;g<s;++g)for(var v=Math.max(0,Math.ceil((f-g)/i)),m=Math.min(o.outHeight,(o.inHeight+f-g)/i),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((l-y)/a)),w=Math.min(o.outWidth,(o.inWidth+l-y)/a),_=0;_<o.outChannels;++_){for(var b=Math.trunc(_/d),C=_%d,E=0,S=0;S<o.batchSize;++S)for(var A=v;A<m;++A)for(var D=g+A*i-f,M=x;M<w;++M)E+=h.get(S,D,y+M*a-l,b)*p.get(S,A,M,_);c.set(E,g,y,b,C)}return c.toTensor()},e.prototype.tile=function(t,r){return te(t,"tile"),x8(this.bufferSync(t),r)},e.prototype.pad=function(t,r,o){te(t,"pad");var i=r.map(function(d,h){return d[0]+t.shape[h]+d[1]}),a=r.map(function(d){return d[0]}),s=this.bufferSync(t),u=Qe(i,t.dtype);0!==o&&u.values.fill(o);for(var c=0;c<t.size;c++){var l=s.indexToLoc(c),f=l.map(function(d,h){return d+a[h]});u.set.apply(u,[s.get.apply(s,l)].concat(f))}return u.toTensor()},e.prototype.gather=function(t,r,o){te([t,r],"gather");var i=t.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Qe(i,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c),f=l.slice();f[o]=a[l[o]];var d=u.locToIndex(f);s.values[c]=u.values[d]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,r,o){te([t],"batchToSpaceND");var i=r.reduce(function(f,d){return f*d}),a=xm(t.shape,r,i),s=wm(a.length,r.length),u=_m(t.shape,r,i),c=ZL(o,r.length),l=QL(u,o,r.length);return ca(t.reshape(a),s).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(t,r,o){te([t],"spaceToBatchND");var i=r.reduce(function(d,h){return d*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=xm(u.shape,r,i,!1),l=wm(c.length,r.length,!1),f=_m(u.shape,r,i,!1);return ca(u.reshape(c),l).reshape(f)},e.prototype.maxPool=function(t,r){return te(t,"maxPool"),xC(this.readSync(t.dataId),0,t.dtype,t.strides,r,"max").toTensor()},e.prototype.maxPoolBackprop=function(t,r,o,i){te([r,o],"maxPoolBackprop");for(var a=this.readSync(r.dataId),s=Qe(i.outShape,r.dtype,QB(a,r.shape,r.dtype,i).values),u=i.strideHeight,c=i.strideWidth,l=i.dilationHeight,f=i.dilationWidth,d=i.effectiveFilterHeight,h=i.effectiveFilterWidth,p=h-1-i.padInfo.left,g=d-1-i.padInfo.top,v=Qe(r.shape,"float32"),m=this.bufferSync(t),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var w=0;w<i.inHeight;++w)for(var _=0;_<i.inWidth;++_){for(var b=w-g,C=_-p,E=0,S=0;S<d;S+=l){var A=(b+S)/u;if(!(A<0||A>=i.outHeight||Math.floor(A)!==A))for(var D=0;D<h;D+=f){var M=(C+D)/c;if(!(M<0||M>=i.outWidth||Math.floor(M)!==M)){var L=d*h-1-s.get(y,A,M,x)===S*h+D?1:0;0!==L&&(E+=m.get(y,A,M,x)*L)}}}v.set(E,y,w,_,x)}return v.toTensor()},e.prototype.avgPoolBackprop=function(t,r,o){te([t,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,f=o.effectiveFilterHeight,d=o.effectiveFilterWidth,h=d-1-o.padInfo.left,p=f-1-o.padInfo.top,g=Qe(r.shape,"float32"),v=1/(s*u),m=this.bufferSync(t),y=0;y<o.batchSize;++y)for(var x=0;x<o.inChannels;++x)for(var w=0;w<o.inHeight;++w)for(var _=0;_<o.inWidth;++_){for(var b=w-p,C=_-h,E=0,S=0;S<f;S+=c){var A=(b+S)/i;if(!(A<0||A>=o.outHeight||Math.floor(A)!==A))for(var D=0;D<d;D+=l){var M=(C+D)/a;M<0||M>=o.outWidth||Math.floor(M)!==M||(E+=m.get(y,A,M,x))}}g.set(E*v,y,w,_,x)}return g.toTensor()},e.prototype.pool3d=function(t,r,o){te(t,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,m="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(t.dataId),x=Qe(r.outShape,t.dtype),w=x.values,_=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],b=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],E=r.outShape[4],S=0;S<r.batchSize;++S)for(var A=S*_,D=S*t.strides[0],M=0;M<r.inChannels;++M)for(var L=0;L<r.outDepth;++L){for(var B=L*i-p,U=B;U<0;)U+=u;for(var G=Math.min(r.inDepth,f+B),H=A+L*b,W=0;W<r.outHeight;++W){for(var $=W*a-g,K=$;K<0;)K+=c;for(var re=Math.min(r.inHeight,d+$),ce=H+W*C,he=0;he<r.outWidth;++he){for(var Ce=he*s-v,Re=Ce;Re<0;)Re+=l;for(var Fe=Math.min(r.inWidth,h+Ce),Pe=ce+he*E,Se=m,Xe=0,nt=0,Ue=U;Ue<G;Ue+=u){for(var it=D+Ue*t.strides[1],rt=K;rt<re;rt+=c){for(var Ot=it+rt*t.strides[2],Mt=Re;Mt<Fe;Mt+=l){var nn=y[Ot+Mt*t.strides[3]+M];if("max"===o&&nn>Se?Se=nn:"avg"===o&&(Xe+=nn,nt++),isNaN(Se))break}if(isNaN(Se))break}if(isNaN(Se))break}w[Pe+M]="avg"===o?Xe/nt:Se}}}return x.toTensor()},e.prototype.avgPool3d=function(t,r){return te(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,o){te([t,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,f=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,g=o.effectiveFilterHeight,v=o.effectiveFilterWidth,m=p-1-o.padInfo.front,y=v-1-o.padInfo.left,x=g-1-o.padInfo.top,w=Qe(r.shape,"float32"),_=1/(u*c*l),b=this.bufferSync(t),C=0;C<o.batchSize;++C)for(var E=0;E<o.inChannels;++E)for(var S=0;S<o.inDepth;++S)for(var A=0;A<o.inHeight;++A)for(var D=0;D<o.inWidth;++D){for(var M=S-m,L=A-x,B=D-y,U=0,G=0;G<p;G+=f){var H=(M+G)/i;if(!(H<0||H>=o.outDepth||Math.floor(H)!==H))for(var W=0;W<g;W+=d){var $=(L+W)/a;if(!($<0||$>=o.outHeight||Math.floor($)!==$))for(var K=0;K<v;K+=h){var re=(B+K)/s;re<0||re>=o.outWidth||Math.floor(re)!==re||(U+=b.get(C,H,$,re,E))}}}w.set(U*_,C,S,A,D,E)}return w.toTensor()},e.prototype.maxPool3d=function(t,r){return te(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var o=Qe(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,m=this.bufferSync(t),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var w=0;w<r.outDepth;++w){for(var _=w*i-p,b=_;b<0;)b+=u;for(var C=Math.min(r.inDepth,f+_),E=0;E<r.outHeight;++E){for(var S=E*a-g,A=S;A<0;)A+=c;for(var D=Math.min(r.inHeight,d+S),M=0;M<r.outWidth;++M){for(var L=M*s-v,B=L;B<0;)B+=l;for(var U=Math.min(r.inWidth,h+L),G=Number.NEGATIVE_INFINITY,H=-1,W=b;W<C;W+=u)for(var $=W-_,K=A;K<D;K+=c)for(var re=K-S,ce=B;ce<U;ce+=l){var he=ce-L,Ce=m.get(y,W,K,ce,x);Ce>=G&&(G=Ce,H=$*d*h+re*d+he)}o.set(H,y,w,E,M,x)}}}return o.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,o,i){te([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,f=i.dilationHeight,d=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=h-1-i.padInfo.front,m=g-1-i.padInfo.left,y=p-1-i.padInfo.top,x=Qe(r.shape,"float32"),w=this.bufferSync(a),_=this.bufferSync(t),b=0;b<i.batchSize;++b)for(var C=0;C<i.inChannels;++C)for(var E=0;E<i.inDepth;++E)for(var S=0;S<i.inHeight;++S)for(var A=0;A<i.inWidth;++A){for(var D=E-v,M=S-y,L=A-m,B=0,U=0;U<h;U+=l){var G=(D+U)/s;if(!(G<0||G>=i.outDepth||Math.floor(G)!==G))for(var H=0;H<p;H+=f){var W=(M+H)/u;if(!(W<0||W>=i.outHeight||Math.floor(W)!==W))for(var $=0;$<g;$+=d){var K=(L+$)/c;if(!(K<0||K>=i.outWidth||Math.floor(K)!==K)){var re=h*p*g-1-w.get(b,G,W,K,C)===U*p*g+H*g+$?1:0;0!==re&&(B+=_.get(b,G,W,K,C)*re)}}}}x.set(B,b,E,S,A,C)}return x.toTensor()},e.prototype.cast=function(t,r){return Gb(t,r,this)},e.prototype.reshape=function(t,r){return Om(t,r)},e.prototype.avgPool=function(t,r){return te(t,"avgPool"),te(t,"maxPool"),xC(this.readSync(t.dataId),0,t.dtype,t.strides,r,"avg").toTensor().toFloat()},e.prototype.resizeBilinear=function(t,r,o,i){te(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=this.readSync(t.dataId),d=new Float32Array(Ee([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=0,v=h[0]/p[0],m=h[1]/p[1],y=0;y<s;y++)for(var x=0;x<r;x++)for(var w=v*x,_=Math.floor(w),b=w-_,C=Math.min(u-1,Math.ceil(w)),E=y*t.strides[0]+_*t.strides[1],S=y*t.strides[0]+C*t.strides[1],A=0;A<o;A++)for(var D=m*A,M=Math.floor(D),L=D-M,B=Math.min(c-1,Math.ceil(D)),U=E+M*t.strides[2],G=S+M*t.strides[2],H=E+B*t.strides[2],W=S+B*t.strides[2],$=0;$<l;$++){var K=f[U+$],re=f[G+$],ce=K+(f[H+$]-K)*L;d[g++]=ce+(re+(f[W+$]-re)*L-ce)*b}return Lr(d,[s,r,o,l])},e.prototype.resizeBilinearBackprop=function(t,r,o){te([t,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,f=l[1],d=l[2],h=new Float32Array(a*s*u*c),p=[o&&f>1?s-1:s,o&&d>1?u-1:u],g=[o&&f>1?f-1:f,o&&d>1?d-1:d],v=p[0]/g[0],m=p[1]/g[1],y=this.readSync(t.dataId),x=0,w=0;w<a;w++)for(var _=w*r.strides[0],b=0;b<f;b++)for(var C=b*v,E=Math.floor(C),S=Math.min(Math.ceil(C),s-1),A=_+E*r.strides[1],D=_+S*r.strides[1],M=C-E,L=1-M,B=0;B<d;B++)for(var U=B*m,G=Math.floor(U),H=Math.min(Math.ceil(U),u-1),W=U-G,$=1-W,K=A+G*r.strides[2],re=A+H*r.strides[2],ce=D+G*r.strides[2],he=D+H*r.strides[2],Ce=L*$,Re=L*W,Fe=M*$,Pe=M*W,Se=0;Se<c;Se++){var Xe=y[x++];h[K+Se]+=Xe*Ce,h[re+Se]+=Xe*Re,h[ce+Se]+=Xe*Fe,h[he+Se]+=Xe*Pe}return Za(h,[a,u,s,c],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,o,i){te(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=this.readSync(t.dataId),d=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=h[0]/p[0],v=h[1]/p[1],m=0,y=0;y<s;y++)for(var x=y*t.strides[0],w=0;w<r;w++)for(var _=g*w,b=x+Math.min(u-1,i?Math.round(_):Math.floor(_))*t.strides[1],C=0;C<o;C++)for(var E=v*C,S=b+Math.min(c-1,i?Math.round(E):Math.floor(E))*t.strides[2],A=0;A<l;A++)d[m++]=f[S+A];return Lr(d,[s,r,o,l],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,o){te([t,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,f=l[1],d=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(t.dataId),g=[o&&f>1?s-1:s,o&&d>1?u-1:u],v=[o&&f>1?f-1:f,o&&d>1?d-1:d],m=g[0]/v[0],y=g[1]/v[1],x=1/m,w=1/y,_=2*Math.ceil(x)+2,b=2*Math.ceil(w)+2,C=0;C<a;C++)for(var E=C*r.strides[0],S=0;S<s;S++)for(var A=E+S*r.strides[1],D=Math.floor(S*x),M=Math.floor(D-_/2),L=0;L<u;L++)for(var B=A+L*r.strides[2],U=Math.floor(L*w),G=Math.floor(U-b/2),H=0;H<c;H++){for(var W=0,$=0;$<_;$++){var K=$+M;if(!(K<0||K>=f)){var re=E+K*t.strides[1],ce=K*m;if(S===Math.min(s-1,o?Math.round(ce):Math.floor(ce)))for(var he=0;he<b;he++){var Ce=he+G;if(!(Ce<0||Ce>=d)){var Re=re+Ce*t.strides[2],Fe=Ce*y;L===Math.min(u-1,o?Math.round(Fe):Math.floor(Fe))&&(W+=p[Re+H])}}}}h[B+H]=W}return Za(h,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,o,i,a,s){te([t,r,o,a,s],"batchNorm");for(var u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),f=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=d.length,g=f.length,v=l.length,m=c.length,y=0,x=0,w=0,_=0,b=0;b<u.length;++b)h[b]=d[y++]+(u[b]-c[x++])*f[w++]/Math.sqrt(l[_++]+i),y>=p&&(y=0),x>=m&&(x=0),w>=g&&(w=0),_>=v&&(_=0);return Za(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,o,i,a){te(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,c=this.readSync(t.dataId),l=t.size,f=new Float32Array(l);function d(v){for(var m=v%s,y=v-m+Math.max(0,m-r),x=v-m+Math.min(m+r,u),w=0;y<=x;y++){var _=c[y];w+=_*_}return w}for(var h=0;h<l;h++){var p=d(h),g=c[h]*Math.pow(o+i*p,-a);f[h]=g}return Za(f,t.shape)},e.prototype.LRNGrad=function(t,r,o,i,a,s,u){te(t,"LRNGrad");for(var c=t.shape[3],l=this.readSync(t.dataId),f=this.readSync(r.dataId),d=this.readSync(o.dataId),h=new Float32Array(t.size),p=t.size,g=0;g<p;g++){for(var v=g%c,m=g-v+Math.max(0,v-i),y=g-v+Math.min(c,v+i+1),x=0,w=m;w<y;w++)x+=Math.pow(f[w],2);for(x=s*x+a,w=m;w<y;w++){var _=-2*s*u*f[w]*d[g]/x;g===w&&(_+=Math.pow(x,-u)),h[w]+=_*=l[g]}}return Za(h,t.shape)},e.prototype.multinomial=function(t,r,o,i){te(t,"multinomial");for(var a=r?t:Tm(t),s=a.shape[0],u=a.shape[1],c=On([s,o],"int32"),l=this.readSync(c.dataId),f=this.readSync(a.dataId),d=0;d<s;++d){var h=d*u,p=new Float32Array(u-1);p[0]=f[h];for(var g=1;g<p.length;++g)p[g]=p[g-1]+f[h+g];for(var v=Lm(i.toString()),m=d*o,y=0;y<o;++y){var x=v();l[m+y]=p.length;for(var w=0;w<p.length;w++)if(x<p[w]){l[m+y]=w;break}}}return c},e.prototype.oneHot=function(t,r,o,i){te(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(i);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return jc(a,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,o,i,a){return te(t,"nonMaxSuppression"),$b(this.readSync(t.dataId),this.readSync(r.dataId),o,i,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var o=t.shape[0],i=t.shape[1],a=Qe(t.shape,"float32"),s=Qe(t.shape,"float32"),u=Oi(t).as2D(o,i),c=Ya(t).as2D(o,i),l=0;l<o;l++)for(var f=u.slice([l,0],[1,i]),d=c.slice([l,0],[1,i]),h=Fr(f,d),p=this.readSync(this.fftImpl(h,r).dataId),g=0;g<i;g++){var v=g8(p,g);a.values[l*i+g]=v.real,s.values[l*i+g]=v.imag}return Fr(a.toTensor(),s.toTensor()).as2D(o,i)},e.prototype.fftImpl=function(t,r){var o=t.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(t.shape[0],t.shape[1]);return r&&(a=Fr(Oi(a).div(Oe(i)),Ya(a).div(Oe(i)))),a}var s=this.readSync(t.dataId),u=function(c){for(var l=new Float32Array(c.length/2),f=new Float32Array(c.length/2),d=0;d<c.length;d+=2)l[d/2]=c[d],f[d/2]=c[d+1];return{real:l,imag:f}}(this.fourierTransformByMatmul(s,i,r));return Fr(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,r,o){if(1===r)return t;var i=this.readSync(t.dataId),a=r/2,s=function(m){for(var y=Math.ceil(m.length/4),x=new Float32Array(y),w=new Float32Array(y),_=0;_<m.length;_+=4)x[Math.floor(_/4)]=m[_],w[Math.floor(_/4)]=m[_+1];return{real:x,imag:w}}(i),u=Fr(s.real,s.imag).as1D(),c=function(m){for(var y=Math.floor(m.length/4),x=new Float32Array(y),w=new Float32Array(y),_=2;_<m.length;_+=4)x[Math.floor(_/4)]=m[_],w[Math.floor(_/4)]=m[_+1];return{real:x,imag:w}}(i),l=Fr(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var f=function(m,y){for(var x=new Float32Array(m/2),w=new Float32Array(m/2),_=0;_<Math.ceil(m/2);_++){var b=(y?2:-2)*Math.PI*(_/m);x[_]=Math.cos(b),w[_]=Math.sin(b)}return{real:x,imag:w}}(r,o),d=Fr(f.real,f.imag).mul(l),h=u.add(d),p=u.sub(d),g=Oi(h).concat(Oi(p)),v=Ya(h).concat(Ya(p));return Fr(g,v).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=z1e(a*c,r,o),f=g8(t,c);s+=f.real*l.real-f.imag*l.imag,u+=f.real*l.imag+f.imag*l.real}o&&(s/=r,u/=r),G1e(i,s,u,a)}return i},e.prototype.depthToSpace=function(t,r,o){T("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],c=a*r,l=s*r,f=u/(r*r),d=this.readSync(t.dataId),h=new Float32Array(i*c*l*f),p=0,g=0;g<i;++g)for(var v=0;v<c;++v)for(var m=Math.floor(v/r),y=v%r,x=0;x<l;++x)for(var w=Math.floor(x/r),_=(y*r+x%r)*f,b=0;b<f;++b)h[p++]=d[b+_+u*(w+s*(m+a*g))];return Za(h,[i,c,l,f])},e.prototype.broadcastedBinaryOp=function(t,r,o,i){var a=yt(t.shape,r.shape),s=Qe(a,o),u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=Vs(t.shape,a),f=Vs(r.shape,a),d=s.values;if(l.length+f.length===0)for(var h=0;h<d.length;++h)d[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(t),g=this.bufferSync(r),v=function(m){var y=s.indexToLoc(m),x=y.slice(-t.rank);l.forEach(function(C){return x[C]=0});var w=p.locToIndex(x),_=y.slice(-r.rank);f.forEach(function(C){return _[C]=0});var b=g.locToIndex(_);d[m]=i(u[w],c[b])};for(h=0;h<d.length;++h)v(h)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,o){var i=yt(t.shape,r.shape),a=Qe(i,"float32"),s=Qe(i,"float32"),u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=Vs(t.shape,i),f=Vs(r.shape,i),d=a.values,h=s.values;if(l.length+f.length===0)for(var p=0;p<d.length;p++){var g=p%u.length,v=p%c.length,m=o(u[2*g],u[2*g+1],c[2*v],c[2*v+1]);d[p]=m.real,h[p]=m.imag}else{var y=this.bufferSync(this.data.get(t.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(_){var b=a.indexToLoc(_),C=b.slice(-t.rank);l.forEach(function(M){return C[M]=0});var E=y.locToIndex(C),S=b.slice(-r.rank);f.forEach(function(M){return S[M]=0});var A=x.locToIndex(S),D=o(u[2*E],u[2*E+1],c[2*A],c[2*A+1]);d[_]=D.real,h[_]=D.imag};for(p=0;p<d.length;p++)w(p)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,r,o){return y8(t,r,o)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,o,i,a,s){for(var u=t.shape,c=u[0],l=u[1],f=u[2],d=u[3],h=r.shape[0],p=i[0],g=i[1],v=Qe([h,p,g,d],"float32"),m=this.readSync(r.dataId),y=this.readSync(o.dataId),x=this.readSync(t.dataId),w=t.strides,_=v.strides,b=0;b<h;b++){var C=4*b,E=m[C],S=m[C+1],A=m[C+2],D=m[C+3],M=y[b];if(!(M>=c))for(var L=p>1?(A-E)*(l-1)/(p-1):0,B=g>1?(D-S)*(f-1)/(g-1):0,U=0;U<p;U++){var G=p>1?E*(l-1)+U*L:.5*(E+A)*(l-1);if(G<0||G>l-1)for(var H=0;H<g;H++)for(var W=0;W<d;W++){var $=W+H*_[2]+U*_[1]+b*_[0];v.values[$]=s}else if("bilinear"===a){var K=Math.floor(G),re=Math.ceil(G),ce=G-K;for(H=0;H<g;H++)if((Ue=g>1?S*(f-1)+H*B:.5*(S+D)*(f-1))<0||Ue>f-1)for(W=0;W<d;W++)v.values[$=W+H*_[2]+U*_[1]+b*_[0]]=s;else{var he=Math.floor(Ue),Ce=Math.ceil(Ue),Re=Ue-he;for(W=0;W<d;W++){var Fe=x[$=W+he*w[2]+K*w[1]+M*w[0]],Pe=x[$=W+Ce*w[2]+K*w[1]+M*w[0]],Se=x[$=W+he*w[2]+re*w[1]+M*w[0]],Xe=Fe+(Pe-Fe)*Re,nt=Se+(x[$=W+Ce*w[2]+re*w[1]+M*w[0]]-Se)*Re;v.values[$=W+H*_[2]+U*_[1]+b*_[0]]=Xe+(nt-Xe)*ce}}}else for(H=0;H<g;++H){var Ue;if((Ue=g>1?S*(f-1)+H*B:.5*(S+D)*(f-1))<0||Ue>f-1)for(W=0;W<d;W++)v.values[$=W+H*_[2]+U*_[1]+b*_[0]]=s;else{var it=Math.round(Ue),rt=Math.round(G);for(W=0;W<d;W++)v.values[W+H*_[2]+U*_[1]+b*_[0]]=x[W+it*w[2]+rt*w[1]+M*w[0]]}}}}return v.toTensor()},e.prototype.sparseToDense=function(t,r,o,i){var a=Cp(0,t,o);return this.scatter(t,r,o,a.outputSize,a.sliceSize,a.numUpdates,a.sliceRank,a.strides,i,!1)},e.prototype.gatherND=function(t,r){var o=r.shape,i=o[o.length-1],a=Fb(t,r),s=a[0],u=a[1],c=a[2],l=a[3];if(0===u)return Lr([],s,t.dtype);for(var f=new hp([u,c],t.dtype),d=this.readSync(r.dataId),h=this.readSync(t.dataId),p=0;p<u;p++){for(var g=[],v=0,m=0;m<i;m++){var y=d[p*i+m];v+=y*l[m],g.push(y)}if(v<0||v>=t.size/c)throw new Error("Invalid indices: "+g+" does not index into "+t.shape);for(var x=0;x<c;x++)f.values[p*c+x]=h[v*c+x]}return f.toTensor().reshape(s)},e.prototype.scatterND=function(t,r,o){var i=Cp(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,f=Oe(0);return this.scatter(t,r,o,l,u,s,a,c,f,!0)},e.prototype.fill=function(t,r,o){var i=up(o=o||kf(r),Ee(t));return i.fill(r),k.makeTensor(i,t,o,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=up(t.dtype,Ee(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,o){return zb(t,r,o)},e.prototype.scatter=function(t,r,o,i,a,s,u,c,l,f){var d=[i/a,a],h=this.readSync(t.dataId),p=this.readSync(r.dataId);if(0===i)return Lr([],o,r.dtype);var g=new hp(d,r.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var v=0;v<s;v++){for(var m=[],y=0,x=0;x<u;x++){var w=h[v*u+x];m.push(w),y+=w*c[x]}if(y<0||y>=i/a)throw new Error("Invalid indices: "+m+" does not index into "+o);for(var _=0;_<a;_++)f?g.values[y*a+_]+=p[v*a+_]:g.values[y*a+_]=0===r.rank?p[0]:p[v*a+_]}return g.toTensor().reshape(o)},e}(p8);function JB(n,e){return{kernelName:n,backendName:"cpu",kernelFunc:function(t){var r=t.inputs,a=r.a,s=r.b,u=t.backend;te([a,s],n);var c=u.data.get(a.dataId).values,l=u.data.get(s.dataId).values,f=e(a.shape,s.shape,c,l,a.dtype),h=f[1];return{dataId:u.write(f[0],h,a.dtype),shape:h,dtype:a.dtype}}}}function e6(n){return function(e,t,r,o,i){var a=yt(e,t),s=a.length,u=Lo(a),c=Wc(i,Ee(a)),l=e.length,f=t.length,d=Lo(e),h=Lo(t),p=Vs(e,a),g=Vs(t,a);if(p.length+g.length===0)for(var v=0;v<c.length;++v)c[v]=n(r[v%r.length],o[v%o.length]);else{var m=function(y){var x=mb(y,s,u),w=x.slice(-l);p.forEach(function(E){return w[E]=0});var _=sm(w,l,d),b=x.slice(-f);g.forEach(function(E){return b[E]=0});var C=sm(b,f,h);c[y]=n(r[_],o[C])};for(v=0;v<c.length;++v)m(v)}return[c,a]}}k.registerBackend("cpu",function(){return new D_e},1);var T_e=e6(function(n,e){return n/e}),R_e=JB(bm,T_e),N_e={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(n){var t=n.attrs,o=n.inputs.x,a=t.filterSize,s=t.strides,u=t.pad,c=t.includeBatchInIndex,l=n.backend;te(o,"MaxPoolWithArgmax");var y,x,w,_,b,C,E,f=l.data.get(o.dataId).values,d=Bu(o.shape,a,s,[1,1],u),h=(_=c,b=d,C=xC(y=f,0,w=o.dtype,Lo(x=o.shape),b,"max"),E=QB(y,x,w,b,!0,_),[C.values,E.values]),g=h[1],v=l.write(h[0],d.outShape,o.dtype),m=l.write(g,d.outShape,o.dtype);return[{dataId:v,shape:d.outShape,dtype:o.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}},O_e={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,r=n.attrs,i=e.boxes,a=e.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,f=r.softNmsSigma,d=n.backend;te(i,"NonMaxSuppressionWithScore");var h=qb(d.data.get(i.dataId).values,d.data.get(a.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},M_e={kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var r=n.inputs.x,o=n.backend;te(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},P_e=e6(function(n,e){var t=n-e;return t*t});function t6(n,e,t,r,o){for(var i=Ee(e),a=e.length,s=Lo(e),u=Lo(o),c=Wc(t,Ee(o)),l=0;l<i;++l){for(var f=mb(l,a,s),d=new Array(f.length),h=0;h<d.length;h++)d[h]=f[r[h]];c[sm(d,a,u)]=n[l]}return c}for(var _C=0,n6=[O_e,M_e,JB(Cm,P_e),R_e,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(n){var o=n.inputs.x,i=n.attrs.perm,a=n.backend;te(o,"transpose");for(var u=new Array(o.shape.length),c=0;c<u.length;c++)u[c]=o.shape[i[c]];var l=t6(a.data.get(o.dataId).values,o.shape,o.dtype,i,u);return{dataId:a.write(l,u,o.dtype),shape:u,dtype:o.dtype}}},N_e];_C<n6.length;_C++)QF(n6[_C]);for(var jf,k_e=function(n){this.variableNames=["A"];var e=Qr(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+t+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},F_e=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Qr(),t=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+t+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},L_e=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var o=fn(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},B_e=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=fn(this.rank),i=_8("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},bC=0,r6=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.backend,o=n.inputs.pixels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],f=[l,c],d=[l,c,n.attrs.numChannels];(s||a)&&(null==jf&&(jf=document.createElement("canvas").getContext("2d")),jf.canvas.width=c,jf.canvas.height=l,jf.drawImage(o,0,0,c,l),o=jf.canvas);var h=t.makeTensorInfo(f,"int32");t.texData.get(h.dataId).usage=ii.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(h.dataId),o);var p=X().getBool("WEBGL_PACK")?new F_e(d):new k_e(d),g=t.runWebGLProgram(p,[h],"int32");return t.disposeData(h.dataId),g}},{kernelName:bm,backendName:"webgl",kernelFunc:function(n){var o,i,a,s,e=n.inputs;return a=n.backend,s=new Pn("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",(o=e.a).shape,(i=e.b).shape),X().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(s=new Qa("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",o.shape,i.shape,!0)),a.runWebGLProgram(s,[o,i],"float32")}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;gm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=e.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,f=r.softNmsSigma,d=t,h=qb(d.readSync(e.boxes.dataId),d.readSync(a.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var r=n.inputs.x,o=n.backend,i=new lt(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Cm,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,o=e.a,i=e.b,a=n.backend,s=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qa("return (a - b) * (a - b);",o.shape,i.shape):new Pn("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(n){for(var e,i=n.inputs.x,a=n.attrs.perm,s=n.backend,c=new Array(i.shape.length),l=0;l<c.length;l++)c[l]=i.shape[a[l]];if(s.shouldExecuteOnCPU([i])){var f=t6(s.texData.get(i.dataId).values,i.shape,i.dtype,a,c);e=s.makeTensorInfo(c,i.dtype),s.texData.get(e.dataId).values=f}else d=i,h=a,p=s,g=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B_e(d.shape,h):new L_e(d.shape,h),e=p.runWebGLProgram(g,[d],d.dtype);var d,h,p,g;return e}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(n){var t=n.attrs,o=n.inputs.x,a=t.filterSize,s=t.strides,u=t.pad,c=t.includeBatchInIndex,l=n.backend;T(4===o.shape.length,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.shape.length+"."});var f=[1,1];T(Zr(s,f),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+f+"'"});var p,g,v,m,y,x,d=Bu(o.shape,a,s,f,u),h=(p=o,g=c,m=l,y=new Dp(v=d,"max",!1),x=m.runWebGLProgram(y,[p],"float32"),y=new Dp(v,"max",!0,!0,g),[x,m.runWebGLProgram(y,[p],"float32")]);return[h[0],h[1]]}}];bC<r6.length;bC++)QF(r6[bC]);for(var CC=0,o6=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],o=yt(t.shape,r.shape);return{a:function(){var i=n,a=nr(t.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(t.shape)},b:function(){var i=n,a=nr(r.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach(function(r,o){t[o]=function(){return n.clone()}}),t}},{kernelName:e8,gradFunc:function(n,e,t){for(var o=t.inputShape,i=t.shape,a=Array.from(i),s=o.length-1;s>=0;s--)if(o[s]===i[s])a[s]=1;else if(1!==o[s])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+i+"].");var u=[];for(s=0;s<a.length;s++)a[s]>1&&u.push(s);return{x:function(){return n.sum(u,!0)}}}},{kernelName:bm,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],o=yt(t.shape,r.shape);return{a:function(){var i=Lu(n,r.toFloat()),a=nr(t.shape,o);return a.length>0?Hu(i,a).reshape(t.shape):i},b:function(){var i=n.mul(t.toFloat()),a=nr(r.shape,o);a.length>0&&(i=Hu(i,a).reshape(r.shape));var s=SB(r);return Pb(Lu(i,s.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,o=e[0],i=e[1],a=e[2],s=e[3],u=hB(o),c=s??Oe(1),l=nr(i.shape,u.shape),f=[];if(1===i.rank){for(var d=0;d<u.shape.length-1;++d)f.push(u.shape[d]);f.push(1)}var h=ua(o,i),p=Mn(n,c),g=i8(Pi(a,Oe(r))),v=Mn(Mn(Mn(g,g),g),Oe(-.5));return{x:function(){return Bs(Mn(Mn(n,1===i.rank?zf(g.as4D(1,1,1,i.shape[0]),f):g),c),o.shape)},mean:function(){var m=Mn(Mn(g,Oe(-1)),p);return 1===i.rank&&(m=Hu(m,l)),Bs(m,i.shape)},variance:function(){var m=Mn(Mn(v,h),p);return 1===i.rank&&(m=Hu(m,l)),Bs(m,i.shape)},scale:function(){var m=Mn(h,g),y=Mn(n,m);return 1===i.rank&&(y=Hu(y,l)),Bs(y,i.shape)},offset:function(){var m=n;return 1===i.rank&&(m=Hu(m,l)),Bs(m,i.shape)}}}},{kernelName:n8,gradFunc:function(n){return{x:function(){return n.toFloat()}}}},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return On(t.shape,"float32")}}}},{kernelName:"PadV2",inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],o=t.paddings.map(function(i){return i[0]});return{x:function(){return n.slice(o,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:Cm,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],o=Oe(2);return{a:function(){return Mn(n,Mn(o,ua(t,r)))},b:function(){return Mn(n,Mn(o,ua(r,t)))}}}},{kernelName:"Tile",inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],o=t.reps;return{x:function(){var i=Tt(r);if(1===r.rank)for(var a=0;a<o[0];++a)i=i.add(n.slice([a*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(a=0;a<o[0];++a)for(var s=0;s<o[1];++s)i=i.add(n.slice([a*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(a=0;a<o[0];++a)for(s=0;s<o[1];++s)for(var u=0;u<o[2];++u)i=i.add(n.slice([a*r.shape[0],s*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<o[0];++a)for(s=0;s<o[1];++s)for(u=0;u<o[2];++u)for(var c=0;c<o[3];++c)i=i.add(n.slice([a*r.shape[0],s*r.shape[1],u*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return i}}}},{kernelName:"Transpose",gradFunc:function(n,e,t){var r=vm(t.perm);return{x:function(){return ca(n,r)}}}}];CC<o6.length;CC++)Dme(o6[CC]);var V_e=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();X().get("IS_BROWSER")&&X().setPlatform("browser",new V_e);var EC,H_e=function(){function n(){this.util=xo(753),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return null!=X().global.fetch?X().global.fetch(e,t):(null==EC&&(EC=xo(522)),EC(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},n}();X().get("IS_NODE")&&X().setPlatform("node",new H_e);var SC={float32:4,int32:4,uint16:2,uint8:1,bool:1},jm=4;function i6(n,e){for(var t={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,f=Ee(l),d=void 0;if("quantization"in s){var h=s.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=SC[h.dtype],g=n.slice(r,r+f*p),v="uint8"===h.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===c)d=Float32Array.from(v,function(b){return b*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=Int32Array.from(v,function(b){return Math.round(b*h.scale+h.min)})}r+=f*p}else if("string"===c){var m=Ee(s.shape);d=[];for(var y=0;y<m;y++){var x=new Uint32Array(n.slice(r,r+jm))[0];r+=jm;var w=new Uint8Array(n.slice(r,r+x));d.push(w),r+=x}}else{var _=SC[c];if(g=n.slice(r,r+f*_),"float32"===c)d=new Float32Array(g);else if("int32"===c)d=new Int32Array(g);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=new Uint8Array(g)}r+=f*_}t[u]=Lr(d,l,c)},i=0,a=e;i<a.length;i++)o(a[i]);return t}function W_e(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(e),o=0;return t.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var AC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function a6(n){return AC?Buffer.byteLength(n):new Blob([n]).size}function IC(n){var e=0;n.forEach(function(o){e+=o.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(o){t.set(new Uint8Array(o),r),r+=o.byteLength}),t.buffer}function s6(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Op(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:a6(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:a6(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var ci=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var o=[];return("load"===t?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(i){var a=i(e,r);null!==a&&o.push(a)}),o},n}(),$f="://",Wu=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(e,t){T(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith($f)&&(e=e.slice(0,e.indexOf($f))),T(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();T(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function $m(n){if(-1===n.indexOf($f))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Wu.getSchemes().join(","));return{scheme:n.split($f)[0],path:n.split($f)[1]}}function u6(n,e,t){return void 0===t&&(t=!1),De(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,f;return Te(this,function(d){switch(d.label){case 0:return T(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),T((r=ci.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),T(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),o=r[0],T((i=ci.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),T(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=i[0],s=$m(n).scheme,u=$m(n).path,c=s===$m(n).scheme,[4,o.load()];case 1:return l=d.sent(),t&&c?[4,Wu.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return f=d.sent(),!t||c?[3,6]:[4,Wu.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var el="models_store",Gu="model_info_store";function c6(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function DC(n){var e=n.result;e.createObjectStore(el,{keyPath:"modelPath"}),e.createObjectStore(Gu,{keyPath:"modelPath"})}var qf=function(){function n(e){if(this.indexedDB=c6(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return De(this,void 0,void 0,function(){return Te(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return De(this,void 0,void 0,function(){return Te(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return DC(a)},a.onsuccess=function(){var s=a.result;if(null==t){var u=s.transaction(el,"readonly"),c=u.objectStore(el).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(g){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,f=Op(t),d=s.transaction(Gu,"readwrite"),h=d.objectStore(Gu),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:f});p.onsuccess=function(){var g=(l=s.transaction(el,"readwrite")).objectStore(el).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return o({modelArtifactsInfo:f})},g.onerror=function(v){var m=(h=d.objectStore(Gu)).delete(r.modelPath);m.onsuccess=function(){return s.close(),i(g.error)},m.onerror=function(y){return s.close(),i(g.error)}}},p.onerror=function(g){return s.close(),i(p.error)},d.oncomplete=function(){null==l?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},n.URL_SCHEME="indexeddb://",n}(),l6=function(n){return X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(qf.URL_SCHEME)?(e=n.slice(qf.URL_SCHEME.length),new qf(e)):null;var e};ci.registerSaveRouter(l6),ci.registerLoadRouter(l6);var G_e=function(){function n(){this.indexedDB=c6()}return n.prototype.listModels=function(){return De(this,void 0,void 0,function(){var e=this;return Te(this,function(t){return[2,new Promise(function(r,o){var i=e.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return DC(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Gu,"readonly"),u=s.objectStore(Gu).getAll();u.onsuccess=function(){for(var c={},l=0,f=u.result;l<f.length;l++){var d=f[l];c[d.modelPath]=d.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},n.prototype.removeModel=function(e){return De(this,void 0,void 0,function(){var t=this;return Te(this,function(r){var o;return e=(o=e).startsWith(qf.URL_SCHEME)?o.slice(qf.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return DC(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Gu,"readwrite"),f=l.objectStore(Gu),d=f.get(e);d.onsuccess=function(){if(null==d.result)return c.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var h=f.delete(e),p=function(){var g=(u=c.transaction(el,"readwrite")).objectStore(el).delete(e);g.onsuccess=function(){return i(d.result.modelArtifactsInfo)},g.onerror=function(v){return a(d.error)}};h.onsuccess=p,h.onerror=function(g){return p(),c.close(),a(d.error)}},d.onerror=function(h){return c.close(),a(d.error)},l.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},n}();if(X().getBool("IS_BROWSER"))try{Wu.registerManager(qf.URL_SCHEME,new G_e)}catch{}var Ws="/",Xf="tensorflowjs_models",f6="info",z_e="model_topology",j_e="weight_specs",$_e="weight_data",q_e="model_metadata";function d6(n){return{info:[Xf,n,f6].join(Ws),topology:[Xf,n,z_e].join(Ws),weightSpecs:[Xf,n,j_e].join(Ws),weightData:[Xf,n,$_e].join(Ws),modelMetadata:[Xf,n,q_e].join(Ws)}}function X_e(n){var e=n.split(Ws);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Ws)}var Kf=function(){function n(e){if(!X().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=d6(this.modelPath)}return n.prototype.save=function(e){return De(this,void 0,void 0,function(){var t,r,o;return Te(this,function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),o=Op(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(AC)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return De(this,void 0,void 0,function(){var e,t,r,o,i,a,s;return Te(this,function(u){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=o,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(c){if(AC){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var f=atob(c),d=new Uint8Array(f.length),h=0;h<f.length;++h)d.set([f.charCodeAt(h)],h);return d.buffer}(s),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),h6=function(n){return X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Kf.URL_SCHEME)?(e=n.slice(Kf.URL_SCHEME.length),new Kf(e)):null;var e};ci.registerSaveRouter(h6),ci.registerLoadRouter(h6);var K_e=function(){function n(){T(X().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),T(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return De(this,void 0,void 0,function(){var e,t,r,o,i,a;return Te(this,function(s){for(e={},t=Xf+Ws,r=Ws+f6,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(t)&&i.endsWith(r)&&(a=X_e(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},n.prototype.removeModel=function(e){return De(this,void 0,void 0,function(){var t,r;return Te(this,function(o){var i;if(e=(i=e).startsWith(Kf.URL_SCHEME)?i.slice(Kf.URL_SCHEME.length):i,t=d6(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(X().getBool("IS_BROWSER"))try{Wu.registerManager(Kf.URL_SCHEME,new K_e)}catch{}var Y_e="model",Z_e=".json",Q_e=".weights.bin";function p6(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var TC=function(){function n(e){if(!X().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),null!=e&&0!==e.length||(e=Y_e),this.modelTopologyFileName=e+Z_e,this.weightDataFileName=e+Q_e}return n.prototype.save=function(e){return De(this,void 0,void 0,function(){var t,i,a,s;return Te(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return i=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,p6(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==e.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,p6(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Op(e)}]}})})},n.URL_SCHEME="downloads://",n}(),J_e=function(){function n(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return De(this,void 0,void 0,function(){var e,t,r=this;return Te(this,function(o){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===t.length&&i({modelTopology:l});var f=c.weightsManifest;if(null!=f){var d;try{d=r.checkManifestAndWeightFiles(f,t)}catch(v){return void a(v)}var h=[],p=[],g=[];f.forEach(function(v){v.paths.forEach(function(m){p.push(m),g.push(null)}),h.push.apply(h,v.weights)}),f.forEach(function(v){v.paths.forEach(function(m){var y=new FileReader;y.onload=function(x){var w=x.target.result,_=p.indexOf(m);g[_]=w,-1===g.indexOf(null)&&i({modelTopology:l,weightSpecs:h,weightData:IC(g),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},y.onerror=function(x){return a("Failed to weights data from file of path '"+m+"'.")},y.readAsArrayBuffer(d[m])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],o=t.map(function(u){return s6(u.name)}),i={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var c=s6(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=t[o.indexOf(c)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return i},n}();function g6(n,e,t,r){var i;T(null!=(i=n)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(i,a){T(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),T(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),T(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(t=t??0,r=r??1);var o=0;return Promise.all(n.map(function(i){return i.then(function(a){var s=t+ ++o/n.length*(r-t);return e(s),a}),i}))}function v6(n,e){return De(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l;return Te(this,function(f){switch(f.label){case 0:return null==e&&(e={}),t=null==e.fetchFunc?X().platform.fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),o=0,i=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=f.sent(),[3,4];case 2:return[4,g6(r,e.onProgress,o,i)];case 3:a=f.sent(),f.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,c=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=f.sent(),[3,8];case 6:return[4,g6(s,e.onProgress,u,c)];case 7:l=f.sent(),f.label=8;case 8:return[2,l]}})})}function m6(n){var e=this;return function(t,r,o){return void 0===r&&(r=""),De(e,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p;return Te(this,function(g){switch(g.label){case 0:if(i=t.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],u=[],t.forEach(function(v,m){var y=0;v.weights.forEach(function(x){var _=SC["quantization"in x?x.quantization.dtype:x.dtype]*Ee(x.shape),b=function(){i[m]=!0,null==a[m]&&(a[m]=[]),a[m].push({manifestEntry:x,groupOffset:y,sizeBytes:_})};null!=o?o.forEach(function(C,E){C===x.name&&(b(),s[E]=!0)}):b(),u.push(x.name),y+=_})}),!s.every(function(v){return v}))throw c=o.filter(function(v,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=i.reduce(function(v,m,y){return m&&v.push(y),v},[]),f=[],l.forEach(function(v){t[v].paths.forEach(function(m){var y=r+(r.endsWith("/")?"":"/")+m;f.push(y)})}),[4,n(f)];case 1:return d=g.sent(),h={},p=0,l.forEach(function(v){for(var m=t[v].paths.length,y=0,x=0;x<m;x++)y+=d[p+x].byteLength;for(var w=new ArrayBuffer(y),_=new Uint8Array(w),b=0,C=0;C<m;C++){var E=new Uint8Array(d[p+C]);_.set(E,b),b+=E.byteLength}a[v].forEach(function(S){var A=i6(w.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var D in A)h[D]=A[D]}),p+=m}),[2,h]}})})}}ci.registerSaveRouter(function(n){return X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(TC.URL_SCHEME)?(void 0===(e=n.slice(TC.URL_SCHEME.length))&&(e="model"),new TC(e)):null;var e});var y6=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(T("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=X().platform.fetch,T(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&T(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return De(this,void 0,void 0,function(){var t,i;return Te(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Op(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},n.prototype.load=function(){return De(this,void 0,void 0,function(){var e,t,r,o,i,a,s,u,c,l,f,d;return Te(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,c=t.userDefinedMetadata,null==(o=t.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:d=h.sent(),l=d[0],f=d[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:f,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},n.prototype.loadWeights=function(e){return De(this,void 0,void 0,function(){var r,o,i,a,s,u,c,f,d;return Te(this,function(h){switch(h.label){case 0:for(void 0,void 0,g=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),v=p.lastIndexOf("?"),r=[p.substring(0,g)+"/",v>g?p.substring(v):""],o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=e;u<c.length;u++)s.push.apply(s,c[u].weights);return f=[],e.forEach(function(p){p.paths.forEach(function(g){f.push(a+g+i)})}),[4,v6(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=h.sent(),[2,[s,IC(d)]]}var p,g,v})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function RC(n){return null!=n.match(y6.URL_SCHEME_REGEX)}var x6=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return RC(t)}):RC(n))?NC(n,{onProgress:e}):null};function NC(n,e){return new y6(n,e)}ci.registerSaveRouter(x6),ci.registerLoadRouter(x6);var Yf,OC=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return De(this,void 0,void 0,function(){return Te(this,function(e){return[2,this.modelArtifacts]})})},n}(),e2e=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return De(this,void 0,void 0,function(){return Te(this,function(t){return[2,this.saveHandler(e)]})})},n}(),w6=Object.freeze({browserFiles:function(n){return new J_e(n)},browserHTTPRequest:function(n,e){return NC(n,e)},concatenateArrayBuffers:IC,decodeWeights:i6,encodeWeights:function(n,e){return De(this,void 0,void 0,function(){var t,r,o,i,a,s=this;return Te(this,function(u){switch(u.label){case 0:for(t=[],r=[],o=Array.isArray(n)?n.map(function(c){return c.name}):Object.keys(n),i=function(c){var l=o[c],f=Array.isArray(n)?n[c].tensor:n[l];if("float32"!==f.dtype&&"int32"!==f.dtype&&"bool"!==f.dtype&&"string"!==f.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+f.dtype);var d={name:l,shape:f.shape,dtype:f.dtype};if("string"===f.dtype){var h=new Promise(function(p){return De(s,void 0,void 0,function(){var g,v,m,y,x,w,_;return Te(this,function(b){switch(b.label){case 0:return[4,f.bytes()];case 1:for(g=b.sent(),v=g.reduce(function(C,E){return C+E.length},0)+jm*g.length,m=new Uint8Array(v),y=0,x=0;x<g.length;x++)w=g[x],_=new Uint8Array(new Uint32Array([w.length]).buffer),m.set(_,y),m.set(w,y+=jm),y+=w.length;return p(m),[2]}})})});r.push(h)}else r.push(f.data());null!=e&&(d.group=e),t.push(d)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:W_e(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return 1===arguments.length?null!=n.modelTopology||null!=n.weightSpecs?new OC(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new OC({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new OC({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return ci.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Op,getSaveHandlers:function(n){return ci.getSaveHandlers(n)},http:NC,isHTTPScheme:RC,loadWeights:function(n,e,t,r){return void 0===e&&(e=""),De(this,void 0,void 0,function(){return Te(this,function(o){return[2,m6(function(i){return v6(i,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return ci.registerLoadRouter(n)},registerSaveRouter:function(n){return ci.registerSaveRouter(n)},weightsLoaderFactory:m6,withSaveHandler:function(n){return new e2e(n)},copyModel:function(n,e){return De(this,void 0,void 0,function(){return Te(this,function(t){return[2,u6(n,e,!1)]})})},listModels:function(){return De(this,void 0,void 0,function(){var n,e,t,r,o,i,a;return Te(this,function(s){switch(s.label){case 0:n=Wu.getSchemes(),e={},t=0,r=n,s.label=1;case 1:return t<r.length?[4,Wu.getManager(o=r[t]).listModels()]:[3,4];case 2:for(a in i=s.sent())e[o+$f+a]=i[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return De(this,void 0,void 0,function(){return Te(this,function(t){return[2,u6(n,e,!0)]})})},removeModel:function(n){return De(this,void 0,void 0,function(){var e;return Te(this,function(t){return e=$m(n),[2,Wu.getManager(e.scheme).removeModel(e.path)]})})}}),t2e=F({confusionMatrix_:function(n,e,t){var r=I(n,"labels","confusionMatrix"),o=I(e,"predictions","confusionMatrix");T(null==t||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),T(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),T(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),T(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),T(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var i=Hm(r.asType("int32"),t),a=Hm(o.asType("int32"),t);return i.transpose().matMul(a).asType("int32")}}),n2e=(Object.freeze({confusionMatrix:t2e}),F({fromPixels_:function(n,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==n)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,o=!1,i=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else{if(null==n.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);a=!0}if(o&&o&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=KF("FromPixels",k.backendName))return k.runKernel("FromPixels",{pixels:n},{numChannels:e});var s,u,c=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],l=c[0],f=c[1];if(a?s=n.getContext("2d").getImageData(0,0,l,f).data:r||t?s=n.data:(i||o)&&(null==Yf&&(Yf=document.createElement("canvas").getContext("2d")),Yf.canvas.width=l,Yf.canvas.height=f,Yf.drawImage(n,0,0,l,f),s=Yf.getImageData(0,0,l,f).data),4===e)u=new Int32Array(s);else{var d=l*f;u=new Int32Array(d*e);for(var h=0;h<d;h++)for(var p=0;p<e;++p)u[h*e+p]=s[4*h+p]}return $L(u,[f,l,e],"int32")}})),_6=Object.freeze({toPixels:function(n,e){return De(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,h,p,g,v,m,y,x,w,_,b,C,E;return Te(this,function(S){switch(S.label){case 0:if(t=I(n,"img","toPixels"),n instanceof Qt||(t=t.toInt()),2!==t.rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),o=r[0],i=r[1],(a=2===t.rank?1:t.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=S.sent(),u=t.min(),c=t.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=S.sent(),h=l[0][0],p=l[1][0],u.dispose(),c.dispose(),"float32"===t.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g="float32"===t.dtype?255:1,v=new Uint8ClampedArray(i*o*4),m=0;m<o*i;++m)y=void 0,x=void 0,w=void 0,_=void 0,1===a?(y=s[m]*g,x=s[m]*g,w=s[m]*g,_=255):3===a?(y=s[3*m]*g,x=s[3*m+1]*g,w=s[3*m+2]*g,_=255):4===a&&(y=s[4*m]*g,x=s[4*m+1]*g,w=s[4*m+2]*g,_=s[4*m+3]*g),v[0+(b=4*m)]=Math.round(y),v[b+1]=Math.round(x),v[b+2]=Math.round(w),v[b+3]=Math.round(_);return null!=e&&(e.width=i,e.height=o,C=e.getContext("2d"),E=new ImageData(v,i,o),C.putImageData(E,0,0)),t!==n&&t.dispose(),[2,v]}})})},fromPixels:n2e}),b6=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),C6=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function zu(n){T(null!=n.className,function(){return"Class being registered does not have the static className property defined."}),T("string"==typeof n.className,function(){return"className is required to be a string, but got type "+typeof n.className}),T(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),C6.register(n)}Object.freeze({Serializable:b6,SerializationMap:C6,registerClass:zu}),Object.freeze({gpgpu_util:Vye,webgl_util:Lme,forceHalfFloat:function(){X().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:dB,setWebGLContext:mL,GPGPUContext:K8});var tl=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ra(e,n),e.prototype.minimize=function(t,r,o){void 0===r&&(r=!1);var i=this.computeGradients(t,o),a=i.value,s=i.grads;if(null!=o){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Bo(s),r?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return function H1e(n,e){T(Mu(n),function(){return"The f passed in variableGrads(f) must be a function"}),T(null==e||Array.isArray(e)&&e.every(function(l){return l instanceof Lf}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=null!=e;if(!t)for(var r in e=[],k.registeredVariables)e.push(k.registeredVariables[r]);var o=t?e.filter(function(l){return!l.trainable}):null,i=e.length;T((e=e.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=k.gradients(n,e,null,!0),s=a.value,u=a.grads;T(u.some(function(l){return null!=l}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),T(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return e.forEach(function(l,f){null!=u[f]&&(c[l.name]=u[f])}),o?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}(t,r)},e.prototype.dispose=function(){null!=this.iterations_&&Bo(this.iterations_)},e.prototype.saveIterations=function(){return De(this,void 0,void 0,function(){return Te(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Oe(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Te(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Te(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return De(this,void 0,void 0,function(){var r;return Te(this,function(o){switch(o.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,t.slice(1)]}})})},e}(b6);Object.defineProperty(tl,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var E6=function(n){function e(t,r,o){void 0===o&&(o=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==o&&(i.epsilon=k.backend.epsilon()),i}return ra(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=k.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:Gt(function(){return Tt(a).variable(!1)})}),null==r.accumulatedUpdates[i]&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:Gt(function(){return Tt(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[o];if(null!=s){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;Gt(function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),f=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),d=c.mul(r.rho).add(f.square().mul(1-r.rho));u.assign(l),c.assign(d);var h=f.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Bo(this.accumulatedGrads.map(function(t){return t.variable})),Bo(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){var t;return Te(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){var r;return Te(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),this.accumulatedGrads=t.slice(0,r=t.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(tl);zu(E6);var S6=function(n){function e(t,r){void 0===r&&(r=.1);var o=n.call(this)||this;return o.learningRate=t,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return ra(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=k.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:Gt(function(){return $c(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[o];if(null!=s){var u=r.accumulatedGrads[i].variable;Gt(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(k.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Bo(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Te(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Te(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(tl);zu(S6);var A6=function(n){function e(t,r,o,i){void 0===i&&(i=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Gt(function(){a.accBeta1=Oe(r).variable(),a.accBeta2=Oe(o).variable()}),null==i&&(a.epsilon=k.backend.epsilon()),a}return ra(e,n),e.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Gt(function(){var i=ua(1,r.accBeta1),a=ua(1,r.accBeta2);o.forEach(function(s,u){var c=k.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Gt(function(){return Tt(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Gt(function(){return Tt(c).variable(!1)})});var l=Array.isArray(t)?t[u].tensor:t[s];if(null!=l){var f=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,h=f.mul(r.beta1).add(l.mul(1-r.beta1)),p=d.mul(r.beta2).add(l.square().mul(1-r.beta2)),g=h.div(i),v=p.div(a);f.assign(h),d.assign(p);var m=g.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Bo(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&Bo(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){var t;return Te(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){var r,o=this;return Te(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),Gt(function(){o.accBeta1.assign(Em(o.beta1,o.iterations_+1)),o.accBeta2.assign(Em(o.beta2,o.iterations_+1))}),this.accumulatedFirstMoment=t.slice(0,r=t.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(tl);zu(A6);var I6=function(n){function e(t,r,o,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Gt(function(){s.iteration=Oe(0).variable(),s.accBeta1=Oe(r).variable()}),null==i&&(s.epsilon=k.backend.epsilon()),s}return ra(e,n),e.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Gt(function(){var i=ua(1,r.accBeta1),a=Lu(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var c=k.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Tt(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Tt(c).variable(!1)});var l=Array.isArray(t)?t[u].tensor:t[s];if(null!=l){var f=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,h=f.mul(r.beta1).add(l.mul(1-r.beta1)),p=d.mul(r.beta2),g=l.abs(),v=p.maximum(g);f.assign(h),d.assign(v);var m=a.div(i).mul(h.div(v.add(r.epsilon))).add(c);c.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Bo(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&Bo(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Te(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Te(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(tl);zu(I6);var MC=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ra(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=Array.isArray(t)?t[i].tensor:t[o];if(null!=a){var s=k.registeredVariables[o];Gt(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function Bme(n){return k.keep(n)}(Oe(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Te(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Te(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(tl);zu(MC);var D6=function(n){function e(t,r,o){void 0===o&&(o=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=Oe(i.momentum),i}return ra(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=k.registeredVariables[o];null==r.accumulations[i]&&(r.accumulations[i]={originalName:o+"/momentum",variable:Gt(function(){return Tt(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(t)?t[i].tensor:t[o];null!=u&&Gt(function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Bo(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Te(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Te(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(MC);zu(D6);var T6=function(n){function e(t,r,o,i,a){void 0===r&&(r=.9),void 0===o&&(o=0),void 0===i&&(i=null),void 0===a&&(a=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,null==i&&(s.epsilon=k.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return ra(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t)).forEach(function(o,i){var a=k.registeredVariables[o];null==r.accumulatedMeanSquares[i]&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:Gt(function(){return Tt(a).variable(!1)})}),null==r.accumulatedMoments[i]&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:Gt(function(){return Tt(a).variable(!1)})}),null==r.accumulatedMeanGrads[i]&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:Gt(function(){return Tt(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[o];if(null!=s){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;Gt(function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var f=r.accumulatedMeanGrads[i].variable,d=f.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(d.square().add(r.epsilon)).sqrt()));u.assign(l),f.assign(d),c.assign(h);var p=a.sub(h);a.assign(p)}else{var g=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),c.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Bo(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Bo(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&Bo(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){var t;return Te(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){var r;return Te(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),this.accumulatedMeanSquares=t.slice(0,r=this.centered?t.length/3:t.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(tl);zu(T6),function(){function n(){}n.sgd=function(e){return new MC(e)},n.momentum=function(e,t,r){return void 0===r&&(r=!1),new D6(e,t,r)},n.rmsprop=function(e,t,r,o,i){return void 0===t&&(t=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1),new T6(e,t,r,o,i)},n.adam=function(e,t,r,o){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===o&&(o=null),new A6(e,t,r,o)},n.adadelta=function(e,t,r){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===r&&(r=null),new E6(e,t,r)},n.adamax=function(e,t,r,o,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===o&&(o=null),void 0===i&&(i=0),new I6(e,t,r,o,i)},n.adagrad=function(e,t){return void 0===t&&(t=.1),new S6(e,t)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,Qt.prototype.add=function(n){return Pi(this,n)},Qt.prototype.broadcastTo=function(n){return yB(this,n)},Qt.prototype.div=function(n){return Lu(this,n)},Qt.prototype.divNoNan=function(n){return _B(this,n)},Qt.prototype.squaredDifference=function(n){return AB(this,n)},Qt.prototype.tile=function(n){return zf(this,n)},Qt.prototype.oneHot=function(n,e,t){return void 0===e&&(e=1),void 0===t&&(t=0),Hm(this,n,e,t)},Qt.prototype.transpose=function(n){return ca(this,n)},Qt.prototype.pad=function(n,e){return Us(this,n,e)},Qt.prototype.batchNorm=function(n,e,t,r,o){return Rp(this,n,e,t,r,o)},Y=I_e;var rl=function(){function n(e,t){if(!ol(e)||!ol(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}(),Ft=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}();function Mp(n,e){return n instanceof Qt&&n.shape.length===e}function qm(n){return Mp(n,3)}function ju(n){return Mp(n,4)}function R6(n){return n%2==0}function PC(n,e){void 0===e&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function N6(n){return n&&n.width&&n.height}function kC(n){return n.reduce(function(e,t){return e.add(t)},new Ft(0,0)).div(new Ft(n.length,n.length))}function Pp(n,e,t){return Array(n).fill(0).map(function(r,o){return e+o*t})}function ol(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||0===n}function O6(n){return ol(n)&&0<=n&&n<=1}var pr,Ja=function(){function n(e,t){void 0===t&&(t=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(ol),i=[r.x,r.y,r.width,r.height].every(ol);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];n.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",t),this._x=s,this._y=u,this._width=c,this._height=l}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(ol)},n.assertIsValidBox=function(e,t,r){if(void 0===r&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Ft(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Ft(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Ft(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Ft(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)});return new n({x:e[0],y:e[1],width:e[2],height:e[3]})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)});return new n({x:e[0],y:e[1],width:e[2],height:e[3]})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,o=e.width,i=e.height,a=Math.abs(o-i);return o<i&&(t-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new n({x:t,y:r,width:o,height:i})},n.prototype.rescale=function(e){var t=N6(e)?e.width:e,r=N6(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t];return new n({x:r[0],y:r[1],width:r[2],height:r[3]})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.y,a=r.right,s=r.bottom,u=Math.max(r.x,0),c=Math.max(i,0),f=s-c;return new n({x:u,y:c,width:Math.min(a-u,e-u),height:Math.min(f,t-c)}).floor()},n.prototype.shift=function(e,t){return new n({x:this.x+e,y:this.y+t,width:this.width,height:this.height})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,o=this.height+1,s=r,u=o,c=this.left,l=this.top,f=this.right,d=this.bottom;return f>t&&(s=-f+t+r,f=t),d>e&&(u=-d+e+o,d=e),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:1,edy:u,dx:1,edx:s,y:l,ey:d,x:c,ex:f,w:r,h:o}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),Xm=function(n){function e(t,r,o,i,a){return void 0===a&&(a=!1),n.call(this,{left:t,top:r,right:o,bottom:i},a)||this}return ap(e,n),e}(Ja),M6=function(n){function e(t,r){var o=n.call(this,t)||this;return o._label=r,o}return ap(e,n),e.assertIsValidLabeledBox=function(t,r){if(Ja.assertIsValidBox(t,r),!ol(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Ja),P6=function(){function n(e,t,r,o,i){this._imageDims=new rl(i.width,i.height),this._score=e,this._classScore=t,this._className=r,this._box=new Ja(o).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Ja(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),FC=(function(n){function e(t,r,o,i){var a=n.call(this,t,r)||this;return a._score=o,a._classScore=i,a}ap(e,n),e.assertIsValidPredictedBox=function(t,r){if(M6.assertIsValidLabeledBox(t,r),!O6(t.score)||!O6(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(M6),function(n){function e(t,r,o,i,a){return void 0===a&&(a=!1),n.call(this,{x:t,y:r,width:o,height:i},a)||this}return ap(e,n),e}(Ja));function k6(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function F6(n){var e="";if(!n)try{n=xo(954)}catch(r){e=r.toString()}return{readFile:n?function(r){return new Promise(function(o,i){n.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function L6(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=F6();return nm({Canvas:n||function a(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function a(){},Image:e||function a(){},ImageData:global.ImageData||function a(){},Video:global.HTMLVideoElement||function a(){},createCanvasElement:function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i)}function B6(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function V6(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function LC(n){pr=n}function BC(){B6()&&LC(k6()),V6()&&LC(L6())}var eo={getEnv:function s2e(){if(!pr)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return pr},setEnv:LC,initialize:BC,createBrowserEnv:k6,createFileSystem:F6,createNodejsEnv:L6,monkeyPatch:function u2e(n){if(pr||BC(),!pr)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=void 0===e?pr.Canvas:e,r=n.Image,o=void 0===r?pr.Image:r;pr.Canvas=t,pr.Image=o,pr.createCanvasElement=n.createCanvasElement||function(){return new t},pr.createImageElement=n.createImageElement||function(){return new o},pr.ImageData=n.ImageData||pr.ImageData,pr.Video=n.Video||pr.Video,pr.fetch=n.fetch||pr.fetch,pr.readFile=n.readFile||pr.readFile},isBrowser:B6,isNodejs:V6};function VC(n){return eo.isNodejs()||"string"!=typeof n?n:document.getElementById(n)}function es(n){var e=eo.getEnv(),t=e.Canvas;if(n instanceof e.CanvasRenderingContext2D)return n;var o=VC(n);if(!(o instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}BC();var ts=(()=>(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"}(ts||(ts={})),ts))(),UC=function n(e){void 0===e&&(e={});var r=e.backgroundColor,o=e.fontColor,i=e.fontSize,a=e.fontStyle,s=e.padding;this.anchorPosition=e.anchorPosition||ts.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4},HC=function(){function n(e,t,r){void 0===r&&(r={}),this.text="string"==typeof e?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new UC(r)}return n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options;return this.text.length*e.fontSize+2*e.padding},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,o=r===ts.BOTTOM_RIGHT||r===ts.TOP_RIGHT,i=r===ts.BOTTOM_LEFT||r===ts.BOTTOM_RIGHT,a=this.measureWidth(e),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(t){var f=t.height;return{x:Math.max(Math.min(u,t.width-a),0),y:Math.max(Math.min(c,f-s),0)}}return{x:u,y:c}},n.prototype.draw=function(e){var t=VC(e),r=es(t),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,c=o.padding;r.font=s+"px "+o.fontStyle;var l=this.measureWidth(r),f=this.measureHeight();r.fillStyle=i;var d=this.getUpperLeft(r,t);r.fillRect(d.x,d.y,l,f),r.fillStyle=a,this.text.forEach(function(h,p){r.fillText(h,c+d.x,c+d.y+(p+1)*s)})},n}(),U6=function n(e){void 0===e&&(e={});var r=e.lineWidth,o=e.label,i=e.drawLabelOptions;this.boxColor=e.boxColor||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=o,this.drawLabelOptions=new UC(Object.assign({},{anchorPosition:ts.BOTTOM_LEFT,backgroundColor:this.boxColor},i))},H6=function(){function n(e,t){void 0===t&&(t={}),this.box=new Ja(e),this.options=new U6(t)}return n.prototype.draw=function(e){var t=es(e),r=this.options,i=r.lineWidth,a=this.box,s=a.x,u=a.y,c=a.width,l=a.height;t.strokeStyle=r.boxColor,t.lineWidth=i,t.strokeRect(s,u,c,l);var f=this.options.label;f&&new HC([f],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(e)},n}();function fa(n,e,t,r){return void 0===t&&(t="same"),void 0===r&&(r=!1),Gt(function(){var o=Pi(Jc(n,e.filters,[1,1],t),e.bias);return r?Wm(o):o})}function Gs(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function Km(n,e){return function(t,r,o,i){var a=Za(n(t*r*o*o),[o,o,t,r]),s=sa(n(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function WC(n,e){return function(t,r,o){var i=jc(n(t*r),[t,r]),a=sa(n(r));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var W6=function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r};function GC(n,e){return function(t,r,o){var i=Za(n(9*t),[3,3,t,1]),a=Za(n(t*r),[1,1,t,r]),s=sa(n(r));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new W6(i,a,s)}}function zC(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),o=n(e+"/bias",1);return new W6(t,r,o)}}function $u(n,e){return function(t,r,o){var i=n[t];if(!Mp(i,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:t,paramPath:o||t}),i}}function zs(n){var e=n;return{extractWeights:function t(o){var i=e.slice(0,o);return e=e.slice(o),i},getRemainingWeights:function r(){return e}}}function G6(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if("/"===n)return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"",o=(n=n.replace(r,"")).split("/").filter(function(s){return s}),i=n.endsWith(".json")?o[o.length-1]:t,a=r+(n.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=n.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function z6(n){var e=eo.getEnv();return n instanceof e.Image&&n.complete||n instanceof e.Video&&n.readyState>=3}function jC(n){var e=eo.getEnv(),r=e.Video;return n instanceof e.Image?new rl(n.naturalWidth,n.naturalHeight):n instanceof r?new rl(n.videoWidth,n.videoHeight):new rl(n.width,n.height)}function Ym(n){var e=n.width,t=n.height,o=(0,eo.getEnv().createCanvasElement)();return o.width=e,o.height=t,o}function Zm(n,e){var t=eo.getEnv().ImageData;if(!(n instanceof t||z6(n)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||jC(n),o=r.width,i=r.height,a=Ym({width:o,height:i});return n instanceof t?es(a).putImageData(n,0,0):es(a).drawImage(n,0,0,o,i),a}function l2e(n,e){return Ri(this,void 0,void 0,function(){var r;return Ni(this,function(o){switch(o.label){case 0:return[4,(0,eo.getEnv().fetch)(n,e)];case 1:if(!((r=o.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function f2e(n){return Ri(this,void 0,void 0,function(){return Ni(this,function(e){switch(e.label){case 0:return[4,l2e(n)];case 1:return[2,e.sent().json()]}})})}function d2e(n,e){return Ri(this,void 0,void 0,function(){var t,r,o,i,a,s;return Ni(this,function(u){switch(u.label){case 0:return t=e||eo.getEnv().createCanvasElement(),r=n.shape.slice(ju(n)?1:0),o=r[0],i=r[1],a=r[2],s=Gt(function(){return n.as3D(o,i,a).toInt()}),[4,_6.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function j6(n){var e=eo.getEnv();return n instanceof e.Image||n instanceof e.Canvas||n instanceof e.Video}function p2e(n,e){return Ri(this,void 0,void 0,function(){var t,o,i;return Ni(this,function(a){switch(a.label){case 0:return t=G6(n,e),o=t.modelBaseUri,[4,f2e(t.manifestUri)];case 1:return i=a.sent(),[2,w6.loadWeights(i,o)]}})})}var Qm=function(){function n(e,t){var r=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(o,i){if(qm(o))return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape);if(ju(o)){var a=o.shape[0];if(1!==a)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape.slice(1))}var s=o instanceof eo.getEnv().Canvas?o:Zm(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Pp(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function a2e(n,e){var t=n.width,r=n.height,o=e/Math.max(r,t);return new rl(Math.round(t*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return void 0===t&&(t=!0),this._inputSize=e,Gt(function(){var o=Pp(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Qt){var u=ju(s)?s:s.expandDims();return u=function v2e(n,e){return void 0===e&&(e=!1),Gt(function(){var t=n.shape.slice(1),r=t[0],o=t[1];if(r===o)return n;var i=Math.abs(r-o),a=Math.round(i*(e?.5:1)),s=r>o?2:1,u=function(h){var p=n.shape.slice();return p[s]=h,$c(p,0)},c=u(a),l=i-c.shape[s],d=[e&&l?u(l):null,n,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return Mi(d,s)})}(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=ZB.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof eo.getEnv().Canvas)return _6.fromPixels(function h2e(n,e,t){void 0===t&&(t=!1);var r=eo.getEnv(),i=r.Canvas;if(!(n instanceof r.Image||n instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=jC(n),s=e/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Ym({width:e,height:e}),f=n instanceof i?n:Zm(n),d=Math.abs(u-c)/2,h=t&&u<c?d:0,p=t&&c<u?d:0;return es(l).drawImage(f,h,p,u,c),l}(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)});return Fu(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,e,e,3)})},n}();function br(n){return Ri(this,void 0,void 0,function(){var e,t,r;return Ni(this,function(o){switch(o.label){case 0:if(n instanceof Qm)return[2,n];if(!(e=Array.isArray(n)?n:[n]).length)throw new Error("toNetInput - empty array passed as input");return t=function(i){return Array.isArray(n)?" at input index "+i+":":""},(r=e.map(VC)).forEach(function(i,a){if(!j6(i)&&!qm(i)&&!ju(i))throw"string"==typeof e[a]?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ju(i)){var s=i.shape[0];if(1!==s)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return j6(i)&&function c2e(n){return new Promise(function(e,t){if(n instanceof eo.getEnv().Canvas||z6(n))return e();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}n.addEventListener("load",r),n.addEventListener("error",o)})}(i)}))];case 1:return o.sent(),[2,new Qm(r,Array.isArray(n))]}})})}var js=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Lf})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Lf)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){e.reassignParamFromPath(t.path,t.tensor.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,o=t.tensor,i=Lr(o.dataSync());o.dispose(),e.reassignParamFromPath(r,i)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){return Array.from(e.tensor.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return Ri(this,void 0,void 0,function(){return Ni(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return Ri(this,void 0,void 0,function(){var t;return Ni(this,function(r){switch(r.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,p2e(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return Ri(this,void 0,void 0,function(){var t,r,o,i,s,u,c,l,f;return Ni(this,function(d){switch(d.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=eo.getEnv().readFile,r=G6(e,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,s=w6.weightsLoaderFactory(function(h){return Promise.all(h.map(function(p){return t(p).then(function(g){return g.buffer})}))}),l=(c=JSON).parse,[4,t(o)];case 1:return u=l.apply(c,[d.sent().toString()]),[4,s(u,i)];case 2:return f=d.sent(),this.loadFromWeightMap(f),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),o=t.params;this._paramMappings=t.paramMappings,this._params=o},n.prototype.extractWeights=function(e){var t=this.extractParams(e),o=t.params;this._paramMappings=t.paramMappings,this._params=o},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=t.obj,o=t.objProp;if(!(r&&o&&r[o]instanceof Qt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:o}},n}();function m2e(n,e,t){void 0===t&&(t=!0);var i=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left))*Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top));return t?i/(n.area+e.area-i):i/Math.min(n.area,e.area)}function kp(n,e,t,r){void 0===r&&(r=!0);for(var o=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++)c.push(m2e(n[s],n[u[l]],r));o=o.filter(function(p,g){return c[g]<=t})};o.length>0;)a();return i}function Fp(n,e){return Gt(function(){var t=e[0],r=e[1],o=e[2],i=$c(ub(n.shape.slice(0,3),[1]),t),a=$c(ub(n.shape.slice(0,3),[1]),r),s=$c(ub(n.shape.slice(0,3),[1]),o),u=Mi([i,a,s],3);return ua(n,u)})}function $C(n){return 1/(1+Math.exp(-n))}var Jm=function(n){return"number"==typeof n};function qC(n){return Gt(function(){var e=Mn(n,Oe(.10000000149011612));return Pi(Wm(ua(n,e)),e)})}function qu(n,e){return Gt(function(){var t=Us(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Jc(t,e.conv.filters,[1,1],"valid"),t=ua(t,e.bn.sub),t=Mn(t,e.bn.truediv),qC(t=Pi(t,e.conv.bias))})}function Xu(n,e){return Gt(function(){var t=Us(n,[[0,0],[1,1],[1,1],[0,0]]);return t=LB(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),qC(t=Pi(t,e.bias))})}var KC=function(){function n(e){var t=void 0===e?{}:e,r=t.inputSize,o=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),$6=function(n){function e(t){var r=n.call(this,"TinyYolov2")||this;return function y2e(n){if(!n)throw new Error("invalid config: "+n);if("boolean"!=typeof n.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Jm(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return"string"==typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return Jm(e.x)&&Jm(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||3!==n.meanRgb.length||!n.meanRgb.every(Jm)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}(t),r._config=t,r}return ap(e,n),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var o=qu(t,r.conv0);return o=qu(o=ui(o,[2,2],[2,2],"same"),r.conv1),o=qu(o=ui(o,[2,2],[2,2],"same"),r.conv2),o=qu(o=ui(o,[2,2],[2,2],"same"),r.conv3),o=qu(o=ui(o,[2,2],[2,2],"same"),r.conv4),o=qu(o=ui(o,[2,2],[2,2],"same"),r.conv5),o=qu(o=ui(o,[2,2],[1,1],"same"),r.conv6),fa(o=qu(o,r.conv7),r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var o=this.config.isFirstLayerConv2d?qC(fa(t,r.conv0,"valid",!1)):Xu(t,r.conv0);return o=Xu(o=ui(o,[2,2],[2,2],"same"),r.conv1),o=Xu(o=ui(o,[2,2],[2,2],"same"),r.conv2),o=Xu(o=ui(o,[2,2],[2,2],"same"),r.conv3),o=Xu(o=ui(o,[2,2],[2,2],"same"),r.conv4),o=Xu(o=ui(o,[2,2],[2,2],"same"),r.conv5),o=ui(o,[2,2],[1,1],"same"),o=r.conv6?Xu(o,r.conv6):o,fa(o=r.conv7?Xu(o,r.conv7):o,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return Gt(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=(a=o.config.meanRgb?Fp(a,o.config.meanRgb):a).div(Oe(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},e.prototype.forward=function(t,r){return Ri(this,void 0,void 0,function(){var o;return Ni(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,br(t)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},e.prototype.detect=function(t,r){return void 0===r&&(r={}),Ri(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,d,h,p,g,y=this;return Ni(this,function(x){switch(x.label){case 0:return o=new KC(r),i=o.inputSize,a=o.scoreThreshold,[4,br(t)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),c=Gt(function(){return ym(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return f=x.sent(),u.dispose(),c.dispose(),d=f.map(function(w){return w.box}),h=f.map(function(w){return w.score}),p=f.map(function(w){return w.classScore}),g=f.map(function(w){return y.config.classes[w.label]}),[2,kp(d.map(function(w){return w.rescale(i)}),h,this.config.iouThreshold,!0).map(function(w){return new P6(h[w],p[w],g[w],d[w],l)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function b2e(n,e){var s,t=[],r=function _2e(n,e){var t=$u(n,e);function o(s){return{filters:t(s+"/filters",4),bias:t(s+"/bias",1)}}return{extractConvParams:o,extractConvWithBatchNormParams:function i(s){var u=o(s+"/conv"),c=function r(s){return{sub:t(s+"/sub",1),truediv:t(s+"/truediv",1)}}(s+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:zC(t)}}(n,t),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return Gs(n,t),{params:s,paramMappings:t}}(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return function w2e(n,e,t,r){var d,o=zs(n),a=o.getRemainingWeights,s=[],u=function x2e(n,e){var t=Km(n,e),i=GC(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:function o(a,s,u){var c=t(a,s,3,u+"/conv"),l=function r(a,s){var u=sa(n(a)),c=sa(n(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}(s,u+"/bn");return{conv:c,bn:l}},extractSeparableConvParams:i}}(o.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,f=u.extractSeparableConvParams;if(e.withSeparableConvs){var h=r[0],p=r[1],g=r[2],v=r[3],m=r[4],y=r[5],x=r[6],w=r[7],_=r[8];d={conv0:e.isFirstLayerConv2d?c(h,p,3,"conv0"):f(h,p,"conv0"),conv1:f(p,g,"conv1"),conv2:f(g,v,"conv2"),conv3:f(v,m,"conv3"),conv4:f(m,y,"conv4"),conv5:f(y,x,"conv5"),conv6:w?f(x,w,"conv6"):void 0,conv7:_?f(w,_,"conv7"):void 0,conv8:c(_||w||x,5*t,1,"conv8")}}else g=r[2],v=r[3],m=r[4],y=r[5],x=r[6],w=r[7],_=r[8],d={conv0:l(h=r[0],p=r[1],"conv0"),conv1:l(p,g,"conv1"),conv2:l(g,v,"conv2"),conv3:l(v,m,"conv3"),conv4:l(m,y,"conv4"),conv5:l(y,x,"conv5"),conv6:l(x,w,"conv6"),conv7:l(w,_,"conv7"),conv8:c(_,5*t,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,o){return Ri(this,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p,g,v,m,y,x,w,_,b,C,E,S,A,D,M,L,B,U,G,H,W=this;return Ni(this,function($){switch($.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=t.shape[1],f=this.config.anchors.length,d=Gt(function(){var K=t.reshape([l,l,f,W.boxEncodingSize]);return[K.slice([0,0,0,0],[l,l,f,4]),K.slice([0,0,0,4],[l,l,f,1]),W.withClassScores?Tm(K.slice([0,0,0,5],[l,l,f,W.config.classes.length]),3):Oe(0)]}),h=d[0],g=d[2],v=[],[4,(p=d[1]).array()];case 1:return m=$.sent(),[4,h.array()];case 2:y=$.sent(),x=0,$.label=3;case 3:if(!(x<l))return[3,12];w=0,$.label=4;case 4:if(!(w<l))return[3,11];_=0,$.label=5;case 5:return _<f?(b=$C(m[x][w][_][0]),!o||b>o?(C=(w+$C(y[x][w][_][0]))/l*u,E=(x+$C(y[x][w][_][1]))/l*c,S=Math.exp(y[x][w][_][2])*this.config.anchors[_].x/l*u,A=Math.exp(y[x][w][_][3])*this.config.anchors[_].y/l*c,D=C-S/2,M=E-A/2,L={row:x,col:w,anchor:_},this.withClassScores?[4,this.extractPredictedClass(g,L)]:[3,7]):[3,9]):[3,10];case 6:return H=$.sent(),[3,8];case 7:H={classScore:1,label:0},$.label=8;case 8:U=(B=H).classScore,G=B.label,v.push(nm({box:new Xm(D,M,D+S,M+A),score:b,classScore:b*U,label:G},L)),$.label=9;case 9:return _++,[3,5];case 10:return w++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),p.dispose(),g.dispose(),[2,v]}})})},e.prototype.extractPredictedClass=function(t,r){return Ri(this,void 0,void 0,function(){var o,i,a,s;return Ni(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(js);function Ku(n,e,t){if(void 0===t&&(t=!1),n.beginPath(),e.slice(1).forEach(function(i,a){var s=i.x,u=i.y,c=e[a];n.moveTo(c.x,c.y),n.lineTo(s,u)}),t){var r=e[e.length-1],o=e[0];if(!r||!o)return;n.moveTo(r.x,r.y),n.lineTo(o.x,o.y)}n.stroke()}var li=function(n){function e(t,r,o){return n.call(this,t,t,"",r,o)||this}return ht(e,n),e.prototype.forSize=function(t,r){var o=n.prototype.forSize.call(this,t,r);return new e(o.score,o.relativeBox,o.imageDims)},e}(P6);function Lp(n){return n.detection instanceof li}function Bp(n,e){return Object.assign({},n,{detection:e})}function C2e(n,e){(Array.isArray(e)?e:[e]).forEach(function(r){var o=r instanceof li?r.score:Lp(r)?r.detection.score:void 0,i=r instanceof li?r.box:Lp(r)?r.detection.box:new Ja(r),a=o?""+PC(o):void 0;new H6(i,{label:a}).draw(n)})}function fi(n,e,t){return Ve(function(){var r=Zk(n,e.depthwise_filter,e.pointwise_filter,t,"same");return Wt(r,e.bias)})}function YC(n,e,t){return void 0===t&&(t=!1),Ve(function(){var r=Jn(t?Wt(Rs(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):fi(n,e.conv0,[2,2])),o=fi(r,e.conv1,[1,1]),a=fi(Jn(Wt(r,o)),e.conv2,[1,1]);return Jn(Wt(r,Wt(o,a)))})}function e1(n,e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),Ve(function(){var o=Jn(t?Wt(Rs(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):fi(n,e.conv0,r?[2,2]:[1,1])),i=fi(o,e.conv1,[1,1]),s=fi(Jn(Wt(o,i)),e.conv2,[1,1]),c=fi(Jn(Wt(o,Wt(i,s))),e.conv3,[1,1]);return Jn(Wt(o,Wt(i,Wt(s,c))))})}function q6(n,e){var t=Km(n,e),r=GC(n,e);function o(a,s,u,c){return void 0===c&&(c=!1),{conv0:c?t(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),conv1:r(s,s,u+"/conv1"),conv2:r(s,s,u+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function i(a,s,u,c){void 0===c&&(c=!1);var l=o(a,s,u,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(s,s,u+"/conv3")}}}}function X6(n){return function(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}}function K6(n,e){var t=$u(n,e),r=X6(t),o=zC(t);return{extractDenseBlock3Params:function i(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}},extractDenseBlock4Params:function a(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2"),conv3:o(s+"/conv3")}}}}var Y6=function(n){function e(){return n.call(this,"FaceFeatureExtractor")||this}return ht(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Ve(function(){var s=e1(Fp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(oe(255)),r.dense0,!0);return s=e1(s,r.dense1),s=e1(s,r.dense2),s=e1(s,r.dense3),rp(s,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function S2e(n){var e=[],t=K6(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Gs(n,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function E2e(n){var e=[],t=zs(n),o=t.getRemainingWeights,i=q6(t.extractWeights,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(t)},e}(js);function ns(n,e){return Ve(function(){return Wt(X2(n,e.weights),e.bias)})}function Z6(n){var e={},t={};return Object.keys(n).forEach(function(r){(r.startsWith("fc")?t:e)[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var Q6=function(n){function e(t,r){var o=n.call(this,t)||this;return o._faceFeatureExtractor=r,o}return ht(e,n),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Ve(function(){var i=t instanceof Qm?r.faceFeatureExtractor.forwardInput(t):t;return ns(i.as2D(i.shape[0],-1),o.fc)})},e.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.paramMappings;this._params=r.params,this._paramMappings=i},e.prototype.extractClassifierParams=function(t){return function A2e(n,e,t){var r=[],o=zs(n),a=o.getRemainingWeights,u=WC(o.extractWeights,r)(e,t,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=Z6(t),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function I2e(n){var e=[],t=$u(n,e),o={fc:function r(i){return{weights:t(i+"/weights",2),bias:t(i+"/bias",1)}}("fc")};return Gs(n,e),{params:o,paramMappings:e}}(i)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=t.slice(0,t.length-i),s=t.slice(t.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e}(js),J6=["neutral","happy","sad","angry","fearful","disgusted","surprised"],ZC=function(){function n(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);J6.forEach(function(r,o){t[r]=e[o]})}return n.prototype.asSortedArray=function(){var e=this;return J6.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),D2e=function(n){function e(t){return void 0===t&&(t=new Y6),n.call(this,"FaceExpressionNet",t)||this}return ht(e,n),e.prototype.forwardInput=function(t){var r=this;return Ve(function(){return Cu(r.runNet(t))})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.predictExpressions=function(t){return Ke(this,void 0,void 0,function(){var r,o,i,a,s=this;return Ye(this,function(u){switch(u.label){case 0:return[4,br(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(Mr(o).map(function(c){return Ke(s,void 0,void 0,function(){var l;return Ye(this,function(f){switch(f.label){case 0:return[4,c.data()];case 1:return l=f.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new ZC(c)}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(Q6);function e5(n,e){return Object.assign({},n,{expressions:e})}function R2e(n,e,t,r){void 0===t&&(t=.1),(Array.isArray(e)?e:[e]).forEach(function(i){var a=i instanceof ZC?i:function T2e(n){return n.expressions instanceof ZC}(i)?i.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var u=a.asSortedArray().filter(function(f){return f.probability>t}),c=Lp(i)?i.detection.box.bottomLeft:r||new Ft(0,0);new HC(u.map(function(f){return f.expression+" ("+PC(f.probability)+")"}),c).draw(n)})}var Zf=function(){function n(e,t,r){void 0===r&&(r=new Ft(0,0));var o=t.width,i=t.height;this._imgDims=new rl(o,i),this._shift=r,this._positions=e.map(function(a){return a.mul(new Ft(o,i)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Ft(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Ft(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ft(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var r=e instanceof li?e.box.floor():new Ja(e);return this.shiftBy(r.x,r.y).align(null,t)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=o.minBoxPadding;return o.useDlibAlignment?this.alignDlib():this.alignMinBbox(a)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),r=e[1],o=e[2],i=function(f){return o.sub(f).magnitude()},a=(i(e[0])+i(r))/2,s=Math.floor(a/.45),u=kC(e),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new FC(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},n.prototype.alignMinBbox=function(e){var t=function N2e(n){var e=n.map(function(s){return s.x}),t=n.map(function(s){return s.y}),r=e.reduce(function(s,u){return u<s?u:s},1/0),o=t.reduce(function(s,u){return u<s?u:s},1/0),i=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new Xm(r,o,i,a)}(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),t5=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(kC)},e}(Zf);function QC(n){return Lp(n)&&n.landmarks instanceof Zf&&n.unshiftedLandmarks instanceof Zf&&n.alignedRect instanceof li}function t1(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),o=r.align(),i=n.detection.imageDims,a=new li(n.detection.score,o.rescale(i.reverse()),i);return Object.assign({},n,{landmarks:r,unshiftedLandmarks:e,alignedRect:a})}var n5=function n(e){void 0===e&&(e={});var t=e.drawLines,o=e.drawPoints,i=void 0===o||o,a=e.lineWidth,s=e.lineColor,u=e.pointSize,c=e.pointColor;this.drawLines=void 0===t||t,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"},r5=function(){function n(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new n5(t)}return n.prototype.draw=function(e){var t=es(e),r=this.options,i=r.drawPoints,a=r.lineWidth,u=r.pointSize,c=r.pointColor;r.drawLines&&this.faceLandmarks instanceof t5&&(t.strokeStyle=r.lineColor,t.lineWidth=a,Ku(t,this.faceLandmarks.getJawOutline()),Ku(t,this.faceLandmarks.getLeftEyeBrow()),Ku(t,this.faceLandmarks.getRightEyeBrow()),Ku(t,this.faceLandmarks.getNose()),Ku(t,this.faceLandmarks.getLeftEye(),!0),Ku(t,this.faceLandmarks.getRightEye(),!0),Ku(t,this.faceLandmarks.getMouth(),!0)),i&&(t.strokeStyle=c,t.fillStyle=c,this.faceLandmarks.positions.forEach(function(f){t.beginPath(),t.arc(f.x,f.y,u,0,2*Math.PI),t.fill()}))},n}();function k2e(n,e){(Array.isArray(e)?e:[e]).forEach(function(r){var o=r instanceof Zf?r:QC(r)?r.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new r5(o).draw(n)})}function o5(n,e,t){return Wt(Rs(n,e.filters,t,"same"),e.bias)}function JC(n,e,t){void 0===t&&(t=!0);var r=t?Jn(n):n;return r=fi(r,e.separable_conv0,[1,1]),r=fi(Jn(r),e.separable_conv1,[1,1]),r=Tf(r,[3,3],[2,2],"same"),Wt(r,o5(n,e.expansion_conv,[2,2]))}var H2e=function(n){function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return ht(e,n),e.prototype.forwardInput=function(t){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return Ve(function(){var s=Fp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(oe(256)),u=Jn(o5(s,o.entry_flow.conv_in,[2,2]));return u=JC(u,o.entry_flow.reduction_block_0,!1),u=JC(u,o.entry_flow.reduction_block_1),Pp(r._numMainBlocks,0,1).forEach(function(c){u=function U2e(n,e){var t=fi(Jn(n),e.separable_conv0,[1,1]);return t=fi(Jn(t),e.separable_conv1,[1,1]),t=fi(Jn(t),e.separable_conv2,[1,1]),Wt(t,n)}(u,o.middle_flow["main_block_"+c])}),u=JC(u,o.exit_flow.reduction_block),u=Jn(fi(u,o.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function V2e(n,e){var t=[],r=function B2e(n,e){var t=$u(n,e),r=X6(t),o=zC(t);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function i(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),expansion_conv:r(s+"/expansion_conv")}},extractMainBlockParams:function a(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),separable_conv2:o(s+"/separable_conv2")}}}}(n,t),i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,f={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},d={};Pp(e,0,1).forEach(function(v){d["main_block_"+v]=s("middle_flow/main_block_"+v)});var g={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Gs(n,t),{params:{entry_flow:f,middle_flow:d,exit_flow:g},paramMappings:t}}(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return function L2e(n,e){var t=[],r=zs(n),i=r.getRemainingWeights,a=function F2e(n,e){var t=Km(n,e),r=GC(n,e);return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:function o(a,s,u){return{separable_conv0:r(a,s,u+"/separable_conv0"),separable_conv1:r(s,s,u+"/separable_conv1"),expansion_conv:t(a,s,1,u+"/expansion_conv")}},extractMainBlockParams:function i(a,s){return{separable_conv0:r(a,a,s+"/separable_conv0"),separable_conv1:r(a,a,s+"/separable_conv1"),separable_conv2:r(a,a,s+"/separable_conv2")}}}}(r.extractWeights,t),u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,p={conv_in:(0,a.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},g={};Pp(e,0,1).forEach(function(x){g["main_block_"+x]=l(128,"middle_flow/main_block_"+x)});var y={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:g,exit_flow:y}}}(t,this._numMainBlocks)},e}(js),Vp=(()=>(function(n){n.FEMALE="female",n.MALE="male"}(Vp||(Vp={})),Vp))(),z2e=function(n){function e(t){void 0===t&&(t=new H2e(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return ht(e,n),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Ve(function(){var i=t instanceof Qm?r.faceFeatureExtractor.forwardInput(t):t,a=rp(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1);return{age:ns(a,o.fc.age).as1D(),gender:ns(a,o.fc.gender)}})},e.prototype.forwardInput=function(t){var r=this;return Ve(function(){var o=r.runNet(t);return{age:o.age,gender:Cu(o.gender)}})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Ke(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return Ye(this,function(l){switch(l.label){case 0:return[4,br(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=Mr(o.age),a=Mr(o.gender),s=i.map(function(f,d){return{ageTensor:f,genderTensor:a[d]}}),[4,Promise.all(s.map(function(f){var d=f.ageTensor,h=f.genderTensor;return Ke(c,void 0,void 0,function(){var p,g,v,m,y;return Ye(this,function(x){switch(x.label){case 0:return[4,d.data()];case 1:return p=x.sent()[0],[4,h.data()];case 2:return g=x.sent()[0],m=(v=g>.5)?Vp.MALE:Vp.FEMALE,y=v?g:1-g,d.dispose(),h.dispose(),[2,{age:p,gender:m,genderProbability:y}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.paramMappings;this._params=r.params,this._paramMappings=i},e.prototype.extractClassifierParams=function(t){return function W2e(n){var e=[],t=zs(n),o=t.getRemainingWeights,i=WC(t.extractWeights,e),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=Z6(t),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function G2e(n){var e=[],t=$u(n,e);function r(i){return{weights:t(i+"/weights",2),bias:t(i+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Gs(n,e),{params:o,paramMappings:e}}(i)},e.prototype.extractParams=function(t){var o=t.slice(0,t.length-1539),i=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(js),j2e=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],kC([t[3],t[4]])]},e}(Zf),i5=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+PC(this.distance)+")":"")},n}(),eE=function(){function n(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n}();function tE(n,e){return Ke(this,void 0,void 0,function(){var t,r,o,i,a,s;return Ye(this,function(c){switch(c.label){case 0:return t=eo.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,br(n)];case 1:if((o=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof t?(a=i,[3,4]):[3,2];case 2:return[4,d2e(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=es(r),[2,e.map(function(l){return l instanceof li?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}).map(function(l){var f=l.x,d=l.y,h=l.width,p=l.height,g=Ym({width:h,height:p});return es(g).putImageData(s.getImageData(f,d,h,p),0,0),g})]}})})}function nE(n,e){return Ke(this,void 0,void 0,function(){return Ye(this,function(t){if(!qm(n)&&!ju(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ju(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ve(function(){var r=n.shape.slice(ju(n)?1:0),o=r[0],i=r[1],a=r[2];return e.map(function(c){return c instanceof li?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}).map(function(c){var l=c.x,f=c.y,d=c.width,h=c.height;return eF(n.as3D(o,i,a),[f,l,0],[h,d,a])})})]})})}var a5=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.postProcess=function(t,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return Ve(function(){var s=function(d,h){return na([zh([68],d),zh([68],h)],1).as2D(1,136).as1D()},u=function(d,h){var p=i[d],g=p.width,v=p.height;return h(g,v)?Math.abs(g-v)/2:0};return t.mul(zh([a,136],r)).sub(na(Array.from(Array(a),function(d,h){return s(function(d){return u(d,function(h,p){return h<p})}(h),function(d){return u(d,function(h,p){return p<h})}(h))}))).div(na(Array.from(Array(a),function(d,h){return s(i[h].width,i[h].height)})))})},e.prototype.forwardInput=function(t){var r=this;return Ve(function(){var o=r.runNet(t);return r.postProcess(o,t.inputSize,t.inputDimensions.map(function(i){return{height:i[0],width:i[1]}}))})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Ke(this,void 0,void 0,function(){var r,o,i,a=this;return Ye(this,function(s){switch(s.label){case 0:return[4,br(t)];case 1:return r=s.sent(),o=Ve(function(){return Mr(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return Ke(a,void 0,void 0,function(){var l,f,d,h,p;return Ye(this,function(g){switch(g.label){case 0:return d=(f=Array).from,[4,u.data()];case 1:return l=d.apply(f,[g.sent()]),h=l.filter(function(v,m){return R6(m)}),p=l.filter(function(v,m){return!R6(m)}),[2,new t5(Array(68).fill(0).map(function(v,m){return new Ft(h[m],p[m])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(Q6),s5=function(n){function e(t){return void 0===t&&(t=new Y6),n.call(this,"FaceLandmark68Net",t)||this}return ht(e,n),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(a5),X2e=function(n){function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return ht(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ve(function(){var s=YC(Fp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(oe(255)),r.dense0,!0);return s=YC(s,r.dense1),s=YC(s,r.dense2),rp(s,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function $2e(n){var e=[],t=K6(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Gs(n,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function q2e(n){var e=[],t=zs(n),o=t.getRemainingWeights,i=q6(t.extractWeights,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}(t)},e}(js),K2e=function(n){function e(t){return void 0===t&&(t=new X2e),n.call(this,"FaceLandmark68TinyNet",t)||this}return ht(e,n),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(a5);function rE(n,e,t,r,o){void 0===o&&(o="same");var i=e.conv,s=i.bias,u=Rs(n,i.filters,t,o);return u=function Y2e(n,e){return Wt(Os(n,e.weights),e.biases)}(u=Wt(u,s),e.scale),r?Jn(u):u}function u5(n,e){return rE(n,e,[1,1],!1)}function c5(n,e){return rE(n,e,[2,2],!0,"valid")}function Q2e(n,e){function i(s,u,c,l){var f=function r(s,u,c,l){var f=function t(s,u,c){var l=n(s),f=l.length/(u*c*c);if(function i2e(n){return n%1!=0}(f))throw new Error("depth has to be an integer: "+f+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return Ve(function(){return Iu(ea(l,[u,f,c,c]),[2,3,1,0])})}(s,u,c),d=ni(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:f,bias:d}}(s,u,c,l+"/conv"),d=function o(s,u){var c=ni(n(s)),l=ni(n(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}(u,l+"/scale");return{conv:f,scale:d}}return{extractConvLayerParams:i,extractResidualLayerParams:function a(s,u,c,l,f){return void 0===f&&(f=!1),{conv1:i((f?.5:1)*s,u,c,l+"/conv1"),conv2:i(s,u,c,l+"/conv2")}}}}function tbe(n){var e=[],t=function ebe(n,e){var t=$u(n,e);function o(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),c=function r(a){return{weights:t(a+"/scale/weights",1),biases:t(a+"/scale/biases",1)}}(a);return{conv:{filters:s,bias:u},scale:c}}return{extractConvLayerParams:o,extractResidualLayerParams:function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}}}(n,e),o=t.extractResidualLayerParams,i=(0,t.extractConvLayerParams)("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),f=o("conv64_2"),d=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),g=o("conv128_2"),v=o("conv256_down"),m=o("conv256_1"),y=o("conv256_2"),x=o("conv256_down_out"),w=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!function o2e(n){return Mp(n,2)}(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var _={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:f,conv64_3:d,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:v,conv256_1:m,conv256_2:y,conv256_down_out:x,fc:w};return Gs(n,e),{params:_,paramMappings:e}}function rs(n,e){var t=function Z2e(n,e){return rE(n,e,[1,1],!0)}(n,e.conv1);return t=u5(t,e.conv2),t=Wt(t,n),Jn(t)}function n1(n,e){var t=c5(n,e.conv1);t=u5(t,e.conv2);var r=rp(n,2,2,"valid"),o=zn(r.shape),i=r.shape[3]!==t.shape[3];if(r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2]){var s=t.shape.slice();s[1]=1;var u=zn(s),c=(t=Fo([t,u],1)).shape.slice();c[2]=1;var l=zn(c);t=Fo([t,l],2)}return r=i?Fo([r,o],3):r,t=Wt(r,t),Jn(t)}!function(n){ht(function e(){return null!==n&&n.apply(this,arguments)||this},n)}(s5);var nbe=function(n){function e(){return n.call(this,"FaceRecognitionNet")||this}return ht(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Ve(function(){var s=c5(Fp(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(oe(256)),r.conv32_down);s=rs(s=Tf(s,3,2,"valid"),r.conv32_1),s=rs(s,r.conv32_2),s=rs(s,r.conv32_3),s=rs(s=n1(s,r.conv64_down),r.conv64_1),s=rs(s,r.conv64_2),s=rs(s,r.conv64_3),s=rs(s=n1(s,r.conv128_down),r.conv128_1),s=rs(s,r.conv128_2),s=rs(s=n1(s,r.conv256_down),r.conv256_1);var u=(s=n1(s=rs(s,r.conv256_2),r.conv256_down_out)).mean([1,2]);return X2(u,r.fc)})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Ke(this,void 0,void 0,function(){var r,o,i,a=this;return Ye(this,function(s){switch(s.label){case 0:return[4,br(t)];case 1:return r=s.sent(),o=Ve(function(){return Mr(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return tbe(t)},e.prototype.extractParams=function(t){return function J2e(n){var e=zs(n),t=e.extractWeights,r=e.getRemainingWeights,o=[],i=Q2e(t,o),s=i.extractResidualLayerParams,u=(0,i.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),m=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),_=s(589824,256,3,"conv256_2"),b=s(589824,256,3,"conv256_down_out"),C=Ve(function(){return Iu(W0(t(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:f,conv64_down:d,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:v,conv128_1:m,conv128_2:y,conv256_down:x,conv256_1:w,conv256_2:_,conv256_down_out:b,fc:C},paramMappings:o}}(t)},e}(js),l5=function(){function n(e){var t=void 0===e?{}:e,r=t.minFaceSize,o=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function os(n,e,t){return Ve(function(){var r=Rs(n,e.filters,t,"same");return r=Wt(r,e.batch_norm_offset),G2(r,0,6)})}var sbe=.0010000000474974513;function dbe(n,e,t){var r=n.arraySync(),o=Math.min(r[e][0],r[e][2]),i=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),c=Math.min(r[t][1],r[t][3]),l=Math.max(r[t][0],r[t][2]),f=Math.max(r[t][1],r[t][3]),d=(a-o)*(s-i),h=(l-u)*(f-c);if(d<=0||h<=0)return 0;var p=Math.max(o,u),g=Math.max(i,c),v=Math.min(a,l),m=Math.min(s,f),y=Math.max(v-p,0)*Math.max(m-g,0);return y/(d+h-y)}function Qf(n,e){return Ve(function(){var t=n.shape[0];return{boxPredictionEncoding:ta(fa(n,e.box_encoding_predictor),[t,-1,1,4]),classPrediction:ta(fa(n,e.class_predictor),[t,-1,3])}})}var r1=function(){function n(e){var t=void 0===e?{}:e,r=t.minConfidence,o=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),f5=function(n){function e(){return n.call(this,"SsdMobilenetv1")||this}return ht(e,n),e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Ve(function(){var o=t.toBatchTensor(512,!1).toFloat(),a=function lbe(n,e){return Ve(function(){var t=null,r=os(n,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(i,a){var s=a+1,u=function cbe(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}(s);r=function ube(n,e,t){return Ve(function(){var r=q2(n,e.filters,t,"same");return r=jk(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,sbe),G2(r,0,6)})}(r,i.depthwise_conv,u),r=os(r,i.pointwise_conv,[1,1]),11===s&&(t=r)}),null===t)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}($a(Os(o,oe(.007843137718737125)),oe(1)),r.mobilenetv1),s=function vbe(n,e,t){return Ve(function(){var r=os(n,t.conv_0,[1,1]),o=os(r,t.conv_1,[2,2]),i=os(o,t.conv_2,[1,1]),a=os(i,t.conv_3,[2,2]),s=os(a,t.conv_4,[1,1]),u=os(s,t.conv_5,[2,2]),c=os(u,t.conv_6,[1,1]),l=os(c,t.conv_7,[2,2]),f=Qf(e,t.box_predictor_0),d=Qf(n,t.box_predictor_1),h=Qf(o,t.box_predictor_2),p=Qf(a,t.box_predictor_3),g=Qf(u,t.box_predictor_4),v=Qf(l,t.box_predictor_5);return{boxPredictions:Fo([f.boxPredictionEncoding,d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:Fo([f.classPrediction,d.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,v.classPrediction],1)}})}(a.out,a.conv11,r.prediction_layer);return function gbe(n,e,t){return Ve(function(){var r=n.shape[0],o=function pbe(n,e){var t=function hbe(n){var e=Mr(Iu(n,[1,0])),t=[$a(e[2],e[0]),$a(e[3],e[1])];return{sizes:t,centers:[Wt(e[0],Ns(t[0],oe(2))),Wt(e[1],Ns(t[1],oe(2)))]}}(n),r=t.sizes,o=t.centers,i=Mr(Iu(e,[1,0])),a=Ns(Os(z2(Ns(i[2],oe(5))),r[0]),oe(2)),s=Wt(Os(Ns(i[0],oe(10)),r[0]),o[0]),u=Ns(Os(z2(Ns(i[3],oe(5))),r[1]),oe(2)),c=Wt(Os(Ns(i[1],oe(10)),r[1]),o[1]);return Iu(na([$a(s,a),$a(c,u),Wt(s,a),Wt(c,u)]),[1,0])}(ta(If(t.extra_dim,[r,1,1]),[-1,4]),ta(n,[-1,4]));o=ta(o,[r,o.shape[0]/r,4]);var i=Hk(Au(e,[0,0,1],[-1,-1,-1])),a=Au(i,[0,0,0],[-1,-1,1]);return a=ta(a,[r,a.shape[1]]),{boxes:Mr(o),scores:Mr(a)}})}(s.boxPredictions,s.classPredictions,r.output_layer)})},e.prototype.forward=function(t){return Ke(this,void 0,void 0,function(){var r;return Ye(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,br(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},e.prototype.locateFaces=function(t,r){return void 0===r&&(r={}),Ke(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,d,h,p,g,v,y,x,w,_,b,C,E;return Ye(this,function(S){switch(S.label){case 0:return o=new r1(r),i=o.maxResults,a=o.minConfidence,[4,br(t)];case 1:for(s=S.sent(),u=this.forwardInput(s),f=(c=u.boxes)[0],d=(l=u.scores)[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return v=(g=Array).from,[4,d.data()];case 2:return p=v.apply(g,[S.sent()]),y=function fbe(n,e,t,r,o){var a=Math.min(t,n.shape[0]),s=e.map(function(l,f){return{score:l,boxIndex:f}}).filter(function(l){return l.score>o}).sort(function(l,f){return f.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var f=l.score,d=c.length-1;d>=0;--d){var h=dbe(n,l.boxIndex,c[d]);if(0!==h&&(l.score*=u(h),l.score<=o))break}f===l.score&&c.push(l.boxIndex)}}),c}(f,p,i,.5,a),x=s.getReshapedInputDimensions(0),_=(w=s.inputSize)/x.width,b=w/x.height,C=f.arraySync(),E=y.map(function(A){var D=[Math.max(0,C[A][0]),Math.min(1,C[A][2])].map(function(H){return H*b}),M=D[0],L=D[1],B=[Math.max(0,C[A][1]),Math.min(1,C[A][3])].map(function(H){return H*_}),U=B[0];return new li(p[A],new FC(U,M,B[1]-U,L-M),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),f.dispose(),d.dispose(),[2,E]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function abe(n){var e=[],t=function ibe(n,e){var t=$u(n,e);function r(c,l,f){return{filters:t(c+"/Conv2d_"+l+"_pointwise/weights",4,f+"/filters"),batch_norm_offset:t(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,f+"/batch_norm_offset")}}function o(c){var l="mobilenetv1/conv_"+c,f="MobilenetV1/Conv2d_"+c+"_depthwise",d=l+"/depthwise_conv",h=l+"/pointwise_conv";return{depthwise_conv:{filters:t(f+"/depthwise_weights",4,d+"/filters"),batch_norm_scale:t(f+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),batch_norm_offset:t(f+"/BatchNorm/beta",1,d+"/batch_norm_offset"),batch_norm_mean:t(f+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),batch_norm_variance:t(f+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,h)}}function a(c,l){return{filters:t(c+"/weights",4,l+"/filters"),bias:t(c+"/biases",1,l+"/bias")}}function s(c){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(n,e),r=t.extractMobilenetV1Params,o=t.extractPredictionLayerParams,i=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!qm(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Gs(n,e),{params:a,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function obe(n){var e=[],t=zs(n),r=t.extractWeights,o=t.getRemainingWeights,i=function rbe(n,e){function r(u,c,l,f,d){var h=ea(n(u*c*l*l),[l,l,u,c]),p=ni(n(c));return e.push({paramPath:f+"/filters"},{paramPath:f+"/"+(d?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,f){var d=r(u,c,l,f,!0);return{filters:d.filters,batch_norm_offset:d.bias}}function i(u,c,l){var f=function t(u,c){var l=ea(n(9*u),[3,3,u,1]),f=ni(n(u)),d=ni(n(u)),h=ni(n(u)),p=ni(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:f,batch_norm_offset:d,batch_norm_mean:h,batch_norm_variance:p}}(u,l+"/depthwise_conv");return{depthwise_conv:f,pointwise_conv:o(u,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function a(){return{conv_0:o(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function s(){return{conv_0:o(1024,256,1,"prediction_layer/conv_0"),conv_1:o(256,512,3,"prediction_layer/conv_1"),conv_2:o(512,128,1,"prediction_layer/conv_2"),conv_3:o(128,256,3,"prediction_layer/conv_3"),conv_4:o(256,128,1,"prediction_layer/conv_4"),conv_5:o(128,256,3,"prediction_layer/conv_5"),conv_6:o(256,64,1,"prediction_layer/conv_6"),conv_7:o(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,e),s=i.extractPredictionLayerParams,u=(0,i.extractMobilenetV1Params)(),c=s(),f={extra_dim:E2(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:f},paramMappings:e}}(t)},e}(js);!function(n){ht(function e(){return null!==n&&n.apply(this,arguments)||this},n)}(f5);var d5=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return ht(e,n),e}(KC),Up=function(){function n(){}return n.prototype.then=function(e){return Ke(this,void 0,void 0,function(){var t;return Ye(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return Ke(this,void 0,void 0,function(){return Ye(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function h5(n,e){return Object.assign({},n,{descriptor:e})}function o1(n,e,t,r,o){return void 0===o&&(o=function(i){return i.alignedRect}),Ke(this,void 0,void 0,function(){var i,a,s,u,c;return Ye(this,function(l){switch(l.label){case 0:return i=n.map(function(f){return QC(f)?o(f):f.detection}),(s=r)?[3,5]:e instanceof se?[4,nE(e,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,tE(e,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,t(a=s)];case 6:return c=l.sent(),a.forEach(function(f){return f instanceof se&&f.dispose()}),[2,c]}})})}function oE(n,e,t,r,o){return Ke(this,void 0,void 0,function(){var i=this;return Ye(this,function(a){return[2,o1([n],e,function(s){return Ke(i,void 0,void 0,function(){return Ye(this,function(u){return[2,t(s[0])]})})},r,o)]})})}var i1=2,a1=12;function iE(n,e){var r=e[1];return{height:Math.floor(e[0]*n),width:Math.floor(r*n)}}var aE=function(n){function e(t,r,o,i){return n.call(this,{left:t,top:r,right:o,bottom:i},!0)||this}return ht(e,n),e}(Ja);function p5(n){return Ve(function(){return Os($a(n,oe(127.5)),oe(.0078125))})}function Jf(n,e){return Ve(function(){return Wt(Jn(n),Os(e,X0(Jn(X0(n)))))})}function sE(n,e,t){return void 0===t&&(t=!1),Ve(function(){var r=fa(n,e.conv1,"valid");return r=Jf(r,e.prelu1_alpha),r=Jf(r=fa(r=Tf(r,t?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),Jf(r=fa(r=t?r:Tf(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function Ibe(n,e,t,r,o){o.stage1=[];var i=e.map(function(d){return Ve(function(){var h={scale:d},p=function Sbe(n,e){return Ve(function(){var t=iE(e,n.shape.slice(1)),a=p5(xF.resizeBilinear(n,[t.height,t.width]));return Iu(a,[0,2,1,3])})}(n,d),g=Date.now(),v=function Ebe(n,e){return Ve(function(){var t=sE(n,e,!0),r=fa(t,e.conv4_1,"valid"),o=Ti(J0(r,3),3);return{prob:Cu($a(r,o),3),regions:fa(t,e.conv4_2,"valid")}})}(p,r),m=v.prob,y=v.regions;return h.pnet=Date.now()-g,{scoresTensor:Mr(Mr(m,3)[1])[0],regionsTensor:Mr(y)[0],scale:d,statsForScale:h}})}),a=i.map(function(d){var h=d.scoresTensor,p=d.regionsTensor,v=d.statsForScale,m=function Abe(n,e,t,r){for(var o=[],i=n.arraySync(),a=0;a<n.shape[0];a++)for(var s=0;s<n.shape[1];s++)i[a][s]>=r&&o.push(new Ft(s,a));return o.map(function(c){var l=new Xm(Math.round((c.y*i1+1)/t),Math.round((c.x*i1+1)/t),Math.round((c.y*i1+a1)/t),Math.round((c.x*i1+a1)/t)),f=i[c.y][c.x],d=e.arraySync();return{cell:l,score:f,region:new aE(d[c.y][c.x][0],d[c.y][c.x][1],d[c.y][c.x][2],d[c.y][c.x][3])}})}(h,p,d.scale,t);if(h.dispose(),p.dispose(),!m.length)return o.stage1.push(v),[];var y=Date.now(),x=kp(m.map(function(w){return w.cell}),m.map(function(w){return w.score}),.5);return v.nms=Date.now()-y,v.numBoxes=x.length,o.stage1.push(v),x.map(function(w){return m[w]})}),s=a.reduce(function(d,h){return d.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),f=kp(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);o.stage1_nms=Date.now()-l,c=f.map(function(d){return s[d].score}),u=f.map(function(d){return s[d]}).map(function(d){var h=d.cell,p=d.region;return new Xm(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function g5(n,e,t){var r=t.width,o=t.height;return Ke(this,void 0,void 0,function(){var i,a,s,u=this;return Ye(this,function(c){switch(c.label){case 0:return i=es(n),[4,Promise.all(e.map(function(l){return Ke(u,void 0,void 0,function(){var f,v,m,y;return Ye(this,function(x){return f=l.padAtBorders(n.height,n.width),y=i.getImageData(v=f.x-1,m=f.y-1,f.ex-v,f.ey-m),[2,eo.isNodejs()?Zm(y):createImageBitmap(y)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var d=es(Ym({width:r,height:o}));d.drawImage(l,0,0,r,o);for(var h=d.getImageData(0,0,r,o).data,p=[],g=0;g<h.length;g+=4)p.push(h[g+2]),p.push(h[g+1]),p.push(h[g]);s.push(p)}),[2,s.map(function(l){return Ve(function(){return p5(Iu(ea(l,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function Tbe(n,e,t,r,o){return Ke(this,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p,g,v,m,y;return Ye(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,g5(n,e,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var _=function Dbe(n,e){return Ve(function(){var t=sE(n,e),i=Jf(ns(ta(t,[t.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),a=ns(i,e.fc2_1),s=Ti(J0(a,1),1),u=Cu($a(a,s),1),c=ns(i,e.fc2_2);return{scores:Mr(u,1)[1],regions:c}})}(w,r);return w.dispose(),_}),o.stage2_rnet=Date.now()-i,u=s.length>1?Fo(s.map(function(w){return w.scores})):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[x.sent()]),u.dispose(),d=c.map(function(w,_){return{score:w,idx:_}}).filter(function(w){return w.score>t}).map(function(w){return w.idx}),h=d.map(function(w){return e[w]}),p=d.map(function(w){return c[w]}),g=[],v=[],h.length>0&&(i=Date.now(),m=kp(h,p,.7),o.stage2_nms=Date.now()-i,y=m.map(function(w){var _=s[d[w]].regions.arraySync();return new aE(_[0][0],_[0][1],_[0][2],_[0][3])}),v=m.map(function(w){return p[w]}),g=m.map(function(w,_){return h[w].calibrate(y[_])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:g,scores:v}]}})})}function Nbe(n,e,t,r,o){return Ke(this,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p,g,v,m,y,x;return Ye(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,g5(n,e,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(_){var b=function Rbe(n,e){return Ve(function(){var t=sE(n,e);t=Jf(t=fa(t=Tf(t,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var i=Jf(ns(ta(t,[t.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),a=ns(i,e.fc2_1),s=Ti(J0(a,1),1),u=Cu($a(a,s),1),c=ns(i,e.fc2_2),l=ns(i,e.fc2_3);return{scores:Mr(u,1)[1],regions:c,points:l}})}(_,r);return _.dispose(),b}),o.stage3_onet=Date.now()-i,u=s.length>1?Fo(s.map(function(_){return _.scores})):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[w.sent()]),u.dispose(),d=c.map(function(_,b){return{score:_,idx:b}}).filter(function(_){return _.score>t}).map(function(_){return _.idx}),h=d.map(function(_){var b=s[_].regions.arraySync();return new aE(b[0][0],b[0][1],b[0][2],b[0][3])}),p=d.map(function(_,b){return e[_].calibrate(h[b])}),g=d.map(function(_){return c[_]}),v=[],m=[],y=[],p.length>0&&(i=Date.now(),x=kp(p,g,.7,!1),o.stage3_nms=Date.now()-i,v=x.map(function(_){return p[_]}),m=x.map(function(_){return g[_]}),y=x.map(function(_,b){return Array(5).fill(0).map(function(C,E){var S=s[_].points.arraySync();return new Ft(S[0][E]*(v[b].width+1)+v[b].left,S[0][E+5]*(v[b].height+1)+v[b].top)})})),s.forEach(function(_){_.regions.dispose(),_.scores.dispose(),_.points.dispose()}),[2,{boxes:v,scores:m,points:y}]}})})}var Obe=function(n){function e(){return n.call(this,"Mtcnn")||this}return ht(e,n),e.prototype.forwardInput=function(t,r){return void 0===r&&(r={}),Ke(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,d,h,p,g,v,m,x,w,_,b,C,E;return Ye(this,function(S){switch(S.label){case 0:if(!(o=this.params))throw new Error("Mtcnn - load model before inference");if(!(i=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Ve(function(){return function ybe(n){return Ve(function(){return na(Mr(n,3).reverse(),3)})}(Ti(dme.fromPixels(i)).toFloat())}),c=function(A){return u.dispose(),a.total=Date.now()-s,A},l=u.shape.slice(1),f=l[0],d=l[1],h=new l5(r),p=h.minFaceSize,g=h.scaleFactor,v=h.maxNumScales,m=h.scoreThresholds,x=(h.scaleSteps||function Cbe(n,e,t){for(var i=a1/n,a=[],s=Math.min(t[0],t[1])*i,u=0;s>=12;)a.push(i*Math.pow(e,u)),s*=e,u+=1;return a}(p,g,[f,d])).filter(function(A){var D=iE(A,[f,d]);return Math.min(D.width,D.height)>a1}).slice(0,v),a.scales=x,a.pyramid=x.map(function(A){return iE(A,[f,d])}),w=Date.now(),[4,Ibe(u,x,m[0],o.pnet,a)];case 1:return _=S.sent(),a.total_stage1=Date.now()-w,_.boxes.length?(a.stage2_numInputBoxes=_.boxes.length,w=Date.now(),[4,Tbe(i,_.boxes,m[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return b=S.sent(),a.total_stage2=Date.now()-w,b.boxes.length?(a.stage3_numInputBoxes=b.boxes.length,w=Date.now(),[4,Nbe(i,b.boxes,m[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return C=S.sent(),a.total_stage3=Date.now()-w,E=C.boxes.map(function(A,D){return t1(Bp({},new li(C.scores[D],new FC(A.left/d,A.top/f,A.width/d,A.height/f),{height:f,width:d})),new j2e(C.points[D].map(function(M){return M.sub(new Ft(A.left,A.top)).div(new Ft(A.width,A.height))}),{width:A.width,height:A.height}))}),[2,c({results:E,stats:a})]}})})},e.prototype.forward=function(t,r){return void 0===r&&(r={}),Ke(this,void 0,void 0,function(){var o;return Ye(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,br(t)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return void 0===r&&(r={}),Ke(this,void 0,void 0,function(){var o;return Ye(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,br(t)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function bbe(n){var e=[],t=function _be(n,e){var t=$u(n,e);function r(l){return{filters:t(l+"/weights",4,l+"/filters"),bias:t(l+"/bias",1)}}function o(l){return{weights:t(l+"/weights",2),bias:t(l+"/bias",1)}}function i(l){return t(l,1)}function a(l){return{conv1:r(l+"/conv1"),prelu1_alpha:i(l+"/prelu1_alpha"),conv2:r(l+"/conv2"),prelu2_alpha:i(l+"/prelu2_alpha"),conv3:r(l+"/conv3"),prelu3_alpha:i(l+"/prelu3_alpha")}}return{extractPNetParams:function s(){var l=a("pnet"),f=r("pnet/conv4_1"),d=r("pnet/conv4_2");return As({},l,{conv4_1:f,conv4_2:d})},extractRNetParams:function u(){var l=a("rnet"),f=o("rnet/fc1"),d=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return As({},l,{fc1:f,prelu4_alpha:d,fc2_1:h,fc2_2:p})},extractONetParams:function c(){var l=a("onet"),f=r("onet/conv4"),d=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),g=o("onet/fc2_1"),v=o("onet/fc2_2"),m=o("onet/fc2_3");return As({},l,{conv4:f,prelu4_alpha:d,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:v,fc2_3:m})}}}(n,e),o=t.extractRNetParams,i=t.extractONetParams,a=(0,t.extractPNetParams)(),s=o(),u=i();return Gs(n,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function wbe(n){var e=zs(n),r=e.getRemainingWeights,o=[],i=function xbe(n,e){var t=Km(n,e),r=WC(n,e);function o(c,l){var f=ni(n(c));return e.push({paramPath:l}),f}function i(c,l,f){return void 0===f&&(f=!1),{conv1:t(c[0],c[1],3,l+"/conv1"),prelu1_alpha:o(c[1],l+"/prelu1_alpha"),conv2:t(c[1],c[2],3,l+"/conv2"),prelu2_alpha:o(c[2],l+"/prelu2_alpha"),conv3:t(c[2],c[3],f?2:3,l+"/conv3"),prelu3_alpha:o(c[3],l+"/prelu3_alpha")}}return{extractPNetParams:function a(){var c=i([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),f=t(32,4,1,"pnet/conv4_2");return As({},c,{conv4_1:l,conv4_2:f})},extractRNetParams:function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),f=o(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return As({},c,{fc1:l,prelu4_alpha:f,fc2_1:d,fc2_2:h})},extractONetParams:function u(){var c=i([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),f=o(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),v=r(256,10,"onet/fc2_3");return As({},c,{conv4:l,prelu4_alpha:f,fc1:d,prelu5_alpha:h,fc2_1:p,fc2_2:g,fc2_3:v})}}}(e.extractWeights,o),s=i.extractRNetParams,u=i.extractONetParams,c=(0,i.extractPNetParams)(),l=s(),f=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:f},paramMappings:o}}(t)},e}(js),Mbe=.4,Pbe=[new Ft(1.603231,2.094468),new Ft(6.041143,7.080126),new Ft(2.882459,3.518061),new Ft(4.266906,5.178857),new Ft(9.041765,10.66308)],kbe=[117.001,114.697,97.404],Fbe=function(n){function e(){return n.call(this,{withSeparableConvs:!0,iouThreshold:Mbe,classes:["face"],anchors:Pbe,meanRgb:kbe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return ht(e,n),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ke(this,void 0,void 0,function(){return Ye(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return[2,i.sent().map(function(a){return new li(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}($6),Lbe=.4,Bbe=[new Ft(.738768,.874946),new Ft(2.42204,2.65704),new Ft(4.30971,7.04493),new Ft(10.246,4.59428),new Ft(12.6868,11.8741)],Vbe=[new Ft(1.603231,2.094468),new Ft(6.041143,7.080126),new Ft(2.882459,3.518061),new Ft(4.266906,5.178857),new Ft(9.041765,10.66308)],Ube=[117.001,114.697,97.404],Gbe=function(n){function e(t){void 0===t&&(t=!0);var o=Object.assign({},{withSeparableConvs:t,iouThreshold:Lbe,classes:["face"]},t?{anchors:Vbe,meanRgb:Ube}:{anchors:Bbe,withClassScores:!0});return n.call(this,o)||this}return ht(e,n),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ke(this,void 0,void 0,function(){return Ye(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return[2,i.sent().map(function(a){return new li(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}($6),Lt={ssdMobilenetv1:new f5,tinyFaceDetector:new Fbe,tinyYolov2:new Gbe,mtcnn:new Obe,faceLandmark68Net:new s5,faceLandmark68TinyNet:new K2e,faceRecognitionNet:new nbe,faceExpressionNet:new D2e,ageGenderNet:new z2e};function v5(n,e){return Object.assign({},n,{age:e})}function m5(n,e,t){return Object.assign({},n,{gender:e,genderProbability:t})}var y5=function(n){function e(t,r,o){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=o,i}return ht(e,n),e}(Up),uE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r,o=this;return Ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,o1(t=i.sent(),this.input,function(a){return Ke(o,void 0,void 0,function(){return Ye(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Lt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(a,s){return e5(a,r[s])})]}})})},e.prototype.withAgeAndGender=function(){return new dE(this,this.input)},e}(y5),cE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r;return Ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(t=o.sent())?[4,oE(t,this.input,function(i){return Lt.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,e5(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new hE(this,this.input)},e}(y5),lE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.withAgeAndGender=function(){return new pE(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vE(this,this.input)},e}(uE),fE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.withAgeAndGender=function(){return new gE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new mE(this,this.input)},e}(cE),x5=function(n){function e(t,r,o){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=o,i}return ht(e,n),e}(Up),dE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r,o=this;return Ye(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,o1(t=i.sent(),this.input,function(a){return Ke(o,void 0,void 0,function(){return Ye(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Lt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(a,s){var u=r[s],c=u.age;return v5(m5(a,u.gender,u.genderProbability),c)})]}})})},e.prototype.withFaceExpressions=function(){return new uE(this,this.input)},e}(x5),hE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r,o;return Ye(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(t=s.sent())?[4,oE(t,this.input,function(u){return Lt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,[2,v5(m5(t,r.gender,r.genderProbability),o)]}})})},e.prototype.withFaceExpressions=function(){return new cE(this,this.input)},e}(x5),pE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.withFaceExpressions=function(){return new lE(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vE(this,this.input)},e}(dE),gE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.withFaceExpressions=function(){return new fE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new mE(this,this.input)},e}(hE),w5=function(n){function e(t,r){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o}return ht(e,n),e}(Up),vE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t;return Ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,o1(t=o.sent(),this.input,function(i){return Promise.all(i.map(function(a){return Lt.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,o.sent().map(function(i,a){return h5(t[a],i)})]}})})},e.prototype.withFaceExpressions=function(){return new lE(this,this.input)},e.prototype.withAgeAndGender=function(){return new pE(this,this.input)},e}(w5),mE=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r;return Ye(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(t=o.sent())?[4,oE(t,this.input,function(i){return Lt.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,h5(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new fE(this,this.input)},e.prototype.withAgeAndGender=function(){return new gE(this,this.input)},e}(w5),_5=function(n){function e(t,r,o){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i.useTinyLandmarkNet=o,i}return ht(e,n),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Lt.faceLandmark68TinyNet:Lt.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Up),zbe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r,o,i,a,s=this;return Ye(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(c){return c.detection}),this.input instanceof se?[4,nE(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,tE(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof se&&c.dispose()}),[2,t.map(function(c,l){return t1(c,a[l])})]}})})},e.prototype.withFaceExpressions=function(){return new lE(this,this.input)},e.prototype.withAgeAndGender=function(){return new pE(this,this.input)},e.prototype.withFaceDescriptors=function(){return new vE(this,this.input)},e}(_5),jbe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r,o,i,a;return Ye(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(t=s.sent())?(r=t.detection,this.input instanceof se?[4,nE(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,tE(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((o=i)[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof se&&u.dispose()}),[2,t1(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new fE(this,this.input)},e.prototype.withAgeAndGender=function(){return new gE(this,this.input)},e.prototype.withFaceDescriptor=function(){return new mE(this,this.input)},e}(_5),b5=function(n){function e(t,r){void 0===r&&(r=new r1);var o=n.call(this)||this;return o.input=t,o.options=r,o}return ht(e,n),e}(Up),$be=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r,o,i;return Ye(this,function(a){switch(a.label){case 0:return r=(t=this).input,(o=t.options)instanceof l5?[4,Lt.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(!(i=o instanceof d5?function(s){return Lt.tinyFaceDetector.locateFaces(s,o)}:o instanceof r1?function(s){return Lt.ssdMobilenetv1.locateFaces(s,o)}:o instanceof KC?function(s){return Lt.tinyYolov2.locateFaces(s,o)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return Ke(t,void 0,void 0,function(){var o;return Ye(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return Bp({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new zbe(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new uE(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new dE(this.runAndExtendWithFaceDetections(),this.input)},e}(b5),qbe=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return ht(e,n),e.prototype.run=function(){return Ke(this,void 0,void 0,function(){var t,r;return Ye(this,function(o){switch(o.label){case 0:return[4,new $be(this.input,this.options)];case 1:return t=o.sent(),r=t[0],t.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return Ke(t,void 0,void 0,function(){var o;return Ye(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?Bp({},o):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new jbe(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new cE(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new hE(this.runAndExtendWithFaceDetection(),this.input)},e}(b5);function C5(n,e){var t=new rl(e.width,e.height),r=t.width,o=t.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(n))return n.map(function(s){return C5(s,{width:r,height:o})});if(QC(n)){var i=n.detection.forSize(r,o),a=n.unshiftedLandmarks.forSize(i.box.width,i.box.height);return t1(Bp(n,i),a)}return Lp(n)?Bp(n,n.detection.forSize(r,o)):n instanceof Zf||n instanceof li?n.forSize(r,o):n}!function(){function n(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof eE)return a;if(a instanceof Float32Array)return new eE(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new eE(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return function Kbe(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(r,e)}).reduce(function(r,o){return r+o},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){return new i5(r.label,t.computeMeanDistance(e,r.descriptors))}).reduce(function(r,o){return r.distance<o.distance?r:o})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new i5("unknown",t.distance)}}();var Ybe=As({},ki,il);const Zbe=["canvas"],Qbe=["shot"];function Jbe(n,e){if(1&n){const t=Na();J(0,"div",12)(1,"div",13),de("click",function(){return xe(t),we(ue(2).entrada())}),J(2,"div",14),ae(3),ee(),sn(4,"div",15),ee()()}if(2&n){const t=ue().$implicit;ke(3),zr(t("registerEnter"))}}function eCe(n,e){if(1&n){const t=Na();J(0,"div",16),sn(1,"img",17),J(2,"h1"),ae(3),ee(),J(4,"h2"),ae(5),ee(),J(6,"div",18),ae(7),ee(),J(8,"div",12)(9,"div",19),de("click",function(){return xe(t),we(ue(2).confirmar())}),J(10,"div",14),ae(11),ee(),sn(12,"div",15),ee(),J(13,"div",20),de("click",function(){return xe(t),we(ue(2).cancelar())}),J(14,"div",14),ae(15),ee(),sn(16,"div",15),ee()()()}if(2&n){const t=ue().$implicit,r=ue();ke(3),zr(t("confirmpopup.title")),ke(2),zr(t("confirmpopup.subtitle")),ke(2),zr(r.userName),ke(4),zr(t("confirmpopup.accept")),ke(4),zr(t("confirmpopup.reject"))}}function tCe(n,e){if(1&n&&(J(0,"div",23),ae(1),ee()),2&n){const t=ue(3);ke(1),xi(" ",t.countDown," ")}}function nCe(n,e){if(1&n&&(J(0,"div",23),ae(1),ee()),2&n){const t=ue(3);ke(1),xi(" ",t.countDown," ")}}function rCe(n,e){if(1&n&&(J(0,"div",21),pn(1,tCe,2,1,"div",22),pn(2,nCe,2,1,"div",22),ee()),2&n){const t=ue(2);ke(1),At("ngIf",t.countDown%2==0),ke(1),At("ngIf",t.countDown%2!=0)}}function oCe(n,e){if(1&n&&(Ta(0),J(1,"div",1),sn(2,"img",2),ee(),sn(3,"video",3,4)(5,"div",null,5)(7,"canvas",6,7),J(9,"div",8),pn(10,Jbe,5,1,"div",9),ee(),pn(11,eCe,17,5,"div",10),pn(12,rCe,3,2,"div",11),Ra()),2&n){const t=ue();ke(3),At("autoplay",!0),ke(7),At("ngIf",!t.countDownActive),ke(1),At("ngIf",t.confirm),ke(1),At("ngIf",t.countDownActive)}}let iCe=(()=>{class n{onResize(t){this.restart()}constructor(t,r,o,i,a,s){var u=this;this.elRef=t,this.identificaApiService=r,this.translocoService=o,this.detectService=i,this.router=a,this._platform=s,this.waiting=!1,this.subscriptions=[],this.countDown=0,this._confirm_identity=!1,this.countDownActive=!1,this.confirm=!1,this.init=!1,this.detect_Faces=lo(function*(){null==u.videoInput&&(yield u.startVideo(!0));let c=function(){var f=lo(function*(){if(u.videoInput.readyState<3)return void setTimeout(c,1e3);try{u.canvas=yield Zm(u.videoInput)}catch(p){console.log("posible problema con el video"),console.log(p)}window;let h=window.innerHeight;u.canvasEl=u.canvasRef.nativeElement,u.canvasEl.innerHTML="",u.canvasEl.appendChild(u.canvas),u.canvas.setAttribute("id","canvas"),u.canvas.setAttribute("class","canvas"),u.canvas.width=.5625*u.videoInput.videoHeight,u.canvas.height=h,u.displaySize={width:u.videoInput.videoWidth,height:u.videoInput.videoHeight},function g2e(n,e,t){void 0===t&&(t=!1);var r=t?jC(e):e,o=r.width,i=r.height;n.width=o,n.height=i}(u.canvas,u.displaySize),clearInterval(u.interval),u.interval=setInterval(lo(function*(){u.detection=yield function Xbe(n,e){return void 0===e&&(e=new r1),new qbe(n,e)}(u.videoInput,new d5({inputSize:160,scoreThreshold:.5})),null!=u.detection?(u.resizedDetections=C5(u.detection,u.displaySize),u.canvas.getContext("2d").clearRect(0,0,u.canvas.width,u.canvas.height),Ybe.drawDetections(u.canvas,u.resizedDetections)):u.canvas.getContext("2d").clearRect(0,0,u.canvas.width,u.canvas.height)}),100)});return function(){return f.apply(this,arguments)}}();if(!u.subscription){if(null==u.videoInput)return void u.startVideo(!0);u.videoInput.addEventListener("play",c),u.subscription=!0}u.videoInput.currentTime>0&&!u.videoInput.paused&&!u.videoInput.ended&&u.videoInput.readyState>u.videoInput.HAVE_CURRENT_DATA||(yield u.videoInput.play())}),this.waiting=!1,Promise.all([Lt.tinyFaceDetector.loadFromUri("/detectlite/assets/models"),Lt.ssdMobilenetv1.loadFromUri("/detectlite/assets/models")]).then(()=>{})}ngOnInit(){this.init=!1,2!=this.detectService.step&&this.router.navigate(["../"]),this.videoInput=this.elRef.nativeElement.querySelector("video"),null!=this.videoInput&&(this.videoInput.stream=null),null!=this.interval&&clearInterval(this.interval),this.countDownActive=!1,this._deviceId=null==this.detectService.device?null:this.detectService.device.id,this._pin=this.detectService.pin,this._rut=this.detectService.rut,this._plate=this.detectService.plate,this._requires_pin=this.detectService.requires_pin,this._confirm_identity=this.detectService.confirm_identity,this._useTime=this.detectService.useTime,this._timePhoto=this.detectService.timePhoto,this.startVideo()}startVideo(t=!1){var r=this;return lo(function*(){if(function B$(n){return n===t3}(r._platform)&&"mediaDevices"in navigator){if(r.waiting)return void(r.preRestart=!0);r.waiting=!0;let o=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!1});if(r.videoInput=r.elRef.nativeElement.querySelector("video"),r.waiting=!1,null==r.videoInput)return;r.videoInput.srcObject=o,r.init=!0,r.detect_Faces()}})()}stopVideo(){null!=this.videoInput&&(null!=this.canvas&&this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.videoInput.pause(),this.videoInput.currentTime=0,this.videoInput.srcObject?.getTracks().forEach(o=>{o.stop()}),this.videoInput.srcObject=null,this.videoInput.stream=null,this.videoInput=null)}restart(){this.init||(this.preRestart=!0),null!=this.videoInput?(clearInterval(this.interval),this.videoInput.pause(),this.videoInput.currentTime=0,null!=this.canvas&&this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.detect_Faces()):this.startVideo(!0)}takePicture(){const t=this.shot.nativeElement;return t.setAttribute("width",this.videoInput.videoWidth),t.setAttribute("height",this.videoInput.videoHeight),t.getContext("2d").drawImage(this.videoInput,0,0,this.videoInput.videoWidth,this.videoInput.videoHeight),t.toDataURL("image/jpeg")}entrada(){var t=this;return lo(function*(){t.clearSubscriptions(),t.takePicture(),t.sendEventWrapper("enter",t._confirm_identity)})()}salida(){var t=this;return lo(function*(){t.clearSubscriptions(),console.log("salida presionado"),t.sendEventWrapper("exit",t._confirm_identity)})()}sendEventWrapper(t,r,o=!1){this.countDown=this._timePhoto,this._useTime?(this.countDownActive=!0,null==this.interval_countdown&&(this.interval_countdown=setInterval(()=>{this.countDown>0?this.countDown--:(clearInterval(this.interval_countdown),this.interval_countdown=null,this.countDownActive=!1,this.sendEvent(t,r,o))}))):this.sendEvent(t,r,o)}sendEvent(t,r,o=!1){this.clearSubscriptions(),this.lastEvent=t;let i=o&&null!=this.lastPicture?this.lastPicture:this.takePicture();this.lastPicture=i,this.showLoading(this.translocoService.translate("enter"==t?"registerloading.enter":"registerloading.exit")),clearInterval(this.interval),this.stopVideo();let a=this.identificaApiService.oldEvent(this._rut,this._plate,i,t,r,this._deviceId).subscribe({next:s=>{if(this.detectService.has_callback){let u=this.detectService.callback_url,c=s.error?"ERROR":"SUCCESS";u=u.replace("<%status%>",c),u=u.replace("<%event%>",t),u=u.replace("<%uuid%>",this.detectService.sessionUUID??s.time??"");let l="INTERNAL_ERROR";if("ERROR"===c){let f={error:{error:s.error}};null!=f.error.error&&(l=f.error.error)}else l="SUCCESS";return u=u.replace("<%detail%>",l),void(window.location.href=u)}s.error?this.showError({error:{error:s.error}}):this.showSuccess(s,r)},error:s=>{if(this.detectService.has_callback){let u=this.detectService.callback_url;u=u.replace("<%status%>","ERROR"),u=u.replace("<%event%>",t),u=u.replace("<%uuid%>",this.detectService.sessionUUID??s.time??"");let l="INTERNAL_ERROR";return null!=s.error.code&&null!=s.error.error&&(l=s.error.error),u=u.replace("<%detail%>",l),void(window.location.href=u)}this.showError(s)}});this.subscriptions.push(a)}showSuccess(t,r){r?(this.confirm=!0,this.userName=t.first_name+" "+t.last_name):this.router.navigate(["../"],{queryParams:{event:"SUCCESS",detail:this.lastEvent}})}showError(t){console.log(t);let r="",o="DESCONOCIDO";try{null!=t.error.code?(o=t.error.code,null!=t.error.error&&(r=t.error.error)):o=t.error.error,t.detail.error.code&&(r=t.detail.error.error,o="CUSTOM")}catch{}this.router.navigate(["../"],{queryParams:{event:"ERROR",code:o,msg:r}})}showLoading(t){}confirmar(){this.sendEvent(this.lastEvent,!1,!0)}cancelar(){this.confirm=!1,this.lastPicture=!1,this.lastEvent=null,this.restart()}clearSubscriptions(){this.subscriptions.forEach(t=>{t?.unsubscribe()}),this.subscriptions=[]}}return n.\u0275fac=function(t){return new(t||n)(Q(ao),Q(yw),Q(s_),Q(xw),Q(jr),Q(Yg))},n.\u0275cmp=Vi({type:n,selectors:[["app-face"]],viewQuery:function(t,r){if(1&t&&(Wd(Zbe,5),Wd(Qbe,5)),2&t){let o;$l(o=ql())&&(r.canvasRef=o.first),$l(o=ql())&&(r.shot=o.first)}},hostBindings:function(t,r){1&t&&de("resize",function(i){return r.onResize(i)},0,ZA)},decls:1,vars:0,consts:[[4,"transloco"],[1,"header"],["alt","logo","src","/detectlite/assets/icono_color.webp",1,"logo"],["muted","","playsinline","",3,"autoplay"],["video",""],["canvas",""],[1,"picture"],["shot",""],[1,"controls"],["class","buttons",4,"ngIf"],["class","modalConfirm",4,"ngIf"],["class","countDown",4,"ngIf"],[1,"buttons"],[1,"button","enter",3,"click"],[1,"label"],[1,"middle"],[1,"modalConfirm"],["alt","","src","/detectlite/assets/icono_color.webp"],[1,"userName"],[1,"button","btn-confirm",3,"click"],[1,"button","btn-cancel",3,"click"],[1,"countDown"],["class","number",4,"ngIf"],[1,"number"]],template:function(t,r){1&t&&pn(0,oCe,13,4,"ng-container",0)},dependencies:[Kd,$v],styles:[".controls[_ngcontent-%COMP%]{position:fixed!important;z-index:9900!important;left:0;bottom:20px;display:inline-flex;align-content:center;align-items:center;justify-content:center;width:100%;overflow:hidden}.header[_ngcontent-%COMP%]{position:fixed;z-index:9999;top:0;left:0;width:100%;display:inline-flex;justify-content:flex-end;align-items:center;align-content:center;padding:10px}.header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-width:100px;min-width:100px;width:40%;margin-right:30px}video[_ngcontent-%COMP%]{position:fixed;text-align:center;inset:0;width:100%;height:100%;object-fit:cover}.canvas[_ngcontent-%COMP%]{position:fixed;text-align:center;inset:0;width:100%;height:100%}.buttons[_ngcontent-%COMP%]{display:inline-flex;justify-content:space-between;max-width:550px}.footer[_ngcontent-%COMP%]{z-index:1000}.label[_ngcontent-%COMP%]{font-size:25px;line-height:23px;color:#fff;white-space:break-spaces;width:60%;flex-wrap:wrap;margin-top:5px;font-weight:700;text-transform:uppercase}.button[_ngcontent-%COMP%]{cursor:pointer;width:350px;min-width:202px;aspect-ratio:25/6;background-size:cover;align-items:center;background-repeat:no-repeat;display:inline-flex}.button[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{align-items:center;align-content:center}.enter[_ngcontent-%COMP%]{justify-content:center;background-image:url(/detectlite/assets/boton_verde.webp);margin-right:5px}.enter[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{justify-content:center;text-align:center}.exit[_ngcontent-%COMP%]{background-image:url(/detectlite/assets/exit.webp);justify-content:left;margin-left:5px}.exit[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{justify-content:flex-end;text-align:end}@media only screen and (max-width: 600px){.label[_ngcontent-%COMP%]{font-size:20px}.button[_ngcontent-%COMP%]{width:200px}.enter[_ngcontent-%COMP%]{margin-left:10px}.exit[_ngcontent-%COMP%]{margin-right:10px}}@media only screen and (max-width: 541px){.label[_ngcontent-%COMP%]{font-size:20px}.buttons[_ngcontent-%COMP%]{min-width:80%}.button[_ngcontent-%COMP%]{width:200px}.enter[_ngcontent-%COMP%]{margin-left:5px}.exit[_ngcontent-%COMP%]{margin-right:5px}}@media only screen and (max-width: 420px){.label[_ngcontent-%COMP%]{font-size:20px}.buttons[_ngcontent-%COMP%]{min-width:90%}.button[_ngcontent-%COMP%]{width:50%;min-width:130px}.enter[_ngcontent-%COMP%]{margin-left:3px}.exit[_ngcontent-%COMP%]{margin-right:3px}}.modalConfirm[_ngcontent-%COMP%], .countDown[_ngcontent-%COMP%]{position:absolute;z-index:10000;top:0;left:0;width:100%;height:100%;background-color:#fff;display:inline-flex;justify-content:center;align-items:center;align-content:center;flex-direction:column;flex-wrap:nowrap;color:#000}.modalConfirm[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .countDown[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#662483;font-size:30px;font-weight:700;margin-bottom:10px}.modalConfirm[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .countDown[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#662483;font-size:20px;margin-bottom:10px}.modalConfirm[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .countDown[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin-bottom:10px}.modalConfirm[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .countDown[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:200px;width:30%}.btn-confirm[_ngcontent-%COMP%]{background-color:#008a95;justify-content:center;margin-right:5px;border-radius:20px}.userName[_ngcontent-%COMP%]{color:#662483;margin-top:30px;font-size:30px;font-weight:700;margin-bottom:90px}.btn-cancel[_ngcontent-%COMP%]{background-color:#852678;justify-content:center;margin-right:5px;border-radius:20px}.countDown[_ngcontent-%COMP%]{background-color:transparent}.countDown[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-size:28vh;font-weight:700;color:#ffffffb0;opacity:0;animation:_ngcontent-%COMP%_number-countdown .9s ease;animation-iteration-count:1}@keyframes _ngcontent-%COMP%_number-countdown{0%{transform:scale(.5);opacity:0}to{transform:scale(1.3);opacity:1}}"]}),n})(),E5=(()=>{class n{constructor(t){this.activatedRoute=t,this.activatedRoute.params.subscribe(r=>{this.deviceId=r.deviceId})}move(){window.location.href="/detectlite/"+(null==this.deviceId?"":"d/"+this.deviceId)}}return n.\u0275fac=function(t){return new(t||n)(Q(su))},n.\u0275cmp=Vi({type:n,selectors:[["app-screensaver"]],decls:8,vars:0,consts:[[1,"screen-container"],[1,"watermark-container"],["src","/detectlite/assets/icono.webp","alt","...",1,"watermark"],[1,"init"],["alt","logo","src","/detectlite/assets/logo_blanco.webp",1,"logo"],[1,"btn-container"],[1,"button-manual",3,"click"]],template:function(t,r){1&t&&(J(0,"div",0)(1,"div",1),sn(2,"img",2),ee(),J(3,"div",3),sn(4,"img",4),J(5,"div",5)(6,"div",6),de("click",function(){return r.move()}),ae(7," Iniciar "),ee()()()())},styles:[".init[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background:linear-gradient(rgb(102,36,131) .3%,30%,rgb(166,48,137) 100%)!important;z-index:9999;display:inline-flex;justify-content:flex-start;align-items:center;align-content:center;flex-direction:column;font-size:30px;overflow:hidden}.init[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{padding-top:20vh;max-width:400px;min-width:300px;width:50%;margin-bottom:10%}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;max-height:100%;width:100%;color:#fff;z-index:100}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;align-content:center;text-align:center}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px;margin:0 0 1px;font-weight:700}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-bottom:15px}.watermark-container[_ngcontent-%COMP%]{position:absolute;overflow:hidden;max-width:100%;max-height:100%;z-index:1;pointer-events:none}.watermark[_ngcontent-%COMP%]{position:relative;max-width:600px;filter:alpha(opacity=10);opacity:.1;left:-50%;margin-top:80%;transform:rotate(-20deg);z-index:1;pointer-events:none;overflow:hidden}.panel-input[_ngcontent-%COMP%]{display:inline-flex;min-width:350px;max-width:90%}.panel-input[_ngcontent-%COMP%]   .rut[_ngcontent-%COMP%]{width:100%;height:80px;border:0;text-align:center;border-bottom:3px solid white;background:transparent;font-size:50px;font-weight:700;padding:0 10px 30px;margin:0 10px}.panel-input[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{width:100%;height:80px;border:0;text-align:center;border-bottom:3px solid white;background:transparent;font-size:70px;font-weight:700;padding:0 10px 30px;margin:0 10px}.panel-input[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:active{outline:none}.button-manual[_ngcontent-%COMP%]{cursor:pointer;width:220px;min-width:200px;height:54px;font-size:22px;font-weight:600;margin-top:30px;background-size:cover;align-items:center;justify-content:center;background-repeat:no-repeat;display:inline-flex;text-transform:uppercase;color:#fff;background-image:url(/detectlite/assets/boton_verde.webp)}.screen-container[_ngcontent-%COMP%]{overflow:hidden;overflow-x:hidden}"]}),n})();function aCe(n,e){if(1&n&&(J(0,"option",13),ae(1),ee()),2&n){const t=e.$implicit;Qy("value",t.label),ke(1),xi(" ",t.label," ")}}function sCe(n,e){if(1&n&&(J(0,"pre"),ae(1),ee()),2&n){const t=ue();ke(1),xi("    ",t.log,"\n")}}function uCe(n,e){if(1&n&&(J(0,"pre"),ae(1,"\n            "),J(2,"span"),ae(3),function AT(n,e){const t=St();let r;const o=n+hn;t.firstCreatePass?(r=function YG(n,e){if(e)for(let t=e.length-1;t>=0;t--){const r=e[t];if(n===r.name)return r}}(e,t.pipeRegistry),t.data[o]=r,r.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(o,r.onDestroy)):r=t.data[o];const i=r.factory||(r.factory=Qu(r.type)),a=gi(Q);try{const s=lg(!1),u=i();return lg(s),function LH(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}(t,ne(),o,u),u}finally{gi(a)}}(4,"json"),ee(),ae(5,"\n    "),ee()),2&n){const t=e.$implicit;ke(3),xi("\n                ",IT(4,1,t),"\n\n            ")}}function cCe(n,e){if(1&n&&(J(0,"div"),pn(1,uCe,6,3,"pre",14),ee()),2&n){const t=ue();ke(1),At("ngForOf",t.cameras.reverse())}}const lCe=[{path:"",component:TP},{path:"d/:deviceId",component:TP},{path:"save",component:E5},{path:"save/:deviceId",component:E5},{path:"config",component:(()=>{class n{constructor(t,r,o){this.settings=t,this.router=r,this.formBuilder=o,this.deviceField=new gc,this.cameraForm=new gc,this.cameras=[],this.log="",this.scannerEnable=!0,this.showLog=!1,this.cameraLabel="",this.cameraListInput=[],this.deviceField.valueChanges.subscribe(i=>{(""==i||null==i)&&(i=null),this.deviceId=i,t.setDevice(i)}),this.cameraForm.valueChanges.subscribe(i=>{this.cameraLabel=i,this.selectCamera(i)})}ngOnDestroy(){this.scannerEnable=!1}ngOnInit(){this.deviceField.setValue(this.settings.getDevice()),this.loadCameras()}loadCameras(){this.log+="\n "+Date.now()+"LOADING CAMERAS\n",navigator.mediaDevices.enumerateDevices().then(t=>{this.camerasFoundHandler(t.filter(r=>"videoinput"==r.kind))})}camerasFoundHandler(t){this.cameraListInput=t.map(i=>({deviceId:i.deviceId,label:i.label})),this.log+="\n "+Date.now()+"CAMERA FOUND:"+t.length+"\n",this.cameras=t;let r=t.map(i=>i.label),o=this.settings.getCameraKey();if(""!=o)if(r.includes(o)){if(this.log+="\n "+Date.now()+"CAMERA SELECTED FROM MEMORY:"+o+"\n",null==this.currentCamera)return void this.cameraForm.setValue(o)}else this.settings.setCamera("");if(null==this.currentCamera){let i=this.cameras.filter(a=>a.label.toLowerCase().includes("front"));if(i.length>0)return void this.cameraForm.setValue(i[0].label);this.cameraForm.setValue(this.cameras[0].label)}}selectCamera(t){this.settings.setCamera(t),this.scannerEnable=!1,this.log+="\n "+Date.now()+"=============Buscando"+t+"=============\n",this.cameras.forEach(r=>{this.log+="\n "+Date.now()+"Check:"+r.label+" result"+r.label.includes(t)+"\n",r.label.includes(t)&&(this.log+="\n "+Date.now()+r.label+"****************MATCH***********\n",this.settings.setCamera(r.label),this.scannerEnable=!0,this.currentCamera=r)}),this.log+="\n ==========================\n"}GoTo(){window.location.href="/detectlite/"+(null==this.deviceId?"":"d/"+this.deviceId)}reset(){this.settings.reset()}}return n.\u0275fac=function(t){return new(t||n)(Q(_O),Q(jr),Q(PQ))},n.\u0275cmp=Vi({type:n,selectors:[["app-settings"]],decls:28,vars:5,consts:[[1,"header"],[1,"fields"],[1,"label"],[1,"label-text"],[1,"field"],["type","text",3,"formControl"],[1,"modern_select",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[1,"log"],[1,"btn",3,"click"],[4,"ngIf"],[1,"action"],[1,"button-manual",3,"click"],[3,"value"],[4,"ngFor","ngForOf"]],template:function(t,r){1&t&&(J(0,"div",0),ae(1," Configuraci\xf3n del dispositivo\n"),ee(),J(2,"div",1)(3,"div",2)(4,"span",3),ae(5,"Device Id"),ee()(),J(6,"div",4),sn(7,"input",5),ee()(),J(8,"div",1)(9,"div",2)(10,"span",3),ae(11,"Device Id"),ee()(),J(12,"div",4)(13,"select",6),pn(14,aCe,2,2,"option",7),ee(),J(15,"h3"),ae(16,"Vista previa QR"),ee()()(),J(17,"div",8)(18,"button",9),de("click",function(){return r.showLog=!r.showLog}),ae(19,"show log"),ee(),pn(20,sCe,2,1,"pre",10),pn(21,cCe,2,1,"div",10),ee(),J(22,"div",11)(23,"div",12),de("click",function(){return r.GoTo()}),ae(24,"Ir a Home"),ee()(),J(25,"div",11)(26,"div",12),de("click",function(){return r.reset()}),ae(27,"Borrar configuraci\xf3n "),ee()()),2&t&&(ke(7),At("formControl",r.deviceField),ke(6),At("formControl",r.cameraForm),ke(1),At("ngForOf",r.cameras),ke(6),At("ngIf",r.showLog),ke(1),At("ngIf",r.showLog))},dependencies:[XR,Kd,pM,vM,qv,o0,qO,b_,QR],styles:[".fields[_ngcontent-%COMP%]{margin-top:15px;display:inline-flex;width:100%;gap:10px;align-content:center;padding:0 10%}.fields[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:20px;min-width:100px}.fields[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .fields[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;height:30px;border-radius:5px;border:1px solid #cccccc;padding:0 10px;font-size:16px}.header[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:30px;margin:30px auto 15px;font-weight:700}.button-manual[_ngcontent-%COMP%]{cursor:pointer;width:220px;min-width:200px;height:49px;font-size:22px;font-weight:600;margin-top:30px;background-size:cover;align-items:center;justify-content:center;background-repeat:no-repeat;display:inline-flex;text-transform:uppercase;color:#fff;background-image:url(/detectlite/assets/boton_verde.webp)}.action[_ngcontent-%COMP%]{width:100%;text-align:center}"]}),n})()},{path:"face",component:iCe}];let fCe=(()=>{class n{constructor(t){this.http=t}getTranslation(t){return this.http.get(`/detectlite/assets/i18n/${t}.json?v=1`)}}return n.\u0275fac=function(t){return new(t||n)(me(wv))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),dCe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n}),n.\u0275inj=no({providers:[{provide:lf,useValue:mZ({availableLangs:["es","en","de"],defaultLang:"es",reRenderOnLangChange:!0,prodMode:!0})},{provide:aO,useClass:fCe}],imports:[wO]}),n})(),hCe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=bo({type:n,bootstrap:[XY]}),n.\u0275inj=no({imports:[Fq,dX,wO,HY.forRoot(lCe,{useHash:!1}),dCe,Bie,FQ]}),n})();kq().bootstrapModule(hCe).catch(n=>console.error(n))},100:ed=>{function td(Ze){return Ze&&Ze.constructor&&"function"==typeof Ze.constructor.isBuffer&&Ze.constructor.isBuffer(Ze)}function xo(Ze){return Ze}function ki(Ze,kn){const $s=(kn=kn||{}).delimiter||".",va=kn.maxDepth,gr=kn.transformKey||xo,qs={};return function al(ma,hi,Fi){Fi=Fi||1,Object.keys(ma).forEach(function(yn){const zt=ma[yn],jn=kn.safe&&Array.isArray(zt),wo=Object.prototype.toString.call(zt),_o=td(zt),Xs="[object Object]"===wo||"[object Array]"===wo,Wo=hi?hi+$s+gr(yn):gr(yn);if(!jn&&!_o&&Xs&&Object.keys(zt).length&&(!kn.maxDepth||Fi<va))return al(zt,Wo,Fi+1);qs[Wo]=zt})}(Ze),qs}ed.exports=ki,ki.flatten=ki,ki.unflatten=function il(Ze,kn){const $s=(kn=kn||{}).delimiter||".",va=kn.overwrite||!1,gr=kn.transformKey||xo,qs={};if(td(Ze)||"[object Object]"!==Object.prototype.toString.call(Ze))return Ze;function ma(yn){const zt=Number(yn);return isNaN(zt)||-1!==yn.indexOf(".")||kn.object?yn:zt}return Ze=Object.keys(Ze).reduce(function(yn,zt){const jn=Object.prototype.toString.call(Ze[zt]);return"[object Object]"!==jn&&"[object Array]"!==jn||function Fi(yn){const zt=Object.prototype.toString.call(yn);return!yn||("[object Array]"===zt?!yn.length:"[object Object]"===zt?!Object.keys(yn).length:void 0)}(Ze[zt])?(yn[zt]=Ze[zt],yn):function hi(yn,zt,jn){return Object.keys(jn).reduce(function(wo,_o){return wo[yn+$s+_o]=jn[_o],wo},zt)}(zt,yn,ki(Ze[zt],kn))},{}),Object.keys(Ze).forEach(function(yn){const zt=yn.split($s).map(gr);let jn=ma(zt.shift()),wo=ma(zt[0]),_o=qs;for(;void 0!==wo;){if("__proto__"===jn)return;const Xs=Object.prototype.toString.call(_o[jn]),Wo="[object Object]"===Xs||"[object Array]"===Xs;if(!va&&!Wo&&typeof _o[jn]<"u")return;(va&&!Wo||!va&&null==_o[jn])&&(_o[jn]="number"!=typeof wo||kn.object?{}:[]),_o=_o[jn],zt.length>0&&(jn=ma(zt.shift()),wo=ma(zt[0]))}_o[jn]=il(Ze[yn],kn)}),qs}},902:()=>{},522:()=>{},753:()=>{},954:()=>{}},ed=>{ed(ed.s=416)}]);